/** * @file FlightPlansController.js * @author Matej Pončák <matej.poncak@r-sys.sk> * @date 18.01.2018 * @brief Kontroler pre pracu s panelom "Flight Plans" a update spravami * existujucich planov *  * (C) Copyright 2018  R-SYS,s.r.o */function FlightPlansController(){this._fplUpdateForm=null;this._thisInstance=this;this.menuAction=function(){var flightPlansMenuFnc=FlightPlansController.createFlightPlansButtonClickAction(AppController.controlPanel,null);flightPlansMenuFnc();};this.createShowDlaFormAction=function(aFplModel){var parentInstance=this._thisInstance;return function(aElement){parentInstance.showDlaForm(aFplModel);};};this.createShowChgFormAction=function(aFplId){var parentInstance=this._thisInstance;return function(aElement){parentInstance.showChgForm(aFplId);};};this.createShowCnlFormAction=function(aFplId){var parentInstance=this._thisInstance;return function(aElement){parentInstance.showCnlForm(aFplId);};};this.createShowArrFormAction=function(aFplObject){var parentInstance=this._thisInstance;return function(aElement){parentInstance.showArrForm(aFplObject);};};this.createShowDepFormAction=function(aFplId){var parentInstance=this._thisInstance;return function(aElement){parentInstance.showDepForm(aFplId);};};this.createShowAsNewAction=function(aFplObject){var parentInstance=this._thisInstance;return function(){parentInstance.showFplForm(aFplObject);};};this.createReverseRouteAction=function(aFplObject){var parentInstance=this._thisInstance;return function(){var clonedFplObject=AWUtils.cloneObject(aFplObject);var tmpVal=null;tmpVal=clonedFplObject.ADEP;clonedFplObject.ADEP=clonedFplObject.ADES;clonedFplObject.ADES=tmpVal;tmpVal=null;if(HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(clonedFplObject.ADAltn1)===false&&HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(clonedFplObject.ADAltn2)===false){tmpVal=clonedFplObject.ADAltn1;clonedFplObject.ADAltn1=clonedFplObject.ADAltn2;clonedFplObject.ADAltn2=tmpVal;tmpVal=null;}if(HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(clonedFplObject.FlOther)===false){clonedFplObject.FlOther=clonedFplObject.FlOther.replace("DEP/","d_e_p/");clonedFplObject.FlOther=clonedFplObject.FlOther.replace("DEST/","DEP/");clonedFplObject.FlOther=clonedFplObject.FlOther.replace("d_e_p/","DEST/");if(getConfigValue2('fplForm','translateRoutePointsNamesToCoordinates',false)===true){clonedFplObject.FlOther=parentInstance.reverseRouteInRmk(clonedFplObject.FlOther);}}if(HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(clonedFplObject.FlRoute)===false){var separator=" ";var wayPoints=clonedFplObject.FlRoute.split(separator);var revArr=wayPoints.reverse();var ruleIdx;if(clonedFplObject.FR==="Y"&&(ruleIdx=wayPoints.indexOf("VFR"))>0){revArr[ruleIdx]="IFR";clonedFplObject.FR="VFR";}else if(clonedFplObject.FR==="Z"&&(ruleIdx=wayPoints.indexOf("IFR"))>0){revArr[ruleIdx]="VFR";clonedFplObject.FR="IFR";}clonedFplObject.FlRoute=revArr.join(separator);}var localisedQuestion=getLocalizedString('FlightPlansTable.DoYouWantToSubtractEETFromTheOriginalEnduranceAndUseTheResultAsANewEnduranceValue?');JQMUtil.showOptionMsg(localisedQuestion,[JQMUtil.yesOption,JQMUtil.noOption],function(optionId){if(optionId===JQMUtil.yesOption.id){var enduranceHHMM=FlightPlansController.parseSuplementaryValue(clonedFplObject.FlSuplementary,'E');var enduranceMinutes=convertHHMM2Minutes(enduranceHHMM);var eetMinutes=convertHHMM2Minutes(clonedFplObject.EET);var newEnduranceMinutes=parseInt(enduranceMinutes)-parseInt(eetMinutes);if(newEnduranceMinutes<0){newEnduranceMinutes=0;}var newEnduranceHHMM=convertMinutesToHHMM(newEnduranceMinutes);clonedFplObject.FlSuplementary=clonedFplObject.FlSuplementary.replace(/E\/[0-9][0-9][0-9][0-9]/g,"E/"+zeroPad(newEnduranceHHMM,4));}parentInstance.showFplForm(clonedFplObject);});};};this.reverseRouteInRmk=function(aFplOtherValue){if(AWUtils.isUndefinedOrIsNullOrIsEmptyString(aFplOtherValue)===true){return aFplOtherValue;}var afterRmkPart=aFplOtherValue;if(afterRmkPart.includes('ROUTE ')===false){return aFplOtherValue;}var splitedByRoute=afterRmkPart.split('ROUTE ');var beforeRoutePart=splitedByRoute.shift();var afterRoutePart=splitedByRoute.join('ROUTE ');var routeItems=[];var afterRouteNextelementPart='';if(afterRoutePart.includes('/')===true){var splitedBySlash=afterRoutePart.split('/');var beforeSlash=splitedBySlash.shift();afterRouteNextelementPart='/'+splitedBySlash.join('/');routeItems=beforeSlash.trim().split(' ');var removedNameOfNextElement=routeItems.pop();afterRouteNextelementPart=removedNameOfNextElement+afterRouteNextelementPart;}else{routeItems=afterRoutePart.trim().split(' ');}var reversedRouteItems=routeItems.reverse();var reversedRouteString=reversedRouteItems.join(' ');var retVal=beforeRoutePart+'ROUTE '+reversedRouteString+' '+afterRouteNextelementPart;retVal=AWUtils.removeDoubleSpaces(retVal);return retVal;};this.createDeleteAction=function(aFplObjectID){return function(){JQMUtil.showOptionMsg(getLocalizedString("FlightPlansTable.DoYouWantToDeleteFpl"),[JQMUtil.yesOption,JQMUtil.noOption],function(optionId){if(optionId===JQMUtil.yesOption.id){setFlDeleted(aFplObjectID,function(){FlightPlansController.reloadActualData();FlightPlansController.reloadArchiveData();},function(){JQMUtil.showInfoMsg(getLocalizedString('FlightPlansTable.errorWhileDeletingFPL'),true,false,function(){});});}});};};this.showDlaForm=function(aFplModel){var formToShow=this.getDlaFlightPlanUpdateForm(aFplModel);this.showFplUpdateForm("dlaFplPanel","DELAY (DLA)",formToShow);};this.showChgForm=function(aFplId){var formToShow=this.getChgFlightPlanUpdateForm(aFplId);this.showFplUpdateForm("chgFplPanel","CHANGE (CHG)",formToShow);};this.showCnlForm=function(aFplModel){var formToShow=this.getCnlFlightPlanUpdateForm(aFplModel);this.showFplUpdateForm("cnlFplPanel","CANCEL (CNL)",formToShow);};this.showArrForm=function(aFplModel){var clonedFplModel=AWUtils.cloneObject(aFplModel);clonedFplModel.ADAltn1=HtmlUtils.C_EMPTY;clonedFplModel.EET=HtmlUtils.C_EMPTY;var formToShow=this.getArrFlightPlanUpdateForm(clonedFplModel);this.showFplUpdateForm("arrFplPanel","ARRIVAL (ARR)",formToShow);};this.showDepForm=function(aFplId){var formToShow=this.getDepFlightPlanUpdateForm(aFplId);this.showFplUpdateForm("depFplPanel","DEPARTURE (DEP)",formToShow);};this.showFplForm=function(aFpObject){const flightLog=FlightPlansController.convertFlightPlanModelToFlightLog(aFpObject);AppController.bundleController.getBundle('fplform',function(bundle){if(bundle){bundle.getFlightPlansValidatorCtrl().showValidationForm(flightLog);}else{JQMUtil.showInfoMsg(getLocalizedString("Messages.moduleLoadingError"),true,true);}});};this.showFplUpdateForm=function(aPanelID,aPanelTitle,aFormObject){aFormObject.addClass('fpl_update_form');var winMan=AppController.controlPanel.getWindowManager();var fplUpdateFormToShow=winMan.createForm(aPanelID,aPanelTitle,aFormObject);this._openedForm=fplUpdateFormToShow;fplUpdateFormToShow.fitHeightToPage();winMan.showForm(fplUpdateFormToShow,AwWinMan.AREA.CENTER,false);};this.closeOpenedForm=function(){this._openedForm.hide();};this._dlaForm=null;this.getDlaFlightPlanUpdateForm=function(aFplModel){if(this._dlaForm===null){this._dlaForm=this.createDlaForm();}this._dlaForm.setFlightPlan(aFplModel);return this._dlaForm.createUpdateForm();};this.createDlaForm=function(){var dlaForm=new FlightPlanUpdateForm();dlaForm.setTitle("DLA");var viewOnlyValues={};viewOnlyValues[FPLFormModel.AV_X7]='ARCID';viewOnlyValues[FPLFormModel.AV_X13A]='ADEP';viewOnlyValues[FPLFormModel.AV_X16A]='ADES';viewOnlyValues[FPLFormModel.AV_X18_DOF]='EOBD';dlaForm.setViewonlyAttributes(viewOnlyValues);var editableValues={};editableValues[FPLFormModel.AV_X13B]='*EOBT';dlaForm.setEditableAttributes(editableValues);var inputRestr={};inputRestr[FPLFormModel.AV_X13B]=HtmlUtils.IRR_HHMM_MAX2359;dlaForm.setInputRestrictionsWhileTypping(inputRestr);dlaForm.setOrderOfAttributes([FPLFormModel.AV_X7,FPLFormModel.AV_X13A,FPLFormModel.AV_X13B,FPLFormModel.AV_X16A,FPLFormModel.AV_X18_DOF]);var parentInstance=this._thisInstance;dlaForm.setSendMessageAction(function(){if(dlaForm.isEobdtBeforeThanActual()===true){JQMUtil.showInfoMsg(getLocalizedString('FlightPlanUpdateForm.dlaNotPossible...refileTheFlightPlan'),true,false,function(){});return;}var messagePrev=dlaForm.getChangeMessagePreview();FlightPlansController.showYesNoOption(getLocalizedString('FlightPlanUpdateForm.DoYouReallyWantToSendDLAMessage')+'</br>'+messagePrev,function(){var fplId=dlaForm.getFplId();var eobtVal=dlaForm.getFormEobtVal();var errCallbackFnc=dlaForm.getErrorCallBackFnc();var okCallBackFnc=FlightPlansController.createAfterUpdateCallbackOkFnc(parentInstance);sendDLA(fplId,eobtVal,okCallBackFnc,errCallbackFnc);});});return dlaForm;};this._chgForm=null;this.getChgFlightPlanUpdateForm=function(aFplModel){if(this._chgForm===null){this._chgForm=this.createChgForm();this._chgForm.setMandatoryLabelVisible(false);}this._chgForm.setFlightPlan(aFplModel);return this._chgForm.createUpdateForm();};this.createChgForm=function(){var chgForm=new FlightPlanUpdateForm();chgForm.setTitle("CHG");var editableValues={};editableValues[FPLFormModel.AV_X8A]='FLIGHT RULES';editableValues[FPLFormModel.AV_X8B]='TYPE OF FLIGHT';editableValues[FPLFormModel.AV_X9A]='NUM';editableValues[FPLFormModel.AV_X9B]='AIRCRAFT TYPE';editableValues[FPLFormModel.AV_X9C]='WAKE TURBULENCE';editableValues[FPLFormModel.AV_X10A]='EQUIPMENT';editableValues[FPLFormModel.AV_X10B]='SURVEILLANCE CAPABILITIES';editableValues[FPLFormModel.AV_X13B]='EOBT';editableValues[FPLFormModel.AV_X15B]='SPEED';editableValues[FPLFormModel.AV_X15D]='LEVEL';editableValues[FPLFormModel.AV_X15E]='ROUTE';editableValues[FPLFormModel.AV_X16B]='TEET';editableValues[FPLFormModel.AV_X16C]='ALTN';editableValues[FPLFormModel.AV_X16D]='ALTN 2nd';editableValues[FPLFormModel.AV_X18]='OTHER INFORMATION';editableValues[FPLFormModel.AV_X19A]='ENDURANCE';editableValues[FPLFormModel.AV_X19B]='PERSONS ON BOARD';editableValues[FPLFormModel.AV_X19C]='EM.RADIO';editableValues[FPLFormModel.AV_X19D]='SURVIVAL EQP.';editableValues[FPLFormModel.AV_X19E]='JACKETS';editableValues[FPLFormModel.AV_X19F_CHECKBOX]='DINGHIES';editableValues[FPLFormModel.AV_X19I]='AIRCRAFT COLOUR AND MARKINGS';editableValues[FPLFormModel.AV_X19N]='REMARKS';editableValues[FPLFormModel.AV_X19K]='PILOT IN COMMAND';var parentInstance=this._thisInstance;var rowTitleAttrs={class:"fpl_chg_rowtitle"};var dashTdAttrs={class:"fpl_chg_dash"};var eetLabelText='TEET';var use16aEET=getConfigValue2("changeForm","use16aEET",false);if(use16aEET===true){eetLabelText='EET';}var chgTableGuiElements={rows:{row1:[new FPLUpdateGUIElement(null,GUIType.TEXT,null,'(CHG',null,null,rowTitleAttrs),new FPLUpdateGUIElement(FPLFormModel.AV_X7,GUIType.LABEL_TEXT,null,null,'ARCID',null,null,HtmlUtils.IRR_AIRCRAFT_ID),new FPLUpdateGUIElement(null,GUIType.TEXT,null,' - ',null,null,dashTdAttrs),new FPLUpdateGUIElement(FPLFormModel.AV_X13A,GUIType.LABEL_TEXT,null,null,'ADEP'),new FPLUpdateGUIElement(null,GUIType.TEXT,null,' - ',null,null,dashTdAttrs),new FPLUpdateGUIElement(FPLFormModel.AV_X13B,GUIType.LABEL_TEXT,null,null,'EOBT'),new FPLUpdateGUIElement(null,GUIType.TEXT,null,' - ',null,null,dashTdAttrs),new FPLUpdateGUIElement(FPLFormModel.AV_X16A,GUIType.LABEL_TEXT,null,null,'ADES'),new FPLUpdateGUIElement(null,GUIType.TEXT,null,' - ',null,null,dashTdAttrs),new FPLUpdateGUIElement(FPLFormModel.AV_X18_DOF,GUIType.LABEL_TEXT,null,null,'EOBD')],row2:[new FPLUpdateGUIElement(null,GUIType.TEXT,null,'8/',null,null,rowTitleAttrs),new FPLUpdateGUIElement(FPLFormModel.AV_X8A,GUIType.LABEL_TEXTINPUT,null,null,'FLIGHT RULES',null,null,HtmlUtils.IRR_FLIGHT_RULES),new FPLUpdateGUIElement(null,GUIType.TEXT,null,' - ',null,null,dashTdAttrs),new FPLUpdateGUIElement(FPLFormModel.AV_X8B,GUIType.LABEL_TEXTINPUT,null,null,'TYPE OF FLIGHT',null,null,HtmlUtils.IRR_TYPE_OF_FLIGHT)],row3:[new FPLUpdateGUIElement(null,GUIType.TEXT,null,'9/',null,null,rowTitleAttrs),new FPLUpdateGUIElement(FPLFormModel.AV_X9A,GUIType.LABEL_TEXTINPUT,null,null,'NUM',null,null,HtmlUtils.IRR_NUMBER_OF_AIRCRAFT),new FPLUpdateGUIElement(null,GUIType.TEXT,null,' - ',null,null,dashTdAttrs),new FPLUpdateGUIElement(FPLFormModel.AV_X9B,GUIType.LABEL_TEXTINPUT,null,null,'AIRCRAFT TYPE',null,null,HtmlUtils.IRR_TYPE_OF_AIRCRAFT),new FPLUpdateGUIElement(null,GUIType.TEXT,null,' - ',null,null,dashTdAttrs),new FPLUpdateGUIElement(FPLFormModel.AV_X9C,GUIType.LABEL_TEXTINPUT,null,null,'WAKE TURBULENCE',null,null,HtmlUtils.IRR_WAKE_TURBULENCE)],row4:[new FPLUpdateGUIElement(null,GUIType.TEXT,null,'10/',null,null,rowTitleAttrs),new FPLUpdateGUIElement(FPLFormModel.AV_X10A,GUIType.LABEL_TEXTINPUT,null,null,'EQUIPMENT',null,null,HtmlUtils.IRR_EQUIPMENT),new FPLUpdateGUIElement(null,GUIType.TEXT,null,' - ',null,null,dashTdAttrs),new FPLUpdateGUIElement(FPLFormModel.AV_X10B,GUIType.LABEL_TEXTINPUT,null,null,'SURVEILLANCE CAPABILITIES',null,null,HtmlUtils.IRR_SURVEILLANCE)],row5:[new FPLUpdateGUIElement(null,GUIType.TEXT,null,'13/',null,null,rowTitleAttrs),new FPLUpdateGUIElement(FPLFormModel.AV_X13A,GUIType.LABEL_TEXT,null,null,'ADEP'),new FPLUpdateGUIElement(null,GUIType.TEXT,null,' - ',null,null,dashTdAttrs),new FPLUpdateGUIElement(FPLFormModel.AV_X13B,GUIType.LABEL_TEXTINPUT,null,null,'EOBT',null,null,HtmlUtils.IRR_HHMM_MAX2359)],row6:[new FPLUpdateGUIElement(null,GUIType.TEXT,null,'15/',null,null,rowTitleAttrs),new FPLUpdateGUIElement(FPLFormModel.AV_X15B,GUIType.LABEL_TEXTINPUT,null,null,'SPEED',null,null,HtmlUtils.IRR_CRUISINGSPEED),new FPLUpdateGUIElement(null,GUIType.TEXT,null,' - ',null,null,dashTdAttrs),new FPLUpdateGUIElement(FPLFormModel.AV_X15D,GUIType.LABEL_TEXTINPUT,null,null,'LEVEL',null,null,HtmlUtils.IRR_CRUISING_LEVEL),new FPLUpdateGUIElement(null,GUIType.TEXT,null,' - ',null,null,dashTdAttrs),new FPLUpdateGUIElement(FPLFormModel.AV_X15E,GUIType.TEXT_AREA,null,null,'ROUTE',null,null,FPLFormModel.TEXTARREA_ROUTE_ALLOWED_CHARS)],row7:[new FPLUpdateGUIElement(null,GUIType.TEXT,null,'16/',null,null,rowTitleAttrs),new FPLUpdateGUIElement(FPLFormModel.AV_X16A,GUIType.LABEL_TEXT,null,null,'ADES'),new FPLUpdateGUIElement(null,GUIType.TEXT,null,' - ',null,null,dashTdAttrs),new FPLUpdateGUIElement(FPLFormModel.AV_X16B,GUIType.LABEL_TEXTINPUT,null,null,eetLabelText,null,null,HtmlUtils.IRR_HHMM_MAX2359),new FPLUpdateGUIElement(null,GUIType.TEXT,null,' - ',null,null,dashTdAttrs),new FPLUpdateGUIElement(FPLFormModel.AV_X16C,GUIType.LABEL_TEXTINPUT,null,null,'ALTN',true,null,HtmlUtils.IRR_AERODROME_ICAO),new FPLUpdateGUIElement(null,GUIType.TEXT,null,' - ',null,null,dashTdAttrs),new FPLUpdateGUIElement(FPLFormModel.AV_X16D,GUIType.LABEL_TEXTINPUT,null,null,'ALTN 2nd',true,null,HtmlUtils.IRR_AERODROME_ICAO)],row8:[new FPLUpdateGUIElement(null,GUIType.TEXT,null,'18/',null,null,rowTitleAttrs),new FPLUpdateGUIElement(FPLFormModel.AV_X18,GUIType.TEXT_AREA,null,null,'OTHER INFORMATION',null,null,HtmlUtils.getOtherInputRestrictionRegexp())],row9:[new FPLUpdateGUIElement(null,GUIType.TEXT,null,'19/',null,null,rowTitleAttrs),new FPLUpdateGUIElement(FPLFormModel.AV_X19A,GUIType.LABEL_TEXTINPUT,null,null,'ENDURANCE',null,null,HtmlUtils.IRR_HHMM_MAX9959),new FPLUpdateGUIElement(null,GUIType.TEXT,null,' - ',null,null,dashTdAttrs),new FPLUpdateGUIElement(FPLFormModel.AV_X19B,GUIType.LABEL_TEXTINPUT,null,null,'PERSONS ON BOARD',null,null,HtmlUtils.IRR_POB),new FPLUpdateGUIElement(null,GUIType.TEXT,null,' - ',null,null,dashTdAttrs),new FPLUpdateGUIElement(FPLFormModel.AV_X19C,GUIType.LABEL_TEXTINPUT,null,null,'EM.RADIO',true,null,HtmlUtils.IRR_EM_RADIO),new FPLUpdateGUIElement(null,GUIType.TEXT,null,' - ',null,null,dashTdAttrs),new FPLUpdateGUIElement(FPLFormModel.AV_X19D,GUIType.LABEL_TEXTINPUT,null,null,'SURVIVAL EQP.',true,null,HtmlUtils.IRR_SURV_EQUIPMENT),new FPLUpdateGUIElement(null,GUIType.TEXT,null,' - ',null,null,dashTdAttrs),new FPLUpdateGUIElement(FPLFormModel.AV_X19E,GUIType.LABEL_TEXTINPUT,null,null,'JACKETS',true,null,HtmlUtils.IRR_JACKETS)],row10:[new FPLUpdateGUIElement(null,GUIType.TEXT,null,'',null,null,rowTitleAttrs),new FPLUpdateGUIElement(FPLFormModel.AV_X19F_CHECKBOX,GUIType.LABEL_TEXTINPUT,null,null,'DINGHIES',true,null,HtmlUtils.IRR_ALPHANUMERIC_SPACE),new FPLUpdateGUIElement(null,GUIType.TEXT,null,' - ',null,null,dashTdAttrs),new FPLUpdateGUIElement(FPLFormModel.AV_X19I,GUIType.LABEL_TEXTINPUT,null,null,'AIRCRAFT COLOUR AND MARKINGS',null,null,HtmlUtils.IRR_COLOUR_MARKS_INPUT)],row11:[new FPLUpdateGUIElement(null,GUIType.TEXT,null,'',null,null,rowTitleAttrs),new FPLUpdateGUIElement(FPLFormModel.AV_X19N,GUIType.LABEL_TEXTINPUT,null,null,'REMARKS',null,null,HtmlUtils.IRR_ALPHANUMERIC_SPACE),new FPLUpdateGUIElement(null,GUIType.TEXT,null,' - ',null,null,dashTdAttrs),new FPLUpdateGUIElement(FPLFormModel.AV_X19K,GUIType.LABEL_TEXTINPUT,null,null,'PILOT IN COMMAND',null,null,HtmlUtils.IRR_ALPHANUMERIC_SPACE),new FPLUpdateGUIElement(null,GUIType.TEXT,null,')')]}};chgForm.setTableGUIElements(chgTableGuiElements);var self=this;chgForm.setSendMessageAction(function(){var fplParams=parentInstance.getCHGParamsData(chgForm);if(self.chgFormLocalValidation(chgForm,fplParams)){var deletedAttributes=parentInstance.getDeletedUndeletableParams(chgForm);if(deletedAttributes.length>0){parentInstance.showDeletedUndeletableAttributesMsg(deletedAttributes);return;}var isDeletedALTNAerodromes=parentInstance.isDeletedOneALTNAerodrome(fplParams);if(isDeletedALTNAerodromes===true){JQMUtil.showInfoMsg(getLocalizedString("FlightPlanUpdateForm.ItIsNotPossibleToRemove...refileTheFlightPlan"),true,false,function(){});return;}var messagePrev=chgForm.getChangeMessagePreview();FlightPlansController.showYesNoOption(getLocalizedString('FlightPlanUpdateForm.DoYouRealyWantToSendCHGMessage')+'<br/>'+messagePrev,function(){var fplId=chgForm.getFplId();var errCallbackFnc=chgForm.getErrorCallBackFnc();var fplParams=parentInstance.getCHGParamsData(chgForm);var okCallBackFnc=FlightPlansController.createAfterUpdateCallbackOkFnc(parentInstance);sendCHG(fplId,fplParams,okCallBackFnc,errCallbackFnc);});}});return chgForm;};this.chgFormLocalValidation=function(chgForm,fplParams){if(Object.keys(fplParams).length==0){JQMUtil.showInfoMsg(getLocalizedString("FlightPlanUpdateForm.ItIsNotAllowedToSendUnchangedCHGForm"),true,false,function(){});return false;}if((HtmlUtils.C_EMPTY+chgForm.getFormTotalEETVal()).length<4){JQMUtil.showInfoMsg(getLocalizedString("FlightPlanUpdateForm.F16 TOTAL EET")+": "+chgForm.getFormTotalEETVal(),true,false,function(){});return false;}return true;};this.isDeletedOneALTNAerodrome=function(aFplParams){var isDeletedAltn1=this.isEmptyParamValue('ADAltn1',aFplParams);var isDeletedAltn2=this.isEmptyParamValue('ADAltn2',aFplParams);if(isDeletedAltn1===true||isDeletedAltn2===true){return true;}else{return false;}};this.isEmptyParamValue=function(aParamKey,aFplParams){if((aParamKey in aFplParams)===false){return false;}var altnVal=aFplParams[aParamKey];return AWUtils.isEmptyString(altnVal);};this.showDeletedUndeletableAttributesMsg=function(aAttributes){var glue=HtmlUtils.C_SEMICOLON+HtmlUtils.C_SPACE_CHAR;var uniqueValueArray=HtmlUtils.arrayRemoveDuplicateValues(aAttributes);var canNotDeleteMandatoryFieldMsg=getLocalizedString('FlightPlanUpdateForm.YouCanNotDeleteMandatoryFieldS');JQMUtil.showInfoMsg(canNotDeleteMandatoryFieldMsg+uniqueValueArray.join(glue),true,false);};this.getDeletedUndeletableParams=function(aChgForm){var deletedUndeletableAttributes=aChgForm.getDeletedUndeletableAttributes();return aChgForm.getAttributeLabels(deletedUndeletableAttributes);};this.getCHGParamsData=function(aChgForm){return this.getCHGParamsDataChanged(aChgForm);};this.getCHGParamsDataAll=function(aChgForm){var fplParams={};fplParams['FlRules']=aChgForm.getFormFlRulesVal();fplParams['FlType']=aChgForm.getFormFlTypeVal();fplParams['ArcNum']=aChgForm.getFormArcNumVal();fplParams['ArcType']=aChgForm.getFormArcTypeVal();fplParams['WakeTurbulenceCat']=aChgForm.getFormWakeTurbulenceCatVal();fplParams['Equipment']=aChgForm.getFormEquipmentVal();fplParams['FlSpeed']=aChgForm.getFormFlSpeedVal();fplParams['FlLevel']=aChgForm.getFormFlLevelVal();fplParams['FlRoute']=aChgForm.getFormFlRouteVal();aChgForm.setFormFlRouteVal(HtmlUtils.toUpperCase(AWUtils.cutAllWordsToMaxlength(fplParams['FlRoute'],11)));fplParams['ADAltn1']=aChgForm.getFormADAltn1Val();fplParams['ADAltn2']=aChgForm.getFormADAltn2Val();var totalEETMinutes=AWUtils.convertHHMM2Minutes(aChgForm.getFormTotalEETVal());fplParams['TotalEET']=totalEETMinutes;fplParams['FlOther']=aChgForm.getFormFlOtherVal();fplParams['FlSuplementary']=aChgForm.getFormFlSuplementaryVal();return fplParams;};this.getCHGParamsDataChanged=function(aChgForm){var flightPlan=aChgForm.getFlightPlan();var fplParams={};if(aChgForm.getFormFlRulesVal()!==flightPlan.FR){fplParams['FlRules']=aChgForm.getFormFlRulesVal();}if(aChgForm.getFormFlTypeVal()!==flightPlan.FlType){fplParams['FlType']=aChgForm.getFormFlTypeVal();}if(aChgForm.getFormArcNumVal()!==flightPlan.ArcNum){fplParams['ArcNum']=aChgForm.getFormArcNumVal();}if(aChgForm.getFormArcTypeVal()!==flightPlan.ATYP){fplParams['ArcType']=aChgForm.getFormArcTypeVal();}if(aChgForm.getFormWakeTurbulenceCatVal()!==flightPlan.WakeTurbulenceCat){fplParams['WakeTurbulenceCat']=aChgForm.getFormWakeTurbulenceCatVal();}if(aChgForm.getFormEquipmentVal()!==aChgForm.getFormEquipmentValFromObject(flightPlan)){fplParams['Equipment']=aChgForm.getFormEquipmentVal();}if(aChgForm.getFormEobtVal()!==aChgForm.parseTimeFromEODB()){fplParams['EobtVal']=aChgForm.getFormEobtVal();}if(aChgForm.getFormFlSpeedVal()!==flightPlan.FlSpeed){fplParams['FlSpeed']=aChgForm.getFormFlSpeedVal();}if(aChgForm.getFormFlLevelVal()!==flightPlan.FlLevel){fplParams['FlLevel']=aChgForm.getFormFlLevelVal();}if(AWUtils.cleanStr(aChgForm.getFormFlRouteVal())!==AWUtils.cleanStr(flightPlan.FlRoute)){fplParams['FlRoute']=aChgForm.getFormFlRouteVal();aChgForm.setFormFlRouteVal(HtmlUtils.toUpperCase(AWUtils.cutAllWordsToMaxlength(fplParams['FlRoute'],11)));}if(aChgForm.getFormADAltn1Val()!==flightPlan.ADAltn1){fplParams['ADAltn1']=aChgForm.getFormADAltn1Val();}if(aChgForm.getFormADAltn2Val()!==flightPlan.ADAltn2){fplParams['ADAltn2']=aChgForm.getFormADAltn2Val();}if(aChgForm.getFormTotalEETVal()!==aChgForm.getFormTotalEETValFromObject(flightPlan)){var totalEETMinutes=AWUtils.convertHHMM2Minutes(aChgForm.getFormTotalEETVal());fplParams['TotalEET']=totalEETMinutes;}if(AWUtils.cleanStr(aChgForm.getFormFlOtherVal())!==AWUtils.cleanStr(flightPlan.FlOther)){fplParams['FlOther']=aChgForm.getFormFlOtherVal();}if(AWUtils.cleanStr(aChgForm.getFormFlSuplementaryVal())!==AWUtils.cleanStr(aChgForm.getFormFlSuplementaryValFromObject(flightPlan))){fplParams['FlSuplementary']=aChgForm.getFormFlSuplementaryVal();}return fplParams;};this._cnlForm=null;this.getCnlFlightPlanUpdateForm=function(aFplModel){if(this._cnlForm===null){this._cnlForm=this.createCnlForm();this._cnlForm.setMandatoryLabelVisible(false);}this._cnlForm.setFlightPlan(aFplModel);return this._cnlForm.createUpdateForm();};this.createCnlForm=function(){var cnlForm=new FlightPlanUpdateForm();cnlForm.setTitle("CNL");var viewOnlyValues={};viewOnlyValues[FPLFormModel.AV_X7]='ARCID';viewOnlyValues[FPLFormModel.AV_X13A]='ADEP';viewOnlyValues[FPLFormModel.AV_X13B]='EOBT';viewOnlyValues[FPLFormModel.AV_X16A]='ADES';viewOnlyValues[FPLFormModel.AV_X18_DOF]='DOF';cnlForm.setViewonlyAttributes(viewOnlyValues);cnlForm.setOrderOfAttributes([FPLFormModel.AV_X7,FPLFormModel.AV_X13A,FPLFormModel.AV_X13B,FPLFormModel.AV_X16A,FPLFormModel.AV_X18_DOF]);var parentInstance=this._thisInstance;cnlForm.setSendMessageAction(function(){var messagePrev=cnlForm.getChangeMessagePreview();FlightPlansController.showYesNoOption(getLocalizedString('FlightPlanUpdateForm.DoYouReallyWantToSendCNLMessage')+'<br/>'+messagePrev,function(){var fplId=cnlForm.getFplId();var errCallbackFnc=cnlForm.getErrorCallBackFnc();var okCallBackFnc=FlightPlansController.createAfterUpdateCallbackOkFnc(parentInstance);sendCNL(fplId,okCallBackFnc,errCallbackFnc);});});return cnlForm;};this._arrForm=null;this.getArrFlightPlanUpdateForm=function(aFplModel){if(this._arrForm===null){this._arrForm=this.createArrForm();}this._arrForm.setFlightPlan(aFplModel);return this._arrForm.createUpdateForm();};this.createArrForm=function(){var arrForm=new FlightPlanUpdateForm();arrForm.setTitle("ARR");var viewOnlyValues={};viewOnlyValues[FPLFormModel.AV_X7]='ARCID';viewOnlyValues[FPLFormModel.AV_X13A]='ADEP';viewOnlyValues[FPLFormModel.AV_X13B]='EOBT';viewOnlyValues[FPLFormModel.AV_X16A]='ADES';viewOnlyValues[FPLFormModel.AV_X18_DOF]='DOF';arrForm.setViewonlyAttributes(viewOnlyValues);var editableValues={};editableValues[FPLFormModel.AV_X16C]='DIV AD';editableValues[FPLFormModel.AV_X16B]='* ATA';editableValues[FPLFormModel.AV_NONICAO_DIVERSION_AD]='non ICAO diversion AD';arrForm.setEditableAttributes(editableValues);var restrictions={};restrictions[FPLFormModel.AV_X16C]=HtmlUtils.IRR_AERODROME_ICAO;restrictions[FPLFormModel.AV_X16B]=HtmlUtils.IRR_HHMM_MAX2359;restrictions[FPLFormModel.AV_NONICAO_DIVERSION_AD]=HtmlUtils.IRR_ALPHANUMERIC;arrForm.setInputRestrictionsWhileTypping(restrictions);var valueProviders={};valueProviders[FPLFormModel.AV_X16B]=function(aFlightModel){var retVal='';var offset=getConfigValue2('flightPlans','arrAtaCurrTimeOffsetMinutes',null);if(AWUtils.isUndefinedOrIsNull(offset)===false){var ataDate=new Date();ataDate.setUTCMinutes(ataDate.getUTCMinutes()+new Number(offset));retVal=zeroPad(ataDate.getUTCHours(),2)+''+zeroPad(ataDate.getUTCMinutes(),2);}return retVal;};arrForm.setValueProviders(valueProviders);var hoverTooltips={};hoverTooltips[FPLFormModel.AV_X16C]='FlightPlanUpdateForm.insertTheDiversionAerodrome4chars';hoverTooltips[FPLFormModel.AV_X16B]='FlightPlanUpdateForm.insertActualTimeOfArrival';hoverTooltips[FPLFormModel.AV_NONICAO_DIVERSION_AD]='FlightPlanUpdateForm.writeDiversionAirportWhenDivAdIsZzzz';arrForm.setHoverTooltipAttributes(hoverTooltips);var orderOfArrAttributes=[FPLFormModel.AV_X7,FPLFormModel.AV_X13A,FPLFormModel.AV_X13B,FPLFormModel.AV_X16A,FPLFormModel.AV_X16C,FPLFormModel.AV_X16B,FPLFormModel.AV_NONICAO_DIVERSION_AD];var showInArrMsgDOF=getConfigValue2('flightPlans','showInArrMsgDOF',true);if(showInArrMsgDOF===true){orderOfArrAttributes.push(FPLFormModel.AV_X18_DOF);}arrForm.setOrderOfAttributes(orderOfArrAttributes);var parentInstance=this._thisInstance;arrForm.setSendMessageAction(function(){var messagePrev=arrForm.getChangeMessagePreview();FlightPlansController.showYesNoOption(getLocalizedString('FlightPlanUpdateForm.DoYouReallyWantToSendARRMessage')+'<br/>'+messagePrev,function(){var fplId=arrForm.getFplId();var ataVal=arrForm.getFormAtaVal();var divAd=arrForm.getFormDivAd();var nonIcaoDivAd=arrForm.getFormNonIcaoDivAd();var errCallbackFnc=arrForm.getErrorCallBackFnc();var okCallBackFnc=FlightPlansController.createAfterUpdateCallbackOkFnc(parentInstance);sendARR(fplId,ataVal,divAd,nonIcaoDivAd,okCallBackFnc,errCallbackFnc);});});return arrForm;};this._depForm=null;this.getDepFlightPlanUpdateForm=function(aFplModel){if(this._depForm===null){this._depForm=this.createDepForm();}this._depForm.setFlightPlan(aFplModel);return this._depForm.createUpdateForm();};this.createDepForm=function(){var depForm=new FlightPlanUpdateForm();depForm.setTitle("DEP");var viewOnlyValues={};viewOnlyValues[FPLFormModel.AV_X7]='ARCID';viewOnlyValues[FPLFormModel.AV_X13A]='ADEP';viewOnlyValues[FPLFormModel.AV_X16A]='ADES';viewOnlyValues[FPLFormModel.AV_X18_DOF]='DOF';depForm.setViewonlyAttributes(viewOnlyValues);var editableValues={};editableValues[FPLFormModel.AV_X13B]='*ATD';depForm.setEditableAttributes(editableValues);var inputRestr={};inputRestr[FPLFormModel.AV_X13B]=HtmlUtils.IRR_HHMM_MAX2359;depForm.setInputRestrictionsWhileTypping(inputRestr);depForm.setOrderOfAttributes([FPLFormModel.AV_X7,FPLFormModel.AV_X13A,FPLFormModel.AV_X13B,FPLFormModel.AV_X16A,FPLFormModel.AV_X18_DOF]);var parentInstance=this._thisInstance;depForm.setSendMessageAction(function(){var messagePrev=depForm.getChangeMessagePreview();FlightPlansController.showYesNoOption(getLocalizedString('FlightPlanUpdateForm.DoYouReallyWantToSendDEPMessage')+'<br/>'+messagePrev,function(){var fplId=depForm.getFplId();var atdVal=depForm.getFormAtdVal();var errCallbackFnc=depForm.getErrorCallBackFnc();var okCallBackFnc=FlightPlansController.createAfterUpdateCallbackOkFnc(parentInstance);sendDEP(fplId,atdVal,okCallBackFnc,errCallbackFnc);});});return depForm;};this.getFlightPlanUpdateForm=function(){if(this._fplUpdateForm===null){this._fplUpdateForm=new FlightPlanUpdateForm();}return this._fplUpdateForm;};}FlightPlansController.flightPlansTableActive;FlightPlansController.flightPlansTableActiveID;FlightPlansController.flightPlansTableArchive;FlightPlansController.flightPlansTableArchiveID;FlightPlansController._previousFilterActive;FlightPlansController._previousFilterArchive;FlightPlansController._ctrlPanelMobile;FlightPlansController._form=null;FlightPlansController.afterUpdateFormRefreshSleepSec=getConfigValue2('flightPlans','afterUpdateFormRefreshSleepSec',5);FlightPlansController.showFlightPlansArchive=function(){var loadFromArchiveFnc=FlightPlansController.createFlightPlansButtonClickAction(AppController.controlPanel,'archiveTabIDNav');loadFromArchiveFnc();};FlightPlansController.showFlightPlansActual=function(){var loadFromActualFnc=FlightPlansController.createFlightPlansButtonClickAction(AppController.controlPanel,'actualTabIDNav');loadFromActualFnc();};FlightPlansController.createFlightPlansButtonClickAction=function(aCtrlPanelMobile,aActivateTab){FlightPlansController._ctrlPanelMobile=aCtrlPanelMobile;if(aCtrlPanelMobile===null){return function(){};}if(HtmlUtils.isUndefinedOrIsNull(aActivateTab)===true){aActivateTab='actualTabIDNav';}const storedSettings=FlightPlanFilter.restoreValues();return function(){if(FlightPlansController._form===null){var resetFunctionActive=FlightPlansController.createResetActionActive();var resetFunctionArchive=FlightPlansController.createResetActionArchive();var openRelevantPlansByAirportFunction=FlightPlansController.createAirportSelectionListener();var openRelevantPlansByPlanClickActive=FlightPlansController.createPlanSelectionListenerActive();var openRelevantPlansByPlanClickArchive=FlightPlansController.createPlanSelectionListenerArchive();FlightPlansController._previousFilterActive=storedSettings[FlightPlanFilter.SETTINGS_ACTIVE_KEY_NAME];FlightPlansController._previousFilterArchive=storedSettings[FlightPlanFilter.SETTINGS_ARCHIVE_KEY_NAME];FlightPlansController.flightPlansTableActive=new FlightPlansTable(FlightPlansController.flightPlans,null,resetFunctionActive,FlightPlansController.reloadActualData,FlightPlansController._previousFilterActive,openRelevantPlansByAirportFunction,openRelevantPlansByPlanClickActive);FlightPlansController.flightPlansTableActive.setUniqueIDPrefix(FPLFormModel.C_ActiveTable);FlightPlansController.flightPlansTableActive.setApplyFunction(FlightPlansController.createApplyActiveAction());FlightPlansController.flightPlansTableArchive=new FlightPlansTable(FlightPlansController.flightPlansArchive,null,resetFunctionArchive,FlightPlansController.reloadArchiveData,FlightPlansController._previousFilterArchive,openRelevantPlansByAirportFunction,openRelevantPlansByPlanClickArchive);FlightPlansController.flightPlansTableArchive.setUniqueIDPrefix(FPLFormModel.C_ArchiveTable);FlightPlansController.flightPlansTableArchive.setApplyFunction(FlightPlansController.createApplyArchiveAction());var winMan=aCtrlPanelMobile.getWindowManager();var actualTableContent=FlightPlansController.flightPlansTableActive.createPanelContent();var actualTabID='actualTabID';actualTableContent.attr(HtmlUtils.A_ID,actualTabID);var archiveTableContent=FlightPlansController.flightPlansTableArchive.createPanelContent();var archiveTabID='archiveTabID';archiveTableContent.attr(HtmlUtils.A_ID,archiveTabID);const fplPlansTabs=HtmlUtils.createTabs(['FlightPlansTable.tabs.title.actual','FlightPlansTable.tabs.title.archive'],[actualTableContent,archiveTableContent],[FlightPlansController.reloadActualData,FlightPlansController.reloadArchiveData]);fplPlansTabs.attr(HtmlUtils.A_ID,"fplPlanTabs");var form=winMan.createForm(FlightPlansTable.singletonId+"Tool","FlightPlansTable.FPL",[fplPlansTabs,FlightPlansTable.createBackgroundColorLegend()]);FlightPlansController._form=form;form.fitHeightToPage();FlightPlansController.flightPlansTableActive.setLocalizedTextContent();FlightPlansController.flightPlansTableArchive.setLocalizedTextContent();form.on(RsForm.EVENTS.AFTER_SHOW,function(){FlightPlansController.startAutomaticDataReloader();FlightPlansController.flightPlansTableArchive.refreshDatetimeFilterInputs();});form.on(RsForm.EVENTS.CLOSE,function(){FlightPlansController.stopAutomaticDataReloader();});form.on(RsForm.EVENTS.AFTER_CLOSE,function(){if(AppController.aisWeb){AppController.aisWeb.clearFplRoutes();}FlightPlansController._form=null;FlightPlansController.closeVerticalProfileIfOpened();FplUserPreferencesCtrl.upload();FlightPlansController.fplOnMapIDs=[];});winMan.showForm(form,AwWinMan.AREA.RIGHT);JQ("#fplPlanTabs").tabs().tabs("refresh");JQ("#"+aActivateTab).click();return false;}};};FlightPlansController.updateActualPaginationValues=function(aCurrentPageNum,aMaxPageCount,aPageItemsCount){var pagination=JQ("#actualTabID").find("div.pagination");FlightPlanGuiFactory.writePaginationValuesToCookies(pagination.attr(HtmlUtils.A_ID),aCurrentPageNum,aMaxPageCount,aPageItemsCount);FlightPlansController.updatePaginationValues(pagination,aCurrentPageNum,aMaxPageCount);};FlightPlansController.updateArchivePaginationValues=function(aCurrentPageNum,aMaxPageCount,aPageItemsCount){var pagination=JQ("#archiveTabID").find("div.pagination");FlightPlanGuiFactory.writePaginationValuesToCookies(pagination.attr(HtmlUtils.A_ID),aCurrentPageNum,aMaxPageCount,aPageItemsCount);FlightPlansController.updatePaginationValues(pagination,aCurrentPageNum,aMaxPageCount);};FlightPlansController.updatePaginationValues=function(aPagination,aCurrentPageNum,aMaxPageCount){FlightPlanGuiFactory.SKIP_RELOAD_BY_PAGINATION=true;FlightPlanGuiFactory.updatePaginationValues(aPagination,aCurrentPageNum,aMaxPageCount);FlightPlanGuiFactory.SKIP_RELOAD_BY_PAGINATION=false;};FlightPlansController.getFplArchivePageNum=function(){var paginationValue=JQ("#archiveTabID").find("input.paginationInput").val();var splitedInput=paginationValue.split(HtmlUtils.C_SPACE_CHAR);return(splitedInput[1]-1);};FlightPlansController.setFplArchiveMaxPageCount=function(aMaxPageCount){var pagination=JQ("#archiveTabID").find("div.pagination");pagination.jqPagination('option','max_page',aMaxPageCount);};FlightPlansController.getFplArchivePageItemsCount=function(){return JQ("#archiveTabID").find("select.countPerPageSelect").val();};FlightPlansController.getFplActualPageNum=function(){var paginationValue=JQ("#actualTabID").find("input.paginationInput").val();var splitedInput=paginationValue.split(HtmlUtils.C_SPACE_CHAR);return(splitedInput[1]-1);};FlightPlansController.getFplActualPageItemsCount=function(){return JQ("#actualTabID").find("select.countPerPageSelect").val();};FlightPlansController.getFplPageNum=function(aElement){var paginationInput=aElement.find("input.paginationInput");return paginationInput.val();};FlightPlansController.getFplItemsCount=function(aElement){var countPerPageSelect=aElement.find("select.countPerPageSelect option:selected");return countPerPageSelect.text();};FlightPlansController.createApplyActiveAction=function(){return FlightPlansController.createApplyAction(FlightPlansController.flightPlansTableActive,FlightPlansController.flightPlansTableActive,FlightPlansController.flightPlansTableActive,true);};FlightPlansController.createApplyArchiveAction=function(){return FlightPlansController.createApplyAction(FlightPlansController.flightPlansTableArchive,FlightPlansController.flightPlansTableArchive,FlightPlansController.flightPlansTableArchive,false);};FlightPlansController.createApplyAction=function(aFlightPlansProvider,aFilterProvider,aPlansTable,aIsActive){var retValApplyFunction=function(){if(aIsActive===true){FlightPlansController.reloadActualData(false);}else{FlightPlansController.reloadArchiveData(false);}};return retValApplyFunction;};FlightPlansController.createResetActionActive=function(){var resetFunction=function(){FlightPlansController.flightPlansTableActive.resetInputFields();FlightPlansController.reloadActualData(false);};return resetFunction;};FlightPlansController.createResetActionArchive=function(){var resetFunction=function(){FlightPlansController.flightPlansTableArchive.resetInputFields();FlightPlansController.reloadArchiveData(false);};return resetFunction;};FlightPlansController.saveFilterValues=function(){FlightPlanFilter.storeValues(FlightPlansController.flightPlansTableActive.getFlightPlanFilter(),FlightPlansController.flightPlansTableArchive.getFlightPlanFilter());};FlightPlansController.AUTOMATIC_RELOADER_INTERVAL_ACTUAL=null;FlightPlansController.AUTOMATIC_RELOADER_INTERVAL_ARCHIVE=null;FlightPlansController.startAutomaticDataReloader=function(){FlightPlansController.startAutomaticDataReloaderActual();FlightPlansController.startAutomaticDataReloaderArchive();};FlightPlansController.startAutomaticDataReloaderActual=function(){var autoFplActualRefreshTime=getConfigValue2('flightPlans','autoFplActualRefreshTime',30);FlightPlansController.AUTOMATIC_RELOADER_INTERVAL_ACTUAL=FlightPlansController.startAutomaticFunctionIfEnabled(()=>{let activeIdx=JQ('#fplPlanTabs').tabs("option","active");if(activeIdx===0){FlightPlansController.reloadActualData(false);}},autoFplActualRefreshTime);};FlightPlansController.startAutomaticDataReloaderArchive=function(){var autoFplArchiveRefreshTime=getConfigValue('flightPlans','autoFplArchiveRefreshTime',0);FlightPlansController.AUTOMATIC_RELOADER_INTERVAL_ARCHIVE=FlightPlansController.startAutomaticFunctionIfEnabled(()=>{let activeIdx=JQ('#fplPlanTabs').tabs("option","active");if(activeIdx===1){FlightPlansController.reloadArchiveData();}},autoFplArchiveRefreshTime);};FlightPlansController.startAutomaticFunctionIfEnabled=function(aFunction,aIntervalTimeSec){if(aIntervalTimeSec>0){var autoFplActualRefreshTimeMilisec=aIntervalTimeSec*1000;return setInterval(aFunction,autoFplActualRefreshTimeMilisec);}else{return null;}};FlightPlansController.stopAutomaticDataReloader=function(){FlightPlansController.stopInterval(FlightPlansController.AUTOMATIC_RELOADER_INTERVAL_ACTUAL);FlightPlansController.AUTOMATIC_RELOADER_INTERVAL_ACTUAL=null;FlightPlansController.stopInterval(FlightPlansController.AUTOMATIC_RELOADER_INTERVAL_ARCHIVE);FlightPlansController.AUTOMATIC_RELOADER_INTERVAL_ARCHIVE=null;};FlightPlansController.stopInterval=function(aInterval){if(aInterval!==null){clearInterval(aInterval);aInterval=null;}};FlightPlansController.createAfterUpdateCallbackOkFnc=function(aFplController){var retVal=function(okMessage){aFplController.closeOpenedForm();FlightPlansController.disableFplUpdateButtons(FlightPlansController.afterUpdateFormRefreshSleepSec);FlightPlansController.reloadActualDataAfter(FlightPlansController.afterUpdateFormRefreshSleepSec);};return retVal;};FlightPlansController.disabledUpdateButtonsTo=null;FlightPlansController.disableFplUpdateButtons=function(aSec){FlightPlansController.disabledUpdateButtonsTo=FlightPlansController.getCurrentTimestamp()+(aSec*1000);FlightPlansController.updateButtonsMenuEnablity(FlightPlansController.DISABLE_UPDATE_BTNS_STATUSES['alldisabled']);};FlightPlansController.getCurrentTimestamp=function(){var retVal=new Date();return retVal.getTime();};FlightPlansController.updateButtonsMenuEnablity=function(aDisabledButtonsTypeArray){if(HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(FlightPlansController.updateButtonsMenu)===true){return;}if(HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(FlightPlansController.disabledUpdateButtonsTo)===false&&FlightPlansController.disabledUpdateButtonsTo>=FlightPlansController.getCurrentTimestamp()){aDisabledButtonsTypeArray=FlightPlansController.DISABLE_UPDATE_BTNS_STATUSES['alldisabled'];}else{FlightPlansController.disabledUpdateButtonsTo=null;}FlightPlansController.updateButtonsMenu.find('button').each(function(index){var iButton=JQ(this);var iButtonType=iButton.attr(FlightPlansController.A_UPDATE_FPL_MSG_TYPE);if(HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(iButtonType)===true){return;}if(HtmlUtils.arrayContains(aDisabledButtonsTypeArray,iButtonType)===true){iButton.addClass(FlightPlansController.DISABLED_BUTTONSTATE);iButton.off('click.'+FlightPlansController.updateButtonsClickEventNamespace);}else{iButton.removeClass(FlightPlansController.DISABLED_BUTTONSTATE);iButton.on('click.'+FlightPlansController.updateButtonsClickEventNamespace,iButton.data(FlightPlansController.updateButtonsFakeEventName));}});};FlightPlansController.setOrderingValues=function(aCallBackEvent){var orderType=FlightPlanGuiFactory.DEFAULT_SORTING_ORDER;if(AWUtils.isUndefinedOrIsNull(aCallBackEvent.OrderType)===false&&AWUtils.isUndefinedOrIsNull(aCallBackEvent.OrderType.__text)===false){orderType=aCallBackEvent.OrderType.toString();}FplUserPreferencesCtrl.setVal('LAST_SORTING_ORDER',orderType);var orderColumn='COL_ARCID';if(AWUtils.isUndefinedOrIsNull(aCallBackEvent.OrderColumn)===false&&AWUtils.isUndefinedOrIsNull(aCallBackEvent.OrderColumn.__text)===false){orderColumn=aCallBackEvent.OrderColumn.toString();}FplUserPreferencesCtrl.setVal('LAST_SORTING_COL',orderColumn);};FlightPlansController.reloadActualData=function(aUseApplyFilter){FlightPlansController.startLoadingFlightPlans();var hoursAfterEta=FlightPlansController.getCfgShowActiveFPLAfterETAHour();var aCallBackFnc=function(aCallBackEvent){debug('Flightplans data recieved');FlightPlansController.flightPlans=FlightPlansController.convertAllIbafDataToFlightPlanModels(aCallBackEvent);FlightPlansController.setOrderingValues(aCallBackEvent);FlightPlansController.flightPlansTableActive.setFlightPlans(FlightPlansController.flightPlans,FlightPlansController.reloadActualData);if(HtmlUtils.isUndefinedOrIsNull(aUseApplyFilter)===true){aUseApplyFilter=true;}var maxPageCount=FlightPlansController.getMaxPageCount(aCallBackEvent);var currentPageNum=FlightPlansController.getCurrentPageNum(aCallBackEvent);var pageItemsCount=FlightPlansController.getFplActualPageItemsCount();FlightPlansController.updateActualPaginationValues(currentPageNum,maxPageCount,pageItemsCount);FlightPlansController.updateActualTableOrderChar(aCallBackEvent);FlightPlansController.stopLoadingFlightPlans();};var aCallBackErrorFnc=function(aErrorCallBack){console.log('Flightplans error recieved:'+aErrorCallBack);FlightPlansController.flightPlansTableActive.setFlightPlans([]);FlightPlansController.stopLoadingFlightPlans();};var pageNum=FlightPlansController.getFplActualPageNum();var pageItemsCount=FlightPlansController.getFplActualPageItemsCount();var flightPlanFilter=FlightPlansController.flightPlansTableActive.getFlightPlanFilter();FlightPlansController.saveFilterValues();var aARCID=flightPlanFilter.arcidIs;var aADEP=flightPlanFilter.adepIs;var aADES=flightPlanFilter.adesIs;var aFlRules=flightPlanFilter.flightRules;var aShowOwnFlights=(flightPlanFilter.showOwnFlights===true?'true':'false');aFlRules=FlightPlansController.convertFlightRulesForWS(aFlRules);var aOrderColumn=FlightPlansController.getActualSendOrderColumnType();var aorderType=FlightPlansController.getActualSendOrderType();getFplList(hoursAfterEta,aARCID,aADEP,aADES,aFlRules,pageNum,pageItemsCount,aShowOwnFlights,aOrderColumn,aorderType,aCallBackFnc,aCallBackErrorFnc);};FlightPlansController.getCfgShowActiveFPLAfterETAHour=function(){return getConfigValue2('flightPlans','showActiveFPLAfterETAHour',1);};FlightPlansController.reloadActualDataAfter=function(aSeconds){var usedSeconds=1;if(HtmlUtils.isUndefinedOrIsNull(aSeconds)===false){var parsedSeconds=parseInt(''+aSeconds);if(parsedSeconds!=='NaN'){usedSeconds=parsedSeconds;}}AWUtils.invokeLater(function(){FlightPlansController.reloadActualData();},null,(usedSeconds*1000));};FlightPlansController.reloadArchiveData=function(aUseApplyFilter){FlightPlansController.startLoadingFlightPlans();var EOBTFromDate=new Date();var EOBTFrom=HtmlUtils.formateDateToGetFPLArchiveDate(EOBTFromDate);var aCallBackFnc=FlightPlansController.createReloadArchiveDataCallback(aUseApplyFilter);var aCallBackErrorFnc=FlightPlansController.createReloadArchiveDataErrorCallback();var pageNum=FlightPlansController.getFplArchivePageNum();var pageItemsCount=FlightPlansController.getFplArchivePageItemsCount();var flightPlanFilter=FlightPlansController.flightPlansTableArchive.getFlightPlanFilter();FlightPlansController.saveFilterValues();var aARCID=flightPlanFilter.arcidIs;var aADEP=flightPlanFilter.adepIs;var aADES=flightPlanFilter.adesIs;var aShowOwnFlights=(flightPlanFilter.showOwnFlights===true?'true':'false');var aFlRules=flightPlanFilter.flightRules;var EOBTFrom=flightPlanFilter.getEOBTFromDatetimeFixed();var EOBTTill=flightPlanFilter.getEOBTTillDatetimeFixed();aFlRules=FlightPlansController.convertFlightRulesForWS(aFlRules);FlightPlansController.flightPlansTableArchive.refreshDatetimeFilterInputs();var aOrderColumn=FlightPlansController.getArchiveSendOrderColumnType();var aorderType=FlightPlansController.getArchiveSendOrderType();getFplArchive(EOBTFrom,EOBTTill,aARCID,aADEP,aADES,aFlRules,pageNum,pageItemsCount,aShowOwnFlights,aOrderColumn,aorderType,aCallBackFnc,aCallBackErrorFnc);};FlightPlansController.createReloadArchiveDataCallback=function(aUseApplyFilter){var retVal=function(aCallBackEvent){debug('Archive Flightplans data recieved');FlightPlansController.flightPlansArchive=FlightPlansController.convertAllIbafDataToFlightPlanModels(aCallBackEvent);FlightPlansController.flightPlansTableArchive.setFlightPlans(FlightPlansController.flightPlansArchive,FlightPlansController.reloadArchiveData);if(HtmlUtils.isUndefinedOrIsNull(aUseApplyFilter)===true){aUseApplyFilter=true;}var maxPageCount=FlightPlansController.getMaxPageCount(aCallBackEvent);var currentPageNum=FlightPlansController.getCurrentPageNum(aCallBackEvent);var pageItemsCount=FlightPlansController.getFplArchivePageItemsCount();FlightPlansController.updateArchivePaginationValues(currentPageNum,maxPageCount,pageItemsCount);FlightPlansController.updateArchiveTableOrderChar(aCallBackEvent);FlightPlansController.stopLoadingFlightPlans();};return retVal;};FlightPlansController.getActualSendOrderColumnType=function(){return FlightPlansController.getTableSendOrderColumnType(FlightPlansController.getActualTable());};FlightPlansController.getActualSendOrderType=function(){return FlightPlansController.getTableSendOrderType(FlightPlansController.getActualTable());};FlightPlansController.getArchiveSendOrderColumnType=function(){return FlightPlansController.getTableSendOrderColumnType(FlightPlansController.getArchiveTable());};FlightPlansController.getArchiveSendOrderType=function(){return FlightPlansController.getTableSendOrderType(FlightPlansController.getArchiveTable());};FlightPlansController.getTableSendOrderColumnType=function(aTable){var columnForSort=aTable.find('th[sort_column="true"]').first();if(AWUtils.isUndefinedOrIsNull(columnForSort)===true||columnForSort.length<=0){columnForSort=aTable.find('th[ordered]').first();}if(AWUtils.isUndefinedOrIsNull(columnForSort)===true||columnForSort.length<=0){return FlightPlansController.getOrderColumnTypeInitial();}return columnForSort.attr('column_type');};FlightPlansController.getTableSendOrderType=function(aTable){var columnForSort=aTable.find('th[sort_column="true"]').first();var useSameOrderType=false;if(AWUtils.isUndefinedOrIsNull(columnForSort)===true||columnForSort.length<=0){columnForSort=aTable.find('th[ordered]').first();if(columnForSort.length>0){useSameOrderType=true;}}if(AWUtils.isUndefinedOrIsNull(columnForSort)===true||columnForSort.length<=0||AWUtils.isUndefinedOrIsNull(columnForSort.attr('ordered'))===true){return FlightPlanGuiFactory.DEFAULT_SORTING_ORDER;}if(useSameOrderType===true){return columnForSort.attr('ordered');}else{if(columnForSort.attr('ordered')==='ASC'){return'DESC';}else{return'ASC';}}};FlightPlansController.updateActualTableOrderChar=function(aCallBackEvent){FlightPlansController.updateFplTableOrderChar(FlightPlansController.getActualTable(),aCallBackEvent);};FlightPlansController.updateArchiveTableOrderChar=function(aCallBackEvent){FlightPlansController.updateFplTableOrderChar(FlightPlansController.getArchiveTable(),aCallBackEvent);};FlightPlansController.getActualTable=function(){return JQ('#actualTabID table').first();};FlightPlansController.getArchiveTable=function(){return JQ('#archiveTabID table').first();};FlightPlansController.updateFplTableOrderChar=function(aTable,aCallBackEvent){FlightPlansController.clearFplTableOrderChars(aTable);const type=FlightPlansController.getOrderType(aCallBackEvent);const column=FlightPlansController.getOrderColumn(aCallBackEvent);FlightPlansController.setFplTableOrderChar(aTable,column,type);};FlightPlansController.setFplTableOrderChar=function(table,column,type){const orderedColumn=table.find('thead> tr > th[column_type = "'+column+'"]');orderedColumn.attr('ordered',type);};FlightPlansController.clearFplTableOrderChars=function(aTable){var thElements=aTable.find('th');thElements.removeAttr('ordered');};FlightPlansController.getOrderType=function(aCallBackEvent){if(AWUtils.isUndefinedOrIsNull(aCallBackEvent)===true||AWUtils.isUndefinedOrIsNull(aCallBackEvent.OrderType)===true){return FlightPlanGuiFactory.DEFAULT_SORTING_ORDER;}return aCallBackEvent.OrderType.toString();};FlightPlansController.getOrderColumn=function(aCallBackEvent){var tableHeaderNamesMap=FlightPlanGuiFactory.getTableHeaderRowNames();if(AWUtils.isUndefinedOrIsNull(aCallBackEvent)===false&&AWUtils.isUndefinedOrIsNull(aCallBackEvent.OrderColumn)===false&&(aCallBackEvent.OrderColumn in tableHeaderNamesMap)===false){return FlightPlansController.getOrderColumnTypeInitial();}else{return aCallBackEvent.OrderColumn.toString();}};FlightPlansController.getOrderColumnTypeInitial=function(aCallBackEvent){var tableHeaderNamesMap=FlightPlanGuiFactory.getTableHeaderRowNames();return Object.keys(tableHeaderNamesMap)[0];};FlightPlansController.createReloadArchiveDataErrorCallback=function(){var aCallBackErrorFnc=function(aErrorCallBack){console.log('Archive Flightplans error recieved:'+aErrorCallBack);FlightPlansController.flightPlansTableArchive.setFlightPlans([]);FlightPlansController.stopLoadingFlightPlans();};return aCallBackErrorFnc;};FlightPlansController.convertFlightRulesForWS=function(aFlRules){var retVal=HtmlUtils.C_EMPTY;if(aFlRules==='ifrvfr'){retVal='X';}else if(aFlRules==='ifr'){retVal='I';}else if(aFlRules==='vfr'){retVal='V';}return retVal;};FlightPlansController.applyFilter=function(){FlightPlansController.flightPlansTableActive._applyFunction();};FlightPlansController.relatedPlansRows={};FlightPlansController.relatedPlansRowsArchive={};FlightPlansController.createPlanSelectionListenerActive=function(){var planSelectionChangeListener=function(aNewSelectedPlan){FlightPlansController.showButtonsMenuActive(aNewSelectedPlan);FlightPlansController.loadAndShowRelatedPlans(aNewSelectedPlan);};return planSelectionChangeListener;};FlightPlansController.createPlanSelectionListenerArchive=function(){var planSelectionChangeListener=function(aNewSelectedPlan){FlightPlansController.showButtonsMenuArchive(aNewSelectedPlan);FlightPlansController.loadAndShowRelatedPlansArchive(aNewSelectedPlan);};return planSelectionChangeListener;};FlightPlansController.closeOpenedRowContents=function(){var table=FlightPlansController.getTableOfCurrentVisibleTab();FlightPlansController.closeOpenedRowContentsOfTable(table);};FlightPlansController.getTableOfCurrentVisibleTab=function(){var areaToFindTable=FlightPlansController.getCurrentVisibleTabDiv();return areaToFindTable.find("#flightPlansResultId table");};FlightPlansController.getCurrentVisibleTabDiv=function(){var retVal=JQ('#actualTabID');if(JQ('#archiveTabID').attr('aria-hidden')==="false"){retVal=JQ('#archiveTabID');}return retVal;};FlightPlansController.unsetLastSelectedPlanIfIn=function(aPlans){FlightPlansController.flightPlansTableActive.unsetLastSelectedPlanIfIn(aPlans);FlightPlansController.flightPlansTableArchive.unsetLastSelectedPlanIfIn(aPlans);};FlightPlansController.closeOpenedRowContentsOfTable=function(aTable){var actualMenuRow=aTable.find('.fpl-menu-row');if(isUndefinedOrIsNull(actualMenuRow)===false&&actualMenuRow.is(":visible")===true){actualMenuRow.parent().siblings().removeClass("fpl-for-menu");actualMenuRow.remove();}var tabDiv=aTable.parent().parent().parent().parent();var relatedPlanRows=FlightPlansController._relatedPlansRows;if(tabDiv.attr(HtmlUtils.A_ID)==='archiveTabID'){relatedPlanRows=FlightPlansController._relatedPlansRowsArchive;}if(isUndefinedOrIsNullOrIsEmptyArray(relatedPlanRows)===false){for(var i=0;i<relatedPlanRows.length;i++){var iPlanRow=relatedPlanRows[i];if(isUndefinedOrIsNull(iPlanRow)===true){continue;}if(iPlanRow.is(":visible")===true){FlightPlansController.closeRelatedFplContentRow(iPlanRow);FlightPlansController.closeVerticalProfileIfOpened();}}}};FlightPlansController.showButtonsMenuActive=function(aNewSelectedPlan){var table=JQ("#actualTabID").find("#flightPlansResultId table");var flightPlanObject=FlightPlansController.getActiveFlightPlan(aNewSelectedPlan);if(HtmlUtils.isUndefinedOrIsNull(flightPlanObject)===true){return;}FlightPlansController.showButtonsMenu(table,flightPlanObject);};FlightPlansController.showButtonsMenuArchive=function(aNewSelectedPlan){var table=JQ("#archiveTabID").find("#flightPlansResultId table");var flightPlanObject=FlightPlansController.getArchiveFlightPlan(aNewSelectedPlan);if(HtmlUtils.isUndefinedOrIsNull(flightPlanObject)===true){return;}FlightPlansController.showButtonsMenu(table,flightPlanObject);};FlightPlansController.getArchiveFlightPlan=function(aPlanID){return FlightPlansController.getFlightPlanByID(FlightPlansController.flightPlansArchive,aPlanID);};FlightPlansController.getActiveFlightPlan=function(aPlanID){return FlightPlansController.getFlightPlanByID(FlightPlansController.flightPlans,aPlanID);};FlightPlansController.getFlightPlanByID=function(aFlightPlanArray,aPlanID){for(var i=0;i<aFlightPlanArray.length;i++){var iPlan=aFlightPlanArray[i];if(iPlan.FlId===aPlanID){return iPlan;}}return null;};FlightPlansController.fplOnMapIDs=[];FlightPlansController.fplClickedRow=null;FlightPlansController.showButtonsMenu=function(aTable,aFlightPlanObject){var clickedRow=FlightPlansController.getOriginalTrFromElement(aTable,aFlightPlanObject.internalID);var actualMenuRow=aTable.find('.fpl-menu-row');clickedRow.siblings().removeClass("fpl-for-menu");if(actualMenuRow.is(":visible")===true){clickedRow.removeClass("fpl-for-menu");actualMenuRow.remove();}else{actualMenuRow.remove();var fplData=clickedRow.data('fpl');var menu=FlightPlansController.createEmptyFplMenu();if(FlightPlansController.isTabOfTableArchive(aTable)===false){menu=FlightPlansController.createFplMenu(fplData,function(func,state){if(func==="drawRoute"){if(state===true){var fplData=clickedRow.data('fpl');var flID=fplData.FlId;FlightPlansController._form.minimize();FlightPlansController.fplOnMapIDs.push(flID);clickedRow.children().eq(0).toggleClass("fpl-on-map",state);FlightPlansController.fplClickedRow=clickedRow;}else{FlightPlansController.fplOnMapIDs=[];if(FlightPlansController.fplClickedRow!==null){FlightPlansController.fplClickedRow.children().eq(0).toggleClass("fpl-on-map",state);FlightPlansController.fplClickedRow=null;}clickedRow.children().eq(0).toggleClass("fpl-on-map",state);}}},aFlightPlanObject);menu.data('fplData',fplData);}if(FunctionsController.isFunctionEnabled("fplProcessing")){const openAsNewBtn=HtmlUtils.buttonWithTooltip("FlightPlansTable.OpenAsNew","FlightPlansTable.OpenAsNew");const reverseRouteBtn=HtmlUtils.buttonWithTooltip("FlightPlansTable.ReverseRoute","FlightPlansTable.ReverseRoute");openAsNewBtn.click(FlightPlansController.getInstance().createShowAsNewAction(aFlightPlanObject));openAsNewBtn.attr("id","openAsNew");menu.append(openAsNewBtn);reverseRouteBtn.click(FlightPlansController.getInstance().createReverseRouteAction(aFlightPlanObject));reverseRouteBtn.attr("id","reverseRoute");menu.append(reverseRouteBtn);}if(AppController.bundleController.isBundleConfigured('exportroute')===true){var exportButton=HtmlUtils.buttonWithTooltip(ExportRouteController.LOC_EXPORT_TO_GPS,ExportRouteController.LOC_EXPORT_TO_GPS);exportButton.click(function(){var fplObj=FlightPlanModel.convert2Adexp(fplData);JQ("#flightPlansTableIdTool").loading(true);AWDataHandler.getRouteForFPL(fplObj,function(aResponseData){var flightLog=FlightPlansController.convertFlightPlanModelToFlightLog(aFlightPlanObject);FlightPlansController.addRouteSegmentsFromRoute(flightLog,aResponseData);flightLog.route.name=aFlightPlanObject.ARCID+'_Route';FlightPlansController.transformRoutePointsFromEPSG4326ToMapProjection(flightLog.route);var exportRouteCtrl=new ExportRouteController();exportRouteCtrl.setFlightLog(flightLog);exportRouteCtrl.exportClickAction();JQ("#flightPlansTableIdTool").loading(false);});});menu.append(exportButton);}if(AppController.aisWeb&&FlightPlansController.isTabOfTableArchive(aTable)===false&&AWUtils.isDrawFUAMerged()===false){var showFUAinConflictBtn=HtmlUtils.buttonFull({},'<span '+AWLocale.LOCALISATION_KEY+'="FlightPlansTable.showFUAinConflict"></span>');AWUtils.addLocalizedTooltip(showFUAinConflictBtn,"FlightPlansTable.showFUAinConflict");showFUAinConflictBtn.click(FlightPlansController.createShowFuaInConflictClickFnc(fplData,aFlightPlanObject));menu.append(showFUAinConflictBtn);}if(FlightPlansController.isTabOfTableArchive(aTable)===false&&HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(aFlightPlanObject.CTOT)===false){var relatedATFMRegulationBtn=HtmlUtils.buttonFull({},'<span '+AWLocale.LOCALISATION_KEY+'="FlightPlansTable.relatedATFMCRegulation"></span>');AWUtils.addLocalizedTooltip(relatedATFMRegulationBtn,"FlightPlansTable.relatedATFMCRegulation");relatedATFMRegulationBtn.click(function(){console.debug("Clicked Related ATFM Regulation");AppController.bundleController.getBundle("atfm",function(bundle){if(bundle){bundle.showRegulationsForFpl(aFlightPlanObject.FlId);}else{JQMUtil.showInfoMsg(getLocalizedString("Messages.moduleLoadingError"),true,true);}});});menu.append(relatedATFMRegulationBtn);}if(AWConfigUtils.getShowDeleteButtonArchive()===true&&aFlightPlanObject.canDelete()===true){var deleteBtn=HtmlUtils.buttonWithTooltip("FlightPlansTable.Delete","FlightPlansTable.Delete");deleteBtn.click(FlightPlansController.getInstance().createDeleteAction(aFlightPlanObject.FlId));menu.append(deleteBtn);}menu.append('<br style="clear: both;">');if(FlightPlansController.isTabOfTableArchive(aTable)===false){var updateButtonsMenu=FlightPlansController.createUpdateButtonsMenu(aFlightPlanObject);menu.append(updateButtonsMenu);}else if(AWUtils.isCurrentUserPilotHOMEBRIEFING()===true&&getConfigValue2('flightPlans','showArrBtnForArchive',false)===true){var flCanDo=AWUtils.parseIntElseZero(aFlightPlanObject.FlCanDo);if(!!(flCanDo&0x01)===true&&!!(flCanDo&0x04)===false&&!!(flCanDo&0x0C)===false){var arrFpl=HtmlUtils.buttonFull(null,'ARR');menu.append(arrFpl);var statusCode=AWUtils.parseIntElseZero(aFlightPlanObject.FlStatusCode);if(FlightPlansController.FL_STATUSCODE_ACCEPTED.includes(""+statusCode)===false){arrFpl.addClass('ui-state-disabled');arrFpl.addClass('ui-shadow');}else{arrFpl.click(FlightPlansController.getInstance().createShowArrFormAction(aFlightPlanObject));}}}AWLocale.localeAllObjectsWithChildren(menu);var breakRow=menu.find('br');breakRow.remove();var menuButtons=menu.find('button');var buttonsBlocksToAdd=[];for(var i=0;i<menuButtons.length;i++){var iButton=JQ(menuButtons[i]);iButton.detach();var count=i+5;var buttonBlock=null;switch(count%5){case 0:buttonBlock=divBlockA();break;case 1:buttonBlock=divBlockB();break;case 2:buttonBlock=divBlockC();break;case 3:buttonBlock=divBlockD();break;case 4:buttonBlock=divBlockE();break;}if(AWUtils.isUndefinedOrIsNull(buttonBlock)===false){var iButtonBlock=buttonBlock.append(iButton);buttonsBlocksToAdd.push(iButtonBlock);}}var buttonsGridToAdd=HtmlUtils.divGridDResponsive();buttonsBlocksToAdd.forEach(function(iBtnBlock){if(AWUtils.isUndefinedOrIsNull(iBtnBlock)===true){return;}if(buttonsGridToAdd.length>=5){menu.append(buttonsGridToAdd);buttonsGridToAdd=HtmlUtils.divGridDResponsive();}buttonsGridToAdd.append(iBtnBlock);});if(buttonsGridToAdd.length>0){menu.append(buttonsGridToAdd);}FlightPlansController.updateButtonsMenu=menu;var menuRow=JQ('<tr class="fpl-menu-row bottom-tooltip"></tr>');var menuCell=JQ('<td colspan="'+clickedRow.children().length+'"></td>');menuCell.append(menu);menuRow.append(menuCell);clickedRow.after(menuRow);clickedRow.addClass("fpl-for-menu");menu.trigger("create");}};FlightPlansController.createEmptyFplMenu=function(){var menuDiv=JQ('<div class="fpl-menu">');return menuDiv;};FlightPlansController.createFplMenu=function(fplData,aCallback,aFlightPlanObject){var csign=fplData.ARCID;var adexp=FlightPlanModel.convert2Adexp(fplData);var menuDiv=FlightPlansController.createEmptyFplMenu();if(AppController.aisWeb&&AppController.aisWeb.initialized){var drawRouteBtn=AWUtils.createDrawRouteButton(csign,adexp,csign,aCallback,fplData,aFlightPlanObject);menuDiv.append(drawRouteBtn);}AWUtils.addPibButton(fplData,menuDiv);AWUtils.addMeteoPibButton(menuDiv);return menuDiv;};FlightPlansController.createShowFuaInConflictClickFnc=function(aFplObj,aFlightPlanObject){return function(){console.debug("Clicked Show FUA in conflict");FlightPlansController.closeVerticalProfileIfOpened();var fplObj=FlightPlanModel.convert2Adexp(aFplObj);if(JQ("li.routeListItem").length>getConfigValue('routeSegmentLimitWarning',5)){JQMUtil.showInfoMsg(getLocalizedString("FlightPlan.msg.longTaskInfo"),function(){FlightPlansController.fplPreview(aFlightPlanObject,fplObj);FlightPlansController.openedFuaInConflict=aFlightPlanObject.FlId;});}else{FlightPlansController.fplPreview(aFlightPlanObject,fplObj);FlightPlansController.openedFuaInConflict=aFlightPlanObject.FlId;}if(HtmlUtils.isUndefinedOrIsNull(FlightPlansController._form)===false&&AWUtils.isDrawFUAMerged()===false){FlightPlansController._form.minimize();}};};FlightPlansController.flightPlansControllerPreviewOwnerID='flightPlansControllerPreviewOwnerID';FlightPlansController.fplPreview=function(aFpl,aFplString){FlightProfile.showFlightProfile(aFpl,function(){FlightPlansController.closeVerticalProfileIfOpened();});if(AppController.aisWeb){if(HtmlUtils.isUndefinedOrIsNull(aFpl)===false){var clonedFpl=AWUtils.cloneObject(aFpl);FlightPlansController.prepareModelForGetReliefForFPL(clonedFpl);AWDataHandler.getReliefForFPL(aFplString,function(relief){var flightLog=FlightPlansController.convertFlightPlanModelToFlightLog(aFpl);FlightPlansController.addRouteSegmentsFromRelief(flightLog,relief);var showSegmentsErrorPopup=false;AppController.aisWeb.checkOwnerAndShowFlightPreview(flightLog,relief,FlightPlansController.flightPlansControllerPreviewOwnerID,showSegmentsErrorPopup,getLocalizedString('FlightProfile.flightRouteIsInformative'),'','');});}else{AppController.aisWeb.flightPreview(null,FlightPlansController.flightPlansControllerPreviewOwnerID);}}};FlightPlansController.openedFuaInConflict=null;FlightPlansController.closeVerticalProfileIfOpened=function(){if(FlightPlansController.openedFuaInConflict!==null){FlightPlansController.closeVerticalProfile();}};FlightPlansController.closeVerticalProfile=function(){AppController.aisWeb.flightPreview(null,FlightPlansController.flightPlansControllerPreviewOwnerID);JQ('.flightPreview-toolbar-holder').children().remove();FlightPlansController.openedFuaInConflict=null;};FlightPlansController.isTabOfTableArchive=function(aTable){var tabTypeId=aTable.parent().parent().parent().parent().attr(HtmlUtils.A_ID);if(tabTypeId==='archiveTabID'){return true;}else{return false;}};FlightPlansController.A_UPDATE_FPL_MSG_TYPE='update_fpl_msg_type';FlightPlansController.UPDATE_FPL_MSG_CHG='CHG';FlightPlansController.UPDATE_FPL_MSG_DLA='DLA';FlightPlansController.UPDATE_FPL_MSG_CNL='CNL';FlightPlansController.UPDATE_FPL_MSG_ARR='ARR';FlightPlansController.UPDATE_FPL_MSG_DEP='DEP';FlightPlansController.DISABLED_BUTTONSTATE='ui-state-disabled';FlightPlansController.DISABLE_UPDATE_BTNS_PRIO=['7','4','16','3','1'];FlightPlansController.DISABLE_UPDATE_BTNS_STATUSES={};FlightPlansController.DISABLE_UPDATE_BTNS_STATUSES['alldisabled']=[FlightPlansController.UPDATE_FPL_MSG_CHG,FlightPlansController.UPDATE_FPL_MSG_DLA,FlightPlansController.UPDATE_FPL_MSG_CNL,FlightPlansController.UPDATE_FPL_MSG_ARR,FlightPlansController.UPDATE_FPL_MSG_DEP];FlightPlansController.DISABLE_UPDATE_BTNS_STATUSES['7']=[FlightPlansController.UPDATE_FPL_MSG_CHG,FlightPlansController.UPDATE_FPL_MSG_DLA,FlightPlansController.UPDATE_FPL_MSG_CNL,FlightPlansController.UPDATE_FPL_MSG_ARR,FlightPlansController.UPDATE_FPL_MSG_DEP];FlightPlansController.DISABLE_UPDATE_BTNS_STATUSES['4']=[FlightPlansController.UPDATE_FPL_MSG_CHG,FlightPlansController.UPDATE_FPL_MSG_DLA,FlightPlansController.UPDATE_FPL_MSG_CNL,FlightPlansController.UPDATE_FPL_MSG_ARR,FlightPlansController.UPDATE_FPL_MSG_DEP];FlightPlansController.DISABLE_UPDATE_BTNS_STATUSES['16']=[FlightPlansController.UPDATE_FPL_MSG_CHG,FlightPlansController.UPDATE_FPL_MSG_DLA,FlightPlansController.UPDATE_FPL_MSG_CNL,FlightPlansController.UPDATE_FPL_MSG_DEP];FlightPlansController.DISABLE_UPDATE_BTNS_STATUSES['3']=[];FlightPlansController.DISABLE_UPDATE_BTNS_STATUSES['1']=[];FlightPlansController.singletonInstance=null;FlightPlansController.getInstance=function(){if(FlightPlansController.singletonInstance===null){FlightPlansController.singletonInstance=new FlightPlansController();}return FlightPlansController.singletonInstance;};FlightPlansController.FL_STATUSCODE_ACCEPTED=getConfigValue2('flightPlans','acceptedStatusCodes',['48','53']);FlightPlansController.updateButtonsMenu=null;FlightPlansController.updateButtonsClickEventNamespace='fplupdatebuttons';FlightPlansController.updateButtonsFakeEventName='updateButtonsFake';FlightPlansController.createUpdateButtonsMenu=function(aFlightPlanModel){var fplsController=FlightPlansController.getInstance();var chgFpl=HtmlUtils.buttonFull(null,'CHG');chgFpl.attr(FlightPlansController.A_UPDATE_FPL_MSG_TYPE,FlightPlansController.UPDATE_FPL_MSG_CHG);chgFpl.data(FlightPlansController.updateButtonsFakeEventName,fplsController.createShowChgFormAction(aFlightPlanModel));var dlaFpl=HtmlUtils.buttonFull(null,'DLA');dlaFpl.attr(FlightPlansController.A_UPDATE_FPL_MSG_TYPE,FlightPlansController.UPDATE_FPL_MSG_DLA);dlaFpl.data(FlightPlansController.updateButtonsFakeEventName,fplsController.createShowDlaFormAction(aFlightPlanModel));var cnlFpl=HtmlUtils.buttonFull(null,'CNL');cnlFpl.attr(FlightPlansController.A_UPDATE_FPL_MSG_TYPE,FlightPlansController.UPDATE_FPL_MSG_CNL);cnlFpl.data(FlightPlansController.updateButtonsFakeEventName,fplsController.createShowCnlFormAction(aFlightPlanModel));var arrFpl=HtmlUtils.buttonFull(null,'ARR');arrFpl.attr(FlightPlansController.A_UPDATE_FPL_MSG_TYPE,FlightPlansController.UPDATE_FPL_MSG_ARR);arrFpl.data(FlightPlansController.updateButtonsFakeEventName,fplsController.createShowArrFormAction(aFlightPlanModel));var depFpl=HtmlUtils.buttonFull(null,'DEP');depFpl.attr(FlightPlansController.A_UPDATE_FPL_MSG_TYPE,FlightPlansController.UPDATE_FPL_MSG_DEP);depFpl.data(FlightPlansController.updateButtonsFakeEventName,fplsController.createShowDepFormAction(aFlightPlanModel));var updateDiv=JQ('<div class="fpl-menu"></div>');if(AWUtils.isCurrentUserPilotHOMEBRIEFING()===true){updateDiv.append(chgFpl);updateDiv.append(dlaFpl);updateDiv.append(cnlFpl);var showDepButton=getConfigValue2('flightPlans','showDepBtn',true);if(showDepButton===true){updateDiv.append(depFpl);}var showArrButton=getConfigValue2('flightPlans','showArrBtn',true);if(showArrButton===true){updateDiv.append(arrFpl);}}FlightPlansController.updateButtonsMenu=updateDiv;var disabledUpdateMsgBtns=FlightPlansController.getDisabledUpdateMsgBtns(aFlightPlanModel);FlightPlansController.updateButtonsMenuEnablity(disabledUpdateMsgBtns);return updateDiv;};FlightPlansController.getDisabledUpdateMsgBtns=function(aFlightPlanModel){var flightPlansMode=getConfigValue2('flightPlans','mode','bfbox');switch(flightPlansMode){case'aro':return FlightPlansController.getDisabledUpdMsgBtnsARO(aFlightPlanModel);default:return FlightPlansController.getDisabledUpdMsgBtnsBXBOX(aFlightPlanModel);}};FlightPlansController.getDisabledUpdMsgBtnsARO=function(aFlightPlanModel){switch(aFlightPlanModel.FR){case'V':return FlightPlansController.getDisabledBtnsAroVFR(aFlightPlanModel);default:return FlightPlansController.getDisabledBtnsAroIFR(aFlightPlanModel);}};FlightPlansController.getDisabledBtnsAroVFR=function(aFlightPlanModel){var flStatusCode=parseInt(aFlightPlanModel.FlStatusCode);var fplCanDoCode=parseInt(aFlightPlanModel.FlCanDo);switch(flStatusCode+''+fplCanDoCode){case'400':return[FlightPlansController.UPDATE_FPL_MSG_DEP,FlightPlansController.UPDATE_FPL_MSG_ARR];break;case'390':return[FlightPlansController.UPDATE_FPL_MSG_CHG,FlightPlansController.UPDATE_FPL_MSG_DLA,FlightPlansController.UPDATE_FPL_MSG_ARR,FlightPlansController.UPDATE_FPL_MSG_DEP];case'4817':case'4917':return[FlightPlansController.UPDATE_FPL_MSG_CHG,FlightPlansController.UPDATE_FPL_MSG_DLA,FlightPlansController.UPDATE_FPL_MSG_CNL,FlightPlansController.UPDATE_FPL_MSG_DEP];case'481':case'491':case'111':return[];case'380':case'431':case'480':case'490':case'4317':case'4812':default:return FlightPlansController.DISABLE_UPDATE_BTNS_STATUSES['alldisabled'];}};FlightPlansController.getDisabledBtnsAroIFR=function(aFlightPlanModel){var flStatusCode=parseInt(aFlightPlanModel.FlStatusCode);var fplCanDoCode=parseInt(aFlightPlanModel.FlCanDo);FlightPlansController.DISABLE_UPDATE_BTNS_STATUSES['alldisabled'];switch(flStatusCode+''+fplCanDoCode){case'490':return FlightPlansController.DISABLE_UPDATE_BTNS_STATUSES['alldisabled'];case'400':return[FlightPlansController.UPDATE_FPL_MSG_ARR,FlightPlansController.UPDATE_FPL_MSG_DEP];case'390':return[FlightPlansController.UPDATE_FPL_MSG_CHG,FlightPlansController.UPDATE_FPL_MSG_DLA,FlightPlansController.UPDATE_FPL_MSG_ARR,FlightPlansController.UPDATE_FPL_MSG_DEP];case'500':return FlightPlansController.DISABLE_UPDATE_BTNS_STATUSES['alldisabled'];case'4817':case'4917':case'5317':case'5117':return[FlightPlansController.UPDATE_FPL_MSG_CHG,FlightPlansController.UPDATE_FPL_MSG_DLA,FlightPlansController.UPDATE_FPL_MSG_CNL,FlightPlansController.UPDATE_FPL_MSG_DEP];case'11':case'381':case'481':case'491':case'511':case'531':case'111':case'113':return[];case'380':case'431':case'490':case'510':case'4317':case'4812':case'5313':default:return FlightPlansController.DISABLE_UPDATE_BTNS_STATUSES['alldisabled'];}};FlightPlansController.getDisabledUpdMsgBtnsBXBOX=function(aFlightPlanModel){var fplCanDoCode=parseInt(aFlightPlanModel.FlCanDo);if(fplCanDoCode==="NaN"){fplCanDoCode=0;}var disabledUpdateMsgBtns=null;for(var iKey in FlightPlansController.DISABLE_UPDATE_BTNS_PRIO){var iBtnStateVal=FlightPlansController.DISABLE_UPDATE_BTNS_PRIO[iKey];if(FlightPlansController.DISABLE_UPDATE_BTNS_STATUSES.hasOwnProperty(iBtnStateVal)){if((fplCanDoCode&parseInt(iBtnStateVal))===parseInt(iBtnStateVal)){disabledUpdateMsgBtns=FlightPlansController.DISABLE_UPDATE_BTNS_STATUSES[iBtnStateVal];break;}}}var flStatusCode=aFlightPlanModel.FlStatusCode;if(FlightPlansController.FL_STATUSCODE_ACCEPTED.includes(flStatusCode)===false||HtmlUtils.isUndefinedOrIsNull(disabledUpdateMsgBtns)===true){disabledUpdateMsgBtns=FlightPlansController.DISABLE_UPDATE_BTNS_STATUSES['alldisabled'];}return disabledUpdateMsgBtns;};FlightPlansController._relatedPlansRows=[];FlightPlansController._relatedPlansRowsArchive=[];FlightPlansController.loadAndShowRelatedPlans=function(aNewSelectedPlanID){console.log("New selected Plan:"+aNewSelectedPlanID);var relatedPlansRow=FlightPlansController.loadRelatedPlanTr(aNewSelectedPlanID);if(AWUtils.isUndefinedOrIsNull(relatedPlansRow)===true){return;}FlightPlansController._relatedPlansRows.push(relatedPlansRow);if(relatedPlansRow.is(":visible")===false){FlightPlansController.openRelatedFplContentRow(relatedPlansRow);}else{FlightPlansController.closeRelatedFplContentRow(relatedPlansRow);}};FlightPlansController.loadRelatedPlanTr=function(aNewSelectedPlanID,aSuccessCallback,aErrorCallback){var flightPlanObject=FlightPlansController.getActiveFlightPlan(aNewSelectedPlanID);if(HtmlUtils.isUndefinedOrIsNull(flightPlanObject)===true){if(AWUtils.isUndefinedOrIsNull(aSuccessCallback)===false){aSuccessCallback(null);}return null;}var retValTr=FlightPlanGuiFactory.createRelatedFplCellsRow(flightPlanObject,function(aRelatedFplTr){if(AWUtils.isUndefinedOrIsNull(aSuccessCallback)===false){aSuccessCallback(retValTr);}},function(aRelatedFplTr){if(AWUtils.isUndefinedOrIsNull(aErrorCallback)===false){aErrorCallback(retValTr);}});FlightPlansController.relatedPlansRows[aNewSelectedPlanID]=retValTr;return retValTr;};FlightPlansController.loadAndShowRelatedPlansArchive=function(aNewSelectedPlanID){console.log("New selected Plan in Archive:"+aNewSelectedPlanID);var flightPlanObject=FlightPlansController.getArchiveFlightPlan(aNewSelectedPlanID);if(HtmlUtils.isUndefinedOrIsNull(flightPlanObject)===true){return;}var relatedPlansRow=FlightPlanGuiFactory.createRelatedFplCellsRow(flightPlanObject);FlightPlansController.relatedPlansRowsArchive[aNewSelectedPlanID]=relatedPlansRow;FlightPlansController._relatedPlansRowsArchive.push(relatedPlansRow);if(relatedPlansRow.is(":visible")===false){FlightPlansController.openRelatedFplContentRowInTable(JQ("#archiveTabID").find("#flightPlansResultId table"),relatedPlansRow);}else{FlightPlansController.closeRelatedFplContentRow(relatedPlansRow);}};FlightPlansController.openRelatedFplContentRow=function(aRowElement){if(isUndefinedOrIsNull(aRowElement)===true){return;}var originalTr=FlightPlansController.getOriginalTr(aRowElement.attr('fullrelatedfplinternalid'));originalTr.after(aRowElement);aRowElement.show();};FlightPlansController.openRelatedFplContentRowInTable=function(aTableElement,aRowElement){if(isUndefinedOrIsNull(aRowElement)===true){return;}var originalTr=FlightPlansController.getOriginalTrFromElement(aTableElement,aRowElement.attr('fullrelatedfplinternalid'));originalTr.after(aRowElement);aRowElement.show();};FlightPlansController.closeRelatedFplContentRow=function(aRowElement){aRowElement.remove();};FlightPlansController.getOriginalTr=function(aFplInternalId){var originalTr=JQ('tr[fplinternalid='+aFplInternalId+']');return originalTr;};FlightPlansController.getOriginalTrFromElement=function(aContentElement,aFplInternalId){var originalTr=aContentElement.find('tr[fplinternalid='+aFplInternalId+']');return originalTr;};FlightPlansController.createAirportSelectionListener=function(){var airportSelectionListener=function(aNewSelectedAirport){alert("New selected Airport:"+aNewSelectedAirport);};return airportSelectionListener;};FlightPlansController.formatDate=function(aDate){return(''+aDate.getFullYear()).substring(2)+zeroPad((aDate.getMonth()+1),2)+zeroPad(aDate.getDate(),2)+' '+zeroPad(aDate.getHours(),2)+zeroPad(aDate.getMinutes(),2);};FlightPlansController.parseIbafDate=function(aDateString){var retVal=new Date();var year=aDateString.substring(0,2);var month=aDateString.substring(2,4);var day=aDateString.substring(4,6);var hours=aDateString.substring(7,9);var minutes=aDateString.substring(9,11);retVal.setFullYear((retVal.getFullYear()+'').substring(0,2)+''+year);retVal.setMonth((month-1));retVal.setDate(day);retVal.setHours(hours);retVal.setMinutes(minutes);return retVal;};FlightPlansController.getMaxPageCount=function(aCallBackEvent){if(HtmlUtils.isUndefined(aCallBackEvent)===false&&HtmlUtils.isUndefined(aCallBackEvent.TotalPages)===false){return parseInt(aCallBackEvent.TotalPages);}else{return 0;}};FlightPlansController.getCurrentPageNum=function(aCallBackEvent){if(HtmlUtils.isUndefined(aCallBackEvent)===false&&HtmlUtils.isUndefined(aCallBackEvent.CurrentPage)===false){return parseInt(aCallBackEvent.CurrentPage)+1;}else{return 1;}};FlightPlansController.convertAllIbafDataToFlightPlanModels=function(aCallBackEvent){var retVal=[];if(aCallBackEvent===null||aCallBackEvent===''){return retVal;}var ibafFpls=aCallBackEvent.FPLsArray;if(ibafFpls===null||ibafFpls===''){return retVal;}if(ibafFpls instanceof Array===false){var arr=[];arr.push(ibafFpls);ibafFpls=arr;}for(var i=0;i<ibafFpls.length;i++){var iIbafFpl=ibafFpls[i];if(iIbafFpl===null){continue;}var converted=FlightPlansController.convertIbafDataToFlightPlanModel(iIbafFpl);if(converted===null){continue;}retVal.push(converted);}return retVal;};FlightPlansController.convertIbafDataToFlightPlanModel=function(aIbafFpl){if(HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(aIbafFpl)===true){return null;}function getVal(val){return JQMUtil.toStringOrEmpty(val);}try{const retVal=new FlightPlanModel();const eodbStr=getVal(aIbafFpl.EOBDT);const eodbDate=IbafUtils.parseUtcDateString(eodbStr);retVal.ADEP=getVal(aIbafFpl.ADEP);retVal.ARCID=getVal(aIbafFpl.ARCID);retVal.CTOT=getVal(aIbafFpl.CTOT);retVal.ArcNum=getVal(aIbafFpl.ArcNum);retVal.FR=getVal(aIbafFpl.FlRules);retVal.FlType=getVal(aIbafFpl.FlType);retVal.ATYP=getVal(aIbafFpl.ArcType);retVal.WakeTurbulenceCat=getVal(aIbafFpl.WakeTurbulenceCat);retVal.Equipment=getVal(aIbafFpl.Equipment);retVal.EODB=(eodbDate)?AWUtils.formatDateToAisMobile(eodbDate):eodbStr;retVal.FlSpeed=getVal(aIbafFpl.FlSpeed);retVal.FlLevel=getVal(aIbafFpl.FlLevel);retVal.FlRoute=getVal(aIbafFpl.FlRoute);retVal.FlStatusCode=getVal(aIbafFpl.FlStatusCode);retVal.FlStatusStr=getVal(aIbafFpl.FlStatusStr);retVal.FlCanDo=getVal(aIbafFpl.FlCanDo);retVal.ADES=getVal(aIbafFpl.ADES);retVal.ADAltn1=getVal(aIbafFpl.ADAltn1);retVal.ADAltn2=getVal(aIbafFpl.ADAltn2);retVal.EET=getVal(aIbafFpl.TotalEET);retVal.FlId=getVal(aIbafFpl.FlId);retVal.ETA=AWUtils.formatDateToAisMobile(addMinutesToDateTime(eodbDate,retVal.EET));retVal.FlOther=getVal(aIbafFpl.FlOther);retVal.REG=parseFplRegValue(retVal.FlOther);if(AWUtils.isAddRmkPhone2OtherInfo_NOT_EditableEnabled()===true){AppController.bundleController.getBundle('fplform',function(bundleInstance){if(AWUtils.isUndefinedOrIsNull(bundleInstance)===true){return;}var rmkPhoneForOtherInfo=bundleInstance.getPhoneWithNumberForOtherInfo(false);rmkPhoneForOtherInfo=AWUtils.removeCharsArround(rmkPhoneForOtherInfo,' ','/');retVal.FlOther=retVal.FlOther.replace(rmkPhoneForOtherInfo,HtmlUtils.C_EMPTY).trim();});}retVal.FlSuplementary=getVal(aIbafFpl.FlSuplementary);retVal.PPRFlag=getVal(aIbafFpl.PPRFlag);var flCandoDevVal=getConfigValue2('flightPlans','flCandoDev',false);if(flCandoDevVal!==false){if(flCandoDevVal!==true){retVal.FlCanDo=flCandoDevVal;}retVal.ARCID=retVal.ARCID+'_C'+retVal.FlCanDo;}var flStatusCodeDevVal=getConfigValue2('flightPlans','flStatusCodeDev',false);if(flStatusCodeDevVal!==false){if(flStatusCodeDevVal!==true){retVal.FlStatusCode=flStatusCodeDevVal;}retVal.ARCID=retVal.ARCID+'_S'+retVal.FlStatusCode;}var showRefrehTimeDevVal=getConfigValue2('flightPlans','showRefrehTimeDev',false);if(showRefrehTimeDevVal!==false){var d=new Date();var currentHHMM=d.getMinutes()+":"+d.getSeconds();retVal.ARCID=retVal.ARCID+'_R'+currentHHMM;}return retVal;}catch(e){debug("FlightPlansController: convertIbafDataToFlightPlanModel exception: "+e);return null;}};FlightPlansController.prepareModelForGetReliefForFPL=function(aFpl){delete aFpl.internalID;aFpl.FlRules=aFpl.FR;delete aFpl.FR;aFpl.ArcType=aFpl.ATYP;delete aFpl.ATYP;aFpl.EOBDT=aFpl.EODB;delete aFpl.EODB;delete aFpl.T;delete aFpl.CTOT;delete aFpl.ATD;aFpl.TotalEET=aFpl.EET;delete aFpl.EET;delete aFpl.ETA;delete aFpl.ATA;delete aFpl.OPR;delete aFpl.REG;delete aFpl.STS;delete aFpl.LMS;delete aFpl.LMR;delete aFpl.STATUS;delete aFpl.RMK;delete aFpl.PIB;delete aFpl.MET;};FlightPlansController.convertFlightPlanModelToFlightLog=function(aFlightPlanModel){var retValFlightLog=new Flight();retValFlightLog.id=aFlightPlanModel.FlId;retValFlightLog.userId=null;retValFlightLog.aircraftId=null;retValFlightLog.PIC=FlightPlansController.parseSuplementaryValue(aFlightPlanModel.FlSuplementary,'C');retValFlightLog.crew=null;retValFlightLog.POB=FlightPlansController.parseSuplementaryValue(aFlightPlanModel.FlSuplementary,'P');retValFlightLog.adep=new Location(aFlightPlanModel.ADEP);retValFlightLog.ades=new Location(aFlightPlanModel.ADES);retValFlightLog.alter1=new Location(aFlightPlanModel.ADAltn1);retValFlightLog.alter2=new Location(aFlightPlanModel.ADAltn2);retValFlightLog.etd=AWUtils.parseOnlyTimeOfDateInMinutes(aFlightPlanModel.EODB);if(AWConfigUtils.getPreffiledEOBTInMinutes()!==null){retValFlightLog.etd=AWConfigUtils.getPreffiledEOBTInMinutes();}retValFlightLog.eat=aFlightPlanModel.ETA;retValFlightLog.eet=aFlightPlanModel.EET;retValFlightLog.dof=AWUtils.parseDateTimeToWellFormat(aFlightPlanModel.EODB);if(AWConfigUtils.getPreffiledDOF()!==null){retValFlightLog.dof=AWConfigUtils.getPreffiledDOF()+"T"+retValFlightLog.dof.split("T")[1];}retValFlightLog.rule=aFlightPlanModel.FR;retValFlightLog.rawRule=aFlightPlanModel.FR;retValFlightLog.type=aFlightPlanModel.FlType;retValFlightLog.ias=FlightPlansController.parseIasValue(aFlightPlanModel.FlSpeed);retValFlightLog.iasUnit=FlightPlansController.parseIasUnit(aFlightPlanModel.FlSpeed);retValFlightLog.xstat;retValFlightLog.xflag;retValFlightLog.fuel;retValFlightLog.fuelUnit;retValFlightLog.consumption;retValFlightLog.consumptionUnit;retValFlightLog.flevel=FlightPlansController.parseFLevelValue(aFlightPlanModel.FlLevel);retValFlightLog.flevelUnit=FlightPlansController.parseFLevelUnit(aFlightPlanModel.FlLevel);retValFlightLog.endurance=FlightPlansController.parseEndurance(aFlightPlanModel.FlSuplementary);retValFlightLog.qnh;retValFlightLog.range;retValFlightLog.Aircraft;retValFlightLog.com;retValFlightLog.nav;retValFlightLog.checkFplValidity;retValFlightLog.rawRoute=aFlightPlanModel.FlRoute;retValFlightLog.rawTotalEet=convertMinutesToHHMM(aFlightPlanModel.EET);retValFlightLog.rawOtherInformation=aFlightPlanModel.FlOther;retValFlightLog.rawRemarks=FlightPlansController.parseSuplementaryValue(aFlightPlanModel.FlSuplementary,'N');retValFlightLog.rawPIC=retValFlightLog.PIC;var aircraft=new AircraftModel();aircraft.id=null;aircraft.userId=null;aircraft.registration=aFlightPlanModel.ARCID;aircraft.type=aFlightPlanModel.ATYP;aircraft.colourMark=FlightPlansController.parseSuplementaryValue(aFlightPlanModel.FlSuplementary,'A');aircraft.fuelTaxi=null;aircraft.fuelTaxiUnit=null;aircraft.fuelLanding=null;aircraft.fuelLandingUnit=null;aircraft.holdingTime=null;aircraft.holdingTimeUnit=null;aircraft.fuelTotal=null;aircraft.fuelTotalUnit=null;aircraft.fuelContingency=null;aircraft.fuelContingencyUnit=null;aircraft.turbulency=aFlightPlanModel.WakeTurbulenceCat;aircraft.climbRate=null;aircraft.climbRateUnit=null;aircraft.climbRateCeiling=null;aircraft.climbRateCeilingUnit=null;aircraft.iasClimb=null;aircraft.iasClimbUnit=null;aircraft.fuelBurn=null;aircraft.fuelBurnUnit=null;aircraft.fuelBurnClimb=null;aircraft.fuelBurnClimbUnit=null;aircraft.ias=null;aircraft.iasUnit=null;aircraft.fuelBurnCeiling=null;aircraft.fuelBurnCeilingUnit=null;aircraft.ceilingFl=null;aircraft.ceilingFlUnit=null;aircraft.descentRate=null;aircraft.descentRateUnit=null;aircraft.iasDesc=null;aircraft.iasDescUnit=null;aircraft.fuelBurnDesc=null;aircraft.fuelBurnDescUnit=null;aircraft.emergencyRadio=HtmlUtils.toLowerCase(FlightPlansController.parseSuplementaryValue(aFlightPlanModel.FlSuplementary,'R'));aircraft.survivalEquipment=HtmlUtils.toLowerCase(FlightPlansController.parseSuplementaryValue(aFlightPlanModel.FlSuplementary,'S'));aircraft.lifeJacket=HtmlUtils.toLowerCase(FlightPlansController.parseSuplementaryValue(aFlightPlanModel.FlSuplementary,'J'));aircraft.dinghiesNumber=FlightPlansController.parseDinghiesNumber(aFlightPlanModel.FlSuplementary);aircraft.dinghiesCapacity=FlightPlansController.parseDinghiesCapacity(aFlightPlanModel.FlSuplementary);aircraft.dinghiesCovered=FlightPlansController.parseDinghiesCover(aFlightPlanModel.FlSuplementary);aircraft.dinghiesColour=FlightPlansController.parseDinghiesColor(aFlightPlanModel.FlSuplementary);aircraft.otherComm=null;aircraft.otherNav=null;aircraft.comNav=HtmlUtils.toLowerCase(aFlightPlanModel.Equipment.split('/')[0]);aircraft.comNavEquipment=HtmlUtils.toLowerCase(aFlightPlanModel.Equipment.split('/')[1]);aircraft.nRemarks=HtmlUtils.toLowerCase(FlightPlansController.parseSuplementaryValue(aFlightPlanModel.FlSuplementary,'N'));retValFlightLog.setAircraft(aircraft);return retValFlightLog;};FlightPlansController.addRouteSegmentsFromRelief=function(aFlightLog,aRelief){if(HtmlUtils.isUndefinedOrIsNull(aFlightLog)||HtmlUtils.isUndefinedOrIsNull(aRelief)||HtmlUtils.isUndefinedOrIsNull(aRelief.route)){return;}FlightPlansController.addRouteSegmentsFromRoute(aFlightLog,aRelief.route);};FlightPlansController.addRouteSegmentsFromRoute=function(aFlightLog,aRoute){if(HtmlUtils.isUndefinedOrIsNull(aFlightLog)===true){return;}var segmentsArray=[];var flightRoute=new FlightRoute();if(HtmlUtils.isUndefinedOrIsNull(aRoute)===true||HtmlUtils.isUndefinedOrIsNull(aRoute.segment)===true){flightRoute.setSegments(segmentsArray);aFlightLog.setRoute(flightRoute);return;}if(Array.isArray(aRoute.segment)===true){for(var i=0;i<aRoute.segment.length;i++){var iSegment=aRoute.segment[i];if(HtmlUtils.isUndefinedOrIsNull(iSegment)===true){continue;}var iRouteSegment=FlightPlansController.createRouteSegment(iSegment);segmentsArray.push(iRouteSegment);}}else{var iSegment=aRoute.segment;if(HtmlUtils.isUndefinedOrIsNull(iSegment)===false){var routeSegment=FlightPlansController.createRouteSegment(iSegment);segmentsArray.push(routeSegment);}}flightRoute.setSegments(segmentsArray);aFlightLog.setRoute(flightRoute);};FlightPlansController.createRouteSegment=function(aReliefSegment){var routeSegment=new RouteSegment();var iFromLocation=new Location();iFromLocation.setName(aReliefSegment.fromPoint.name);iFromLocation.setLatitude(aReliefSegment.fromPoint.lat);iFromLocation.setLongitude(aReliefSegment.fromPoint.lng);var iToLocation=new Location();iToLocation.setName(aReliefSegment.toPoint.name);iToLocation.setLatitude(aReliefSegment.toPoint.lat);iToLocation.setLongitude(aReliefSegment.toPoint.lng);routeSegment.setFromPoint(iFromLocation);routeSegment.setToPoint(iToLocation);routeSegment.setHeightUnit(aReliefSegment.heightUnit);routeSegment.setDistance(AWUtils.convertToMeter(aReliefSegment.distance,"km"));routeSegment.setHeight(aReliefSegment.height);return routeSegment;};FlightPlansController.convertHours2Milisec=function(aHours){return(aHours*3600000);};FlightPlansController.showYesNoOption=function(aMessage,aYesFunction){var formatOptions=AWUtils.getFormatOptionsForSendMessagePreview();JQMUtil.showOptionMsgFormated(aMessage,[JQMUtil.yesOption,JQMUtil.noOption],function(optionId){if(optionId===JQMUtil.yesOption.id){aYesFunction();}},formatOptions);};FlightPlansController.parseIasValue=function(aInputString){return aInputString.substr(1);};FlightPlansController.parseIasUnit=function(aInputString){if(HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(aInputString)){return HtmlUtils.C_EMPTY;}return FlightPlanModel.SPEED_MODEL2DB_UNITS[aInputString.substr(0,1)];};FlightPlansController.parseFLevelValue=function(aInputString){if(aInputString.startsWith("VFR")){return aInputString.substr(3);}return aInputString.substr(1);};FlightPlansController.parseFLevelUnit=function(aInputString){if(aInputString.startsWith("VFR")){return aInputString.substr(0,3);}return aInputString.substr(0,1);};FlightPlansController.parseEndurance=function(aSuplementaryString){var retVal=FlightPlansController.parseSuplementaryValue(aSuplementaryString,'E');if(retVal.length===4){var splitedRetVal=retVal.split(HtmlUtils.C_EMPTY);retVal=splitedRetVal[0]+HtmlUtils.C_EMPTY+splitedRetVal[1]+HtmlUtils.C_COLON+splitedRetVal[2]+HtmlUtils.C_EMPTY+splitedRetVal[3];}return retVal;};FlightPlansController.parseDinghiesNumber=function(aSuplementaryString){var retVal=FlightPlansController.parseSuplementaryValue(aSuplementaryString,'D');if(HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(retVal)){return HtmlUtils.C_EMPTY;}var splitedDinghiesValue=retVal.split(HtmlUtils.C_SPACE_CHAR);if(HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(splitedDinghiesValue[0])){return HtmlUtils.C_EMPTY;}return splitedDinghiesValue[0];};FlightPlansController.parseDinghiesCapacity=function(aSuplementaryString){var retVal=FlightPlansController.parseSuplementaryValue(aSuplementaryString,'D');if(HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(retVal)){return HtmlUtils.C_EMPTY;}var splitedDinghiesValue=retVal.split(HtmlUtils.C_SPACE_CHAR);if(HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(splitedDinghiesValue[1])){return HtmlUtils.C_EMPTY;}return splitedDinghiesValue[1];};FlightPlansController.parseDinghiesCover=function(aSuplementaryString){var retVal=FlightPlansController.parseSuplementaryValue(aSuplementaryString,'D');if(HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(retVal)){return HtmlUtils.C_EMPTY;}var splitedDinghiesValue=retVal.split(HtmlUtils.C_SPACE_CHAR);if(HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(splitedDinghiesValue[2])){return HtmlUtils.C_EMPTY;}return splitedDinghiesValue[2];};FlightPlansController.parseDinghiesColor=function(aSuplementaryString){var retVal=FlightPlansController.parseSuplementaryValue(aSuplementaryString,'D');if(HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(retVal)){return HtmlUtils.C_EMPTY;}var splitedSupplementary=retVal.split(' ');var colourArray=[];if(splitedSupplementary[2]==='C'){colourArray=splitedSupplementary.slice('3');}else{colourArray=splitedSupplementary.slice('2');}return colourArray.join(' ');};FlightPlansController.parseSuplementaryValue=function(aSuplementaryFullString,aValueKey){if(HtmlUtils.isUndefinedOrIsNull(aSuplementaryFullString)||HtmlUtils.isUndefinedOrIsNull(aValueKey)){return HtmlUtils.C_EMPTY;}var key=aValueKey+HtmlUtils.C_SLASH_CHAR;if(HtmlUtils.contains(aSuplementaryFullString,key)===false){return HtmlUtils.C_EMPTY;}var splitedByKey=aSuplementaryFullString.split(key);var dirtValue=splitedByKey[1];var retVal=HtmlUtils.C_EMPTY;if(HtmlUtils.contains(dirtValue,HtmlUtils.C_SLASH_CHAR)===false){retVal=dirtValue;}else{var splitedDirtValue=dirtValue.split(HtmlUtils.C_SLASH_CHAR);splitedDirtValue=splitedDirtValue[0].split(HtmlUtils.C_SPACE_CHAR);splitedDirtValue.splice(-1,1);retVal=splitedDirtValue.join(HtmlUtils.C_SPACE_CHAR);}return retVal;};FlightPlansController.transformRoutePointsFromEPSG4326ToMapProjection=function(aRoute){var segments=aRoute.segment;for(var i=0;i<segments.length;i++){var iSegment=segments[i];if(HtmlUtils.isUndefinedOrIsNull(iSegment)===true){continue;}var iFromPoint=iSegment.fromPoint;FlightPlansController.transformPointFromEPSG4326ToMapProjection(iFromPoint);var iToPoint=iSegment.toPoint;FlightPlansController.transformPointFromEPSG4326ToMapProjection(iToPoint);}};FlightPlansController.transformPointFromEPSG4326ToMapProjection=function(aPoint){if(HtmlUtils.isUndefinedOrIsNull(aPoint)===true||HtmlUtils.isUndefinedOrIsNull(aPoint.lng)===true||HtmlUtils.isUndefinedOrIsNull(aPoint.lat)){return;}var epsg4326=new OpenLayers.Projection("EPSG:4326");var place=new Object();place.lon=aPoint.lng;place.lat=aPoint.lat;var lonLat=new OpenLayers.LonLat(parseFloat(place.lon),parseFloat(place.lat)).transform(epsg4326,AppController.mapProjection);aPoint.lng=lonLat.lon;aPoint.lat=lonLat.lat;};FlightPlansController.startLoadingFlightPlans=function(){FlightPlansController._form.loading(true);JQ('#fplPlanTabs').addClass('ui-disabled');};FlightPlansController.stopLoadingFlightPlans=function(){FlightPlansController._form.loading(false);JQ('#fplPlanTabs').removeClass('ui-disabled');};/** * @file FplUserPreferences.js * @author Matej Pončák <matej.poncak@r-sys.sk> * @date Oct 23, 2017 * @brief Manazer (singleton) uzivatelskych nastaveni pre FPL funkcionality * * (C) Copyright 2017  R-SYS,s.r.o */var FplUserPreferencesCtrl=(function(){var _fplUserPrefsKey='FplUserPreferencesCtrl';var _fplUserPrefs=AppController.userPrefs.getValue(_fplUserPrefsKey,true)||{};return{getString:function(aKey,aDefaultValue){if((aKey in _fplUserPrefs)===true&&_fplUserPrefs[aKey]){return _fplUserPrefs[aKey];}else{return aDefaultValue;}},getInt:function(aKey,aDefaultValue){const retVal=this.getString(aKey,aDefaultValue);return parseInt(retVal);},setVal:function(aKey,aValue){_fplUserPrefs[aKey]=aValue;},upload:function(){AppController.userPrefs.setValue(_fplUserPrefsKey,_fplUserPrefs,AwUserPreferences.TYPE.JSON);}};})();/** * @file FlightPlansTable.js * @author Matej Pončák <matej.poncak@r-sys.sk> * @date 18.01.2018 * @brief Kontroler zabezpecujuci tvorbu tabulky letovych planov spolu  * s GUI prvkami ako su vstupne polia filtracie a tlacidla obsluhy * Reset, Apply Filter, Reload Data *  * (C) Copyright 2018  R-SYS,s.r.o */function FlightPlansTable(aFlightPlans,aApplyFunction,aResetFunction,aReloadFunction,aPreviousFilter,aAirportSelectionListener,openRelevantPlansByPlanFunction){FlightPlansTable.singletonPrefix="flightPlansTable";FlightPlansTable.singletonIdSufix="Id";FlightPlansTable.singletonContentSufix="Content";FlightPlansTable.singletonId=FlightPlansTable.singletonPrefix+FlightPlansTable.singletonIdSufix;FlightPlansTable.contentId=FlightPlansTable.singletonPrefix+FlightPlansTable.singletonContentSufix;this._guiFactory;this._plans=null;this._uniqueIDPrexif='';this._applyFunction=aApplyFunction;this.setApplyFunction=function(aFunction){this._applyFunction=aFunction;};this._resetFunction=aResetFunction;this.setResetFunction=function(aFunction){this._resetFunction=aFunction;};this._reloadFunction=aReloadFunction;this.setReloadFunction=function(aFunction){this._reloadFunction=aFunction;};this._previousFilter=aPreviousFilter;this.setPreviousFilter=function(aFilter){this._previousFilter=aFilter;};this._flightPlans=aFlightPlans;this._openRelevantPlansByPlanFunction=openRelevantPlansByPlanFunction;this.setOpenRelevantPlansByPlanFunction=function(aFunction){this._openRelevantPlansByPlanFunction=aFunction;};this.createPanelContent=function(){this._guiFactory=new FlightPlanGuiFactory();this._guiFactory.setUniqueIDPRefix(this._uniqueIDPrexif);var mainDiv=this._guiFactory.createFlightPlanGuiDiv(this._flightPlans,this._applyFunction,this._resetFunction,this._reloadFunction,this._previousFilter,this._openRelevantPlansByPlanFunction);return mainDiv;};this.setLocalizedTextContent=function(){};this.resetInputFields=function(){this._guiFactory.resetInputFields();};this.refreshDatetimeFilterInputs=function(){this._guiFactory.refreshDatetimeFilterInputs();};this.reloadData=function(){this._guiFactory.reloadData();};this.setFlightPlans=function(aPlans,aReloadFnc){this._plans=aPlans;this._guiFactory.setPlans(aPlans,aReloadFnc);};this.getFlightPlans=function(){return this._plans;};this.setVisibleEligiblePlans=function(aEligiblePlans){if(aEligiblePlans===null){aEligiblePlans=[];}this._guiFactory.setVisibleEligiblePlans(aEligiblePlans);};this.getFlightPlanFilter=function(){this._guiFactory.fillFilterFromInput(this._previousFilter);return this._previousFilter;};this.unsetLastSelectedPlanIfIn=function(aPlans){this._guiFactory.unsetLastSelectedPlanIfIn(aPlans);};this.setUniqueIDPrefix=function(aUniqueIDPrefix){this._uniqueIDPrexif=aUniqueIDPrefix;};}FlightPlansTable.createDevPlans=function(aCount){var retVal=[];for(var i=0;i<aCount;i++){var iPlan=new FlightPlanModel();iPlan.ARCID=FlightPlansTable.getRandomArcId();iPlan.FR=FlightPlansTable.getRandomFlightRule();iPlan.ATYP='ATYP'+i;iPlan.ADEP=FlightPlansTable.getRandomAirportShortcut();iPlan.EODB=FlightPlansTable.getRandomEODB();iPlan.T='T';iPlan.CTOT='CTOT';iPlan.ATD='ATD';iPlan.ADES=FlightPlansTable.getRandomAirportShortcut();iPlan.EET='EET';iPlan.ETA=FlightPlansTable.getRandomETA();iPlan.ATA='ATA';iPlan.OPR='OPR';iPlan.REG='REG';iPlan.STS='STS';iPlan.LMS='LMS';iPlan.LMR='LMR';iPlan.STATUS='STATUS';iPlan.RMK='RMK';iPlan.PIB='PIB';iPlan.MET='MET';retVal.push(iPlan);}return retVal;};FlightPlansTable.getRandomAirportShortcut=function(){try{var allAirportList=['LZKZ','LZIB','LKPR','LZIB','LZKZ','LZLU','LZPP','LZPW','LZSL','LZZI','LZTT','LZDB','LZHL'];return allAirportList[Math.floor(Math.random()*allAirportList.length)];}catch(e){return'';}};FlightPlansTable.getRandomFlightRule=function(){try{var allFrTypes=['I','V'];return allFrTypes[Math.floor(Math.random()*allFrTypes.length)];}catch(e){return'';}};FlightPlansTable.getRandomArcId=function(){return('OM-'+AWUtils.createRandomHash());};FlightPlansTable.getRandomETA=function(){var date=new Date();date.setTime(date.getTime()-(Math.random()*1000000000));return FlightPlansController.formatDate(date);};FlightPlansTable.getRandomEODB=function(){return FlightPlansTable.getRandomETA();};FlightPlansTable.createBackgroundColorLegend=function(){var retVal=JQ("<div>");var colorDef=getConfigValue2("flightPlans","backgroundColor");if(colorDef!==undefined){var keys=Object.keys(colorDef);if(keys.length>0){var label=JQ('<label>');var values=JQ('<div>');label.attr(AWLocale.LOCALISATION_KEY,"FlightPlansTable.colorLegend");retVal.append(label);JQ.each(keys,function(idx,key){var def=colorDef[key];var div=JQ("<div>");AWLocale.localizeJqElement(div,"FlightPlansTable.colorLegend.stat."+key);div.css('background-color',def.color);values.append(div);});values.addClass("flightPlans-colorLegend-values");retVal.append(values);}}retVal.addClass("flightPlans-colorLegend");return retVal;};/** * @file FlightPlanGuiFactory.js * @author Matej PonÄŤĂˇk <matej.poncak@r-sys.sk> * @date 18.01.2018 * @brief Trieda zabezpecujuca tvorbu GUI panela "Flight Plans" *  * (C) Copyright 2018  R-SYS,s.r.o */function FlightPlanGuiFactory(){var mThisInstance=this;this.timeFormat='HHMM';this.dateFormat='YYYY-MM-DD';this._labelSuffix='_label';this._utcGtEtaInput;this._utcGtEobtInput;this._utcLtEtaInput;this._arcid;this._adep;this._ades;this._dateFrom;this._timeFrom;this._dateTo;this._timeTo;this._adepOrAdes;this._adepAndAdesNot;this._eodbtFromDate;this._eodbtFromTime;this._eodbtTillDate;this._eodbtTillTime;this._etaFromDate;this._etaFromTime;this._etaTillDate;this._etaTillTime;this._hideIfrFlightCheckBox;this._hideVfrFlightCheckBox;this._collapsibleResult;this._hideClnFlightCheckBox;this._hideArrFlightCheckBox;this._hideTstFlightCheckBox;this._showOwnFlightCheckBox;this._flightRulesCombobox;FlightPlanGuiFactory.DEFAULT_PADDING='padding: 0px 5px;';FlightPlanGuiFactory.STYLE_NAME='style';FlightPlanGuiFactory.DEFAULT_SORTING_COL='ARCID';FlightPlanGuiFactory.DEFAULT_SORTING_ORDER='ASC';this._eligiblePlans;this._tableRows=[];this._showRelatedPlanFunction;this._uniqueIDPrexif='';this.resetInputFields=function(){this.resetAllInputFields();this.resetAllCheckBoxes();this.resetAllComboBoxes();this.showAllRows();};this.resetAllInputFields=function(){var allInputFields=this.getAllInputFields();for(var i in allInputFields){var iInputField=allInputFields[i];this.setNotNullTextInputValue(iInputField,'');}};this.resetAllCheckBoxes=function(){var allcheckBoxes=this.getAllCheckboxes();for(var i in allcheckBoxes){var iCheckbox=allcheckBoxes[i];this.setNotNullCheckBoxValue(iCheckbox,false);}};this.resetAllComboBoxes=function(){var allComboboxes=this.getAllComboboxes();var defaultFilter=new FlightPlanFilter();for(var i in allComboboxes){var iCombobox=allComboboxes[i];setNotNullComboboxValue(iCombobox,defaultFilter[i]);}};this.showAllRows=function(){for(var i=0;i<this._tableRows.length;i++){var iTableRow=this._tableRows[i];iTableRow.show();}AWUtils.markEvenTableRows(this._collapsibleResult.find('table'));};this.fillFilterFromInput=function(aFilter){if(aFilter===null){return;}var allInputFields=this.getAllInputFields();var allcheckBoxes=this.getAllCheckboxes();var allComboboxes=this.getAllComboboxes();for(var prop in aFilter){if(prop in allInputFields){var iInputField=allInputFields[prop];this.fillNotNullFromTextInputValue(iInputField,prop,aFilter);}else if(prop in allcheckBoxes){var iCheckbox=allcheckBoxes[prop];this.fillNotNullFromCheckBoxValue(iCheckbox,prop,aFilter);}else if(prop in allComboboxes){var iCombobox=allComboboxes[prop];fillNotNullFromComboboxValue(iCombobox,prop,aFilter);}}};this.getAllInputFields=function(){var retVal={'utcGtEtaHours':this._utcGtEtaInput,'utcGtEobtHours':this._utcGtEobtInput,'utcLtEtaHours':this._utcLtEtaInput,'arcidIs':this._arcid,'adepIs':this._adep,'adesIs':this._ades,'dateFromIs':this._dateFrom,'timeFromIs':this._timeFrom,'dateToIs':this._dateTo,'timeToIs':this._timeTo,'adepOrAdesIs':this._adepOrAdes,'adepAndAdesIsNot':this._adepAndAdesNot,'eodbtFromDate':this._eodbtFromDate,'eodbtFromTime':this._eodbtFromTime,'eodbtTillDate':this._eodbtTillDate,'eodbtTillTime':this._eodbtTillTime,'etaFromDate':this._etaFromDate,'etaFromTime':this._etaFromTime,'etaTillDate':this._etaTillDate,'etaTillTime':this._etaTillTime};return retVal;};this.getAllCheckboxes=function(){var retVal={'hideIfrFlights':this._hideIfrFlightCheckBox,'hideVfrFlights':this._hideVfrFlightCheckBox,'showOwnFlights':this._showOwnFlightCheckBox};return retVal;};this.getAllComboboxes=function(){var retVal={'flightRules':this._flightRulesCombobox};return retVal;};this.setPlans=function(aPlans,aReloadFnc){var parentInstance=this;var resultTable=this.createResultTable(aPlans,function(aTableDiv){parentInstance._collapsibleResult.find('table').parent().remove();parentInstance._collapsibleResult.find('.ui-collapsible-content').append(aTableDiv);},function(aTableDiv){parentInstance._collapsibleResult.find('table').parent().remove();parentInstance._collapsibleResult.find('.ui-collapsible-content').append(aTableDiv);},aReloadFnc);};this.lastShowedPlanID=null;this.setVisibleEligiblePlans=function(aEligiblePlans){FlightPlansController.closeOpenedRowContents();if(this.lastShowedPlanID!==null){this._showRelatedPlanFunction(this.lastShowedPlanID);}if(aEligiblePlans===null){aEligiblePlans=[];}for(var i=0;i<this._tableRows.length;i++){var iTableRow=this._tableRows[i];iTableRow.hide();for(var j=0;j<aEligiblePlans.length;j++){var iFlightPlan=aEligiblePlans[j];if(iFlightPlan.internalID===iTableRow.attr('fplinternalid')){iTableRow.show();}}}AWUtils.markEvenTableRows(this._collapsibleResult.find('table'));};this.unsetLastSelectedPlanIfIn=function(aPlans){if(this.lastShowedPlanID===null){return;}for(var i=0;i<aPlans.length;i++){var iPlan=aPlans[i];if(iPlan===null){continue;}if(iPlan.FlId===this.lastShowedPlanID){this.lastShowedPlanID=null;break;}}};this.mainElement=null;FlightPlanGuiFactory.SKIP_RELOAD_BY_PAGINATION=false;this.createFlightPlanGuiDiv=function(aFlightPlans,aApplyFunction,aResetFunction,aReloadFunction,aPreviousFilter,aShowNoticefunction){if(this._uniqueIDPrexif===FPLFormModel.C_ArchiveTable){return this.createFlightPlanGuiDivArchive(aFlightPlans,aApplyFunction,aResetFunction,aReloadFunction,aPreviousFilter,aShowNoticefunction);}else{return this.createFlightPlanGuiDivActive(aFlightPlans,aApplyFunction,aResetFunction,aReloadFunction,aPreviousFilter,aShowNoticefunction);}};this.createFlightPlanGuiDivActive=function(aFlightPlans,aApplyFunction,aResetFunction,aReloadFunction,aPreviousFilter,aShowNoticefunction){this._showRelatedPlanFunction=aShowNoticefunction;var filterInputsGrid=this.createFilterInputsGrid(aPreviousFilter);var filterButtonsGrid=this.createFilterButtonsGrid(aPreviousFilter,aApplyFunction,aResetFunction,aReloadFunction);var filterBlock=divBlockA(filterInputsGrid);var buttonsBlock=divBlockB(filterButtonsGrid);var inputsGrid=divGridA();inputsGrid.addClass('fpls-table-filters');inputsGrid.addClass('my-breakpoint');inputsGrid.append(filterBlock);inputsGrid.append(buttonsBlock);this._collapsibleResult=this.createFlightPlansCollapsibleContent(aFlightPlans,aReloadFunction);var retVal=divGridSolo();retVal.attr(HtmlUtils.A_ID,'flightPlansFilterDiv');retVal.append(inputsGrid);retVal.append(this.createNoteLabel());retVal.append(divGridSolo(this._collapsibleResult));this.mainElement=retVal;return retVal;};this.createFlightPlanGuiDivArchive=function(aFlightPlans,aApplyFunction,aResetFunction,aReloadFunction,aPreviousFilter,aShowNoticefunction){this._showRelatedPlanFunction=aShowNoticefunction;var filterInputsGrid=this.createFilterInputsGrid(aPreviousFilter);var filterButtonsGrid=this.createFilterButtonsGrid(aPreviousFilter,aApplyFunction,aResetFunction,aReloadFunction);var dateTimeRangeGrid=this.createDateTimeRangeFilters(aPreviousFilter);var filterBlock=divBlockA(filterInputsGrid);var dateTimeRangeBlock=divBlockB(dateTimeRangeGrid);var filterWithDateInputsGrid=divGridA();filterWithDateInputsGrid.addClass('fpls-table-filters');filterWithDateInputsGrid.addClass('my-breakpoint');filterWithDateInputsGrid.append(filterBlock);filterWithDateInputsGrid.append(dateTimeRangeBlock);var noteBlock=divBlockA(this.createNoteLabel());var buttonsBlock=divBlockB(filterButtonsGrid);var noteWithButtonsGrid=divGridA();noteWithButtonsGrid.addClass('my-breakpoint');noteWithButtonsGrid.append(noteBlock);noteWithButtonsGrid.append(buttonsBlock);this._collapsibleResult=this.createFlightPlansCollapsibleContent(aFlightPlans,aReloadFunction);var retVal=divGridSolo();retVal.append(filterWithDateInputsGrid);retVal.append(noteWithButtonsGrid);retVal.append(this._collapsibleResult);this.mainElement=retVal;return retVal;};this.createFlightPlansCollapsibleContent=function(aFlightPlans,aReloadFunction){var collapsibleResultContentDiv=HtmlUtils.div(null);var paginationRow=this.createTablePagination(this.createPaginationID(),function(aNewPageNum){if(FlightPlanGuiFactory.SKIP_RELOAD_BY_PAGINATION===true){return;}console.debug("Zmenila sa stranka na:"+aNewPageNum);aReloadFunction();},function(){console.debug("Zmenil sa pocet na stranku");if(FlightPlanGuiFactory.SKIP_RELOAD_BY_PAGINATION===true){return;}aReloadFunction();});collapsibleResultContentDiv.append(paginationRow);collapsibleResultContentDiv.append(this.createResultTable(aFlightPlans,null,null,aReloadFunction));return this.createCollapsibleContent('flightPlansResultId',getLocaleKey("Result"),collapsibleResultContentDiv);};this.createPaginationID=function(){return this._uniqueIDPrexif+'Pagination';};this.createFilterInputsGrid=function(aFilter){var retVal=this.createAirportsFilters(aFilter);return retVal;};this.createFilterButtonsGrid=function(aFilter,aApplyFunction,aResetFunction,aReloadFunction){var divGridButtons=this.createControllButtons(aFilter,aApplyFunction,aResetFunction,aReloadFunction);return divGridButtons;};this.createUtcFilters=function(aFilter){var utcGtEtaBlock=this.createUtcGtEtaBlock(aFilter);var utcGtEobtBlock=this.createUtcGtEobtBlock(aFilter);var utcLtEtaBlock=this.createUtcLtEtaBlock(aFilter);var areasDiv=divGridB(null);areasDiv.append(divBlockA(utcGtEtaBlock));areasDiv.append(divBlockB(utcGtEobtBlock));areasDiv.append(divBlockC(utcLtEtaBlock));return areasDiv;};this.createUtcGtEtaBlock=function(aFilter){var id=FlightPlanGuiFactory.nextId();var utcGtEtaLabel=createLabel(getLocaleKey('hideOldFlightsWhereUtcGtEta'),id);this._utcGtEtaInput=createTextInput(getLocaleKey('hrs'),id);this.setNotNullTextInputValue(this._utcGtEtaInput,aFilter.utcGtEtaHours);return twoRowedDivGridSolo(utcGtEtaLabel,this._utcGtEtaInput);};this.createUtcGtEobtBlock=function(aFilter){var id=FlightPlanGuiFactory.nextId();var utcGtEobtLabel=createLabel(getLocaleKey('activeFlightsOnlyWhereUtcGtEobt'),id);this._utcGtEobtInput=createTextInput(getLocaleKey('hrs'),id);this.setNotNullTextInputValue(this._utcGtEobtInput,aFilter.utcGtEobtHours);return twoRowedDivGridSolo(utcGtEobtLabel,this._utcGtEobtInput);};this.createUtcLtEtaBlock=function(aFilter){var id=FlightPlanGuiFactory.nextId();var utcLtEtaLabel=createLabel(getLocaleKey('andUtcLtEta'),id);this._utcLtEtaInput=createTextInput(getLocaleKey('hrs'),id);this.setNotNullTextInputValue(this._utcLtEtaInput,aFilter.utcLtEtaHours);return twoRowedDivGridSolo(utcLtEtaLabel,this._utcLtEtaInput);};this.createAirportsFilters=function(aFilter){var arcidModel=this.createArcidModel(aFilter);var adepModel=this.createAdepModel(aFilter);var adesModel=this.createAdesModel(aFilter);var flightRuleModel=this.createFlightRulesModel(aFilter);var arcidColumn=divBlockA();arcidColumn.append(divGridSolo(arcidModel.label));arcidColumn.append(divGridSolo(arcidModel.input));var adepColumn=divBlockB();adepColumn.append(divGridSolo(adepModel.label));adepColumn.append(divGridSolo(adepModel.input));var adesColumn=divBlockC();adesColumn.append(divGridSolo(adesModel.label));adesColumn.append(divGridSolo(adesModel.input));var flightRuleColumn=divBlockD();flightRuleColumn.append(divGridSolo(flightRuleModel.label));flightRuleColumn.append(divGridSolo(flightRuleModel.input));var retValGrid=divGridC();retValGrid.addClass('airports-row-grid');retValGrid.append(arcidColumn);retValGrid.append(adepColumn);retValGrid.append(adesColumn);retValGrid.append(flightRuleColumn);return retValGrid;};this._dateFromFilterInput;this._dateToFilterInput;this.createDateTimeRangeFilters=function(aFilter){var dateFromModel=this.createDateFromdModel(aFilter);var timeFromModel=this.createTimeFromModel(aFilter);var timeFromObject=timeFromModel.input;this._dateFromFilterInput=dateFromModel.input;this._dateFromFilterInput.change(this.createTimepickerDisablerChangeListener(this._dateFromFilterInput,timeFromObject));var dateFromBlock=divBlockA();dateFromBlock.append(divGridSolo(dateFromModel.label));dateFromBlock.append(divGridSolo(this._dateFromFilterInput).addClass('datetime-input-grid'));var timeFromBlock=divBlockB();timeFromBlock.append(divGridSolo(timeFromModel.label));timeFromBlock.append(divGridSolo(timeFromObject).addClass('datetime-input-grid'));var dateToModel=this.createDateToModel(aFilter);var timeToModel=this.createTimeToModel(aFilter);this._dateToFilterInput=dateToModel.input;this._dateToFilterInput.change(this.createTimepickerDisablerChangeListener(this._dateToFilterInput,timeToModel.input));var dateToBlock=divBlockC();dateToBlock.append(divGridSolo(dateToModel.label));dateToBlock.append(divGridSolo(this._dateToFilterInput).addClass('datetime-input-grid'));var timeToBlock=divBlockD();timeToBlock.append(divGridSolo(timeToModel.label));timeToBlock.append(divGridSolo(timeToModel.input).addClass('datetime-input-grid'));var retVal=divGridC();retVal.addClass('datetime-row-grid');retVal.append(dateFromBlock);retVal.append(timeFromBlock);retVal.append(dateToBlock);retVal.append(timeToBlock);return retVal;};this.refreshDatetimeFilterInputs=function(){if(AWUtils.isUndefinedOrIsNull(this._dateFromFilterInput)===false){this._dateFromFilterInput.change();}if(AWUtils.isUndefinedOrIsNull(this._dateToFilterInput)===false){this._dateToFilterInput.change();}};this.createTimepickerDisablerChangeListener=function(aCheckedInput,aTimePicker){return function(){var checkingVal=aCheckedInput.val();var enableInput=true;if((AWUtils.isUndefinedOrIsNull(checkingVal)===true||AWUtils.isEmptyString(checkingVal)===true)||AWUtils.isDateFormatCorrect(checkingVal)===false){enableInput=false;}if(enableInput){HtmlUtils.enableTimepicker(aTimePicker);}else{HtmlUtils.disableTimepicker(aTimePicker);}};};this.createArcidModel=function(aFilter){var arcidId=FlightPlanGuiFactory.nextId();var arcidLabel=createLabel('ARCID',arcidId);this._arcid=createTextInput('',arcidId);this._arcid.addClass('uppercaseinput');this.setNotNullTextInputValue(this._arcid,aFilter.arcidIs);return HtmlUtils.createLabeledInputModel(arcidLabel,this._arcid);};this.createAdepModel=function(aFilter){var adepId=FlightPlanGuiFactory.nextId();var adepLabel=createLabel('*ADEP',adepId);this._adep=createTextInput('',adepId);this._adep.addClass('uppercaseinput');this.setNotNullTextInputValue(this._adep,aFilter.adepIs);return HtmlUtils.createLabeledInputModel(adepLabel,this._adep);};this.createAdesModel=function(aFilter){var adesId=FlightPlanGuiFactory.nextId();var adesLabel=createLabel('*ADES',adesId);this._ades=createTextInput('',adesId);this._ades.addClass('uppercaseinput');this.setNotNullTextInputValue(this._ades,aFilter.adesIs);return HtmlUtils.createLabeledInputModel(adesLabel,this._ades);};this.createFlightRulesBlock=function(aFilter){var id=FlightPlanGuiFactory.idPrefix+'flightruleselect';var flightRulesLabel=createLabel(getLocaleKey('FlightRule'),id);this._flightRulesCombobox=createCombobox(id,{ifrvfr:'IFR + VFR',ifr:'IFR',vfr:'VFR'});this._flightRulesCombobox.val(aFilter.flightRules);var retVal=twoRowedDivGridSolo(flightRulesLabel,this._flightRulesCombobox);return retVal;};this.createFlightRulesModel=function(aFilter){var id=FlightPlanGuiFactory.idPrefix+'flightruleselect';var flightRulesLabel=createLabel(getLocaleKey('FlightRule'),id);this._flightRulesCombobox=createCombobox(id,{ifrvfr:'IFR + VFR',ifr:'IFR',vfr:'VFR'});this._flightRulesCombobox.val(aFilter.flightRules);return HtmlUtils.createLabeledInputModel(flightRulesLabel,this._flightRulesCombobox);};this.createDateFromdModel=function(aFilter){var dateFromId=FlightPlanGuiFactory.nextId();var dateFromLabel=createLabel('FlightPlanFilter.DateFrom',dateFromId);this._dateFrom=HtmlUtils.createCalboxInput("",dateFromId);this._dateFrom.addClass('uppercaseinput filterdatetimeinput');this.setNotNullTextInputValue(this._dateFrom,aFilter.dateFromIs);return HtmlUtils.createLabeledInputModel(dateFromLabel,this._dateFrom);};this.createTimeFromModel=function(aFilter){var timeFromId=FlightPlanGuiFactory.nextId();var timeFromLabel=createLabel('FlightPlanFilter.TimeFrom',timeFromId);this._timeFrom=HtmlUtils.createTimeInput('',timeFromId);this._timeFrom.addClass('uppercaseinput filterdatetimeinput');this.setNotNullTextInputValue(this._timeFrom,aFilter.timeFromIs);return HtmlUtils.createLabeledInputModel(timeFromLabel,this._timeFrom);};this.createDateToModel=function(aFilter){var dateToId=FlightPlanGuiFactory.nextId();var dateToLabel=createLabel('FlightPlanFilter.DateTo',dateToId);this._dateTo=HtmlUtils.createCalboxInput('',dateToId);this._dateTo.addClass('uppercaseinput filterdatetimeinput');this.setNotNullTextInputValue(this._dateTo,aFilter.dateToIs);return HtmlUtils.createLabeledInputModel(dateToLabel,this._dateTo);};this.createTimeToModel=function(aFilter){var timeToId=FlightPlanGuiFactory.nextId();var timeToLabel=createLabel('FlightPlanFilter.TimeTo',timeToId);this._timeTo=HtmlUtils.createTimeInput('',timeToId);this._timeTo.addClass('uppercaseinput filterdatetimeinput');this.setNotNullTextInputValue(this._timeTo,aFilter.timeToIs);return HtmlUtils.createLabeledInputModel(timeToLabel,this._timeTo);};this.createTimeRangeFilters=function(aFilter){var retValDiv=div(null);retValDiv.append(this.createEodbTimeRangeRow(aFilter));retValDiv.append(this.createEtaTimeRangeRow(aFilter));return retValDiv;};this.createEodbTimeRangeRow=function(aFilter){var eodbtFromDiv=this.createEodbtFromDiv(aFilter);var eodbtTillDiv=this.createEodbtTillDiv(aFilter);var eodbtDiv=divGridA(null);eodbtDiv.append(divBlockA(eodbtFromDiv));eodbtDiv.append(divBlockB(eodbtTillDiv));return eodbtDiv;};this.createEodbtFromDiv=function(aFilter){var eodbtFromId=FlightPlanGuiFactory.nextId();var eodbtFromTimestampId=FlightPlanGuiFactory.nextId();this._eodbtFromDate=createDateInput(this.dateFormat,eodbtFromId);this._eodbtFromTime=createTimeInput(this.timeFormat,eodbtFromTimestampId);this.setNotNullTextInputValue(this._eodbtFromTime,aFilter.eodbtFrom);var eodbtFromInputDiv=divGridA(null);eodbtFromInputDiv.append(divBlockA(this._eodbtFromDate));eodbtFromInputDiv.append(divBlockB(this._eodbtFromTime));var eodbtFromLabel=createLabel(getLocaleKey('eobtFrom'),eodbtFromId);return twoRowedDivGridSolo(eodbtFromLabel,eodbtFromInputDiv);};this.createEodbtTillDiv=function(aFilter){var eodbtTillId=FlightPlanGuiFactory.nextId();var eodbtTillTimestampId=FlightPlanGuiFactory.nextId();this._eodbtTillDate=createDateInput(this.dateFormat,eodbtTillId);this._eodbtTillTime=createTimeInput(this.timeFormat,eodbtTillTimestampId);this.setNotNullTextInputValue(this._eodbtTillTime,aFilter.eodbtTill);var eodbtTillInputDiv=divGridA(null);eodbtTillInputDiv.append(divBlockA(this._eodbtTillDate));eodbtTillInputDiv.append(divBlockB(this._eodbtTillTime));var eodbtTillLabel=createLabel(getLocaleKey('eobtTill'),eodbtTillId);return twoRowedDivGridSolo(eodbtTillLabel,eodbtTillInputDiv);};this.createEtaTimeRangeRow=function(aFilter){var etaFromDiv=this.createEtaFromDiv(aFilter);var etaTillDiv=this.createEtaTillDiv(aFilter);var etaDiv=divGridA(null);etaDiv.append(divBlockA(etaFromDiv));etaDiv.append(divBlockB(etaTillDiv));return etaDiv;};this.createEtaFromDiv=function(aFilter){var etaFromId=FlightPlanGuiFactory.nextId();var etaFromTimestampId=FlightPlanGuiFactory.nextId();this._etaFromDate=createDateInput(this.dateFormat,etaFromId);this._etaFromTime=createTimeInput(this.timeFormat,etaFromTimestampId);this.setNotNullTextInputValue(this._etaFromTime,aFilter.etaFrom);var etaFromInputDiv=divGridA(null);etaFromInputDiv.append(divBlockA(this._etaFromDate));etaFromInputDiv.append(divBlockB(this._etaFromTime));var etaFromLabel=createLabel(getLocaleKey('ETAFrom'),etaFromId);return twoRowedDivGridSolo(etaFromLabel,etaFromInputDiv);};this.createEtaTillDiv=function(aFilter){var etaTillId=FlightPlanGuiFactory.nextId();var etaTillTimestampId=FlightPlanGuiFactory.nextId();this._etaTillDate=createDateInput(this.dateFormat,etaTillId);this._etaTillTime=createTimeInput(this.timeFormat,etaTillTimestampId);this.setNotNullTextInputValue(this._etaTillTime,aFilter.etaTill);var etaTillInputDiv=divGridA(null);etaTillInputDiv.append(divBlockA(this._etaTillDate));etaTillInputDiv.append(divBlockB(this._etaTillTime));var etaTillLabel=createLabel(getLocaleKey('ETATill'),etaTillId);return twoRowedDivGridSolo(etaTillLabel,etaTillInputDiv);};this.createFlightStateFilters=function(aFilter){var hideIfrId=FlightPlanGuiFactory.nextId();var hideVfrId=FlightPlanGuiFactory.nextId();var hideClnId=FlightPlanGuiFactory.nextId();var hideArrId=FlightPlanGuiFactory.nextId();var hideTestId=FlightPlanGuiFactory.nextId();this._hideIfrFlightCheckBox=this.createLabeledCheckBox(getLocaleKey('HideIFRFlights'),hideIfrId,aFilter.hideIfrFlights);this._hideVfrFlightCheckBox=this.createLabeledCheckBox(getLocaleKey('HideVFRflights'),hideVfrId,aFilter.hideVfrFlights);this._hideIfrFlightCheckBox.attr(FlightPlanGuiFactory.STYLE_NAME,FlightPlanGuiFactory.DEFAULT_PADDING);this._hideVfrFlightCheckBox.attr(FlightPlanGuiFactory.STYLE_NAME,FlightPlanGuiFactory.DEFAULT_PADDING);this._hideClnFlightCheckBox=this.createLabeledCheckBox(getLocaleKey('HideFlightsInCLNstatus'),hideClnId,aFilter.hideFlightInClnStatus);this._hideArrFlightCheckBox=this.createLabeledCheckBox(getLocaleKey('HideFlightsInARRStatus'),hideArrId,aFilter.hideFlightInArrStatus);this._hideTstFlightCheckBox=this.createLabeledCheckBox(getLocaleKey('HideTestFlights'),hideTestId,aFilter.hideTestFlight);this._hideTstFlightCheckBox.attr('class','ui-disabled');this._hideClnFlightCheckBox.attr('class','ui-disabled');this._hideArrFlightCheckBox.attr('class','ui-disabled');var divA=divBlockA(this._hideIfrFlightCheckBox);var divB=divBlockB(this._hideVfrFlightCheckBox);var divC=divBlockC(this._hideClnFlightCheckBox);var divD=divBlockD(this._hideArrFlightCheckBox);var divAA=divBlockA(this._hideTstFlightCheckBox);var retValDiv=divGridA(null);retValDiv.append(divA);retValDiv.append(divB);return retValDiv;};this.createNoteLabel=function(){const retValDiv=divGridSolo(null);retValDiv.append(divBlockA(createLabel(getLocaleKey('noteTextWithExample'),FlightPlanGuiFactory.nextId())));retValDiv.attr(FlightPlanGuiFactory.STYLE_NAME,FlightPlanGuiFactory.DEFAULT_PADDING);retValDiv.addClass('filterNoteLabelGrid');return retValDiv;};this.createControllButtons=function(aFilter,aApplyFunction,aResetFunction,aReloadFunction){var inputElementsArray=[];if(AWUtils.isCurrentUserAroSupervisor()===true){var ownFlCheckBox=HtmlUtils.createLabeledCheckbox('ownFlCheckbox',"FlightPlanFilter.MyFPL",''+aFilter.showOwnFlights,'','d');ownFlCheckBox.find("div[class!='ui-checkbox']").remove();ownFlCheckBox.find("input[type='checkbox']:first").attr("checked",(aFilter.showOwnFlights==='true'?true:false)).checkboxradio().checkboxradio("refresh");this._showOwnFlightCheckBox=ownFlCheckBox;inputElementsArray.push(ownFlCheckBox);}var resetButtonLocale=getLocaleKey("Reset");var resetButton=createButton(resetButtonLocale,FlightPlanGuiFactory.nextId(),aResetFunction);resetButton.addClass('bottom-tooltip');AWUtils.addLocalizedTooltip(resetButton,resetButtonLocale);inputElementsArray.push(resetButton);var applyFilterButtonlocale=getLocaleKey("ApplyFilter");var applyFilterButton=createButton(applyFilterButtonlocale,FlightPlanGuiFactory.nextId(),aApplyFunction);applyFilterButton.addClass('bottom-tooltip');AWUtils.addLocalizedTooltip(applyFilterButton,applyFilterButtonlocale);inputElementsArray.push(applyFilterButton);var reloadButtonLocale=getLocaleKey("Reload");var reloadButton=createButton(reloadButtonLocale,FlightPlanGuiFactory.nextId(),aReloadFunction);reloadButton.addClass('bottom-tooltip');AWUtils.addLocalizedTooltip(reloadButton,reloadButtonLocale);inputElementsArray.push(reloadButton);var retValDiv;if(inputElementsArray.length===4){retValDiv=divGridC(null);}else{retValDiv=divGridB(null);}var blockA=divBlockA();blockA.append(this.createBlankDivGridSolo());blockA.append(divGridSolo(inputElementsArray[0]));blockA.attr(FlightPlanGuiFactory.STYLE_NAME,FlightPlanGuiFactory.DEFAULT_PADDING);retValDiv.append(blockA);var blockB=divBlockB();blockB.append(this.createBlankDivGridSolo());blockB.append(divGridSolo(inputElementsArray[1]));blockB.attr(FlightPlanGuiFactory.STYLE_NAME,FlightPlanGuiFactory.DEFAULT_PADDING);retValDiv.append(blockB);var blockC=divBlockC();blockC.append(this.createBlankDivGridSolo());blockC.append(divGridSolo(inputElementsArray[2]));blockC.attr(FlightPlanGuiFactory.STYLE_NAME,FlightPlanGuiFactory.DEFAULT_PADDING);retValDiv.append(blockC);if(inputElementsArray.length===4){var blockD=divBlockD();blockD.append(this.createBlankDivGridSolo());blockD.append(divGridSolo(inputElementsArray[3]));blockD.attr(FlightPlanGuiFactory.STYLE_NAME,FlightPlanGuiFactory.DEFAULT_PADDING);retValDiv.append(blockD);}retValDiv.addClass('filterbuttons-row-grid');return retValDiv;};this.createBlankDivGridSolo=function(){var retVal=divGridSolo('&#8203;');retVal.addClass('blank-grid-solo');return retVal;};this.createDateTimeRangeInputsGrid=function(aFilter){var inputElementsArray=this.createDateTimeRangeInputs(aFilter);var retValDiv=divGridB(null);if(inputElementsArray.length===4){retValDiv=divGridC(null);}var blockA=divBlockA(inputElementsArray[0]);blockA.attr(FlightPlanGuiFactory.STYLE_NAME,FlightPlanGuiFactory.DEFAULT_PADDING);retValDiv.append(blockA);var blockB=divBlockB(inputElementsArray[1]);blockB.attr(FlightPlanGuiFactory.STYLE_NAME,FlightPlanGuiFactory.DEFAULT_PADDING);retValDiv.append(blockB);var blockC=divBlockC(inputElementsArray[2]);blockC.attr(FlightPlanGuiFactory.STYLE_NAME,FlightPlanGuiFactory.DEFAULT_PADDING);retValDiv.append(blockC);if(inputElementsArray.length===4){var blockD=divBlockC(inputElementsArray[3]);blockD.attr(FlightPlanGuiFactory.STYLE_NAME,FlightPlanGuiFactory.DEFAULT_PADDING);retValDiv.append(blockD);}return retValDiv;};this.createDateTimeRangeInputs=function(aFilter){var inputElementsArray=[];var arcidModel=this.createArcidModel(aFilter);var adepModel=this.createAdepModel(aFilter);var adesModel=this.createAdesModel(aFilter);var flightRuleModel=this.createFlightRulesModel(aFilter);var airportsDivLabels=divGridC(null);airportsDivLabels.append(divBlockA(arcidModel.label));airportsDivLabels.append(divBlockB(adepModel.label));airportsDivLabels.append(divBlockC(adesModel.label));airportsDivLabels.append(divBlockD(flightRuleModel.label));var airportsDivInputs=divGridC(null);airportsDivInputs.append(divBlockA(arcidModel.input));airportsDivInputs.append(divBlockB(adepModel.input));airportsDivInputs.append(divBlockC(adesModel.input));airportsDivInputs.append(divBlockD(flightRuleModel.input));var retVal=HtmlUtils.div();retVal.append(divGridSolo(divBlockA(airportsDivLabels)));retVal.append(divGridSolo(divBlockA(airportsDivInputs)));return retVal;return inputElementsArray;};this.createTablePagination=function(aPaginationID,aPaginationAction,aCountPerPageAction){var retVal=HtmlUtils.createResponsivePagination(aPaginationAction,aCountPerPageAction,0);retVal.attr(HtmlUtils.A_ID,aPaginationID);var paginationValues=FlightPlanGuiFactory.readPaginationValuesToCookies(aPaginationID);var currentPageNum=HtmlUtils.isUndefinedOrIsNull(paginationValues[FlightPlanGuiFactory.C_CurrentPageNum])?1:parseInt(paginationValues[FlightPlanGuiFactory.C_CurrentPageNum]);var maxPageCount=HtmlUtils.isUndefinedOrIsNull(paginationValues[FlightPlanGuiFactory.C_MaxPageCount])?1:parseInt(paginationValues[FlightPlanGuiFactory.C_MaxPageCount]);var pageItemsCount=HtmlUtils.isUndefinedOrIsNull(paginationValues[FlightPlanGuiFactory.C_PageItemsCount])?25:parseInt(paginationValues[FlightPlanGuiFactory.C_PageItemsCount]);FlightPlanGuiFactory.SKIP_RELOAD_BY_PAGINATION=true;var paginationelement=retVal.find('div.pagination');FlightPlanGuiFactory.updatePaginationValues(paginationelement,currentPageNum,maxPageCount);retVal.find("select.countPerPageSelect").val(pageItemsCount);FlightPlanGuiFactory.SKIP_RELOAD_BY_PAGINATION=false;return retVal;};this.createResultTable=function(aFlightPlans,aSuccessCallback,aErrorCallback,aReloadFnc){var tableDiv=div(null);var parentInstance=this;var tableElement=this.createTableElement(aFlightPlans,aReloadFnc);if(this.lastShowedPlanID!==null){var relatedPlansRow=FlightPlansController.loadRelatedPlanTr(this.lastShowedPlanID,function(aRelatedPlanTr){const sortColumn=FplUserPreferencesCtrl.getString('LAST_SORTING_COL',FlightPlanGuiFactory.DEFAULT_SORTING_COL);tableDiv.append(tableElement);sortTable(tableElement,tableElement.find('th['+AWLocale.LOCALISATION_KEY+'=\''+sortColumn+'\']'));if(AWUtils.isUndefinedOrIsNull(aRelatedPlanTr)===false){var flightPlanObject=FlightPlansController.getActiveFlightPlan(parentInstance.lastShowedPlanID);FlightPlansController.showButtonsMenu(tableElement,flightPlanObject);FlightPlansController.openRelatedFplContentRowInTable(tableElement,aRelatedPlanTr);FlightPlansController._relatedPlansRows.push(aRelatedPlanTr);}if(AWUtils.isUndefinedOrIsNull(aSuccessCallback)===false){const type=FplUserPreferencesCtrl.getString('LAST_SORTING_ORDER',FlightPlanGuiFactory.DEFAULT_SORTING_ORDER);aSuccessCallback(tableDiv);FlightPlansController.setFplTableOrderChar(tableDiv,sortColumn,type);}},function(aRelatedPlanTr){const sortColumn=FplUserPreferencesCtrl.getString('LAST_SORTING_COL',FlightPlanGuiFactory.DEFAULT_SORTING_COL);tableDiv.append(tableElement);sortTable(tableElement,tableElement.find('th['+AWLocale.LOCALISATION_KEY+'=\''+sortColumn+'\']'));if(AWUtils.isUndefinedOrIsNull(aRelatedPlanTr)===false){FlightPlansController.openRelatedFplContentRowInTable(tableElement,aRelatedPlanTr);FlightPlansController._relatedPlansRows.push(aRelatedPlanTr);}if(AWUtils.isUndefinedOrIsNull(aErrorCallback)===false){const type=FplUserPreferencesCtrl.getString('LAST_SORTING_ORDER',FlightPlanGuiFactory.DEFAULT_SORTING_ORDER);aErrorCallback(tableDiv);FlightPlansController.setFplTableOrderChar(tableDiv,sortColumn,type);}});}else{const sortColumn=FplUserPreferencesCtrl.getString('LAST_SORTING_COL',FlightPlanGuiFactory.DEFAULT_SORTING_COL);tableDiv.append(tableElement);sortTable(tableElement,tableElement.find('th['+AWLocale.LOCALISATION_KEY+'=\''+sortColumn+'\']'));if(AWUtils.isUndefinedOrIsNull(aSuccessCallback)===false){const type=FplUserPreferencesCtrl.getString('LAST_SORTING_ORDER',FlightPlanGuiFactory.DEFAULT_SORTING_ORDER);aSuccessCallback(tableDiv);FlightPlansController.setFplTableOrderChar(tableDiv,sortColumn,type);}}return tableDiv;};this.createTableElement=function(aFlightPlans,aReloadFnc){if(isUndefinedOrIsNullOrIsEmptyArray(aFlightPlans)){aFlightPlans={};}var tableElement=table(null);tableElement.attr('data-role','table');tableElement.attr('data-mode',"reflow");tableElement.addClass('ui-table');tableElement.addClass('ui-table-reflow');tableElement.addClass('my-custom-breakpoint');var headerRowNames=FlightPlanGuiFactory.getTableHeaderRowNames();var headerRow=createTableHeaderRowOfNames(headerRowNames,aReloadFnc);tableElement.append(headerRow);var tbody=element('tbody',null);tableElement.append(tbody);this._tableRows=[];this._tableRows.length=0;for(var i=0;i<aFlightPlans.length;i++){var iFlightPlan=aFlightPlans[i];if(isUndefinedOrIsNull(iFlightPlan)){continue;}var flightRow=this.createFlightPlanRepsponsiveCellsRow(iFlightPlan,headerRowNames);this._tableRows.push(flightRow);tbody.append(flightRow);}return tableElement;};this.getDefaultSortingColumn=function(){return FplUserPreferencesCtrl.getString('LAST_SORTING_COL',FlightPlanGuiFactory.DEFAULT_SORTING_COL);};this.createShowRelatedPlansFunction=function(aPlanId){var parentInstance=this;var retVal=function(){console.log('Clicked on row with ID:'+aPlanId);var jqObj=JQ(this);var intId=jqObj.attr('fplinternalid');var tableObject=jqObj.parent().parent();var canOpen=(tableObject.find("tr[fullrelatedfplinternalid='"+intId+"']").length===0);FlightPlansController.closeOpenedRowContentsOfTable(tableObject);parentInstance.lastShowedPlanID=null;if(canOpen){parentInstance.lastShowedPlanID=aPlanId;parentInstance._showRelatedPlanFunction(aPlanId);}};return retVal;};this.createCollapsibleContent=function(aId,aTitle,aContent){var filtersDiv=JQ('<div id="'+aId+'" data-role="collapsible" data-inset="true" data-collapsed="false"></div>');var titleHeader=JQ("<h3>"+aTitle+"</h3>");titleHeader.attr(AWLocale.LOCALISATION_KEY,aTitle);filtersDiv.append(titleHeader);filtersDiv.append(aContent);return filtersDiv;};this.createFlightPlanRepsponsiveCellsRow=function(iFlightPlan,aHeaderRowNames){var retVal=tr(null);retVal.attr('fplinternalid',iFlightPlan.internalID);retVal.attr('data-flcando',iFlightPlan.FlCanDo);var arcidTD=this.createFPLTableResponsiveTD(iFlightPlan.ARCID,aHeaderRowNames['COL_ARCID'],'12%');if(FlightPlansController.fplOnMapIDs.indexOf(iFlightPlan.FlId)>=0){arcidTD.addClass('fpl-on-map');}retVal.append(arcidTD);retVal.append(this.createFPLTableResponsiveTD(iFlightPlan.FR,aHeaderRowNames['COL_FR'],'8%'));retVal.append(this.createFPLTableResponsiveTD(iFlightPlan.ATYP,aHeaderRowNames['COL_ATYP'],'11%'));retVal.append(this.createFPLTableResponsiveTD(iFlightPlan.ADEP,aHeaderRowNames['COL_ADEP'],'11%'));retVal.append(this.createFPLTableResponsiveTD(iFlightPlan.EODB,aHeaderRowNames['COL_EOBDT'],'15%'));retVal.append(this.createFPLTableResponsiveTD(HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(iFlightPlan.CTOT)?HtmlUtils.C_EMPTY:iFlightPlan.CTOT,aHeaderRowNames['COL_CTOT'],'10%'));retVal.append(this.createFPLTableResponsiveTD(iFlightPlan.ADES,aHeaderRowNames['COL_ADES'],'11%'));retVal.append(this.createFPLTableResponsiveTD((HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(iFlightPlan.ETA)?HtmlUtils.C_EMPTY:iFlightPlan.ETA.split(HtmlUtils.C_SPACE_CHAR)[1]),aHeaderRowNames['COL_ETA'],'15%'));retVal.append(this.createFPLTableResponsiveTD(iFlightPlan.REG,aHeaderRowNames['COL_REG']));if(AWUtils.isShowPPRColumnEnabled()===true){retVal.append(this.createFPLTableResponsiveTD((HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(iFlightPlan.PPRFlag)?HtmlUtils.C_EMPTY:iFlightPlan.PPRFlag),aHeaderRowNames['COL_PPR']));}retVal.data("fpl",iFlightPlan);this.setFplRowBackgroundColour(retVal,iFlightPlan);retVal.click(this.createShowRelatedPlansFunction(iFlightPlan.FlId));return retVal;};this.createFlightPlanCellsRow=function(iFlightPlan){var retVal=tr(null);retVal.attr('fplinternalid',iFlightPlan.internalID);retVal.attr('data-flcando',iFlightPlan.FlCanDo);var arcidTD=this.createFPLTableResponsiveTD(iFlightPlan.ARCID);if(FlightPlansController.fplOnMapIDs.indexOf(iFlightPlan.FlId)>=0){arcidTD.addClass('fpl-on-map');}retVal.append(arcidTD);retVal.append(centeredTd(iFlightPlan.FR));retVal.append(centeredTd(iFlightPlan.ATYP));retVal.append(centeredTd(iFlightPlan.ADEP));retVal.append(centeredTd(iFlightPlan.EODB));retVal.append(centeredTd(HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(iFlightPlan.CTOT)?HtmlUtils.C_EMPTY:iFlightPlan.CTOT));retVal.append(centeredTd(iFlightPlan.ADES));retVal.append(centeredTd((HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(iFlightPlan.ETA)?HtmlUtils.C_EMPTY:iFlightPlan.ETA.split(HtmlUtils.C_SPACE_CHAR)[1])));retVal.append(centeredTd(iFlightPlan.REG));if(AWUtils.isShowPPRColumnEnabled()===true){retVal.append(centeredTd((HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(iFlightPlan.PPRFlag)?HtmlUtils.C_EMPTY:iFlightPlan.PPRFlag)));}retVal.data("fpl",iFlightPlan);this.setFplRowBackgroundColour(retVal,iFlightPlan);retVal.click(this.createShowRelatedPlansFunction(iFlightPlan.FlId));return retVal;};this.createFPLTableResponsiveTD=function(aValue,aColumnHeaderName,aWidth){var retVal=td(null,aWidth);retVal.append(JQ('<b class="ui-table-cell-label">'+aColumnHeaderName+'</b>'));retVal.append(JQ('<span>'+aValue+'</span>'));return retVal;};this.setFplRowBackgroundColour=function(aRow,aFlightPlan){var colourCode=HtmlUtils.C_EMPTY;if(typeof aFlightPlan.isCanceled==="function"&&aFlightPlan.isCanceled()===true){colourCode='canceled';}else{colourCode=aFlightPlan.FlStatusCode;}aRow.addClass(HtmlUtils.encodeForHTMLAttribute("fpl-row-status-"+colourCode));};var createTableHeaderRowOfNames=function(headerRowNames,aReloadFnc){var trContent=tr(null);for(var iColumnType in headerRowNames){var iColumnName=headerRowNames[iColumnType];var iThElement=element('th',iColumnName);iThElement.attr('column_type',iColumnType);iThElement.click(function(){JQ(this).attr('sort_column','true');aReloadFnc();});trContent.append(iThElement);}return element('thead',trContent);};this.createListItem=function(aRowData){if(isUndefinedOrIsNull(aRowData)){aRowData=[];}var li=JQ('<li></li>');li.append("<h2>"+aRowData[0]+"</h2>");li.append("<p><strong>"+aRowData[1]+"</strong><em> "+aRowData[2]+"</em><strong> - "+aRowData[3]+"</strong></p>");li.append("<p>"+aRowData[4]+", "+aRowData[5]+"</p>");li.append("<p>"+aRowData[6]+", "+aRowData[7]+"</p>");li.append("<p><code>"+aRowData[8]+"</code></p>");return li;};this.fillNotNullFromTextInputValue=function(aInputField,aParameterName,aFilter){if(isUndefinedOrIsNull(aInputField)===false&&aParameterName!==null&&aFilter!==null){aFilter[aParameterName]=HtmlUtils.toUpperCase(aInputField.val());}};this.fillNotNullFromCheckBoxValue=function(aCheckbox,aParameterName,aFilter){if(isUndefinedOrIsNull(aCheckbox)===false&&aParameterName!==null&&aFilter!==null){aFilter[aParameterName]=aCheckbox.find('input').is(':checked')?true:false;}};this.setNotNullTextInputValue=function(aTextInput,aValue){if(isUndefinedOrIsNull(aTextInput)===false&&isUndefinedOrIsNull(aValue)===false){aTextInput.val(aValue);}};this.setNotNullCheckBoxValue=function(aCheckbox,aValue){if(aValue===null||aValue===''){aValue=false;}if(isUndefinedOrIsNull(aCheckbox)===false){aCheckbox.find('input').prop('checked',aValue).checkboxradio('refresh');}};this.createLabeledCheckBox=function(aLabelName,aCheckBoxId,aValue){var checkBoxDiv=div(null);var checkboxLabel=createLabel(aLabelName,aCheckBoxId);var checkbox=createCheckBox(aCheckBoxId,aValue);checkBoxDiv.append(checkboxLabel);checkBoxDiv.append(checkbox);return checkBoxDiv;};this.createCheckBoxLabel=function(aLabelName,aCheckBoxId){if(isUndefinedOrIsNullOrIsEmptyString(aLabelName)){aLabelName="";}if(isUndefinedOrIsNullOrIsEmptyString(aCheckBoxId)){aCheckBoxId="";}return JQ("<label class=\""+this.mDisabledCheckBoxClass+"\" for=\""+aCheckBoxId+"\">"+aLabelName+"</label>");};createCheckBox=function(aId,aValue){return JQ('<input name="'+aId+'" type="checkbox" id="'+aId+'" data-cacheval="'+aValue+'">');};createTimeInput=function(aPlaceHolder,aId){var timePicker=JQ('<input data-role="datebox" data-mini="true" id="'+aId+'" type="text" placeholder="'+aPlaceHolder+'"></input>');timePicker.attr("data-options",'{"mode":"timeflipbox"}');return timePicker;};table=function(aContent){var tableElement=element('table',aContent);tableElement.attr('id',FlightPlanGuiFactory.nextId());return tableElement;};createSortableTh=function(aContent){var retVal=element('th',aContent);retVal.attr(upSortingCharKey,upSortingChar);retVal.attr(downSortingCharKey,downSortingChar);retVal.attr('id',FlightPlanGuiFactory.nextId());retVal.click(function(){sortTable('#'+JQ(this).parents('table').attr('id'),JQ(this));});return retVal;};tr=function(aContent){return element('tr',aContent);};getLocaleKey=function(aKey){return FlightPlanGuiFactory.localePrefix+''+aKey;};this.createFplSignFont=function(aText){var fontAttrs={};fontAttrs[HtmlUtils.A_CLASS]=HtmlUtils.AV_FPL_SIGN;return HtmlUtils.font(fontAttrs,aText);};FlightPlanGuiFactory.fplTdAttrs={};FlightPlanGuiFactory.fplTdAttrs[HtmlUtils.A_CLASS]=HtmlUtils.AV_FPL_TD;this.createFplTd=function(aAttrs,aContent){if(HtmlUtils.isUndefinedOrIsNull(aAttrs)===true){aAttrs={};}if(aAttrs.hasOwnProperty(HtmlUtils.A_CLASS)===true){if(aAttrs[HtmlUtils.A_CLASS]===null){aAttrs[HtmlUtils.A_CLASS]=HtmlUtils.C_EMPTY;}if(aAttrs[HtmlUtils.A_CLASS].split(HtmlUtils.C_SPACE_CHAR).indexOf(FlightPlanGuiFactory.fplTdAttrs[HtmlUtils.A_CLASS])<0){aAttrs[HtmlUtils.A_CLASS]=aAttrs[HtmlUtils.A_CLASS]+HtmlUtils.C_SPACE_CHAR+FlightPlanGuiFactory.fplTdAttrs[HtmlUtils.A_CLASS];}}else{aAttrs[HtmlUtils.A_CLASS]=FlightPlanGuiFactory.fplTdAttrs[HtmlUtils.A_CLASS];}return HtmlUtils.td(aAttrs,aContent);};this.createDefaultTableAttrs=function(){var retVal=this.createDefaultZeroTableAttrs();retVal[HtmlUtils.A_WIDTH]=HtmlUtils.AV_100_PERCENT;return retVal;};this.createDefaultZeroTableAttrs=function(){var retVal={};retVal[HtmlUtils.A_CELLPADDING]=HtmlUtils.AV_0;retVal[HtmlUtils.A_CELLSPACING]=HtmlUtils.AV_0;retVal[HtmlUtils.A_BORDER]=HtmlUtils.AV_0;return retVal;};this.setUniqueIDPRefix=function(aUniqueIDPrexif){this._uniqueIDPrexif=aUniqueIDPrexif;};}FlightPlanGuiFactory.getTableHeaderRowNames=function(){var retVal={};retVal['COL_ARCID']='ARCID';retVal['COL_FR']='FR';retVal['COL_ATYP']='ATYP';retVal['COL_ADEP']='ADEP';retVal['COL_EOBDT']='EOBD/T';retVal['COL_CTOT']='CTOT';retVal['COL_ADES']='ADES';retVal['COL_ETA']='ETA';retVal['COL_REG']='REG';if(AWUtils.isShowPPRColumnEnabled()===true){retVal['COL_PPR']='PPR';}return retVal;};FlightPlanGuiFactory.updatePaginationValues=function(aPagination,aCurrentPageNum,aMaxPageCount){if(aCurrentPageNum>aMaxPageCount){aMaxPageCount=aCurrentPageNum;}aPagination.jqPagination('option','max_page',aMaxPageCount);aPagination.jqPagination('option','current_page',aCurrentPageNum);};FlightPlanGuiFactory.createRelatedFplCellsRow=function(aFlightPlanObject,aSuccessCallback,aErrorCallback){var retVal=tr(null);retVal.attr('fullrelatedfplinternalid',aFlightPlanObject.internalID);retVal.attr('unsortable','');retVal.attr('class','relatedfpl');retVal.attr('style','display:none;');var spanedCell=td(FlightPlanGuiFactory.createOneRelatedFplDiv(aFlightPlanObject.FlId,function(aRelatedFplDiv){if(AWUtils.isUndefinedOrIsNull(aSuccessCallback)===false){aSuccessCallback(retVal);}},function(aRelatedFplDiv){if(AWUtils.isUndefinedOrIsNull(aSuccessCallback)===false){aErrorCallback(retVal);}}));spanedCell.attr('colspan','10');retVal.append(spanedCell);return retVal;};FlightPlanGuiFactory.createOneRelatedFplDiv=function(aFplId,aSuccessCallback,aErrorCallback){if(isUndefinedOrIsNull(aFplId)===true){var retVal=div(null);if(AWUtils.isUndefinedOrIsNull(aSuccessCallback)===false){aSuccessCallback(retVal);}return retVal;}var relatedFplDiv=div(null);relatedFplDiv.attr('class','relatedfpl');var callBackFnc=function(aResultArray){var msgArray=[];if(isUndefinedOrIsNull(aResultArray)===false&&isUndefinedOrIsNull(aResultArray.MsgArray)===false){if(Array.isArray(aResultArray.MsgArray)===false){msgArray=[aResultArray.MsgArray];}else{msgArray=aResultArray.MsgArray;}}for(var i=0;i<msgArray.length;i++){var iMsgItem=msgArray[i];if(isUndefinedOrIsNull(iMsgItem)===true||isUndefinedOrIsNull(iMsgItem.MsgTxt)===true){continue;}var msg=HtmlUtils.divGridSolo();msg.addClass("fpl-msg");var msg=JQ('<div class="fpl-msg"></div>');var dateTime=JQ('<div class="fpl-msg-time"></div>');var sender=JQ('<div class="fpl-msg-sender"></div>');var desc=JQ('<div class="fpl-msg-desc"></div>');var text=JQ('<pre class="fpl-msg-text aftn-message-preview"></pre>');var msgTime=new Date(iMsgItem.MsgTime.toString());dateTime.text(AWUtils.formatDateToAisMobile(AWUtils.convertDateToUtc(msgTime)),true);sender.text(iMsgItem.SenderName.toString());desc.text(iMsgItem.StatusDesc.toString());text.text(iMsgItem.MsgTxt.toString());msg.append(dateTime);msg.append(sender);msg.append(desc);msg.append(text);relatedFplDiv.append(msg);}if(AWUtils.isUndefinedOrIsNull(aSuccessCallback)===false){aSuccessCallback(relatedFplDiv);}};var errorCallBackFnc=function(aResult){relatedFplDiv.append(div("Error while loading related plans"));if(AWUtils.isUndefinedOrIsNull(aErrorCallback)===false){aErrorCallback(relatedFplDiv);}};getFlMsgList(aFplId,callBackFnc,errorCallBackFnc);return relatedFplDiv;};FlightPlanGuiFactory.currentId=0;FlightPlanGuiFactory.idPrefix='flightPlanId_';FlightPlanGuiFactory.nextId=function(){return FlightPlanGuiFactory.idPrefix+''+FlightPlanGuiFactory.currentId++;};FlightPlanGuiFactory.writePaginationValuesToCookies=function(aPaginationID,aCurrentPageNum,aMaxPageCount,aPageItemsCount){FplUserPreferencesCtrl.setVal(aPaginationID+FlightPlanGuiFactory.C_CurrentPageNum,aCurrentPageNum);FplUserPreferencesCtrl.setVal(aPaginationID+FlightPlanGuiFactory.C_MaxPageCount,aMaxPageCount);FplUserPreferencesCtrl.setVal(aPaginationID+FlightPlanGuiFactory.C_PageItemsCount,aPageItemsCount);};FlightPlanGuiFactory.readPaginationValuesToCookies=function(aPaginationID){var retVal=[];retVal[FlightPlanGuiFactory.C_CurrentPageNum]=FplUserPreferencesCtrl.getInt(aPaginationID+FlightPlanGuiFactory.C_CurrentPageNum,1);retVal[FlightPlanGuiFactory.C_MaxPageCount]=FplUserPreferencesCtrl.getInt(aPaginationID+FlightPlanGuiFactory.C_MaxPageCount,1);retVal[FlightPlanGuiFactory.C_PageItemsCount]=FplUserPreferencesCtrl.getInt(aPaginationID+FlightPlanGuiFactory.C_PageItemsCount,25);return retVal;};FlightPlanGuiFactory.localizableElements=[];FlightPlanGuiFactory.localePrefix='FlightPlanFilter.';FlightPlanGuiFactory.C_CurrentPageNum="CurrentPageNum";FlightPlanGuiFactory.C_MaxPageCount="MaxPageCount";FlightPlanGuiFactory.C_PageItemsCount="PageItemsCount";/** * @file FlightPlanFilter.js * @author Matej Pončák <matej.poncak@r-sys.sk> * @date 18.01.2018 * @brief Trieda zabezpecujuca filtrovanie jednotlivych FlightPLan-ov na  * zaklade zadanych hodnot. Pouziva sa v panely "Flight Plans" na zobrazenie * planov so spolocnymi atributmi (ARCID, ADEP, ADES, Flight rules). *  * (C) Copyright 2018  R-SYS,s.r.o */function FlightPlanFilter(){this.utcGtEtaHours="";this.utcGtEobtHours="";this.utcLtEtaHours="";this.arcidIs="";this.adepIs="";this.adesIs="";this.adepOrAdesIs="";this.adepAndAdesIsNot="";this.dateFromIs="";this.timeFromIs="";this.timeFromFixedIs="";this.dateToIs="";this.timeToIs="";this.eodbtFromDate="";this.eodbtFromTime="";this.eodbtTillDate="";this.eodbtTillTime="";this.etaFromDate="";this.etaFromTime="";this.etaTillDate="";this.etaTillTime="";this.hideIfrFlights=false;this.hideVfrFlights=false;this.hideFlightInClnStatus=false;this.hideFlightInArrStatus=false;this.hideTestFlight=false;this.flightRules="ifrvfr";this.showOwnFlights=false;this.isPlanEligible=function(aPlan){if(aPlan===null){return false;}if(this.isFilterEmpty()===true||(this.isPlanActiveInTime(aPlan)===true&&this.isPlanArcidEligible(aPlan)===true&&this.isPlanAdepEligible(aPlan)===true&&this.isPlanAdesEligible(aPlan)===true&&this.isPlanAdepOrAdesIsEligible(aPlan)===true&&this.isPlanAdepAndAdesIsNotEligible(aPlan)===true&&this.isPlanFlightRuleEligible(aPlan)===true)){return true;}else{return false;}};this.isFilterEmpty=function(){var emptyFilter=new FlightPlanFilter();for(var prop in emptyFilter){if(emptyFilter[prop]!==this[prop]){return false;}}return true;};this.isPlanArcidEligible=function(aPlan){return this.compareContainsFilterValue(aPlan.ARCID,this.arcidIs);};this.isPlanAdepEligible=function(aPlan){return this.compareContainsFilterValue(aPlan.ADEP,this.adepIs);};this.isPlanAdesEligible=function(aPlan){return this.compareContainsFilterValue(aPlan.ADES,this.adesIs);};this.isPlanAdepOrAdesIsEligible=function(aPlan){var adepRetVal=this.compareContainsFilterValue(aPlan.ADEP,this.adepOrAdesIs);if(adepRetVal===true){return true;}var adesRetVal=this.compareContainsFilterValue(aPlan.ADES,this.adepOrAdesIs);if(adesRetVal===true){return true;}return false;};this.isPlanAdepAndAdesIsNotEligible=function(aPlan){if(this.adepAndAdesIsNot===null||this.adepAndAdesIsNot===''){return true;}var adepRetVal=this.compareContainsFilterValue(aPlan.ADEP,this.adepAndAdesIsNot);var adesRetVal=this.compareContainsFilterValue(aPlan.ADES,this.adepAndAdesIsNot);if(adepRetVal===false&&adesRetVal===false){return true;}else{return false;}};this.isPlanFlightRuleEligible=function(aPlan){var defaultFlightPlan=new FlightPlanFilter();if(this.flightRules===defaultFlightPlan.flightRules){return true;}if(aPlan.FR==="I"&&this.flightRules==='ifr'){return true;}else if(aPlan.FR==="V"&&this.flightRules==='vfr'){return true;}return false;};this.isPlanStatesEligible=function(aPlan){if(this.isPlanHideIfrFlightsEligible(aPlan)===true&&this.isPlanHideVfrFlightsEligible(aPlan)===true){return true;}return false;};this.isPlanHideIfrFlightsEligible=function(aPlan){if(this.hideIfrFlights!==true){return true;}if(aPlan.FR==="I"){return false;}return true;};this.isPlanHideVfrFlightsEligible=function(aPlan){if(this.hideVfrFlights!==true){return true;}if(aPlan.FR==="V"){return false;}return true;};this.isPlanHideFlightInClnStatusEligible=function(aPlan){if(this.hideFlightInClnStatus!==true){return true;}if(aPlan.STATUS==="CLN"){return false;}return true;};this.isPlanHideFlightInArrStatusEligible=function(aPlan){if(this.hideFlightInArrStatus!==true){return true;}if(aPlan.STATUS==="ARR"){return false;}return true;};this.isPlanHideTestFlightEligible=function(aPlan){if(this.hideTestFlight!==true){return true;}if(aPlan.STATUS==="TEST"){return false;}return true;};this.isPlanActiveInTime=function(aPlan){if(this.isPlanInUtcGtEtaHours(aPlan)===true&&this.isPlanInUtcEodbHours(aPlan)===true&&this.isPlanInUtcLtEtaHours(aPlan)===true&&this.isPlanInEodbtRange(aPlan)===true&&this.isPlanInEtaRange(aPlan)===true){return true;}return false;};this.isPlanInUtcGtEtaHours=function(aPlan){if(aPlan===null||this.utcGtEtaHours===""){return true;}if(aPlan.ETA===null||aPlan.ETA===""){return false;}var currentDate=new Date();if(currentDate.getTime()>=(FlightPlansController.parseIbafDate(aPlan.ETA).getTime()+FlightPlansController.convertHours2Milisec(this.utcGtEtaHours))){return true;}return false;};this.isPlanInUtcEodbHours=function(aPlan){if(aPlan===null||this.utcGtEobtHours===""){return true;}if(aPlan.EODB===null||aPlan.EODB===""){return false;}var currentDate=new Date();if(currentDate.getTime()>=(FlightPlansController.parseIbafDate(aPlan.EODB).getTime()-FlightPlansController.convertHours2Milisec(this.utcGtEobtHours))){return true;}return false;};this.isPlanInUtcLtEtaHours=function(aPlan){if(aPlan===null||this.utcLtEtaHours===""){return true;}if(aPlan.ETA===null||aPlan.ETA===""){return false;}var currentDate=new Date();if(currentDate.getTime()<=(FlightPlansController.parseIbafDate(aPlan.ETA).getTime()+FlightPlansController.convertHours2Milisec(this.utcLtEtaHours))){return true;}return false;};this.isPlanInEodbtRange=function(aPlan){if(aPlan===null){return false;}return this.isPlanInTimeRange(this.eodbtFromDate,this.eodbtFromTime,aPlan.EODB,this.eodbtTillDate,this.eodbtTillTime);};this.isPlanInEtaRange=function(aPlan){if(aPlan===null){return false;}return this.isPlanInTimeRange(this.etaFromDate,this.etaFromTime,aPlan.ETA,this.etaTillDate,this.etaTillTime);};this.isPlanInTimeRange=function(aFromDate,aFromTime,aIbafDateTime,aTillDate,aTillTime){if((aFromDate===null||aFromDate==='')&&(aFromTime===null||aFromTime==='')&&(aTillDate===null||aTillDate==='')&&(aTillTime===null||aTillTime==='')){return true;}if(aFromTime===null||aFromTime===''){aFromTime='00:00';}if(aTillTime===null||aTillTime===''){aTillTime='00:00';}var fromTimeStamp='';if(aFromDate!==null&&aFromDate!==''){fromTimeStamp=this.mergeDateAndTime(aFromDate,aFromTime);}var tillTimeStamp='';if(aTillDate!==null&&aTillDate!==''){tillTimeStamp=this.mergeDateAndTime(aTillDate,aTillTime);}if(aIbafDateTime===null||aIbafDateTime===""){return false;}var middleTimeStamp=FlightPlansController.parseIbafDate(aIbafDateTime).toString();return this.isDateTimeValueInRange(fromTimeStamp,middleTimeStamp,tillTimeStamp);};this.mergeDateAndTime=function(aDateFilterElement,aTimeFilterElement){return aDateFilterElement+"T"+aTimeFilterElement+":00+00:00";};this.isDateTimeValueInRange=function(aDateTimeFrom,aCheckedTime,aDateTimeTill){if(aCheckedTime===null||aCheckedTime===""||(aDateTimeFrom===""&&aDateTimeTill==="")){return true;}var timeFrom=Number.MIN_VALUE;if(aDateTimeFrom!==""){timeFrom=Date.parse(aDateTimeFrom);}var timeTill=Number.MAX_VALUE;if(aDateTimeTill!==""){timeTill=Date.parse(aDateTimeTill);}var middleTime=Date.parse(aCheckedTime);if(timeFrom<=middleTime&&middleTime<=timeTill){return true;}return false;};this.compareContainsFilterValue=function(aFullValue,aFilterValue){if(aFilterValue===null||aFilterValue===""){return true;}var filterValues=aFilterValue.split(" ");for(var iFilterKey in filterValues){var iFilterValue=filterValues[iFilterKey];if(isUndefinedOrIsNullOrIsEmptyString(iFilterValue)===true||typeof iFilterValue!=="string"){continue;}if(isUndefinedOrIsNullOrIsEmptyString(aFullValue)!==true&&typeof iFilterValue==="string"&&aFullValue.toLowerCase().indexOf(iFilterValue.toLowerCase())>-1){return true;}}return false;};this.getEOBTFromDatetime=function(){return this.createDateTimeFormat(this.dateFromIs,this.timeFromIs);};this.getEOBTTillDatetime=function(){return this.createDateTimeFormat(this.dateToIs,this.timeToIs);};this.getEOBTFromDatetimeFixed=function(){var dateInput=this.dateFromIs;var timeInput=this.timeFromIs;if(this.isDateTimeInNullState(dateInput,timeInput)===true){return null;}if(AWUtils.isUndefinedOrIsNull(timeInput)===true||AWUtils.isTimeFormatCorrect(timeInput)===false){timeInput='00:00';}return this.createDateTimeFormat(dateInput,timeInput);};this.getEOBTTillDatetimeFixed=function(){var dateInput=this.dateToIs;var timeInput=this.timeToIs;if(this.isDateTimeInNullState(dateInput,timeInput)===true){return null;}if(AWUtils.isUndefinedOrIsNull(timeInput)===true||AWUtils.isTimeFormatCorrect(timeInput)===false){timeInput='23:59';}return this.createDateTimeFormat(dateInput,timeInput);};this.isDateTimeInNullState=function(aDate,aTime){if(AWUtils.isUndefinedOrIsNull(aDate)===true&&AWUtils.isUndefinedOrIsNull(aTime)===true){return true;}if(AWUtils.isUndefinedOrIsNull(aDate)===false&&AWUtils.isDateFormatCorrect(aDate)===false){return true;}return false;};this.createDateTimeFormat=function(aDate,aTime){if(AWUtils.isUndefinedOrIsNullOrIsEmptyString(aDate)===true||AWUtils.isUndefinedOrIsNullOrIsEmptyString(aTime)===true){return null;}var dateFormatRegExp=/^[0-9]{4}\-(0[0-9]|1[0-2])\-([0-2][0-9]|3[0-1])$/;var timeFormatRegExp=/^(2[0-4]|[0-1][0-9])\:[0-5][0-9]$/;if(dateFormatRegExp.test(aDate)===false||timeFormatRegExp.test(aTime)===false){return null;}else{return aDate+' '+aTime;}};this.getSettings=function(){const retVal={};for(var iPropertyName in this){if(typeof this[iPropertyName]==='function'){continue;}retVal[iPropertyName]=""+this[iPropertyName];}return retVal;};}FlightPlanFilter.filterFlightPlans=function(aFlightPlans,aFilter){var retVals=[];if(aFlightPlans===null){aFlightPlans=[];}for(var i=0;i<aFlightPlans.length;i++){var iFlightPlan=aFlightPlans[i];var isPLanEligible=aFilter.isPlanEligible(iFlightPlan);if(isPLanEligible===true){retVals.push(iFlightPlan);}}return retVals;};FlightPlanFilter.SETTINGS_KEY_NAME='flightPlanFilter';FlightPlanFilter.SETTINGS_ACTIVE_KEY_NAME='active';FlightPlanFilter.SETTINGS_ARCHIVE_KEY_NAME='archive';FlightPlanFilter.storeValues=function(activeFilter,archiveFilter){const newSettings={};let dataToStore;newSettings[FlightPlanFilter.SETTINGS_ACTIVE_KEY_NAME]=activeFilter.getSettings();newSettings[FlightPlanFilter.SETTINGS_ARCHIVE_KEY_NAME]=archiveFilter.getSettings();if(AppController.userPrefs.isValueForName(FlightPlanFilter.SETTINGS_KEY_NAME)){const storedSettings=AppController.userPrefs.getValue(FlightPlanFilter.SETTINGS_KEY_NAME,true);if(storedSettings){const oldStr=JSON.stringify(storedSettings);const newStr=JSON.stringify(newSettings);if(oldStr!==newStr){dataToStore=newSettings;}}else{dataToStore=newSettings;}}else{dataToStore=newSettings;}if(dataToStore){AppController.userPrefs.setValue(FlightPlanFilter.SETTINGS_KEY_NAME,dataToStore,AwUserPreferences.TYPE.JSON);}};FlightPlanFilter.restoreValues=function(){const retVal={};const storedSettings=AppController.userPrefs.getValue(FlightPlanFilter.SETTINGS_KEY_NAME,true)||{};retVal[FlightPlanFilter.SETTINGS_ACTIVE_KEY_NAME]=FlightPlanFilter.createBySettings(storedSettings[FlightPlanFilter.SETTINGS_ACTIVE_KEY_NAME],FlightPlanFilter.SETTINGS_ACTIVE_KEY_NAME);retVal[FlightPlanFilter.SETTINGS_ARCHIVE_KEY_NAME]=FlightPlanFilter.createBySettings(storedSettings[FlightPlanFilter.SETTINGS_ARCHIVE_KEY_NAME],FlightPlanFilter.SETTINGS_ARCHIVE_KEY_NAME);return retVal;};FlightPlanFilter.createBySettings=function(settings,settingsNodeName){var retVal=new FlightPlanFilter();for(var propertyName in retVal){if(settings){if(settings[propertyName]){retVal[propertyName]=settings[propertyName];}}else if(JQ.cookie(settingsNodeName+propertyName)){retVal[propertyName]=JQ.cookie(settingsNodeName+propertyName);}}return retVal;};/** * @file FlightPlanUpdateForm.js * @author Matej Pončák <matej.poncak@r-sys.sk> * @date 18.01.2018 * @brief Trieda zabezpecujuca tvorbu GUI a obsluhu akcii sprav "Update" uz  * existujuceho planu  *  * (C) Copyright 2018  R-SYS,s.r.o */function FlightPlanUpdateForm(){this._instance=this;this._fplGuiFactory=new FlightPlanGuiFactory();this._viewonlyAttributes=[];this._readonlyAttributes=[];this._editableAttributes={};this._deletableAttributes=[];this._hoverTooltipAttributes={};this._initialValues={};this._rowTitles=[];this._sendMessageAction=null;this._requestAction=null;this._mandatoryLabelVisible=true;this._tableElements=null;FlightPlanUpdateForm.NEXT_ROW='FlightPlanUpdateFormNextRow';var mInputRestr=null;var mValueProviders=null;var mTdElementsMap={};this.setMandatoryLabelVisible=function(aVisibleMark){this._mandatoryLabelVisible=aVisibleMark;};this.setTitle=function(aTitle){this._title=aTitle;};this.setRowTitles=function(aRowTitles){this._rowTitles=aRowTitles;};this.setViewonlyAttributes=function(aViewonlyAttributes){this._viewonlyAttributes=aViewonlyAttributes;};this.setReadonlyAttributes=function(aReadonlyAttributes){this._readonlyAttributes=aReadonlyAttributes;};this.setEditableAttributes=function(aEditableAttributes){this._editableAttributes=aEditableAttributes;this.resetInitialValuesMap();};this.setInputRestrictionsWhileTypping=function(aInputRestr){mInputRestr=aInputRestr;};this.setValueProviders=function(aValueProviders){mValueProviders=aValueProviders;};this.setHoverTooltipAttributes=function(aHoverTooltipAttributes){if(AWUtils.isUndefinedOrIsNull(aHoverTooltipAttributes)===true){aHoverTooltipAttributes={};}this._hoverTooltipAttributes=aHoverTooltipAttributes;};this.resetInitialValuesMap=function(){this._initialValues={};};this.setDeletableAttributes=function(aCanDeleteAttributes){this._deletableAttributes=aCanDeleteAttributes;};this.setOrderOfAttributes=function(aAttributes){this._orderAttributes=aAttributes;};this.setSendMessageAction=function(aSendMessageAction){this._sendMessageAction=aSendMessageAction;};this.setRequestAction=function(aRequestAction){this._requestAction=aRequestAction;};this.setFlightPlan=function(aFlightPlanModel){this._flightPlanModel=aFlightPlanModel;};this.getFlightPlan=function(){return this._flightPlanModel;};this.getEobDatetime=function(){var eobt=this.getFormEobtVal();if(HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(eobt)===true){eobt=this.getDataFromModel(FPLFormModel.AV_X13B);}return this.getDataFromModel(FPLFormModel.AV_X18_DOF)+eobt;};this.getDeletedUndeletableAttributes=function(){var retVal=[];var parentInstance=this;if(AWUtils.isUndefinedOrIsNull(this._tableElements)===false){this.doForAllFplUpdateGUIElements(function(aFplUpdateGuiElement){if(AWUtils.isUndefinedOrIsNull(aFplUpdateGuiElement)===true||!(aFplUpdateGuiElement._guiType===GUIType.LABEL_TEXTINPUT||aFplUpdateGuiElement._guiType===GUIType.TEXT_AREA)){return;}if(aFplUpdateGuiElement._isDeletable===false&&parentInstance.isDeletedUndeletableAttribute(aFplUpdateGuiElement._fplFormModelID)===true){retVal.push(aFplUpdateGuiElement._fplFormModelID);}});}else{for(var iEditableAttr in this._editableAttributes){if(HtmlUtils.arrayContains(this._deletableAttributes,iEditableAttr)===true){continue;}if(this.isDeletedUndeletableAttribute(iEditableAttr)===true){retVal.push(iEditableAttr);}}}return retVal;};this.isDeletedUndeletableAttribute=function(aEditableAttr){var editedValue=this.checkAndGetValue(aEditableAttr);if(editedValue!==HtmlUtils.C_EMPTY){return false;}var iValueInitial=this._initialValues[aEditableAttr];if(editedValue!==iValueInitial){return true;}else{return false;}};this.getAttributeLabels=function(aAttributes){if(AWUtils.isUndefinedOrIsNull(aAttributes)===true){return[];}if(AWUtils.isUndefinedOrIsNull(this._tableElements)===false){return this.getAttributeLabelsFromTableElements(aAttributes);}else{var retVal=[];for(var i in aAttributes){var iAttr=aAttributes[i];if(AWUtils.isUndefinedOrIsNull(iAttr)===true){continue;}if((iAttr in this._editableAttributes)===true){retVal.push(this._editableAttributes[iAttr]);}}return retVal;}};this.getAttributeLabelsFromTableElements=function(aAttributes){var retVal=[];this.doForAllFplUpdateGUIElements(function(aTableGuiElement){if(AWUtils.isUndefinedOrIsNull(aTableGuiElement)===true){return;}if(HtmlUtils.arrayContains(aAttributes,aTableGuiElement._fplFormModelID)===true){retVal.push(aTableGuiElement._labelValue);}});return retVal;};this.getChangeMessagePreview=function(){var retVal=HtmlUtils.C_EMPTY;var isPreviewEnabled=getConfigValue2('flightPlans','previewAftnMSGsend',true);if(isPreviewEnabled===false){return retVal;}switch(this._title){case'DLA':retVal=this.createPreviewMessageDLA();break;case'CHG':retVal=this.createPreviewMessageCHG();break;case'CNL':retVal=this.createPreviewMessageCNL();break;case'ARR':retVal=this.createPreviewMessageARR();break;case'DEP':retVal=this.createPreviewMessageDEP();break;}return retVal;};this.createPreviewMessageDLA=function(){var retVal=HtmlUtils.C_EMPTY;retVal+='(DLA-'+this.getDataFromModel(FPLFormModel.AV_X7)+'-'+this.getDataFromModel(FPLFormModel.AV_X13A)+this.getFormEobtVal()+'-'+this.getDataFromModel(FPLFormModel.AV_X16A)+'-'+this.createDOFValueForPreviewMsg()+')';return retVal;};this.createPreviewMessageCHG=function(){var retVal=HtmlUtils.C_EMPTY;retVal+='(CHG-'+this.getDataFromModel(FPLFormModel.AV_X7)+'-'+this.getDataFromModel(FPLFormModel.AV_X13A)+this.getDataFromModel(FPLFormModel.AV_X13B)+'-'+this.getDataFromModel(FPLFormModel.AV_X16A)+'-'+this.createDOFValueForPreviewMsg();retVal+=this.create8ValueForCHGPreviewMsg();retVal+=this.create9ValueForCHGPreviewMsg();retVal+=this.create10ValueForCHGPreviewMsg();retVal+=this.create13ValueForCHGPreviewMsg();retVal+=this.create15ValueForCHGPreviewMsg();retVal+=this.create16ValueForCHGPreviewMsg();retVal+=this.create18ValueForCHGPreviewMsg();retVal+=this.create19ValueForCHGPreviewMsg();retVal+=')';return retVal;};this.createPreviewMessageCNL=function(){var retVal=HtmlUtils.C_EMPTY;retVal+='(CNL-'+this.getDataFromModel(FPLFormModel.AV_X7)+'-'+this.getDataFromModel(FPLFormModel.AV_X13A)+this.getDataFromModel(FPLFormModel.AV_X13B)+'-'+this.getDataFromModel(FPLFormModel.AV_X16A)+'-'+this.createDOFValueForPreviewMsg()+')';return retVal;};this.createPreviewMessageARR=function(){var retVal=HtmlUtils.C_EMPTY;retVal+='(ARR-'+this.getDataFromModel(FPLFormModel.AV_X7)+'-'+this.getDataFromModel(FPLFormModel.AV_X13A)+this.getDataFromModel(FPLFormModel.AV_X13B)+'-'+(this.getFormDivAd()===HtmlUtils.C_EMPTY?this.getDataFromModel(FPLFormModel.AV_X16A):this.getFormDivAd())+this.getFormAtaVal()+(this.getFormNonIcaoDivAd()===HtmlUtils.C_EMPTY?HtmlUtils.C_EMPTY:'-'+this.getFormNonIcaoDivAd());var showInArrMsgDOF=getConfigValue2('flightPlans','showInArrMsgDOF',true);if(showInArrMsgDOF===true){retVal+='-'+this.createDOFValueForPreviewMsg()+')';}else{retVal+=')';}return retVal;};this.createPreviewMessageDEP=function(){var retVal=HtmlUtils.C_EMPTY;retVal+='(DEP-'+this.getDataFromModel(FPLFormModel.AV_X7)+'-'+this.getDataFromModel(FPLFormModel.AV_X13A)+this.getFormAtdVal()+'-'+this.getDataFromModel(FPLFormModel.AV_X16A)+'-'+this.createDOFValueForPreviewMsg()+')';return retVal;};this.createDOFValueForPreviewMsg=function(){var dofValue=this.getDataFromModel(FPLFormModel.AV_X18_DOF);if(HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(dofValue)===true||dofValue===0){dofValue=0;}else{dofValue='DOF/'+dofValue;}return dofValue;};this.create8ValueForCHGPreviewMsg=function(){var retVal=HtmlUtils.C_EMPTY;if(this.isFormFlRulesValChanged()===true||this.isFormFlTypeValChanged()===true){retVal+=HtmlUtils.C_DASH+this.create8ValueForPreviewMsg();}return retVal;};this.create8ValueForPreviewMsg=function(){var retVal=HtmlUtils.C_EMPTY;retVal+='8/'+this.getFormFlRulesVal()+this.getFormFlTypeVal();return retVal;};this.create9ValueForCHGPreviewMsg=function(){var retVal=HtmlUtils.C_EMPTY;if(this.isFormArcNumValChanged()===true||this.isFormArcTypeValChanged()===true||this.isFormWakeTurbulenceCatValChanged()===true){retVal+=HtmlUtils.C_DASH+this.create9ValueForPreviewMsg();}return retVal;};this.create9ValueForPreviewMsg=function(){var retVal=HtmlUtils.C_EMPTY;retVal+='9/'+this.getFormArcNumVal()+' '+this.getFormArcTypeVal()+' '+this.getFormWakeTurbulenceCatVal();return retVal;};this.create10ValueForCHGPreviewMsg=function(){var retVal=HtmlUtils.C_EMPTY;if(this.isFormEquipmentValChanged()===true){retVal+=HtmlUtils.C_DASH+this.create10ValueForPreviewMsg();}return retVal;};this.create10ValueForPreviewMsg=function(){var retVal=HtmlUtils.C_EMPTY;retVal+='10/'+this.getFormEquipmentVal();return retVal;};this.create13ValueForCHGPreviewMsg=function(){var retVal=HtmlUtils.C_EMPTY;if(this.isFormEOBTValChanged()===true){retVal+=HtmlUtils.C_DASH+this.create13ValueForPreviewMsg();}return retVal;};this.create13ValueForPreviewMsg=function(){var retVal=HtmlUtils.C_EMPTY;retVal+='13/'+this.getDataFromModel(FPLFormModel.AV_X13A)+this.getFormEobtVal();return retVal;};this.create15ValueForCHGPreviewMsg=function(){var retVal=HtmlUtils.C_EMPTY;if(this.isFormFlSpeedValChanged()===true||this.isFormFlLevelValChanged()===true||this.isFormFlRouteValChanged()===true){retVal+=HtmlUtils.C_DASH+this.create15ValueForPreviewMsg();}return retVal;};this.create15ValueForPreviewMsg=function(){var retVal=HtmlUtils.C_EMPTY;retVal+='15/'+this.getFormFlSpeedVal()+HtmlUtils.C_EMPTY+this.getFormFlLevelVal()+' '+this.getFormFlRouteVal();return retVal;};this.create16ValueForCHGPreviewMsg=function(){var retVal=HtmlUtils.C_EMPTY;if(this.isFormTotalEETValChanged()===true||this.isFormADAltn1ValChanged()===true||this.isFormADAltn2ValChanged()===true){retVal+=HtmlUtils.C_DASH+this.create16ValueForPreviewMsg();}return retVal;};this.create16ValueForPreviewMsg=function(){var retVal=HtmlUtils.C_EMPTY;retVal+='16/'+this.getDataFromModel(FPLFormModel.AV_X16A)+HtmlUtils.C_EMPTY+this.getFormTotalEETVal()+' '+this.getFormADAltn1Val()+' '+this.getFormADAltn2Val();return retVal;};this.create18ValueForCHGPreviewMsg=function(){var retVal=HtmlUtils.C_EMPTY;if(this.isFormFlOtherValChanged()===true){retVal+=HtmlUtils.C_EMPTY+this.create18ValueForPreviewMsg();}return retVal;};this.create18ValueForPreviewMsg=function(){var retVal=HtmlUtils.C_EMPTY;retVal+='18/'+this.getFormFlOtherVal();return retVal;};this.create19ValueForCHGPreviewMsg=function(){var retVal=HtmlUtils.C_EMPTY;if(this.isFormFlSuplementaryValChanged()===true){retVal+=HtmlUtils.C_DASH+this.create19ValueForPreviewMsg();}return retVal;};this.create19ValueForPreviewMsg=function(){var retVal=HtmlUtils.C_EMPTY;retVal+='19/'+this.getFormFlSuplementaryVal();return retVal;};this.createUpdateForm=function(){var retVal=HtmlUtils.div(null);retVal.attr(HtmlUtils.A_CLASS,'fpl_window_form');var headerTable=this.createHeaderTable();var valuesTable=this.createValuesTable();var buttonsTable=this.createButtonsTable();retVal.append(headerTable);retVal.append(valuesTable);retVal.append(buttonsTable);return retVal;};this.createHeaderTable=function(){var fontElementTitle=this._fplGuiFactory.createFplSignFont(HtmlUtils.encodeForHTML(this._title));var td00Attrs={};td00Attrs[HtmlUtils.A_WIDTH]=HtmlUtils.AV_80;var td00=this._fplGuiFactory.createFplTd(td00Attrs,fontElementTitle);var tr0=HtmlUtils.tr({},td00);var tr1=this.getLineRow();var tableBody=HtmlUtils.tbody({},tr0);tableBody.append(tr1);var table=HtmlUtils.table(this._fplGuiFactory.createDefaultTableAttrs(),tableBody);table.addClass('fpl_udpate_table_title');return table;};this.createButtonsTable=function(){var tr0=HtmlUtils.tr({},null);var tableBody=HtmlUtils.tbody({},tr0);var sendMessageRow=this.createSendMessageRow();tableBody.append(sendMessageRow);var table=HtmlUtils.table(this._fplGuiFactory.createDefaultTableAttrs(),tableBody);table.addClass('fpl_udpate_table_buttons');return table;};this.createSendMessageRow=function(){var parentInstance=this._instance;return this.createLabeledButtonRow('Send message: ',FlightPlanUpdateForm.LABEL_ATTRS_DEFAULT,'Send',FlightPlanUpdateForm.BUTTON_ATTRS_DEFAULT,function(aElement){if(HtmlUtils.isUndefinedOrIsNull(parentInstance._sendMessageAction)===false){parentInstance._sendMessageAction();}});};this.createNmB2BServiceRow=function(){var parentInstance=this._instance;return this.createLabeledButtonRow('NM B2B web service: ',FlightPlanUpdateForm.LABEL_ATTRS_DEFAULT,'Request',FlightPlanUpdateForm.BUTTON_ATTRS_DEFAULT,function(aElement){if(HtmlUtils.isUndefinedOrIsNull(parentInstance._requestAction)===false){parentInstance._requestAction();}});};this.createLabeledButtonRow=function(aLabelName,aLabelAttributes,aButtonName,aButtonAttributes,aButtonClickAction){var retValTr=HtmlUtils.tr({},null);var tdLabel=this.createLabelTd(aLabelName,aLabelAttributes);var tdButton=this.createButtonTd(aButtonName,aButtonAttributes,aButtonClickAction);retValTr.append(HtmlUtils.td({},null));retValTr.append(HtmlUtils.td({},null));retValTr.append(HtmlUtils.td({},null));retValTr.append(tdLabel);retValTr.append(tdButton);return retValTr;};FlightPlanUpdateForm.LABEL_ATTRS_DEFAULT={'class':"fpl_td",'align':"right"};this.createLabelTd=function(aLabelName,aLabelAttributes){var label=HtmlUtils.label(aLabelAttributes,HtmlUtils.encodeForHTML(aLabelName));var tdLabel=HtmlUtils.td(aLabelAttributes,label);return tdLabel;};FlightPlanUpdateForm.BUTTON_ATTRS_DEFAULT={'data-role':"button",'class':"ui-link ui-btn ui-shadow ui-corner-all",'role':"button"};this.createButtonTd=function(aButtonName,aButtonAttributes,aButtonClickAction){var button=HtmlUtils.aFull(aButtonAttributes,HtmlUtils.encodeForHTML(aButtonName));button.click(aButtonClickAction);var retValTd=this._fplGuiFactory.createFplTd({},button);return retValTd;};this.createValuesTable=function(){var retVal=null;if(this._tableElements!==null){retVal=this.createValuesTableByTableGuiElements();}else{retVal=this.createValuesTableByOrderAttributes();}retVal.addClass('fpl_udpate_table_values');return retVal;};this.createValuesTableByTableGuiElements=function(){var valueTableBody=HtmlUtils.tbody({},null);for(var iTableRowKey in this._tableElements.rows){if(AWUtils.isUndefinedOrIsNull(iTableRowKey)===true){continue;}var iTableRow=this._tableElements.rows[iTableRowKey];var tableRowElement=this.createTableRowElement(iTableRow);if(AWUtils.isUndefinedOrIsNull(tableRowElement)===true){continue;}valueTableBody.append(tableRowElement);}var lineRow=this.getLineRow();valueTableBody.append(lineRow);var retValTable=HtmlUtils.table(this._fplGuiFactory.createDefaultTableAttrs(),valueTableBody);return retValTable;};this.createTableRowElement=function(aTableRow){if(AWUtils.isUndefinedOrIsNull(aTableRow)===true){return null;}var retValTr=HtmlUtils.tr({},null);for(var iRowCellKey in aTableRow){if(AWUtils.isUndefinedOrIsNull(iRowCellKey)===true){continue;}var iRowCell=aTableRow[iRowCellKey];var cell=this.createRowCellElement(iRowCell);if(AWUtils.isUndefinedOrIsNull(cell)===true){continue;}retValTr.append(cell);}return retValTr;};this.createRowCellElement=function(iRowCell){if(AWUtils.isUndefinedOrIsNull(iRowCell)===true){return null;}var retValCellElement=null;if(AWUtils.isUndefinedOrIsNull(iRowCell._guiType)===true){return null;}else if(iRowCell._guiType===GUIType.TEXT){var retValTd=this.createTextTd(iRowCell._value);HtmlUtils.checkAndAddAdditionalAttrs(retValTd,iRowCell._additionalAttrs);return retValTd;}else if(iRowCell._guiType===GUIType.LABEL_TEXT){return this.createLabeledTextCell(iRowCell._labelValue,this.getDataFromModel(iRowCell._fplFormModelID));}else if(iRowCell._guiType===GUIType.LABEL_TEXTINPUT){var inputRestrictionRegex=iRowCell._inputRestrictionRegex;return this.createLabeledEditableInputfieldCell(iRowCell._fplFormModelID,iRowCell._labelValue,inputRestrictionRegex);}else if(iRowCell._guiType===GUIType.TEXT_AREA){var inputRestrictionRegex=iRowCell._inputRestrictionRegex;return this.createLabeledEditableTextAreaCell(iRowCell._fplFormModelID,iRowCell._labelValue,inputRestrictionRegex);}return retValCellElement;};this.createValuesTableByOrderAttributes=function(){var openTd=this.createOpenTd();var valueTr=HtmlUtils.tr({'class':'fpl_change_row'},openTd);var valueTableBody=HtmlUtils.tbody({},valueTr);if(HtmlUtils.isUndefinedOrIsNull(this._orderAttributes)===true){return retValTable;}mTdElementsMap={};var rowIndex=0;for(var i=0;i<this._orderAttributes.length;i++){var iAttribute=this._orderAttributes[i];if(FlightPlanUpdateForm.NEXT_ROW===iAttribute){valueTr=HtmlUtils.tr({},this.createrowTitleTd(rowIndex++));valueTableBody.append(valueTr);continue;}var valueTd=null;if((iAttribute in this._viewonlyAttributes)===true){valueTd=this.createViewonlyTd(iAttribute);}else if((iAttribute in this._readonlyAttributes)===true){valueTd=this.createReadonlyTd(iAttribute);}else if((iAttribute in this._editableAttributes)===true){valueTd=this.createEditableTd(iAttribute);}if(HtmlUtils.isUndefinedOrIsNull(valueTd)===false){valueTr.append(valueTd);mTdElementsMap[iAttribute]=valueTd;}if(i+1<this._orderAttributes.length){var dashTd=this.createDashTd();valueTr.append(dashTd);}}var closeTd=this.createCloseTd();valueTr.append(closeTd);if(this._mandatoryLabelVisible===true){valueTableBody.append(this.createRequiredMsgTr());}if((FPLFormModel.AV_NONICAO_DIVERSION_AD in mTdElementsMap)===true&&(FPLFormModel.AV_X16C in mTdElementsMap)===true){var nonIcaoDiversionAD=mTdElementsMap[FPLFormModel.AV_NONICAO_DIVERSION_AD].find('input');nonIcaoDiversionAD.attr('disabled','disabled');mTdElementsMap[FPLFormModel.AV_X16C].find('input').change(function(e){var value=JQ(this).val();var enablity='disable';if((''+value).toLowerCase()==='zzzz'){enablity='enable';}nonIcaoDiversionAD.textinput(enablity);});}var lineRow=this.getLineRow();valueTableBody.append(lineRow);var retValTable=HtmlUtils.table(this._fplGuiFactory.createDefaultTableAttrs(),valueTableBody);return retValTable;};this.createrowTitleTd=function(aRowIndex){return this.createTextTd(this._rowTitles[aRowIndex]);};this._requiredMsgLocKey="FlightPlanUpdateForm.requiredMsg";this.createRequiredMsgTr=function(){var label=HtmlUtils.label({},getLocalizedString(this._requiredMsgLocKey));var openTd=this._fplGuiFactory.createFplTd({'colspan':this._orderAttributes.length},label);var valueTr=HtmlUtils.tr({},openTd);return valueTr;};this.createOpenTd=function(){return this.createTextTd("("+this._title);};this.createTextTd=function(aText){var fontElementTitle=this._fplGuiFactory.createFplSignFont(HtmlUtils.encodeForHTML(aText));var tdAttrs={};tdAttrs[HtmlUtils.A_WIDTH]=this.getDefaultTdWidth();var retVal=this._fplGuiFactory.createFplTd(tdAttrs,fontElementTitle);var itemLabelName=HtmlUtils.label({},HtmlUtils.C_SPACE_CHAR);retVal.append(itemLabelName);return retVal;};this.createCloseTd=function(){return this.createTextTd(")");};this.createViewonlyTd=function(aAttribute){return this.createLabeledTextCell(this._viewonlyAttributes[aAttribute],this.getDataFromModel(aAttribute));};this.createLabeledTextCell=function(aLabelValue,aTextValue){var itemLabelName=HtmlUtils.label({'class':'fpl_desc'},HtmlUtils.encodeForHTML(aLabelValue));var itemLabelValue=HtmlUtils.label({},this._fplGuiFactory.createFplSignFont(HtmlUtils.encodeForHTML(aTextValue)));return this.createLabelValueTd(itemLabelName,itemLabelValue);};this.createReadonlyTd=function(aAttribute){var itemLabelName=HtmlUtils.label({},HtmlUtils.encodeForHTML(this._readonlyAttributes[aAttribute]));var itemInputValue=this.createReadonlyInputText(aAttribute);return this.createLabelValueTd(itemLabelName,itemInputValue);};this.createEditableTd=function(aAttribute){var attrInputRestrict=null;if(AWUtils.isUndefinedOrIsNull(mInputRestr)===false&&aAttribute in mInputRestr===true){attrInputRestrict=mInputRestr[aAttribute];}return this.createLabeledEditableInputfieldCell(aAttribute,this._editableAttributes[aAttribute],attrInputRestrict);};this.createLabeledEditableInputfieldCell=function(aAttribute,aLabelValue,aInputRestrRegex){var itemLabelName=HtmlUtils.label({'class':'fpl_desc'},HtmlUtils.encodeForHTML(aLabelValue));var itemInputValue=this.createEditableInputText(aAttribute,aInputRestrRegex);var editableValue=this.getDataFromModel(aAttribute);this._initialValues[aAttribute]=editableValue;itemInputValue.val(editableValue);var tooltipElement=this.createTooltipElement(aAttribute);this.initChangeColorWhenValueChanged(itemInputValue);return this.createLabelValueTd(itemLabelName,itemInputValue,tooltipElement);};this.createLabeledEditableTextAreaCell=function(aAttribute,aLabelValue,aInputRestrRegex){var itemLabelName=HtmlUtils.label({'class':'fpl_desc'},HtmlUtils.encodeForHTML(aLabelValue));var itemInputValue=this.createEditableTextArea(aAttribute,aInputRestrRegex);var editableValue=this.getDataFromModel(aAttribute);this._initialValues[aAttribute]=editableValue;itemInputValue.val(editableValue);this.initChangeColorWhenValueChanged(itemInputValue);return this.createLabelValueTdWithColspan(itemLabelName,itemInputValue,8);};this.initChangeColorWhenValueChanged=function(aInputTextField){if(HtmlUtils.isUndefinedOrIsNull(aInputTextField)===true){return;}var origValue=HtmlUtils.toUpperCase(aInputTextField.val());aInputTextField.css({'background':'powderblue'});var origBgColor=aInputTextField.css('backgroundColor');var checkAndChangeFnc=function(){var newVal=HtmlUtils.toUpperCase(JQ(this).val());var newBgColor=origBgColor;if(newVal!==origValue){newBgColor='white';}JQ(this).css({'background':newBgColor});};aInputTextField.keyup(checkAndChangeFnc);};this.createReadonlyInputText=function(aAttribute){var retValInput=this.createEditableInputText(aAttribute);retValInput.attr(HtmlUtils.A_READONLY,HtmlUtils.A_READONLY);return retValInput;};this.inputsMap={};this.createEditableInputText=function(aAttribute,aInputRestrRegex){var itemInput=HtmlUtils.input({});itemInput.attr(HtmlUtils.A_MAXLENGTH,this.getMaxInputLength(aAttribute));itemInput.val(this.getDataFromModel(aAttribute));switch(aAttribute){case FPLFormModel.AV_X19F_CHECKBOX:HtmlUtils.setRestrictionsForDinghiesInput(itemInput);break;case FPLFormModel.AV_X19I:HtmlUtils.setRestrictionsForColourMarksInput(itemInput);break;}if(AWUtils.isUndefinedOrIsNull(aInputRestrRegex)===false){HtmlUtils.setInputTextCharsCheckerWhileTyping(itemInput,aInputRestrRegex);}this.inputsMap[aAttribute]=itemInput;return itemInput;};this.createEditableTextArea=function(aAttribute,aInputRestrRegex){var itemInput=HtmlUtils.textArea({});itemInput.attr(HtmlUtils.A_MAXLENGTH,this.getMaxInputLength(aAttribute));itemInput.val(this.getDataFromModel(aAttribute));this.inputsMap[aAttribute]=itemInput;if(AWUtils.isUndefinedOrIsNull(aInputRestrRegex)===false){HtmlUtils.setInputTextCharsCheckerWhileTyping(itemInput,aInputRestrRegex);}return itemInput;};this.createLabelValueTdWithColspan=function(aLabelElement,aValueElement,aColspan){var tdAttrs={};tdAttrs[HtmlUtils.A_WIDTH]=this.getDefaultTdWidth();tdAttrs[HtmlUtils.A_CLASS]='fpl_change_td';tdAttrs[HtmlUtils.A_COLSPAN]=aColspan;aValueElement.addClass('fpl_change_item_value');var retVal=this._fplGuiFactory.createFplTd(tdAttrs,null);retVal.append(aLabelElement);retVal.append(HtmlUtils.br());retVal.append(aValueElement);return retVal;};this.createLabelValueTd=function(aLabelElement,aValueElement,aTooltipElement){var tdAttrs={};tdAttrs[HtmlUtils.A_WIDTH]=this.getDefaultTdWidth();tdAttrs[HtmlUtils.A_CLASS]='fpl_change_td';if(AWUtils.isUndefinedOrIsNull(aTooltipElement)===true){aTooltipElement=HtmlUtils.div();}aTooltipElement.addClass('label_tooltip');aValueElement.addClass('fpl_change_item_value');var labelWrapper=HtmlUtils.div();labelWrapper.addClass('labelWrapper');labelWrapper.append(aLabelElement);labelWrapper.append(aTooltipElement);var retVal=this._fplGuiFactory.createFplTd(tdAttrs,null);retVal.append(labelWrapper);retVal.append(aValueElement);return retVal;};this.createDashTd=function(){var fontElementDash=this._fplGuiFactory.createFplSignFont(HtmlUtils.C_DASH);var tdAttrs={};var retVal=this._fplGuiFactory.createFplTd(tdAttrs,fontElementDash);return retVal;};this.getLineRow=function(){var retVal=HtmlUtils.tr(null,null);var td=HtmlUtils.td(null,null);td.attr(HtmlUtils.A_COLSPAN,this.getLineColspanValue());td.attr(HtmlUtils.A_CLASS,'fpl_td');var hr=HtmlUtils.hr({'size':"1","color":"#557a9a"});td.append(hr);retVal.append(td);return retVal;};this.getLineColspanValue=function(){if(AWUtils.isUndefinedOrIsNull(this._tableElements)===false){return this.getMaxColumnCountFromTableElements();}else{return(2*this._orderAttributes.length)+2;}};this.getMaxColumnCountFromTableElements=function(){var retVal=0;for(var iTableRowKey in this._tableElements.rows){if(AWUtils.isUndefinedOrIsNull(iTableRowKey)===true){continue;}var iTableRow=this._tableElements.rows[iTableRowKey];if(AWUtils.isUndefinedOrIsNull(iTableRow)===true){continue;}if(iTableRow.length>retVal){retVal=iTableRow.length;}}return retVal;};this.getDefaultTdWidth=function(){return HtmlUtils.AV_80;};FlightPlanUpdateForm.tooltipImageAttributes={"hspace":"0","vspace":"0","src":"images/fplimages/fpl_help.gif","title":"","localisationkey":""};this.createTooltipElement=function(aAttribute){if(AWUtils.isString(aAttribute)===false){return aAttribute;}var tooltipLocKey=this.getTooltipLocKey(aAttribute);if(AWUtils.isString(tooltipLocKey)===false){return null;}var retVal=HtmlUtils.img(FlightPlanUpdateForm.tooltipImageAttributes);retVal.attr(AWLocale.LOCALISATION_KEY,tooltipLocKey);return retVal;};this.getTooltipLocKey=function(aAttribute){if(AWUtils.isString(aAttribute)===false){return aAttribute;}if(aAttribute in this._hoverTooltipAttributes){return this._hoverTooltipAttributes[aAttribute];}else{return null;}};this.getDataFromModel=function(aAttribute){var retVal=HtmlUtils.C_EMPTY;if(HtmlUtils.isUndefinedOrIsNull(this._flightPlanModel)===true){return retVal;}if(AWUtils.isUndefinedOrIsNull(mValueProviders)===false&&(aAttribute in mValueProviders)===true&&AWUtils.isUndefinedOrIsNull(mValueProviders[aAttribute])===false){return mValueProviders[aAttribute](this._flightPlanModel);}switch(aAttribute){case FPLFormModel.AV_X7:retVal+=this._flightPlanModel.ARCID;break;case FPLFormModel.AV_X13A:retVal+=this._flightPlanModel.ADEP;break;case FPLFormModel.AV_X13B:var showCurrentUTC=getConfigValue2('flightPlans','depAtdShowCurrentUTC',false);if(showCurrentUTC===true&&this._title==="DEP"){var currDate=new Date();retVal+=zeroPad(currDate.getUTCHours(),2)+''+zeroPad(currDate.getUTCMinutes(),2);}else{retVal+=this.parseTimeFromEODB();}break;case FPLFormModel.AV_X16A:retVal+=this._flightPlanModel.ADES;break;case FPLFormModel.AV_X18_DOF:retVal+=this.parseDateFromEODB();break;case FPLFormModel.AV_X8A:retVal+=this._flightPlanModel.FR;break;case FPLFormModel.AV_X8B:retVal+=this._flightPlanModel.FlType;break;case FPLFormModel.AV_X9A:retVal+=this._flightPlanModel.ArcNum;break;case FPLFormModel.AV_X9B:retVal+=this._flightPlanModel.ATYP;break;case FPLFormModel.AV_X9C:retVal+=this._flightPlanModel.WakeTurbulenceCat;break;case FPLFormModel.AV_X10A:retVal+=this._flightPlanModel.getEquipmentFirst();break;case FPLFormModel.AV_X10B:case FPLFormModel.AV_X10C:retVal+=this._flightPlanModel.getEquipmentSecond();break;case FPLFormModel.AV_X15B:retVal+=this._flightPlanModel.FlSpeed;break;case FPLFormModel.AV_X15D:retVal+=this._flightPlanModel.FlLevel;break;case FPLFormModel.AV_X15E:retVal+=this._flightPlanModel.FlRoute;break;case FPLFormModel.AV_X16B:var ataValue=this._flightPlanModel.EET;if(HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(ataValue)===false){ataValue=zeroPad(Math.floor(ataValue/60),2)+HtmlUtils.C_EMPTY+zeroPad((ataValue%60),2);}retVal+=ataValue;break;case FPLFormModel.AV_X16C:retVal+=this._flightPlanModel.ADAltn1;break;case FPLFormModel.AV_X16D:retVal+=this._flightPlanModel.ADAltn2;break;case FPLFormModel.AV_X18:retVal+=this._flightPlanModel.FlOther;break;case FPLFormModel.AV_X19A:retVal+=this._flightPlanModel.getSupplementaryValueOf("E");break;case FPLFormModel.AV_X19B:retVal+=this._flightPlanModel.getSupplementaryValueOf("P");break;case FPLFormModel.AV_X19C:retVal+=this._flightPlanModel.getSupplementaryValueOf("R");break;case FPLFormModel.AV_X19D:retVal+=this._flightPlanModel.getSupplementaryValueOf("S");break;case FPLFormModel.AV_X19E:retVal+=this._flightPlanModel.getSupplementaryValueOf("J");break;case FPLFormModel.AV_X19F_CHECKBOX:retVal+=this._flightPlanModel.getSupplementaryValueOf("D");break;case FPLFormModel.AV_X19I:retVal+=this._flightPlanModel.getSupplementaryValueOf("A");break;case FPLFormModel.AV_X19N:retVal+=this._flightPlanModel.getSupplementaryValueOf("N");break;case FPLFormModel.AV_X19K:retVal+=this._flightPlanModel.getSupplementaryValueOf("C");break;}return retVal;};this.getMaxInputLength=function(aAttribute){var retVal=HtmlUtils.C_EMPTY;if(HtmlUtils.isUndefinedOrIsNull(this._flightPlanModel)===true){return retVal;}switch(aAttribute){case FPLFormModel.AV_X7:retVal=4;break;case FPLFormModel.AV_X13A:retVal=4;break;case FPLFormModel.AV_X13B:retVal=4;break;case FPLFormModel.AV_X16A:retVal=4;break;case FPLFormModel.AV_X18_DOF:retVal=4;break;case FPLFormModel.AV_X16C:retVal=4;break;case FPLFormModel.AV_X16B:retVal=4;break;default:retVal=255;break;}return retVal;};this.parseDateFromEODB=function(){var explodedEOBD=this.explodeEODB();return explodedEOBD[0];};this.parseTimeFromEODB=function(){var explodedEOBD=this.explodeEODB();var explodedTime=explodedEOBD[1].split(HtmlUtils.C_COLON);if(explodedTime.length>1){return explodedTime[0]+HtmlUtils.C_EMPTY+explodedTime[1];}else{return explodedEOBD[1];}};this.explodeEODB=function(){if(HtmlUtils.isUndefinedOrIsNull(this._flightPlanModel.EODB)===true){this._flightPlanModel.EODB=HtmlUtils.C_EMPTY;}var eodb=(HtmlUtils.C_EMPTY+this._flightPlanModel.EODB).split(HtmlUtils.C_SPACE_CHAR);var dateValue=HtmlUtils.C_EMPTY;var timeValue=HtmlUtils.C_EMPTY;if(eodb.length>1){dateValue=eodb[0];timeValue=eodb[1];}return[dateValue,timeValue];};this.getFplId=function(){return this._flightPlanModel.FlId;};this.getFormEobtVal=function(){return HtmlUtils.toUpperCase(this.checkAndGetValue(FPLFormModel.AV_X13B));};this.getFormAtaVal=function(){return HtmlUtils.toUpperCase(this.checkAndGetValue(FPLFormModel.AV_X16B));};this.getFormDivAd=function(){return HtmlUtils.toUpperCase(this.checkAndGetValue(FPLFormModel.AV_X16C));};this.getFormNonIcaoDivAd=function(){if(FPLFormModel.AV_NONICAO_DIVERSION_AD in mTdElementsMap&&mTdElementsMap[FPLFormModel.AV_NONICAO_DIVERSION_AD].find('input').textinput("option","disabled")===true){return HtmlUtils.C_EMPTY;}return HtmlUtils.toUpperCase(this.checkAndGetValue(FPLFormModel.AV_NONICAO_DIVERSION_AD));};this.getFormAtdVal=function(){return HtmlUtils.toUpperCase(this.checkAndGetValue(FPLFormModel.AV_X13B));};this.getFormFlRulesVal=function(){return HtmlUtils.toUpperCase(this.checkAndGetValue(FPLFormModel.AV_X8A));};this.getFormFlTypeVal=function(){return HtmlUtils.toUpperCase(this.checkAndGetValue(FPLFormModel.AV_X8B));};this.getFormArcNumVal=function(){return HtmlUtils.toUpperCase(this.checkAndGetValue(FPLFormModel.AV_X9A));};this.getFormArcTypeVal=function(){return HtmlUtils.toUpperCase(this.checkAndGetValue(FPLFormModel.AV_X9B));};this.getFormWakeTurbulenceCatVal=function(){return HtmlUtils.toUpperCase(this.checkAndGetValue(FPLFormModel.AV_X9C));};this.getFormEquipmentVal=function(){return HtmlUtils.toUpperCase(this.concatenateEquipmentValue());};this.getFormEquipmentValFromObject=function(aFlightPlan){var previousFlightPlan=this.getFlightPlan();this.setFlightPlan(aFlightPlan);var retVal=HtmlUtils.C_EMPTY;var x10AValue=this.getDataFromModel(FPLFormModel.AV_X10A);var x10BValue=this.getDataFromModel(FPLFormModel.AV_X10B);if(x10BValue!==HtmlUtils.C_EMPTY){retVal+=x10AValue+FlightPlanModel.KEY_SEPARATOR+x10BValue;}this.setFlightPlan(previousFlightPlan);return retVal.trim();};this.getFormFlSpeedVal=function(){return HtmlUtils.toUpperCase(this.checkAndGetValue(FPLFormModel.AV_X15B));};this.getFormFlLevelVal=function(){return HtmlUtils.toUpperCase(this.checkAndGetValue(FPLFormModel.AV_X15D));};this.getFormFlRouteVal=function(){return HtmlUtils.toUpperCase(this.checkAndGetValue(FPLFormModel.AV_X15E));};this.setFormFlRouteVal=function(aNewValue){this.checkAndSetValue(FPLFormModel.AV_X15E,aNewValue);};this.getFormADAltn1Val=function(){return HtmlUtils.toUpperCase(this.checkAndGetValue(FPLFormModel.AV_X16C));};this.getFormADAltn2Val=function(){return HtmlUtils.toUpperCase(this.checkAndGetValue(FPLFormModel.AV_X16D));};this.getFormTotalEETVal=function(){return HtmlUtils.toUpperCase(this.checkAndGetValue(FPLFormModel.AV_X16B));};this.getFormTotalEETValFromObject=function(aFlightPlan){var previousFlightPlan=this.getFlightPlan();this.setFlightPlan(aFlightPlan);var retVal=HtmlUtils.C_EMPTY;retVal=this.getDataFromModel(FPLFormModel.AV_X16B);this.setFlightPlan(previousFlightPlan);return retVal.trim();};this.getFormFlOtherVal=function(){return HtmlUtils.toUpperCase(this.checkAndGetValue(FPLFormModel.AV_X18));};this.getFormFlSuplementaryVal=function(){return HtmlUtils.toUpperCase(this.concatenateSupplementaryValue());};this.getFormFlSuplementaryValFromObject=function(aFlightPlan){var previousFlightPlan=this.getFlightPlan();this.setFlightPlan(aFlightPlan);var retVal=HtmlUtils.C_EMPTY;retVal+=this.getDataFromModelWithPrefixIfNotEmpty(FPLFormModel.AV_X19A,"E");retVal+=this.getDataFromModelWithPrefixIfNotEmpty(FPLFormModel.AV_X19B,"P");retVal+=this.getDataFromModelWithPrefixIfNotEmpty(FPLFormModel.AV_X19C,"R");retVal+=this.getDataFromModelWithPrefixIfNotEmpty(FPLFormModel.AV_X19D,"S");retVal+=this.getDataFromModelWithPrefixIfNotEmpty(FPLFormModel.AV_X19E,"J");retVal+=this.getDataFromModelWithPrefixIfNotEmpty(FPLFormModel.AV_X19F_CHECKBOX,"D");retVal+=this.getDataFromModelWithPrefixIfNotEmpty(FPLFormModel.AV_X19I,"A");retVal+=this.getDataFromModelWithPrefixIfNotEmpty(FPLFormModel.AV_X19N,"N");retVal+=this.getDataFromModelWithPrefixIfNotEmpty(FPLFormModel.AV_X19K,"C");this.setFlightPlan(previousFlightPlan);return retVal.trim();};this.isFormFlRulesValChanged=function(){return this.getFormFlRulesVal()!==this.getFlightPlan().FR;};this.isFormFlTypeValChanged=function(){return this.getFormFlTypeVal()!==this.getFlightPlan().FlType;};this.isFormArcNumValChanged=function(){return this.getFormArcNumVal()!==this.getFlightPlan().ArcNum;};this.isFormArcTypeValChanged=function(){return this.getFormArcTypeVal()!==this.getFlightPlan().ATYP;};this.isFormWakeTurbulenceCatValChanged=function(){return this.getFormWakeTurbulenceCatVal()!==this.getFlightPlan().WakeTurbulenceCat;};this.isFormEquipmentValChanged=function(){return this.getFormEquipmentVal()!==this.getFormEquipmentValFromObject(this.getFlightPlan());};this.isFormEOBTValChanged=function(){return this.getFormEobtVal()!==this.getDataFromModel(FPLFormModel.AV_X13B);};this.isFormFlSpeedValChanged=function(){return this.getFormFlSpeedVal()!==this.getFlightPlan().FlSpeed;};this.isFormFlLevelValChanged=function(){return this.getFormFlLevelVal()!==this.getFlightPlan().FlLevel;};this.isFormFlRouteValChanged=function(){return this.getFormFlRouteVal()!==this.getFlightPlan().FlRoute;};this.isFormADAltn1ValChanged=function(){return this.getFormADAltn1Val()!==this.getFlightPlan().ADAltn1;};this.isFormADAltn2ValChanged=function(){return this.getFormADAltn2Val()!==this.getFlightPlan().ADAltn2;};this.isFormTotalEETValChanged=function(){return this.getFormTotalEETVal()!==this.getFormTotalEETValFromObject(this.getFlightPlan());};this.isFormFlOtherValChanged=function(){return this.getFormFlOtherVal()!==this.getFlightPlan().FlOther;};this.isFormFlSuplementaryValChanged=function(){return this.getFormFlSuplementaryVal()!==this.getFormFlSuplementaryValFromObject(this.getFlightPlan());};this.getDataFromModelWithPrefixIfNotEmpty=function(aAttribute,aPrefix){var value=this.getDataFromModel(aAttribute);if(value===HtmlUtils.C_EMPTY){return HtmlUtils.C_EMPTY;}value=HtmlUtils.C_SPACE_CHAR+aPrefix+FlightPlanModel.KEY_SEPARATOR+value;return value;};this.concatenateEquipmentValue=function(){var retVal=HtmlUtils.C_EMPTY;var x10AValue=this.checkAndGetValue(FPLFormModel.AV_X10A);var x10BValue=this.checkAndGetValue(FPLFormModel.AV_X10B);if(x10BValue!==HtmlUtils.C_EMPTY){retVal+=x10AValue+FlightPlanModel.KEY_SEPARATOR+x10BValue;}return retVal.trim();};this.concatenateSupplementaryValue=function(){var retVal=HtmlUtils.C_EMPTY;retVal+=this.getValueWithPrefixIfNotEmpty(FPLFormModel.AV_X19A,"E");retVal+=this.getValueWithPrefixIfNotEmpty(FPLFormModel.AV_X19B,"P");retVal+=this.getValueWithPrefixIfNotEmpty(FPLFormModel.AV_X19C,"R");retVal+=this.getValueWithPrefixIfNotEmpty(FPLFormModel.AV_X19D,"S");retVal+=this.getValueWithPrefixIfNotEmpty(FPLFormModel.AV_X19E,"J");retVal+=this.getValueWithPrefixIfNotEmpty(FPLFormModel.AV_X19F_CHECKBOX,"D");retVal+=this.getValueWithPrefixIfNotEmpty(FPLFormModel.AV_X19I,"A");retVal+=this.getValueWithPrefixIfNotEmpty(FPLFormModel.AV_X19N,"N");retVal+=this.getValueWithPrefixIfNotEmpty(FPLFormModel.AV_X19K,"C");return retVal.trim();};this.getValueWithPrefixIfNotEmpty=function(aValueItem,aPrefix){var aValue=this.checkAndGetValue(aValueItem);if(aValue===HtmlUtils.C_EMPTY){return HtmlUtils.C_EMPTY;}aValue=HtmlUtils.C_SPACE_CHAR+aPrefix+FlightPlanModel.KEY_SEPARATOR+aValue;return aValue;};this.checkAndGetValue=function(aAttribute){if(HtmlUtils.isUndefinedOrIsNull(aAttribute)===true||HtmlUtils.isUndefinedOrIsNull(this.inputsMap)===true){return HtmlUtils.C_EMPTY;}if((aAttribute in this.inputsMap)===false){return HtmlUtils.C_EMPTY;}else{return latinize((HtmlUtils.C_EMPTY+this.inputsMap[aAttribute].val()));}};this.checkAndSetValue=function(aAttribute,aNewValue){if(HtmlUtils.isUndefinedOrIsNull(aAttribute)===true||HtmlUtils.isUndefinedOrIsNull(this.inputsMap)===true){return;}if((aAttribute in this.inputsMap)===true){this.inputsMap[aAttribute].val(aNewValue);}};this.msgPreffix="Sending message \"";this.okMsgSuffix="\" was successful";this.errMsgSuffix="\" failed";this.okCallBackFnc=null;this.getOkCallBackFnc=function(){if(this.okCallBackFnc===null){var parentInstance=this._instance;this.okCallBackFnc=function(aOkMessage){var localizedOkMsg=getUpdtLocalizedString(parentInstance.msgPreffix+parentInstance._title+parentInstance.okMsgSuffix);parentInstance.showOkOptionMsg(HtmlUtils.encodeForHTML(localizedOkMsg),false,true);};}return this.okCallBackFnc;};this.errorCallBackFnc=null;this.getErrorCallBackFnc=function(){if(this.errorCallBackFnc===null){var parentInstance=this._instance;this.errorCallBackFnc=function(aErrorMessage){var transSengingMsg=getUpdtLocalizedString(parentInstance.msgPreffix+parentInstance._title+parentInstance.errMsgSuffix);var transDescription=getDecodeLocalizedString(aErrorMessage);parentInstance.showOkOptionMsg(HtmlUtils.encodeForHTML(transSengingMsg+' : \"'+transDescription+'\"'),true,false);};}return this.errorCallBackFnc;};var translateKeyPreffix='FlightPlanUpdateForm.';var getUpdtLocalizedString=function(aString){return getLocalizedString(translateKeyPreffix+aString);};var getDecodeLocalizedString=function(aString){aString=translateKeyPreffix+aString;var splitStr=aString.split(":");if(splitStr.length>1){return getLocalizedString(splitStr[0])+":"+splitStr[1];}else{return getLocalizedString(aString);}};this.msgPopup=JQ('<div data-role="popup" data-theme="a" data-overlay-theme="b" class="closePopup" id="flightPlanUpdateForm"></div>');this.showOkOptionMsg=function(aMsgText,aIsError,aIsSoft){aMsgText=getLocalizedString(aMsgText);this.msgPopup.text(aMsgText);var parentInstance=this._instance;JQMUtil.showInfoMsg(aMsgText,aIsError,aIsSoft,function(optionId){parentInstance.msgPopup.popup();parentInstance.msgPopup.popup(HtmlUtils.C_CLOSE);});};this.isEobdtBeforeThanActual=function(){const eobdatetime=this.getEobDatetime();const currentdatetime=AWUtils.formatDateToAisMobile(new Date(),true).replace(' ','').replace(':','');return eobdatetime<currentdatetime;};this.setTableGUIElements=function(aTableElements){this._tableElements=aTableElements;var deletableAttributes=this.getDeletableAttributesFromTableElements();this.setDeletableAttributes(deletableAttributes);};this.getDeletableAttributesFromTableElements=function(){var retVal=[];this.doForAllFplUpdateGUIElements(function(aFplUpdateGuiElement){if(AWUtils.isUndefinedOrIsNull(aFplUpdateGuiElement)===true){return;}if(AWUtils.isUndefinedOrIsNull(aFplUpdateGuiElement._isDeletable)===false&&aFplUpdateGuiElement._isDeletable===true){retVal.push(aFplUpdateGuiElement._fplFormModelID);}});return retVal;};this.doForAllFplUpdateGUIElements=function(aVisitorFnc){if(AWUtils.isUndefinedOrIsNull(this._tableElements)===true){return;}for(var iTableRowKey in this._tableElements.rows){if(AWUtils.isUndefinedOrIsNull(iTableRowKey)===true){continue;}var iTableRow=this._tableElements.rows[iTableRowKey];if(AWUtils.isUndefinedOrIsNull(iTableRow)===true){return null;}for(var iRowCellKey in iTableRow){if(AWUtils.isUndefinedOrIsNull(iRowCellKey)===true){continue;}var iRowCell=iTableRow[iRowCellKey];aVisitorFnc(iRowCell);}}};}function FPLUpdateGUIElement(aFplFormModelID,aGuiType,aIsEditable,aValue,aLabelValue,aIsDeletable,aAdditionalAttrs,aInputRestrRegx){this._fplFormModelID=null;this._guiType=null;this._isEditable=null;this._isDeletable=false;this._value=null;this._labelValue=null;this._additionalAttrs=null;this._inputRestrictionRegex=null;if(AWUtils.isUndefinedOrIsNull(aFplFormModelID)===false){this._fplFormModelID=aFplFormModelID;}if(AWUtils.isUndefinedOrIsNull(aGuiType)===false){this._guiType=aGuiType;}if(AWUtils.isUndefinedOrIsNull(aIsEditable)===false){this._isEditable=aIsEditable;}if(AWUtils.isUndefinedOrIsNull(aValue)===false){this._value=aValue;}if(AWUtils.isUndefinedOrIsNull(aLabelValue)===false){this._labelValue=aLabelValue;}if(AWUtils.isUndefinedOrIsNull(aIsDeletable)===false){this._isDeletable=aIsDeletable;}if(AWUtils.isUndefinedOrIsNull(aAdditionalAttrs)===false){this._additionalAttrs=aAdditionalAttrs;}if(AWUtils.isUndefinedOrIsNull(aInputRestrRegx)===false){this._inputRestrictionRegex=aInputRestrRegx;}}function GUIType(){}GUIType.TEXT='GUIType.TEXT';GUIType.LABEL_TEXT='GUIType.LABEL_TEXT';GUIType.LABEL_TEXTINPUT='GUIType.LABEL_TEXTINPUT';GUIType.TEXT_INPUT='GUIType.TEXT_INPUT';GUIType.TEXT_AREA='GUIType.TEXT_AREA';