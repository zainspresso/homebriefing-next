function AWDataHandler(){}AWDataHandler.token;AWDataHandler.tokenHeader='X-AisWeb-Token';var _activeLoadNotamsFromRectRequest=null;AWDataHandler.setToken=function(token){AWDataHandler.token=token;JQ.ajaxSetup({beforeSend:function(xhr){AWDataHandler.addTokenToXhr(xhr);}});};AWDataHandler.addTokenToXhr=function(xhr){try{if(AWDataHandler.token!==undefined){xhr.setRequestHeader(AWDataHandler.tokenHeader,AWDataHandler.token);}}catch(e){};};AWDataHandler.sendRequest=function(xhr,data){AWDataHandler.addTokenToXhr(xhr);xhr.send(data);};function checkCustomHeaders(xhr){var secManHeader=xhr.getResponseHeader('SecurityManager');if(secManHeader!==undefined&&typeof secManHeader==="string"){JQMUtil.showInfoMsg(AWUtils.createSecurityManagerInfoMsg(secManHeader,xhr));}var loginCheck=xhr.getResponseHeader('LoginCheck');if(loginCheck!==undefined&&(loginCheck==="false"||loginCheck===false)){debug("Session error! "+xhr.responseURL);JQMUtil.showInfoMsg(getLocalizedString("Messages.sessionError"),true,function(){window.location.reload();});}}AWDataHandler.callMethod=function(methodName,params,element,showLoadingFlag){var xhr=AWUtils.getXhr();xhr.onreadystatechange=function(){var errorText="Loading ...";if(xhr.readyState===4&&xhr.status===200){checkCustomHeaders(this);var responseText=xhr.responseText;if(responseText.indexOf("Error:")!==0){try{var responseXML=new OpenLayers.Format.XML().read(responseText);if(responseXML){responseText=(responseXML.text)?responseXML.text:responseXML.childNodes[0].childNodes[0].textContent;}}catch(e){responseText=errorText;}}else{responseText="Loading error!";}if(element instanceof HTMLInputElement){element.value=responseText;}else if(element instanceof jQuery){var pre=JQ("<pre></pre>");pre.html(responseText);element.loading(false);element.append(pre);}else{element.innerHTML=unescape(responseText);}}else if(showLoadingFlag===undefined||showLoadingFlag){if(element instanceof HTMLInputElement){element.value=errorText;}else{element.innerHTML=errorText;}}};var url=AWDataHandler.getServiceUrl()+"?method="+methodName+"&"+params;xhr.open("POST",url,true);xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');AWDataHandler.sendRequest(xhr);};AWDataHandler.callMethodWithCallback=function(methodName,params,aCallBackFunction,userData,externalServiceOptions){const xhr=AWUtils.getXhr();var url=AWDataHandler.getServiceUrl()+"?method=";var urlParams,payload;url+=(externalServiceOptions)?externalServiceOptions.serviceName+".":"";url+=methodName;if(typeof params==="string"&&params.length>0){urlParams=params;}else if(typeof params==="object"&&params!==null){if(params.urlParam!==undefined&&params.payload!==undefined){urlParams=(params.urlParam.length>0)?params.urlParam:null;payload=params.payload;}else{var x2js=new X2JS();payload=x2js.json2xml_str(params);}}if(urlParams){url+="&"+urlParams;}xhr.onreadystatechange=function(){if(xhr.readyState===4){var retVal;if(xhr.status===200){const responseSuffix=(externalServiceOptions)?externalServiceOptions.responseSuffix:"Result";checkCustomHeaders(this);var response=AWUtils.processResponse(xhr.responseText,methodName+responseSuffix);if(response&&response.length>0){var x2js=new X2JS();retVal=x2js.xml2json(response[0]);}}AWUtils.applyFunction(this,aCallBackFunction,[retVal,this.userData,xhr]);}};xhr.open("POST",url,true);if(userData!==undefined){xhr.userData=userData;}if(payload){xhr.setRequestHeader('Content-Type','text/xml');}else{xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');}AWDataHandler.sendRequest(xhr,payload);return xhr;};AWDataHandler.loadAupUup=function(element,aDate,showLoadingFlag){var params="aDate="+AWUtils.date2yyyymmdd(aDate);AWDataHandler.callMethod("getAupUup",params,element,showLoadingFlag);};AWDataHandler.loadMetar=function(element,arpCode,showLoadingFlag){var params="aArpCode="+arpCode;AWDataHandler.callMethod("getMetar",params,element,showLoadingFlag);};AWDataHandler.getMetar=function(arpCode,aCallBackFunction){var params="aArpCode="+arpCode;AWDataHandler.callMethodWithCallback("getMetar",params,aCallBackFunction);};AWDataHandler.loadTaf=function(element,aDate,arpCode,showLoadingFlag){var params="aDate="+AWUtils.date2yyyymmdd(aDate)+"&aArpCode="+arpCode;AWDataHandler.callMethod("getTaf",params,element,showLoadingFlag);};AWDataHandler.getTaf=function(aDate,arpCode,aCallBackFunction){var params="aDate="+AWUtils.date2yyyymmdd(aDate)+"&aArpCode="+arpCode;AWDataHandler.callMethodWithCallback("getTaf",params,aCallBackFunction);};AWDataHandler.loadFua=function(element,aDate,airspaceName,showLoadingFlag){var params="aDate="+AWUtils.date2yyyymmdd(aDate)+"&aArea="+airspaceName;AWDataHandler.callMethod("getFua",params,element,showLoadingFlag);};AWDataHandler.loadSigmet=function(element,aDate,firName,showLoadingFlag){var params="aDate="+AWUtils.date2yyyymmdd(aDate)+"&aFir="+firName;AWDataHandler.callMethod("getSigmet",params,element,showLoadingFlag);};AWDataHandler.getSigmet=function(aDate,code,aCallBackFunction){var params="aDate="+AWUtils.date2yyyymmdd(aDate)+"&aFir="+code;AWDataHandler.callMethodWithCallback("getSigmet",params,aCallBackFunction);};AWDataHandler.loadFisForFir=function(element,firName,showLoadingFlag){var params="aFir="+firName;AWDataHandler.callMethod("getFisForFir",params,element,showLoadingFlag);};AWDataHandler.processNotamResponseData=function(data){if(data){const getOlFeatureFunc=function(mapProjection){if(!this.olFeature||this.olFeature.geometry===null){if(this.geometry&&this.geometry.length>0){var format=new OpenLayers.Format.WKT();this.olFeature=format.read(this.geometry);if(this.olFeature&&this.olFeature.geometry){const centroid=this.olFeature.geometry.getCentroid();if(centroid.x<=90&&centroid.y<=180){this.olFeature.geometry.transform("EPSG:4326",mapProjection);}}}}return this.olFeature;};data=(Array.isArray(data.AdNotam))?data.AdNotam:[data.AdNotam];data.forEach(function(notam,index){notam.getOLFeature=getOlFeatureFunc;});}return data;};AWDataHandler.getNotamsForArp=function(options,aCallBackFunction,userData){var retVal;if(options&&options.date&&options.code){var params="aDate="+options.date.toISOString()+"&aArpCode="+options.code;function processNotamResponse(data,userData,xhr){data=AWDataHandler.processNotamResponseData(data);AWUtils.applyFunction(this,aCallBackFunction,[data,userData,xhr]);};if(options.notamMode){params+="&aEffective=";params+=(options.notamMode===AisWeb.NOTAM_MODES.EFFECTIVE)?"true":"false";}retVal=AWDataHandler.callMethodWithCallback("getNotamsForArp",params,processNotamResponse,userData);}return retVal;};AWDataHandler.loadXtamMarks=function(aDate,map,aCallBackFunction){var extent=map.getExtent();if(extent){extent.transform(map.getProjectionObject(),"EPSG:4326");var bbox=extent.toArray();var lat1=Math.floor(bbox[1]*60*60);var lng1=Math.floor(bbox[0]*60*60);var lat2=Math.floor(bbox[3]*60*60);var lng2=Math.floor(bbox[2]*60*60);var flDown=AppController.flFilter.lower;var flUp=AppController.flFilter.upper;var params="aDateTime="+aDate.toISOString()+"&flDwn="+flDown+"&flUp="+flUp+"&lat1="+lat1+"&lng1="+lng1+"&lat2="+lat2+"&lng2="+lng2;var notamMode=AppController.aisWeb.actualNotamMode;if(notamMode){params+="&aEffective=";params+=(notamMode===AisWeb.NOTAM_MODES.EFFECTIVE)?"true":"false";}if(_activeLoadNotamsFromRectRequest!==null&&_activeLoadNotamsFromRectRequest.readyState<4){_activeLoadNotamsFromRectRequest.abort();}_activeLoadNotamsFromRectRequest=AWDataHandler.callMethodWithCallback("getXtamMarks",params,aCallBackFunction);}};AWDataHandler.loadNotams=function(aDate,map,aCallBackFunction){var extent=map.getExtent();if(extent){extent.transform(map.getProjectionObject(),"EPSG:4326");var bbox=extent.toArray();var lat1=Math.floor(bbox[1]*60*60);var lng1=Math.floor(bbox[0]*60*60);var lat2=Math.floor(bbox[3]*60*60);var lng2=Math.floor(bbox[2]*60*60);var flDown=AppController.flFilter.lower;var flUp=AppController.flFilter.upper;var params="aDateTime="+aDate.toISOString()+"&flDwn="+flDown+"&flUp="+flUp+"&lat1="+lat1+"&lng1="+lng1+"&lat2="+lat2+"&lng2="+lng2;var notamMode=AppController.aisWeb.actualNotamMode;if(notamMode){params+="&aEffective=";params+=(notamMode===AisWeb.NOTAM_MODES.EFFECTIVE)?"true":"false";}if(_activeLoadNotamsFromRectRequest!==null&&_activeLoadNotamsFromRectRequest.readyState<4){_activeLoadNotamsFromRectRequest.abort();}_activeLoadNotamsFromRectRequest=AWDataHandler.callMethodWithCallback("getNotamsFromRectangle",params,aCallBackFunction);}};AWDataHandler.loadSnowtams=function(aDate,aCallBackFunction){var params="aDateTime="+aDate.toISOString();AWDataHandler.callMethodWithCallback("getSnowtams",params,aCallBackFunction);};AWDataHandler.analyzeFplRoute=function(fpl,callbackFnc){var params="Fpl="+fpl;var xhr=AWUtils.getXhr();xhr.onreadystatechange=function(){if(xhr.status===500){AWUtils.applyFunction(this,callbackFnc);}else if(xhr.readyState===4&&xhr.status===200){checkCustomHeaders(this);var response=AWUtils.processResponse(xhr.responseText,'getPointsForFplResult');if(response&&response.length>0){var x2js=new X2JS();var json=x2js.xml2json(response[0]);AWUtils.applyFunction(this,callbackFnc,[json]);}}};var url=AWDataHandler.getServiceUrl()+"?method=getPointsForFpl&"+params;xhr.open("POST",url,true);xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');AWDataHandler.sendRequest(xhr);};AWDataHandler.getAllValidNotams=function(aDate,aCallBackFunction){const params="aDateTime="+aDate.toISOString();function processNotamResponse(data,userData,xhr){data=AWDataHandler.processNotamResponseData(data);AWUtils.applyFunction(this,aCallBackFunction,[data,userData,xhr]);};AWDataHandler.callMethodWithCallback("getAllValidNotams",params,processNotamResponse);};AWDataHandler.getSnowtamsForArp=function(options,aCallBackFunction,userData){if(options&&options.date&&options.code){var params="aDate="+AWUtils.date2yyyymmdd(options.date)+"&aArpCode="+options.code;var uData={callback:aCallBackFunction,data:userData};AWDataHandler.callMethodWithCallback("getSnowtamsForArp",params,function(res,aData){var snowtams=(JQ.isArray(res.AdSnowtam))?res.AdSnowtam:[res.AdSnowtam];AWUtils.applyFunction(this,aData.callback,[snowtams,aData.data]);},uData);}};AWDataHandler.loadNotamsAndSnowtamsForArp=function(options,feature,callbackFnc){const result={};function syncFnc(data,userData,xhr){if(data&&userData){result[userData]=data;if(result.notams&&result.snowtams){AWUtils.applyFunction(this,callbackFnc,[feature,result]);}}};if(options.disableSnowtam){result.snowtams=[];}else{AWDataHandler.getSnowtamsForArp(options,syncFnc,"snowtams");}AWDataHandler.getNotamsForArp(options,syncFnc,"notams");};AWDataHandler.getBirdtamList=function(aDate,aCallBackFunction){var params="dateTime="+aDate.toISOString();AWDataHandler.callMethodWithCallback("getBirdtamList",params,aCallBackFunction);};AWDataHandler.getAshtamList=function(options,aCallBackFunction){if(options&&options.date&&options.code){const params="dateTime="+options.date.toISOString()+"&fir="+options.code;AWDataHandler.callMethodWithCallback("getAshtamList",params,aCallBackFunction,options.userData);}};AWDataHandler.loadFplsForAd=function(dateTime,adCode,aCallbackFnc){var params="aDateTime="+dateTime.toISOString()+"&adCode="+adCode;var xhr=AWUtils.getXhr();xhr.onreadystatechange=function(){if(xhr.readyState===4&&xhr.status===200){var retVal;var responseText=xhr.responseText;checkCustomHeaders(this);if(responseText){var response=AWUtils.processResponse(xhr.responseText,'getFplsForAdResult');if(response&&response.length>0){var x2js=new X2JS();retVal=x2js.xml2json(response[0]).AdFpl;if(Array.isArray(retVal)===false){retVal=[retVal];}}}aCallbackFnc(retVal);}};var url=AWDataHandler.getServiceUrl()+"?method=getFplsForAd&"+params;xhr.open("POST",url,true);xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');AWDataHandler.sendRequest(xhr);};AWDataHandler.userLogout=function(){var xhr=AWUtils.getXhr();xhr.onreadystatechange=function(){if(xhr.readyState===4){var href=document.referrer;if(window.frameElement){href=document.URL;}window.location.href=href;}};var url=AWDataHandler.getServiceUrl()+"?method=logout";xhr.open("POST",url,true);xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');AWDataHandler.sendRequest(xhr);};AWDataHandler.getUserInfo=function(callbackFnc){var xhr=AWUtils.getXhr();xhr.onreadystatechange=function(){if(xhr.readyState===4){var info=null;if(xhr.status===200){checkCustomHeaders(this);info=xhr.response;}callbackFnc(info);}};var url=AWDataHandler.getServiceUrl()+"?method=getUserInfo";xhr.open("POST",url,true);xhr.responseType='json';AWDataHandler.sendRequest(xhr);};AWDataHandler.refreshUserInfo=function(callbackFnc){var xhr=AWUtils.getXhr();xhr.onreadystatechange=function(){if(xhr.readyState===4){var info=null;if(xhr.status===200){checkCustomHeaders(this);info=xhr.response;}callbackFnc(info);document.appCtrl.refreshUserInfo(info);}};var url=AWDataHandler.getServiceUrl()+"?method=refreshUserInfo";xhr.open("POST",url,true);xhr.responseType='json';AWDataHandler.sendRequest(xhr);};AWDataHandler.getUserMessage=function(callback){return AWDataHandler.callMethodWithCallback("getUserMessage",null,(response,data,xhr)=>{const msg=(xhr.status===200)?xhr.responseText:null;callback(msg);});};AWDataHandler.addAircraft=function(aircraft,callback){return AWDataHandler.callMethodWithCallback("addAircraft",aircraft.getJson(),callback);};AWDataHandler.updateAircraft=function(aircraft,callback){return AWDataHandler.callMethodWithCallback("updateAircraft",aircraft.getJson(),callback);};AWDataHandler.deleteAircraft=function(aircraftId,callback){const params="id="+aircraftId;return AWDataHandler.callMethodWithCallback("deleteAircraft",params,callback);};AWDataHandler.getAircraftList=function(callback){return AWDataHandler.callMethodWithCallback("getAircraftList",null,(response)=>{var acList=null;if(response){acList=new AircraftListModel();acList.init(response);}callback(acList);});};AWDataHandler.addFlight=function(flight,callbackFnc){var xhr=AWUtils.getXhr();var x2js=new X2JS();var url=AWDataHandler.getServiceUrl()+"?method=addFlight";var xmlData=x2js.json2xml(flight.getJson());xhr.onreadystatechange=function(){if(xhr.readyState===4&&xhr.status===200){checkCustomHeaders(this);var response=AWUtils.processResponse(xhr.responseText,'addFlightResult');var retVal=null;if(response&&response.length>0){retVal=response[0].textContent;}AWUtils.applyFunction(this,callbackFnc,[retVal]);}};xhr.open("POST",url,true);xhr.setRequestHeader('Content-Type','application/xml');AWDataHandler.sendRequest(xhr,xmlData);};AWDataHandler.updateFlight=function(flight,callbackFnc){var xhr=AWUtils.getXhr();var x2js=new X2JS();var url=AWDataHandler.getServiceUrl()+"?method=updateFlight";var json=flight.getJson();var xmlData=x2js.json2xml(json);xhr.onreadystatechange=function(){if(xhr.readyState===4&&xhr.status===200){checkCustomHeaders(this);if(callbackFnc!==undefined){var response=AWUtils.processResponse(xhr.responseText,'faultstring');var retVal=null;if(response&&response.length>0){retVal=response[0].textContent;}else{response=AWUtils.processResponse(xhr.responseText,'updateFlightResult');if(response&&response.length>0)retVal=parseInt(response[0].textContent);}callbackFnc(retVal);}}};xhr.open("POST",url,true);xhr.setRequestHeader('Content-Type','application/xml');AWDataHandler.sendRequest(xhr,xmlData);};AWDataHandler.reverseRouteForFlight=function(flight,callback){if(!flight){return;}return AWDataHandler.callMethodWithCallback("reverseRouteForFlight",flight.getJson(),(res,userData,xhr)=>{var retVal=null;const response=AWUtils.processResponse(xhr.responseText,'Flight',"json");if(response){retVal=new Flight();retVal.init(response);}callback(retVal);});};AWDataHandler.deleteFlight=function(flightId,callback){const params="id="+flightId;return AWDataHandler.callMethodWithCallback("deleteFlight",params,callback);};AWDataHandler.getFlightById=function(id){var xhr=AWUtils.getXhr();var url=AWDataHandler.getServiceUrl()+"?method=getFlightById&id="+id;xhr.timeout=0;xhr.open("POST",url,false);xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');AWDataHandler.sendRequest(xhr);checkCustomHeaders(xhr);var response=AWUtils.processResponse(xhr.responseText,'Flight',"json");var retVal=null;if(response){retVal=new Flight();retVal.init(response);}return retVal;};AWDataHandler.getFlightList=function(callbackFnc){var xhr=AWUtils.getXhr();var url=AWDataHandler.getServiceUrl()+"?method=getFlightList";xhr.onreadystatechange=function(){if(xhr.readyState===4){var fList=null;if(callbackFnc){if(xhr.status===200){checkCustomHeaders(this);var response=AWUtils.processResponse(xhr.responseText,'getFlightListResult',"json");if(response!==undefined){fList=new FlightList();fList.init(response);}}callbackFnc(fList);}}};xhr.open("POST",url,true);xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');AWDataHandler.sendRequest(xhr);};AWDataHandler.calculateFlight=function(flight,callbackFnc){var xhr=AWUtils.getXhr();var x2js=new X2JS();var url=AWDataHandler.getServiceUrl()+"?method=calculateFlight";xhr.onreadystatechange=function(){if(xhr.readyState===4&&xhr.status===200){checkCustomHeaders(this);if(callbackFnc!==undefined){const response=AWUtils.processResponse(xhr.responseText,'Flight',"json");var calculatedFlight=null;if(response){calculatedFlight=new Flight();calculatedFlight.init(response);}callbackFnc(calculatedFlight);}}};xhr.open("POST",url,true);xhr.setRequestHeader('Content-Type','application/xml');var json=flight.getJson();var xmlData=x2js.json2xml(json);AWDataHandler.sendRequest(xhr,xmlData);};AWDataHandler.getReliefForFlight=function(flight,callbackFnc){var xhr=AWUtils.getXhr();var url=AWDataHandler.getServiceUrl()+"?method=getReliefForFlight";xhr.onreadystatechange=function(){if(xhr.readyState===4&&xhr.status===200){checkCustomHeaders(this);if(callbackFnc!==undefined){var response=AWUtils.processResponse(xhr.responseText,'getReliefForFlightResult',"json");var relief=null;if(response){relief=new Relief();relief.init(response);}callbackFnc(relief);}}};xhr.open("POST",url,true);xhr.setRequestHeader('Content-Type','application/xml');xhr.timeout=180*1000;var json=flight.getJson();var x2js=new X2JS();var xmlData=x2js.json2xml(json);AWDataHandler.sendRequest(xhr,xmlData);};AWDataHandler.getReliefForFPL=function(aFpl,callbackFnc){var xhr=AWUtils.getXhr();var url=AWDataHandler.getServiceUrl()+"?method=getReliefForFPL";var params="flight="+aFpl;url+="&"+params;xhr.onreadystatechange=function(){if(xhr.readyState===4&&xhr.status===200){checkCustomHeaders(this);if(callbackFnc!==undefined){var response=AWUtils.processResponse(xhr.responseText,'getReliefForFPLResult');var relief=null;if(response&&response.length>0){var x2js=new X2JS();var retJson=x2js.xml2json(response[0]);relief=new Relief();relief.init(retJson);}callbackFnc(relief);}}};xhr.open("POST",url,true);xhr.setRequestHeader('Content-Type','application/xml');xhr.timeout=180*1000;AWDataHandler.sendRequest(xhr);};AWDataHandler.getFlightReportWithMapBytes=function(flight,svgRelief,svgRoute,reportIndex=new ReportIndex(),wmsParams,callbackFnc){var xhr=AWUtils.getXhr();var url=AWDataHandler.getServiceUrl()+"?method=getFlightReportWithMapBytes";xhr.onreadystatechange=function(){if(xhr.readyState===4){if(xhr.status===200){checkCustomHeaders(this);if(callbackFnc!==undefined){var response=AWUtils.processResponse(xhr.responseText,'getFlightReportWithMapBytesResult');var data=(response!==undefined&&response.length>0)?response[0].textContent:null;callbackFnc(data);}}else{callbackFnc(null);}}};xhr.open("POST",url,true);xhr.setRequestHeader('Content-Type','application/xml');var x2js=new X2JS();var xmlSer=new XMLSerializer();var json={Data:flight.getJson()};if(svgRelief&&reportIndex.Chapter.find(chapter=>chapter.name===ReportChapterType.RELIEF)){}else{svgRelief="<svg/>";}if(svgRoute&&reportIndex.Chapter.find(chapter=>chapter.name===ReportChapterType.MAP)){svgRoute=xmlSer.serializeToString(svgRoute);}else{svgRoute="<svg/>";}json.Data.svgRelief=AWUtils.btoa(svgRelief);json.Data.svgRoute=AWUtils.btoa(svgRoute);json.Data.reportIndex=reportIndex.getJson().reportIndex;json.Data.wmsParams=encodeURIComponent(wmsParams);var xmlData=x2js.json2xml(json);AWDataHandler.sendRequest(xhr,xmlData);};AWDataHandler.getFlightMapWmsBytes=function(flight,svgRoute,wmsParams,callbackFnc){var xhr=AWUtils.getXhr();var url=AWDataHandler.getServiceUrl()+"?method=getFlightMapWmsBytes";xhr.onreadystatechange=function(){if(xhr.readyState===4&&xhr.status===200){checkCustomHeaders(this);if(callbackFnc!==undefined){var response=AWUtils.processResponse(xhr.responseText,'getFlightMapWmsBytesResult');var data=(response&&response.length>0)?response[0].textContent:null;callbackFnc(data);}}};xhr.open("POST",url,true);xhr.setRequestHeader('Content-Type','application/xml');var x2js=new X2JS();var xmlSer=new XMLSerializer();var json={Data:flight.getJson()};svgRoute=(svgRoute)?xmlSer.serializeToString(svgRoute):"<svg/>";json.Data.svgRoute=AWUtils.btoa(svgRoute);json.Data.wmsParams=encodeURIComponent(wmsParams);var xmlData=x2js.json2xml(json);AWDataHandler.sendRequest(xhr,xmlData);};AWDataHandler.getMagVariation=function(params){return new Promise((resolve,reject)=>{const data={data:params};AWDataHandler.callMethodWithCallback("getMagVariation",data,(res,userData,xhr)=>{const response=AWUtils.processResponse(xhr.responseText,"getMagVariationResult","json");const val=parseFloat(response);if(isNaN(val)){reject(new Error(xhr.statusText));}else{resolve(val);}});});};AWDataHandler.calculateSunRiseSunSet=function(date,latitude,longitude,callbackFnc){var xhr=AWUtils.getXhr();var params="date="+AWUtils.date2yyyymmdd(date)+"&lat="+latitude+"&lng="+longitude;xhr.onreadystatechange=function(){if(xhr.readyState===4&&xhr.status===200){checkCustomHeaders(this);if(callbackFnc!==undefined){const response=AWUtils.processResponse(xhr.responseText,'calculateSunRiseSunSetResult',"json");callbackFnc((response)?response:null);}}};var url=AWDataHandler.getServiceUrl()+"?method=calculateSunRiseSunSet&"+params;xhr.open("POST",url,true);xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');AWDataHandler.sendRequest(xhr);};AWDataHandler.getMeteoLayer=function(aDate,callbackFnc){var params="aDateTime="+aDate.toISOString();var xhr=AWUtils.getXhr();xhr.onreadystatechange=function(){if(xhr.readyState===4&&xhr.status===200){checkCustomHeaders(this);if(callbackFnc!==undefined){var response=AWUtils.processResponse(xhr.responseText,'getMeteoLayerResult',"json");var meteoList=null;if(response){meteoList=new MeteoAdCoordList();meteoList.init(response);}callbackFnc(meteoList);}}};var url=AWDataHandler.getServiceUrl()+"?method=getMeteoLayer&"+params;xhr.open("POST",url,true);xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');AWDataHandler.sendRequest(xhr);};AWDataHandler.setUserPreferences=function(name,value,type,callbackFnc){var xhr=AWUtils.getXhr();xhr.onreadystatechange=function(){if(xhr.readyState===4&&xhr.status===200){checkCustomHeaders(this);if(callbackFnc!==undefined){var response=AWUtils.processResponse(xhr.responseText,'setUserPreferencesResult');var result=false;if(response&&response.length>0){result=(response[0].textContent==="true");}callbackFnc(result);}}};var url=AWDataHandler.getServiceUrl()+"?method=setUserPreferences";xhr.open("POST",url,true);xhr.setRequestHeader('Content-Type','application/xml');var x2js=new X2JS();var json={preferences:{name:name,value:value,type:type,sum:AWUtils.crc32(value.toString())}};AWDataHandler.sendRequest(xhr,x2js.json2xml(json));};AWDataHandler.getUserPreferences=function(callback){return AWDataHandler.callMethodWithCallback("getUserPreferences",null,(res,userData,xhr)=>{const response=AWUtils.processResponse(xhr.responseText,'getUserPreferencesResult',"json");callback((response)?response:null);});};AWDataHandler.getFplsForUserId=function(aCallBackFunction){var xhr=AWUtils.getXhr();var url=AWDataHandler.getServiceUrl()+"?method=getFplsForUserId";xhr.onreadystatechange=function(){if(isUndefinedOrIsNull(aCallBackFunction)){return;}if(xhr.readyState===4&&xhr.status===200){checkCustomHeaders(this);var response=AWUtils.processResponse(xhr.responseText,'getFplsForUserIdResult');var data=(response!==undefined&&response.length>0)?response[0]:null;aCallBackFunction(data);}};xhr.open("POST",url,true);xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');AWDataHandler.sendRequest(xhr);};AWDataHandler.getFlightLogOverviewCount=function(flightLogOverviewFilter,callbackFnc){var xhr=AWUtils.getXhr();var url=AWDataHandler.getServiceUrl()+"?method=getFlightLogOverviewCount";xhr.onreadystatechange=function(){if(isUndefinedOrIsNull(callbackFnc)){return;}if(xhr.readyState===4&&xhr.status===200){checkCustomHeaders(this);var response=AWUtils.processResponse(xhr.responseText,'getFlightLogOverviewCountResult');var data=(response!==undefined&&response.length>0)?parseInt(response[0].textContent):null;callbackFnc(data);}};xhr.open("POST",url,true);xhr.setRequestHeader('Content-Type','application/xml');var json=flightLogOverviewFilter.getJson();var x2js=new X2JS();var xmlData=x2js.json2xml(json);AWDataHandler.sendRequest(xhr,xmlData);};AWDataHandler.getFlightLogOverview=function(flightLogOverviewRq,callbackFnc){var xhr=AWUtils.getXhr();var url=AWDataHandler.getServiceUrl()+"?method=getFlightLogOverview";xhr.onreadystatechange=function(){if(isUndefinedOrIsNull(callbackFnc)){return;}if(xhr.readyState===4&&xhr.status===200){checkCustomHeaders(this);var response=AWUtils.processResponse(xhr.responseText,'getFlightLogOverviewResult');var fList=null;if(response&&response.length>0){var x2js=new X2JS();var retJson=x2js.xml2json(response[0]);fList=new FlightList();fList.init(retJson);}callbackFnc(fList);}};xhr.open("POST",url,true);xhr.setRequestHeader('Content-Type','application/xml');var json=flightLogOverviewRq.getJson();var x2js=new X2JS();var xmlData=x2js.json2xml(json);AWDataHandler.sendRequest(xhr,xmlData);};AWDataHandler.aircraftListForUserNotFull=function(aCallBackFunction){var xhr=AWUtils.getXhr();var url=AWDataHandler.getServiceUrl()+"?method=aircraftListForUserNotFull";xhr.onreadystatechange=function(){if(xhr.readyState===4&&xhr.status===200){checkCustomHeaders(this);if(isUndefinedOrIsNull(aCallBackFunction)===false){var response=AWUtils.processResponse(xhr.responseText,"aircraftListForUserNotFullResult");var val=(response!==undefined&&response.length>0)?(response[0].textContent==="true"):false;aCallBackFunction(val);}}};xhr.open("POST",url,true);xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');AWDataHandler.sendRequest(xhr);};AWDataHandler.flightListForUserNotFull=function(aCallBackFunction){var xhr=AWUtils.getXhr();var url=AWDataHandler.getServiceUrl()+"?method=flightListForUserNotFull";xhr.onreadystatechange=function(){if(xhr.readyState===4&&xhr.status===200){checkCustomHeaders(this);if(isUndefinedOrIsNull(aCallBackFunction)===false){var response=AWUtils.processResponse(xhr.responseText,"flightListForUserNotFullResult");var val=(response!==undefined&&response.length>0)?(response[0].textContent==="true"):false;aCallBackFunction(val);}}};xhr.open("POST",url,true);xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');AWDataHandler.sendRequest(xhr);};AWDataHandler.getMaxSegment=function(aCallBackFunction){var xhr=AWUtils.getXhr();var url=AWDataHandler.getServiceUrl()+"?method=getMaxSegment";xhr.onreadystatechange=function(){if(xhr.readyState===4&&xhr.status===200){checkCustomHeaders(this);if(isUndefinedOrIsNull(aCallBackFunction)===false){var response=AWUtils.processResponse(xhr.responseText,"getMaxSegmentResult");var val=(response!==undefined&&response.length>0)?(parseInt(response[0].textContent)):null;aCallBackFunction(val);}}};xhr.open("POST",url,true);xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');AWDataHandler.sendRequest(xhr);};AWDataHandler.getPibBytesReport=function(pibJson,aCallBackFunction){var xhr=AWUtils.getXhr();var method="getPIBBytes";var url=AWDataHandler.getServiceUrl()+"?method="+method;var x2js=new X2JS();var xmlData=x2js.json2xml(pibJson);xhr.onreadystatechange=function(){if(xhr.readyState===4){var data;if(xhr.status===200){if(!isUndefinedOrIsNull(aCallBackFunction)){data=AWUtils.processResponse(xhr.responseText,"getPIBBytesResult","json");}}aCallBackFunction(data);}};xhr.open("POST",url,true);xhr.setRequestHeader('Content-Type','application/xml');AWDataHandler.sendRequest(xhr,xmlData);};AWDataHandler.getPibTemplate=function(pibMode,aCallBackFunction){var x2js=new X2JS();var jsonParams={"Data":{pibType:pibMode}};var xmlData=x2js.json2xml(jsonParams);var xhr=AWUtils.getXhr();var url=AWDataHandler.getServiceUrl()+"?method=getPibTemplateParametersByType";xhr.onreadystatechange=function(){if(xhr.readyState===4&&xhr.status===200){if(!isUndefinedOrIsNull(aCallBackFunction)){var response=AWUtils.processResponse(xhr.responseText,"getPibTemplateParametersByTypeResult");var data=(response!==undefined&&response.length>0)?response[0]:null;aCallBackFunction(data);}}};xhr.open("POST",url,true);xhr.setRequestHeader('Content-Type','application/xml');AWDataHandler.sendRequest(xhr,xmlData);};AWDataHandler.getRoutePibParameters=function(fplData,buffer,callbackFnc,customData){var adexp=FlightPlanModel.convert2Adexp(fplData);var params="fpl="+adexp+"&buffer="+buffer;var xhr=AWUtils.getXhr();var url=AWDataHandler.getServiceUrl()+"?method=getRoutePibParameters&"+params;xhr.onreadystatechange=function(){if(xhr.readyState===4&&xhr.status===200){const response=AWUtils.processResponse(xhr.responseText,"getRoutePibParametersResult","json");const params=(response)?response:null;AWUtils.applyFunction(this,callbackFnc,[params,customData]);}};xhr.open("POST",url,true);xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');AWDataHandler.sendRequest(xhr);};AWDataHandler.getPibList=function(callbackFnc){const xhr=AWUtils.getXhr();const url=AWDataHandler.getServiceUrl()+"?method=getPibList";xhr.onreadystatechange=function(){if(xhr.readyState===4&&xhr.status===200){const response=AWUtils.processResponse(xhr.responseText,"getPibListResult","json");const params=(response)?response:null;AWUtils.applyFunction(this,callbackFnc,[params]);}};xhr.open("POST",url,true);xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');AWDataHandler.sendRequest(xhr);};AWDataHandler.getPibUpdate=function(pibId,aCallBackFunction){const xhr=AWUtils.getXhr();const param="IdPib="+pibId;const url=AWDataHandler.getServiceUrl()+"?method=getPIBUpdate&"+param;xhr.onreadystatechange=function(){if(xhr.readyState===4){var data;if(xhr.status===200){if(!isUndefinedOrIsNull(aCallBackFunction)){data=AWUtils.processResponse(xhr.responseText,"getPIBUpdateResult","json");}}aCallBackFunction(data);}};xhr.open("POST",url,true);xhr.setRequestHeader('Content-Type','application/xml');AWDataHandler.sendRequest(xhr);};AWDataHandler.createFlightForQuickRoute=function(routePoints,aCallBackFunction){var xhr=AWUtils.getXhr();var url=AWDataHandler.getServiceUrl()+"?method=createFlightForQuickRoute";var x2js=new X2JS();var params={route:routePoints};xhr.onreadystatechange=function(){if(xhr.readyState===4){var callbackParams;if(xhr.status===200){checkCustomHeaders(this);var response=AWUtils.processResponse(xhr.responseText,"QuickFlight");var flight=null;if(response&&response.length>0){var x2js=new X2JS();var retJson=x2js.xml2json(response[0]);if(retJson.Flight!==undefined){flight=new Flight();flight.init(retJson.Flight);}callbackParams=[flight,retJson.ErrorCode,retJson.ErrorDescription];}else{callbackParams=[null,2,""];}}else{callbackParams=[null,2,""];}AWUtils.applyFunction(this,aCallBackFunction,callbackParams);}};xhr.open("POST",url,true);xhr.setRequestHeader('Content-Type','application/xml');AWDataHandler.sendRequest(xhr,x2js.json2xml(params));};AWDataHandler.addUserPoint=function(name,latitude,longitude,latlongStr,remark,callbackFnc){var xhr=AWUtils.getXhr();xhr.onreadystatechange=function(){if(xhr.readyState===4&&xhr.status===200){checkCustomHeaders(this);if(callbackFnc!==undefined){var response=AWUtils.processResponse(xhr.responseText,"addUserPointResult");var result=-1;if(response&&response.length>0){result=response[0].textContent;}callbackFnc(result);}}};var url=AWDataHandler.getServiceUrl()+"?method=addUserPoint";xhr.open("POST",url,true);xhr.setRequestHeader('Content-Type','application/xml');var x2js=new X2JS();var json={point:{txt_name:name,lat:latitude,lng:longitude,lat_lng_str:latlongStr,txt_rmk:remark}};AWDataHandler.sendRequest(xhr,x2js.json2xml(json));};AWDataHandler.updateUserPoint=function(pointId,name,latitude,longitude,latlongStr,remark,callbackFnc){var xhr=AWUtils.getXhr();xhr.onreadystatechange=function(){if(xhr.readyState===4&&xhr.status===200){checkCustomHeaders(this);if(callbackFnc!==undefined){var response=AWUtils.processResponse(xhr.responseText,"updateUserPointResult");var result=false;if(response&&response.length>0){result=(response[0].textContent);}callbackFnc(result);}}};var url=AWDataHandler.getServiceUrl()+"?method=updateUserPoint";xhr.open("POST",url,true);xhr.setRequestHeader('Content-Type','application/xml');var x2js=new X2JS();var json={point:{txt_name:name,lat:latitude,lng:longitude,txt_rmk:remark,lat_lng_str:latlongStr,id:pointId}};AWDataHandler.sendRequest(xhr,x2js.json2xml(json));};AWDataHandler.deleteUserPoints=function(pointIds,callbackFnc){var xhr=AWUtils.getXhr();xhr.onreadystatechange=function(){if(xhr.readyState===4&&xhr.status===200){checkCustomHeaders(this);if(callbackFnc!==undefined){var response=AWUtils.processResponse(xhr.responseText,"deleteUserPointsResult");var result=false;if(response&&response.length>0){result=(response[0].textContent==="true");}callbackFnc(result);}}};var url=AWDataHandler.getServiceUrl()+"?method=deleteUserPoints";xhr.open("POST",url,true);xhr.setRequestHeader('Content-Type','application/xml');var x2js=new X2JS();var json={pointId:{int:pointIds}};AWDataHandler.sendRequest(xhr,x2js.json2xml(json));};AWDataHandler.getUserPointList=function(aCallBackFunction){var xhr=AWUtils.getXhr();var url=AWDataHandler.getServiceUrl()+"?method=getUserPointList";xhr.onreadystatechange=function(){if(xhr.readyState===4&&xhr.status===200){checkCustomHeaders(this);if(!isUndefinedOrIsNull(aCallBackFunction)){var response=AWUtils.processResponse(xhr.responseText,"getUserPointListResult","json");if(response&&response.UserPoints&&response.UserPoints instanceof Object&&response.UserPoints instanceof Array===false){response.UserPoints=[response.UserPoints];}aCallBackFunction(response);}}};xhr.open("POST",url,true);xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');AWDataHandler.sendRequest(xhr);};AWDataHandler.importUserPointsFile=function(fileInputObject,callbackFnc,progressFnc){var file=fileInputObject.files[0];var xhr=AWUtils.getXhr();(xhr.upload||xhr).addEventListener('progress',function(e){var done=e.position||e.loaded;var total=e.totalSize||e.total;AWUtils.applyFunction(this,progressFnc,[Math.round(done/total*100)]);});xhr.addEventListener('load',function(e){var response=AWUtils.processResponse(this.responseText,"importUserPointsFileResult");var result;if(response&&response.length>0){result=response[0].textContent;}else{var faultTag=AWUtils.processResponse(this.responseText,'faultstring');var text=(faultTag.length>0)?faultTag[0].textContent:"Unexpected error!";debug("Import user file error: "+text);result=3;}AWUtils.applyFunction(this,callbackFnc,[result]);});if(!!window.FileReader){var reader=new FileReader();reader.onload=function(){var url=AWDataHandler.getServiceUrl()+"?method=importUserPointsFile";var x2js=new X2JS();var json={file:arrayBufferToBase64(reader.result)};xhr.open('POST',url,true);AWDataHandler.sendRequest(xhr,x2js.json2xml(json));};reader.readAsArrayBuffer(file);}else{AWUtils.applyFunction(this,callbackFnc);}};AWDataHandler.getUserPointListFromCircle=function(lat,long,aCallBackFunction){var xhr=AWUtils.getXhr();var params="&lat="+lat+"&lng="+long;var url=AWDataHandler.getServiceUrl()+"?method=getUserPointListFromCircle"+params;xhr.onreadystatechange=function(){if(xhr.readyState===4&&xhr.status===200){checkCustomHeaders(this);if(!isUndefinedOrIsNull(aCallBackFunction)){const response=AWUtils.processResponse(xhr.responseText,"getUserPointListFromCircleResult","json");const pointList=(response)?response:null;aCallBackFunction(pointList);}}};xhr.open("POST",url,true);xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');AWDataHandler.sendRequest(xhr);};AWDataHandler.getUserPointListByName=function(name,aCallBackFunction){var xhr=AWUtils.getXhr();var params="&likeName="+encodeURIComponent(name);var url=AWDataHandler.getServiceUrl()+"?method=getUserPointListByName"+params;xhr.onreadystatechange=function(){if(xhr.readyState===4&&xhr.status===200){checkCustomHeaders(this);if(!isUndefinedOrIsNull(aCallBackFunction)){const response=AWUtils.processResponse(xhr.responseText,"getUserPointListByNameResult","json");const pointList=(response)?response:null;aCallBackFunction(pointList);}}};xhr.open("POST",url,true);xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');AWDataHandler.sendRequest(xhr);};AWDataHandler.checkFplValidityWithDetailedResult=function(flightLogId,aCallBackFunction){var params="flightLogId="+flightLogId;var xhr=AWUtils.getXhr();var url=AWDataHandler.getServiceUrl()+"?method=checkFplValidityDetailed&"+params;xhr.onreadystatechange=function(){if(xhr.readyState===4&&xhr.status===200){checkCustomHeaders(this);var response=AWUtils.processResponse(xhr.responseText,'ArrayOfCheckFplValidityRet');if(response&&response.length>0){var x2js=new X2JS();var retJson=x2js.xml2json(response[0]);var isError=((retJson.IsError!==undefined)&&retJson.IsError.toString()==="1");var errorMsg=(retJson.ErrorMsg!==undefined)?retJson.ErrorMsg.toString():"";var fplIsOk=((retJson.FplIsOk!==undefined)&&retJson.FplIsOk.toString()==="1");var fplErrors=(retJson.FplErrors!==undefined)?retJson.FplErrors:null;if(fplErrors!==null&&!JQ.isArray(fplErrors)){fplErrors=[fplErrors.toString()];}AWUtils.applyFunction(this,aCallBackFunction,[isError,errorMsg,fplIsOk,fplErrors]);}else{AWUtils.applyFunction(this,aCallBackFunction,[true,xhr.statusText]);}}};xhr.open("POST",url,true);xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');AWDataHandler.sendRequest(xhr);};AWDataHandler.createZone=function(zone,aCallBackFunction){var x2js=new X2JS();var xhr=AWUtils.getXhr();var url=AWDataHandler.getServiceUrl()+"?method=createZone";var xml=x2js.json2xml({CreateZoneRequest:zone});xhr.onreadystatechange=function(){if(xhr.readyState===4&&xhr.status===200){checkCustomHeaders(this);if(!isUndefinedOrIsNull(aCallBackFunction)){const response=AWUtils.processResponse(xhr.responseText,"CreateZoneResponse","json");const zoneResponse=(response)?response:null;aCallBackFunction(zoneResponse);}}};xhr.open("POST",url,true);AWDataHandler.sendRequest(xhr,xml);};AWDataHandler.updateZone=function(zone,aCallBackFunction){var x2js=new X2JS();var xhr=AWUtils.getXhr();var url=AWDataHandler.getServiceUrl()+"?method=updateZone";var xml=x2js.json2xml({CreateZoneRequest:zone});xhr.onreadystatechange=function(){if(xhr.readyState===4&&xhr.status===200){checkCustomHeaders(this);if(!isUndefinedOrIsNull(aCallBackFunction)){const response=AWUtils.processResponse(xhr.responseText,"CreateZoneResponse","json");const zoneResponse=(response)?response:null;aCallBackFunction(zoneResponse);}}};xhr.open("POST",url,true);AWDataHandler.sendRequest(xhr,xml);};AWDataHandler.getZones=function(params,aCallBackFunction){var x2js=new X2JS();var xhr=AWUtils.getXhr();var url=AWDataHandler.getServiceUrl()+"?method=getZones";var rqData={type:params.type};if(params.filter!==undefined){rqData.filter=params.filter;}var xml=x2js.json2xml({ZonesRequest:rqData});xhr.onreadystatechange=function(){if(xhr.readyState===4&&xhr.status===200){checkCustomHeaders(this);if(!isUndefinedOrIsNull(aCallBackFunction)){const response=AWUtils.processResponse(xhr.responseText,"GetZonesResponse","json");const zoneResponse=(response)?response:null;aCallBackFunction(zoneResponse);}}};xhr.open("POST",url,true);AWDataHandler.sendRequest(xhr,xml);};AWDataHandler.getAllZones=function(params,aCallBackFunction){var x2js=new X2JS();var xhr=AWUtils.getXhr();var url=AWDataHandler.getServiceUrl()+"?method=getAllZones";var rqData={type:params.type};if(params.filter!==undefined){rqData.filter=params.filter;}var xml=x2js.json2xml({ZonesRequest:rqData});xhr.onreadystatechange=function(){if(xhr.readyState===4){checkCustomHeaders(this);if(!isUndefinedOrIsNull(aCallBackFunction)){const response=AWUtils.processResponse(xhr.responseText,"GetZonesResponse","json");const zoneResponse=(response)?response:null;aCallBackFunction(zoneResponse);}}};xhr.timeout=180*1000;xhr.open("POST",url,true);AWDataHandler.sendRequest(xhr,xml);};AWDataHandler.convertHtml2Pdf=function(html,documentTitle,aCallBackFunction){if(html!==undefined){html=JQ(html);var jHtml=JQ('<div>').append(html.clone());var htmlTitle=jHtml.find('title');if(htmlTitle.length>0){documentTitle=htmlTitle.text();htmlTitle.remove();}var dataStr=JSON.stringify({html:AWUtils.btoa(jHtml.html()),title:documentTitle});var xhr=AWUtils.getXhr();var url=AWDataHandler.getServiceUrl()+"?method=generatePdf";xhr.onreadystatechange=function(){if(xhr.readyState===4){if(xhr.status===200){checkCustomHeaders(this);if(!isUndefinedOrIsNull(aCallBackFunction)){aCallBackFunction(xhr.responseText);}}else{aCallBackFunction();}}};xhr.open("POST",url,true);AWDataHandler.sendRequest(xhr,dataStr);}else{debug("convertHtml2Pdf: Invalid 'html' paramter. [title='"+documentTitle+"']");}};AWDataHandler.getZoneUserMessages=function(type,status,aCallBackFunction){var x2js=new X2JS();var xhr=AWUtils.getXhr();var url=AWDataHandler.getServiceUrl()+"?method=getZoneUserMessages";var rqData={type:type};if(status!==undefined){rqData.status=status;}var xml=x2js.json2xml({GetUserMessagesRequest:rqData});xhr.onreadystatechange=function(){if(xhr.readyState===4&&xhr.status===200){checkCustomHeaders(this);if(!isUndefinedOrIsNull(aCallBackFunction)){const response=AWUtils.processResponse(xhr.responseText,"GetUserMessagesResponse","json");const zoneResponse=(response)?response:null;aCallBackFunction(zoneResponse);}}};xhr.open("POST",url,true);AWDataHandler.sendRequest(xhr,xml);};AWDataHandler.getServiceUrl=function(){return(config.dataHandlerUrl!==undefined)?config.dataHandlerUrl:"dataHandler.php";};function getActiveUserAreaList(aDateStringISO,aCallBackFunction){var xhr=AWUtils.getXhr();var url=AWDataHandler.getServiceUrl()+"?method=getActiveUserAreaList&aDateTime="+aDateStringISO;xhr.onreadystatechange=function(){if(xhr.readyState===4&&xhr.status===200){checkCustomHeaders(this);if(!isUndefinedOrIsNull(aCallBackFunction)){var response=AWUtils.processResponse(xhr.responseText,'getActiveUserAreaListResult');var userAreaWarningList=null;if(response&&response.length>0){var x2js=new X2JS();userAreaWarningList=x2js.xml2json(response[0]);}aCallBackFunction(userAreaWarningList);}}};xhr.open("POST",url,true);xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');AWDataHandler.sendRequest(xhr);}function getUserAreaList(aCallBackFunction){var xhr=AWUtils.getXhr();var url=AWDataHandler.getServiceUrl()+"?method=getUserAreaList";xhr.onreadystatechange=function(){if(xhr.readyState===4&&xhr.status===200){checkCustomHeaders(this);if(!isUndefinedOrIsNull(aCallBackFunction)){var response=AWUtils.processResponse(xhr.responseText,'getUserAreaListResult');var userAreaWarningList=null;if(response&&response.length>0){var x2js=new X2JS();userAreaWarningList=x2js.xml2json(response[0]);}aCallBackFunction(userAreaWarningList);}}};xhr.open("POST",url,true);xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');AWDataHandler.sendRequest(xhr);};function addUserArea(aUserAreaWarning,callbackFnc){var xhr=AWUtils.getXhr();xhr.onreadystatechange=function(){if(xhr.readyState===4&&xhr.status===200){checkCustomHeaders(this);if(callbackFnc!==undefined){var response=AWUtils.processResponse(xhr.responseText,'addUserAreaResult');var result=-1;if(response&&response.length>0){result=response[0].textContent;}callbackFnc(result);}}};var url=AWDataHandler.getServiceUrl()+"?method=addUserArea";xhr.open("POST",url,true);xhr.setRequestHeader('Content-Type','application/xml');var x2js=new X2JS();var json=convertUserAreaWarningToJson(aUserAreaWarning);AWDataHandler.sendRequest(xhr,x2js.json2xml(json));};function updateUserArea(aUserAreaWarning,callbackFnc){var xhr=AWUtils.getXhr();xhr.onreadystatechange=function(){if(xhr.readyState===4&&xhr.status===200){checkCustomHeaders(this);if(callbackFnc!==undefined){var response=AWUtils.processResponse(xhr.responseText,'updateUserAreaResult');var result=-1;if(response&&response.length>0){result=response[0].textContent;}callbackFnc(result);}}};var url=AWDataHandler.getServiceUrl()+"?method=updateUserArea";xhr.open("POST",url,true);xhr.setRequestHeader('Content-Type','application/xml');var x2js=new X2JS();var json=convertUserAreaWarningToJson(aUserAreaWarning);AWDataHandler.sendRequest(xhr,x2js.json2xml(json));};function convertUserAreaWarningToJson(aUserAreaWarning){if(isUndefinedOrIsNull(aUserAreaWarning)===true){return{};}var retVal={area:{txt_name:aUserAreaWarning.txt_name,txt_rmk:aUserAreaWarning.txt_rmk,geometry:aUserAreaWarning.geometry,dt_from:aUserAreaWarning.datetime_from,id:aUserAreaWarning.id,dt_till:aUserAreaWarning.datetimetill,low_limit:aUserAreaWarning.low_limit,low_limit_unit:aUserAreaWarning.low_limit_unit,upp_limit:aUserAreaWarning.upp_limit,upp_limit_unit:aUserAreaWarning.upp_limit_unit,color:aUserAreaWarning.color,border_color:aUserAreaWarning.border_color,publish:aUserAreaWarning.publish}};return retVal;};function deleteUserAreas(aUawIds,callbackFnc){var xhr=AWUtils.getXhr();xhr.onreadystatechange=function(){if(xhr.readyState===4&&xhr.status===200){checkCustomHeaders(this);if(callbackFnc!==undefined){var response=AWUtils.processResponse(xhr.responseText,'deleteUserAreasResult');var result=false;if(response&&response.length>0){result=(response[0].textContent==="true");}callbackFnc(result);}}};var url=AWDataHandler.getServiceUrl()+"?method=deleteUserAreas";xhr.open("POST",url,true);xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');var x2js=new X2JS();var json={areaId:{int:aUawIds}};AWDataHandler.sendRequest(xhr,x2js.json2xml(json));};AWDataHandler.getZoneDescTempList=function(callback){AWDataHandler.callMethodWithCallback("getZoneDescTempList","",callback);};AWDataHandler.deleteZoneDescTemp=function(template,callback){var params="id="+template.id;AWDataHandler.callMethodWithCallback("deleteZoneDescTemp",params,callback);};AWDataHandler.getRouteForFPL=function(aFpl,callback){const params="flight="+aFpl;return AWDataHandler.callMethodWithCallback("getRoutefForFPL",params,(res,userData,xhr)=>{const response=AWUtils.processResponse(xhr.responseText,'getRoutefForFPLResult',"json");const route=(response)?response:null;callback(route);});};AWDataHandler.getMeteoReportForFpl=function(params,aCallbackFunc){AWDataHandler.callMethodWithCallback("getMeteoReportForFpl",params,aCallbackFunc);};function MapsetDefinition(definitionName){this.name=definitionName;this.itemNames=mapsetDefinitionConfig[definitionName];this.getName=function(){return this.name;};this.getItemNames=function(){return this.itemNames;};}var MapsetItemType={WMS:0,WFS:1,OSM:2,Google:3,WMTS:4,XYZ:5,KML:6,SYSTEM:7};function MapsetItem(itemName,itemObject){this.name=itemName;this.cfg=itemObject;this.source=itemObject["source"];this.url=itemObject["url"];this.version=itemObject["version"];this.visibility=itemObject["visibility"];this.baseLayer=itemObject["baseLayer"];this.format=itemObject["format"];this.singleTile=itemObject["singleTile"];this.layerNames=itemObject["layers"];this.flLower=itemObject["flLower"];this.flUpper=itemObject["flUpper"];this.type=itemObject["type"];this.opacity=itemObject["opacity"];this.googleType=itemObject["googleType"];this.featureType=itemObject["featureType"];this.featureNS=itemObject["featureNS"];this.featurePrefix=itemObject["featurePrefix"];this.maxFeatures=itemObject["maxFeatures"];this.matrixSet=itemObject["matrixSet"];this.requestEncoding=itemObject["requestEncoding"];this.projection=itemObject["projection"];this.physicalLayer=null;this.sublayers=[];this.bgColor=itemObject["bgColor"];this.attribution=itemObject["attribution"];this.oldLoadingMode=itemObject["oldLoadingMode"];if(this.visibility===undefined)this.visibility=false;if(this.type==="OSM"||this.type==="Google")this.baseLayer=true;if(this.baseLayer===undefined){this.baseLayer=false;}if(this.format===undefined){this.format="image/png";}if(this.singleTile===undefined)this.singleTile=true;if(this.opacity===undefined)this.opacity=1;this.getType=function(){switch(this.type){case"WFS":case"wfs":case MapsetItemType.WFS:return MapsetItemType.WFS;break;case"OSM":case"osm":case MapsetItemType.OSM:return MapsetItemType.OSM;break;case"Google":case"google":case MapsetItemType.Google:return MapsetItemType.Google;break;case"WMTS":case"wmts":case MapsetItemType.WMTS:return MapsetItemType.WMTS;break;case"XYZ":case"xyz":case MapsetItemType.XYZ:return MapsetItemType.XYZ;break;case"KML":case"kml":case MapsetItemType.KML:return MapsetItemType.KML;break;case"system":case"SYSTEM":case"sys":case"SYS":case MapsetItemType.SYSTEM:return MapsetItemType.SYSTEM;break;default:return MapsetItemType.WMS;}};if(this.getType()===MapsetItemType.WMTS){this.visibility=true;};if(this.getType()===MapsetItemType.KML&&this.projection===undefined){this.projection="EPSG:4326";};if(this.source!==undefined){var url=getConfigValue3("sources",this.source,"url");var version=getConfigValue3("sources",this.source,"version");if(url!==undefined){this.url=url;}if(version!==undefined){this.version=version;}}if(this.layerNames!==undefined&&this.layerNames.length>0){var type=typeof this.layerNames;if(type==="string"){this.sublayers.push(new MapsetItemSublayer(this,this.layerNames,(this.visibility||this.baseLayer)));}else if(type==="object"){var t=this;JQ.each(this.layerNames,function(index,layerName){var vis=(t.source==null||t.baseLayer)?true:t.visibility;if(layerName.charAt(0)==="!"){layerName=layerName.substring(1);vis=!vis;}t.sublayers.push(new MapsetItemSublayer(t,layerName,vis));});}else{debug("MapsetItem: Unsupported type for layers config value!");}}this.getFlLimit=function(){var lower=this.flLower;var upper=this.flUpper;lower=(lower===undefined)?0:lower;upper=(upper===undefined)?99999:upper;return lower+"-"+upper;};this.getLayerNamesString=function(){var retVal="";var subLayCount=this.sublayers.length;if(subLayCount===0){retVal=this.layerNames;}else{for(var i=0;i<subLayCount;i++){var sublayer=this.sublayers[i];if(sublayer.visibility){if(retVal.length>0){retVal+=",";}retVal+=sublayer.fullname;}}}return retVal;};this.getMapsetItemSublayer=function(name){var retVal=null;for(var i=0;i<this.sublayers.length;i++){var sublayer=this.sublayers[i];if(sublayer.name===name){retVal=sublayer;break;}}return retVal;};}function MapsetItemSublayer(item,name,visibility){this.mapsetItem=item;this.fullname=name;this.name;this.visibility=visibility;var b=name.lastIndexOf(".");var p=name.lastIndexOf("-");b=(b>p)?b:p;if(b>-1&&b<name.length){this.name=name.substring(b+1);}else{this.name=name;}}function Mapset2(){this.mapsetItemArr=new Array();this.layers=new Array();this.mapsetDefinition;var _instance=this;this.init=function(){var definition=this.getMapsetDefinition();var done=true;if(definition!==undefined){if(JQ.isArray(definition)&&definition.length>0){for(var idx=0;idx<definition.length;idx++){var itemName=definition[idx];var itemObject=mapsetItemConfig[itemName];if(itemObject!==undefined){var mapsetItem=new MapsetItem(itemName,itemObject);this.mapsetItemArr[idx]=mapsetItem;}else{alert("Undefined MapsetItem '"+itemName+"' in mapset for '"+AppController.currentLogin.userTypeDesc+"' !");}}}else if(JQ.isPlainObject(definition)&&Object.keys(definition).length>0){for(var rootName in definition){var i=definition[rootName];if(JQ.isArray(i)===false){i=[i];}if(i.length>0){for(var idx=0;idx<i.length;idx++){var itemName=i[idx];var itemObject=mapsetItemConfig[itemName];if(itemObject!==undefined){var foundMi=this.getMapsetItem(itemName);if(foundMi===null||foundMi.cfg!==itemObject){var mapsetItem=new MapsetItem(itemName,itemObject);if(rootName!=="default"){mapsetItem.rootName=rootName;}this.mapsetItemArr.push(mapsetItem);}}else{alert("Undefined MapsetItem '"+itemName+"' in mapset for '"+AppController.currentLogin.userTypeDesc+"' !");}}}}}else{JQMUtil.showInfoMsg("Unsupported Type for Mapset Definition for '"+AppController.currentLogin.userTypeDesc+"' !",true);done=false;}}else{JQMUtil.showInfoMsg("Undefined Mapset for '"+AppController.currentLogin.userTypeDesc+"' !",true);done=false;}if(done){JQ(this).trigger(Mapset2.EVENT.MAPSET_INIT_DONE);}};this.getMapsetDefinition=function(){var retVal;var userGroup=(AppController.currentLogin)?AppController.currentLogin.userTypeDesc:"Guest";var userGroupValue=mapsetGroupConfig[userGroup];var definitionName=[];if(userGroupValue===undefined){userGroupValue=mapsetGroupConfig["default"];}switch(typeof userGroupValue){case"string":definitionName.push(userGroupValue);break;case"object":if(userGroupValue.mapset!==undefined){definitionName.push(userGroupValue.mapset);}FunctionsController.RuleSet.forEach(function(rule){if(rule!==undefined&&userGroupValue[rule.name]!==undefined){var ruleConf=userGroupValue[rule.name];var values=Object.keys(ruleConf);for(var i=0;i<values.length;i++){var val=values[i];switch(rule.type){case FunctionsController.RULE_TYPE.BITMASK:if(parseInt(val)&parseInt(rule.value)){definitionName.push(ruleConf[val]);}break;default:debug("Mapset: Unsupported RuleType '"+rule.type+"' for user group '"+userGroup+"'.");}}}});break;default:break;}if(definitionName.length===1){retVal=mapsetDefinitionConfig[definitionName[0]];}else if(definitionName.length>1){var tmpVal={};definitionName.forEach(function(dName){if(mapsetDefinitionConfig[dName]!==undefined){JQ.extend(tmpVal,mapsetDefinitionConfig[dName]);}});retVal=tmpVal;}return retVal;};this.loadConfig=function(configName,successCallback){JQ.ajax({dataType:"script",url:"js/"+configName,cache:false,success:function(data,status,jqHhr){successCallback(data,status);},error:function(jqXhr,status,error){var msg={text:"Can not load mapset configuration!",details:status+"\n"+error};JQMUtil.showInfoMsg(msg,true);}});};this.loadItemConfig=function(){var cfgName=getConfigValue("mapsetItemConfig","mapsetItemConfig.js");this.loadConfig(cfgName,function(){_instance.loadDefinitionConfig();});};this.loadDefinitionConfig=function(){var cfgName=getConfigValue("mapsetDefinitionConfig","mapsetDefinitionConfig.js");this.loadConfig(cfgName,function(){_instance.loadGroupConfig();});};this.loadGroupConfig=function(){var cfgName=getConfigValue("mapsetGroupConfig","mapsetGroupConfig.js");this.loadConfig(cfgName,function(){_instance.init();});};this.setMap=function(map){this.map=map;};this.prepareLayer=function(mapsetItem,effectiveDate,separateMapsetItemNames){var retVal;if(mapsetItem!==undefined){var source=mapsetItem.source;if(source!==undefined&&mapsetItem.baseLayer===false){retVal=this.getLayerForSource(source);if(retVal!==undefined&&retVal.opacity===mapsetItem.opacity&&separateMapsetItemNames.indexOf(mapsetItem.name)===-1){var subLayers=retVal.params["LAYERS"];var itemSublayers=mapsetItem.sublayers;if(itemSublayers!==undefined&&itemSublayers.length>0){JQ.each(itemSublayers,function(index,itemSublayer){subLayers=AWUtils.toggleString(subLayers,itemSublayer.fullname,",",itemSublayer.visibility);});retVal.mergeNewParams({layers:subLayers});}if(mapsetItem.visibility){retVal.visibility=true;}}else{retVal=undefined;}}if(retVal===undefined){retVal=this.createLayer(mapsetItem,effectiveDate,source);if(mapsetItem.baseLayer===false&&retVal!==null){this.layers.push(retVal);}}mapsetItem.physicalLayer=retVal;_instance.mapsetItem2LayerReference(mapsetItem,retVal);}return retVal;};this.mapsetItem2LayerReference=function(mapsetItem,olLayer){if(olLayer!==null&&mapsetItem!==null){var mItemArr=olLayer.mapsetItems;if(mItemArr===undefined){mItemArr=[];olLayer.mapsetItems=mItemArr;}if(mItemArr.indexOf(mapsetItem)===-1){mItemArr.push(mapsetItem);}}};this.createLayer=function(mapsetItem,effectiveDate,source){var retVal=null;if(mapsetItem!==undefined){const mapResolutions=getConfigValue2("map","resolutions");switch(mapsetItem.getType()){case MapsetItemType.WFS:retVal=new OpenLayers.Layer.Vector(mapsetItem.name,{strategies:[new OpenLayers.Strategy.BBOX()],protocol:new OpenLayers.Protocol.WFS({version:mapsetItem.version,url:mapsetItem.url,featureType:mapsetItem.featureType,featureNS:mapsetItem.featureNS,featurePrefix:mapsetItem.featurePrefix,srsName:this.map.projection,maxFeatures:mapsetItem.maxFeatures}),visibility:mapsetItem.visibility,displayInLayerSwitcher:true});break;case MapsetItemType.KML:retVal=new OpenLayers.Layer.Vector(mapsetItem.name,{strategies:[new OpenLayers.Strategy.Fixed()],projection:mapsetItem.projection,protocol:new OpenLayers.Protocol.HTTP({url:mapsetItem.url,format:new OpenLayers.Format.KML({extractStyles:true,extractAttributes:true,maxDepth:2})}),visibility:mapsetItem.visibility,displayInLayerSwitcher:true});break;case MapsetItemType.OSM:const osmOpts={visibility:mapsetItem.visibility,oldLoadingMode:true};const url=mapsetItem.url||['//a.tile.openstreetmap.org/${z}/${x}/${y}.png','//b.tile.openstreetmap.org/${z}/${x}/${y}.png','//c.tile.openstreetmap.org/${z}/${x}/${y}.png'];if(mapResolutions){osmOpts.resolutions=mapResolutions;osmOpts.serverResolutions=[156543.03390625,78271.516953125,39135.7584765625,19567.87923828125,9783.939619140625,4891.9698095703125,2445.9849047851562,1222.9924523925781,611.4962261962891,305.74811309814453,152.87405654907226,76.43702827453613,38.218514137268066,19.109257068634033,9.554628534317017,4.777314267158508,2.388657133579254,1.194328566789627,0.5971642833948135];}retVal=new OpenLayers.Layer.OSM(mapsetItem.name,url,osmOpts);break;case MapsetItemType.Google:if(google.maps.Map!==undefined){retVal=new OpenLayers.Layer.Google(mapsetItem.name,{type:mapsetItem.googleType,numZoomLevels:this.map.numZoomLevels,visibility:mapsetItem.visibility});}break;case MapsetItemType.WMTS:var itemLayers=mapsetItem.getLayerNamesString();var itemVis=(itemLayers.length>0)?mapsetItem.visibility:false;var matrixIds=new Array(26);for(var i=0;i<26;++i){matrixIds[i]=mapsetItem.matrixSet+":"+i;}retVal=new OpenLayers.Layer.WMTS({name:mapsetItem.name,url:mapsetItem.url,layer:itemLayers,matrixSet:mapsetItem.matrixSet,matrixIds:matrixIds,format:mapsetItem.format,style:"_null",visibility:itemVis,isBaseLayer:mapsetItem.baseLayer});if(mapsetItem.requestEncoding!==undefined){retVal.requestEncoding=mapsetItem.requestEncoding;}break;case MapsetItemType.XYZ:const xyzOpts={isBaseLayer:mapsetItem.baseLayer,visibility:mapsetItem.visibility,transitionEffect:'resize'};if(mapResolutions){xyzOpts.resolutions=mapResolutions;xyzOpts.serverResolutions=[156543.03390625,78271.516953125,39135.7584765625,19567.87923828125,9783.939619140625,4891.9698095703125,2445.9849047851562,1222.9924523925781,611.4962261962891,305.74811309814453,152.87405654907226,76.43702827453613,38.218514137268066,19.109257068634033,9.554628534317017,4.777314267158508,2.388657133579254,1.194328566789627,0.5971642833948135];}retVal=new OpenLayers.Layer.XYZ(mapsetItem.name,mapsetItem.url,xyzOpts);break;case MapsetItemType.SYSTEM:break;default:if(mapsetItem.layerNames!==null&&mapsetItem.layerNames.length>0){const mapResolutions=getConfigValue2("map","resolutions");var effT=(effectiveDate!==undefined)?effectiveDate.toISOString():null;var name=(mapsetItem.baseLayer||source===undefined)?mapsetItem.name:source;var itemLayers=mapsetItem.getLayerNamesString();var itemVis=(itemLayers.length>0)?mapsetItem.visibility:false;var params={layers:itemLayers,version:mapsetItem.version,transparent:!mapsetItem.baseLayer,format:mapsetItem.format,exceptions:"application/vnd.ogc.se_xml",time:effT};var wmsOpts={isBaseLayer:mapsetItem.baseLayer,visibility:itemVis,singleTile:mapsetItem.singleTile,tileSize:new OpenLayers.Size(512,512),buffer:0,displayInLayerSwitcher:true,resolutions:mapResolutions};if(mapsetItem.bgColor){params.bgcolor=mapsetItem.bgColor;}retVal=new OpenLayers.Layer.WMS(name,mapsetItem.url,params,wmsOpts);if(mapsetItem.baseLayer===false){retVal.source=source;}}else{debug("Can not create WMS Layer with name: "+(mapsetItem.baseLayer||source===undefined)?mapsetItem.name:source);}}if(retVal!==null){retVal.isInMapset=true;if(mapsetItem.opacity>=0&&mapsetItem.opacity<1){retVal.setOpacity(mapsetItem.opacity);}if(mapsetItem.attribution){retVal.attribution=mapsetItem.attribution;}if(mapsetItem.oldLoadingMode!==undefined){retVal.oldLoadingMode=mapsetItem.oldLoadingMode;}}}return retVal;};this.showMapsetItem=function(index,effectiveDate,separateMapsetItemNames){var layer=this.prepareLayer(this.mapsetItemArr[index],effectiveDate,separateMapsetItemNames);if(layer!==undefined&&layer!==null&&this.map.getLayerIndex(layer)===-1){var vis=layer.visibility;this.map.addLayer(layer);if(layer.isBaseLayer&&vis){this.map.setBaseLayer(layer);}}};this.addOverlaysToMap=function(effectiveDate,separateMapsetItemNames){for(var i=0;i<this.mapsetItemArr.length;i++){if(this.mapsetItemArr[i]!==undefined&&this.mapsetItemArr[i].baseLayer===false){this.showMapsetItem(i,effectiveDate,separateMapsetItemNames);}}};this.addBaseToMap=function(effectiveDate,separateMapsetItemNames){for(var i=0;i<this.mapsetItemArr.length;i++){if(this.mapsetItemArr[i]!==undefined&&this.mapsetItemArr[i].baseLayer){this.showMapsetItem(i,effectiveDate,separateMapsetItemNames);}}};this.getLayerForSource=function(source){var retVal;if(source!==undefined&&this.layers.length>0){JQ.each(this.layers,function(index,layer){if(layer instanceof OpenLayers.Layer.WMS){if(layer.source===source){retVal=layer;return;}}});}return retVal;};this.getMapsetItem=function(name){var rv=null;JQ.each(this.mapsetItemArr,function(index,mapsetItem){if(mapsetItem!==undefined&&mapsetItem.name===name){rv=mapsetItem;return false;}});return rv;};this.canCreateSystemLayerForName=function(name){var retVal=true;var enable=getConfigValue("enableSystemLayersWithoutMapsetItem",false);if(!enable){retVal=false;JQ.each(this.mapsetItemArr,function(index,mapsetItem){if(mapsetItem!==undefined&&mapsetItem.layerNames===name){retVal=true;return false;}});}return retVal;};this.getPrefs=function(){var retVal=new Object();JQ.each(this.mapsetItemArr,function(index,mapsetItem){if(mapsetItem.sublayers.length>0){var obj=new Object();JQ.each(mapsetItem.sublayers,function(i,sublayer){obj[sublayer.name]=sublayer.visibility;});retVal[mapsetItem.name]={visibility:mapsetItem.visibility,sublayers:obj};}else{retVal[mapsetItem.name]=mapsetItem.visibility;}});return retVal;};this.setPrefs=function(jsonData){var visibleLayers=[];JQ.each(jsonData,function(itemName,data){var mapsetItem=_instance.getMapsetItem(itemName);var miRv=setMapsetItemPrefs(mapsetItem,data);if(miRv&&miRv.layer&&miRv.visibility&&visibleLayers.indexOf(miRv.layer)===-1){visibleLayers.push(miRv.layer);}});if(this.map&&this.map.baseLayer!==null){this.map.baseLayer.visibility=true;this.map.baseLayer.redraw();}JQ.each(visibleLayers,function(idx,layer){layer.setVisibility(true);});for(var i=0;i<this.layers.length;i++){var layer=this.layers[i];if(layer instanceof OpenLayers.Layer.WMS&&layer.visibility){layer.mergeNewParams({'rqTime':new Date().toISOString()});}}};setMapsetItemPrefs=function(mapsetItem,data){var olLayer;if(mapsetItem!==null){var olLayerVis,cfgVis;olLayer=mapsetItem.physicalLayer;if(olLayer){olLayerVis=olLayer.visibility;olLayer.setVisibility(false);}if(typeof data==="string"){cfgVis=(data==="true")?true:false;}else if(typeof data==="boolean"){cfgVis=data;}else if(typeof data==="object"){var wmsLayers;cfgVis=data.visibility;if(olLayer instanceof OpenLayers.Layer.WMS){wmsLayers=olLayer.params["LAYERS"];}if(data.sublayers&&(wmsLayers===undefined||wmsLayers.length>0)){JQ.each(data.sublayers,function(sublayerName,vis){var sublayer=mapsetItem.getMapsetItemSublayer(sublayerName);if(sublayer!==null){sublayer.visibility=vis;if(wmsLayers){wmsLayers=AWUtils.toggleString(wmsLayers,sublayer.fullname,",",vis);if(wmsLayers.length===0){olLayerVis=false;}}}});}else{if(cfgVis&&mapsetItem.sublayers.length>0){wmsLayers=AWUtils.toggleString(wmsLayers,mapsetItem.sublayers[0].fullname,",",mapsetItem.sublayers[0].visibility);}}if(olLayer&&olLayer instanceof OpenLayers.Layer.WMS&&olLayer.params["LAYERS"]!==wmsLayers){if(olLayer.loading){var map=olLayer.map;map.tileManager.clearTileQueue({object:olLayer});}olLayer.mergeNewParams({'LAYERS':wmsLayers});}}else{debug("Mapset: Unknown data format in UserPreferences!");}mapsetItem.visibility=cfgVis;if(cfgVis&&!olLayerVis){olLayerVis=true;}if(olLayer&&olLayer.mapsetItems!==undefined&&olLayer.mapsetItems.length===1){olLayerVis=mapsetItem.visibility;}if(olLayer&&mapsetItem.baseLayer&&olLayerVis){debug("Mapset: Setting BaseLayer to: "+olLayer.name);_instance.map.setBaseLayer(olLayer);}}return{layer:olLayer,visibility:olLayerVis};};this.setMapsetItemVisibility=function(mapsetItem,b){if(mapsetItem&&mapsetItem.visibility!==b){const opts={visibility:b};var miRv;JQ.each(mapsetItem.sublayers,function(index,sublayer){sublayer.visibility=b;});miRv=setMapsetItemPrefs(mapsetItem,opts);JQ(this).trigger(Mapset2.EVENT.MAPSET_ITEM_VISIBILITY_CHANGE,mapsetItem);if(miRv&&miRv.layer&&miRv.visibility){miRv.layer.setVisibility(miRv.visibility);}}};this.processSystemLayers=function(){for(var i=0;i<this.mapsetItemArr.length;i++){var mItem=this.mapsetItemArr[i];if(mItem!==undefined&&mItem.getType()===MapsetItemType.SYSTEM){var mapLayers=this.map.getLayersByName(mItem.layerNames);if(mapLayers.length>0){var phLayer=mapLayers[0];phLayer.isInMapset=true;phLayer.setVisibility(mItem.visibility);if(mItem.opacity>=0&&mItem.opacity<=1){phLayer.setOpacity(mItem.opacity);}mItem.physicalLayer=phLayer;_instance.mapsetItem2LayerReference(mItem,phLayer);}}}JQ(_instance).trigger(Mapset2.EVENT.SYSTEM_LAYER_PROCESSED);};};Mapset2.EVENT={MAPSET_INIT_DONE:"mapsetinitdone",MAPSET_ITEM_VISIBILITY_CHANGE:"mapsetItemVisibilityChange",SYSTEM_LAYER_PROCESSED:"systemLayerProcessed"};function AdFpl(object){this.getAttribute=function(attrName){retVal=null;attr=object.getElementsByTagName(attrName);if(attr.length>0){retVal=attr[0].childNodes[0].nodeValue;}return retVal;};this.id=this.getAttribute("id");this.csign=this.getAttribute("csign");this.adep=this.getAttribute("adep");this.ades=this.getAttribute("ades");this.eobt=this.getAttribute("eobt");this.fl=this.getAttribute("fl");this.speed=this.getAttribute("speed");this.desc=this.getAttribute("description");}function AdFplList(xmlData){this.table=new Array();XMLformat=new OpenLayers.Format.XML();var xmlDocument=XMLformat.read(xmlData);if(xmlDocument.normalize==='function'){xmlDocument.normalize();}else if(xmlDocument.normalizeDocument==='function'){xmlDocument.normalizeDocument();}x=xmlDocument.getElementsByTagName("AdFpl");if(x.length>0){for(i=0;i<x.length;i++){var adFpl=new AdFpl(x[i]);this.table[i]=adFpl;}}this.at=function(index){return this.table[index];};this.size=function(){return this.table.length;};}/* Copyright (c) 2006-2008 MetaCarta, Inc., published under the Clear BSD * license.  See http://svn.openlayers.org/trunk/openlayers/license.txt for the * full text of the license. */OpenLayers.Control.LoadingPanel=OpenLayers.Class(OpenLayers.Control,{counter:0,maximized:false,visible:true,initialize:function(options){OpenLayers.Control.prototype.initialize.apply(this,[options]);},setVisible:function(visible){this.visible=visible;if(visible){OpenLayers.Element.show(this.div);}else{OpenLayers.Element.hide(this.div);}},getVisible:function(){return this.visible;},hide:function(){this.setVisible(false);},show:function(){this.setVisible(true);},toggle:function(){this.setVisible(!this.getVisible());},addLayer:function(evt){if(evt.layer){evt.layer.events.register('loadstart',this,this.increaseCounter);evt.layer.events.register('loadend',this,this.decreaseCounter);}},setMap:function(map){OpenLayers.Control.prototype.setMap.apply(this,arguments);this.map.events.register('preaddlayer',this,this.addLayer);for(var i=0;i<this.map.layers.length;i++){var layer=this.map.layers[i];layer.events.register('loadstart',this,this.increaseCounter);layer.events.register('loadend',this,this.decreaseCounter);}},increaseCounter:function(){this.counter++;if(this.counter>0){if(!this.maximized&&this.visible){this.maximizeControl();}}},decreaseCounter:function(){if(this.counter>0){this.counter--;}if(this.counter==0){if(this.maximized&&this.visible){this.minimizeControl();}}},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);return this.div;},minimizeControl:function(evt){this.div.style.display="none";this.maximized=false;if(evt!=null){OpenLayers.Event.stop(evt);}},maximizeControl:function(evt){this.div.style.display="block";this.maximized=true;if(evt!=null){OpenLayers.Event.stop(evt);}},destroy:function(){if(this.map){this.map.events.unregister('preaddlayer',this,this.addLayer);if(this.map.layers){for(var i=0;i<this.map.layers.length;i++){var layer=this.map.layers[i];layer.events.unregister('loadstart',this,this.increaseCounter);layer.events.unregister('loadend',this,this.decreaseCounter);}}}OpenLayers.Control.prototype.destroy.apply(this,arguments);},CLASS_NAME:"OpenLayers.Control.LoadingPanel"});var AisWeb=function(mainDivId){AisWeb.squareIndicatorID='squareIndicator';var _instance=this;var _mainDivId=mainDivId;var _map;var _wmsFeatureInfoCtrl;var _wmsQuickInfoCtrl;var _vectorLayer;var _flogRouteLayer;var _flogRoutePreviewStrategy;var _flogRoutePreviewLayer;var _fplRouteLayer;var _fplModifyCtrl;var _xtamMarksLayerCtrl;var _meteoMarksLayer;var _notamsLayer;var _notamsMapLayer;var _searchLayer;var _drawingControls;var _graticuleCtrl;var _graticule2Ctrl;var _graticule3Ctrl;var _keyboardCtrl;var _navigationCtrl;var _mapset;var _mapsetProfileCtrl;var _autoRefresh;var _fplRouteGetFtCtrl;var _featureSelectorCtrl;var _controlPanel;var _loadingCtrl;var _lastReliefData;var _hoverFeatureCtrl;var _rangeCirclesCtrl;this.config;this.getMapLonLatCtrl;this.actualFuaMode=AisWeb.FUA_MODES.TODAY;this.actualNotamMode;this.actualPopupWindow;this.mapContext=AisWeb.MAP_CONTEXT.MAP;var WMS_SELECTION_TIMEOUT=2000;this.getMainDivId=function(){return _mainDivId;};this.initialized=false;this.refreshMeteoLayer=function(dateTime){AWDataHandler.getMeteoLayer(dateTime,function(meteoList){const ahpMarkArr=[];if(meteoList!=undefined){const selectedIds=_meteoMarksLayer.selectedFeatures.map(f=>f.attributes.id);for(var i=0;i<meteoList.size();i++){var meteo=meteoList.at(i);var decMetar=meteo.decodedMetar;var lon=AwCoordinates.convertSec2deg(meteo.lng);var lat=AwCoordinates.convertSec2deg(meteo.lat);if(lon!=undefined&&lat!=undefined){var lonLat=new OpenLayers.LonLat(lon,lat).transform("EPSG:4326",_map.getProjectionObject());var point=new OpenLayers.Geometry.Point(lonLat.lon,lonLat.lat);var colorObj=AWUtils.getMetarColor(decMetar);var iconUrl=[];var attrs={id:meteo.ad_code,color:colorObj.color,strokeColor:lightenDarkenColor(colorObj.color,-40),pointRadius:getConfigValue2("meteoLayer","ahpMarkRadius",8)};if(decMetar!==undefined&&decMetar.weather!==null&&decMetar.weather!==undefined){if(JQ.isArray(decMetar.weather)){JQ.each(decMetar.weather,function(index,weather){iconUrl.push(getWeatherIconUrl(weather));});}else{iconUrl.push(getWeatherIconUrl(decMetar.weather));}}if(iconUrl.length>0){attrs.image={url:iconUrl,xOffset:5,width:32,height:32};}var ahpMark=new OpenLayers.Feature.Vector(point,attrs);var metar=meteo.metar;var taf=meteo.taf;var sigmet=meteo.sigmet;var hoverInfo='<div class="rs-popup-content">';var msgViewer='<div class="aftn-message-preview">';hoverInfo+="<h3>"+HtmlUtils.encodeForHTML(meteo.ad_code)+"</h3>";if(colorObj.text!==undefined&&colorObj.text.length>0)hoverInfo+="<b><font color="+HtmlUtils.encodeForHTML(colorObj.color)+" size=+1>"+HtmlUtils.encodeForHTML(colorObj.text)+"</font></b>";if(decMetar!==undefined&&decMetar.qnh!==undefined&&decMetar.qnh!==null)hoverInfo+="<br><b>QNH: "+HtmlUtils.encodeForHTML(decMetar.qnh)+" "+HtmlUtils.encodeForHTML(decMetar.qnhUnit)+"</b>";hoverInfo+="<hr>";if(metar!==undefined&&metar!==null){msgViewer+="<pre>"+metar+"</pre>";msgViewer+=JQ("<div />").append(getDecodedMetarDescription(decMetar)).html();}if(taf!==undefined&&taf!==null)msgViewer+="<pre>"+HtmlUtils.encodeForHTML(taf)+"</pre>";if(sigmet!==undefined&&sigmet!==null)msgViewer+="<pre>"+HtmlUtils.encodeForHTML(sigmet)+"</pre>";msgViewer+="</div>";hoverInfo+=msgViewer;hoverInfo+="</div>";ahpMark.hoverInfo=hoverInfo;ahpMarkArr.push(ahpMark);}}_hoverFeatureCtrl.unselectAll();_meteoMarksLayer.removeAllFeatures();if(ahpMarkArr.length>0){_meteoMarksLayer.addFeatures(ahpMarkArr);if(selectedIds.length>0){const newSelectedFeatures=Array.from(ahpMarkArr).filter(f=>selectedIds.includes(f.attributes.id));newSelectedFeatures.length>0&&_hoverFeatureCtrl.selectAll(newSelectedFeatures);}}}else{_meteoMarksLayer.selectedFeatures.forEach(f=>{_hoverFeatureCtrl.unselect(f);});_meteoMarksLayer.removeAllFeatures();}});};this.refreshFlFilter=function(filter){if(typeof filter==="object"){var itemNames=getConfigValue2("flFilter","mapsetItems",[]);if(!isUndefinedOrIsNull(filter.customMapsetItemNames)){itemNames=itemNames.concat(filter.customMapsetItemNames);}if(itemNames.length>0){var layerArr=[];JQ.each(itemNames,function(index,itemName){var mapsetItem=_mapset.getMapsetItem(itemName);if(mapsetItem!==null&&(mapsetItem.physicalLayer instanceof OpenLayers.Layer.WMS)&&layerArr.indexOf(mapsetItem.physicalLayer)===-1){layerArr.push(mapsetItem.physicalLayer);}});if(filter.active){var lower=AppController.flFilter.lower*0.3048;var upper=AppController.flFilter.upper*0.3048;var vls=lower.toFixed(3)+"-"+upper.toFixed(3);_wmsFeatureInfoCtrl.vendorParams.fls=vls;_wmsQuickInfoCtrl.vendorParams.fls=vls;JQ.each(layerArr,function(index,layer){layer.mergeNewParams({'FLS':vls,'rqTime':new Date().toISOString()});});}else{delete _wmsFeatureInfoCtrl.vendorParams.fls;delete _wmsQuickInfoCtrl.vendorParams.fls;JQ.each(layerArr,function(index,layer){delete layer.params["FLS"];layer.mergeNewParams({'rqTime':new Date().toISOString()});});}}}};this.refreshDay=function(now){var currTime=new Date();var refreshTime=new Date(currTime.getTime());refreshTime.setHours(currTime.getHours()+24);refreshTime.setHours(0,1,0,0);setTimeout(this.refreshDay,refreshTime-currTime,1);if(now!=undefined){_instance.refreshCommon(1);}};this.refreshAfterZoomChange=function(event){let reqFmt;let actualZoom=_map.getZoom();if(actualZoom<=_instance.config.graticule.dmTransitionLevel){reqFmt='d';}else if(actualZoom<=_instance.config.graticule.dmsTransitionLevel){reqFmt='dm';}else{reqFmt='dms';}if(_graticuleCtrl.labelFormat!==reqFmt){_graticuleCtrl.labelFormat=reqFmt;_graticuleCtrl.update();}_instance.refreshAfterMapChange(event);};this.refreshAfterMapChange=function(event){var dttm=AppController.appTime.getTime();if(_xtamMarksLayerCtrl.getSelectedFeatures().length===0){_xtamMarksLayerCtrl.refresh(dttm);}if(_meteoMarksLayer.visibility&&_meteoMarksLayer.selectedFeatures.length===0){_instance.refreshMeteoLayer(dttm);}if(typeof _controlPanel.mapChanged==="function"){_controlPanel.mapChanged();}_instance.updateSquareIndicator();if(AWUtils.device.is_mobile()&&window.ontouchstart!==undefined){var mousePositionCtrl=_map.getControlsByClass(OpenLayers.Control.MousePosition.prototype.CLASS_NAME)[0];var lonLat=_map.getCenter();var newHtml;if(mousePositionCtrl.displayProjection){lonLat.transform(mousePositionCtrl.map.getProjectionObject(),mousePositionCtrl.displayProjection);}newHtml=mousePositionCtrl.formatOutput(lonLat);if(newHtml!==mousePositionCtrl.element.innerHTML){mousePositionCtrl.element.innerHTML=newHtml;}}};this.refreshCommon=function(all){var wmsLayerParams={};var dttm=AppController.appTime.getTime();var rqTimeParam=new Date();wmsLayerParams.time=(AppController.appTime.isWholeDay())?AWUtils.date2yyyymmdd(dttm):dttm.toISOString;wmsLayerParams.rqTime=rqTimeParam.toISOString();if(all!=undefined){if(_mapset!=undefined){for(var i=0;i<_mapset.layers.length;i++){var layer=_mapset.layers[i];if(layer instanceof OpenLayers.Layer.WMS){_mapset.layers[i].mergeNewParams(wmsLayerParams);}}}}_xtamMarksLayerCtrl.refresh(dttm);if(_meteoMarksLayer.visibility){_instance.refreshMeteoLayer(dttm);}if(_notamsMapLayer!==undefined&&_notamsMapLayer.getLayer().visibility&&_notamsMapLayer.getLayer().selectedFeatures.length===0){_notamsMapLayer.refresh(dttm);}JQ(_instance).trigger(AisWeb.EVENT.REFRESH_COMMON,{time:dttm,rqTime:rqTimeParam});var itemNames=getConfigValue2("timeRefresh","mapsetItems");if(itemNames!=undefined&&itemNames.length>0){JQ.each(itemNames,function(index,itemName){var mapsetItem=_mapset.getMapsetItem(itemName);if(mapsetItem!==null&&mapsetItem.physicalLayer!==undefined){mapsetItem.physicalLayer.mergeNewParams(wmsLayerParams);}else{debug("Unknown MapsetItem for automaticRefresh: '"+itemName+"'.");}});}if(typeof _controlPanel.dataRefresh==='function'){_controlPanel.dataRefresh();}};this.autoRefreshAction=function(interval,force){if(_autoRefresh!=undefined){clearTimeout(_autoRefresh);_autoRefresh=undefined;}if(interval>0){_autoRefresh=setTimeout(_instance.autoRefreshAction,interval*60000,interval,true);if(force)_instance.refreshCommon();}};this.showPopup=function(id,coord,rawContent,onClose,userObject){var retVal;if(rawContent!==null){var parentDiv,$popupDiv;const timeStamp=AWUtils.createTimeStampElement();const content=JQ("<div />").append(rawContent);const MAX_MOVE_EVENTS_OUTSIDE_POPUP=30;const mouseKeeperFunc=function(e){if(popup.hovered===false){if(popup.moveOutCnt>MAX_MOVE_EVENTS_OUTSIDE_POPUP){closeFnc(e);}else{popup.moveOutCnt=(popup.moveOutCnt===undefined)?0:++popup.moveOutCnt;}}return false;};const closeFnc=function(e){_map.removePopup(popup);_instance.actualPopupWindow=null;parentDiv.off('mousemove',mouseKeeperFunc);if(typeof onClose==="function"){onClose(e,userObject);}if(e){e.stopPropagation();}};content.find('.rs-popup-content').eq(0).append(timeStamp);AWLocale.processLocalisationOnJQElement(content);const popup=new OpenLayers.Popup.FramedCloud(id,_map.getLonLatFromPixel(coord),new OpenLayers.Size(250,100),content.html(),null,true,function(e){closeFnc(e);});if(_instance.actualPopupWindow){_instance.actualPopupWindow.close();}popup.hovered=false;popup.close=closeFnc;_map.addPopup(popup,true);_instance.actualPopupWindow=popup;$popupDiv=JQ("#"+popup.id);parentDiv=$popupDiv.parent();parentDiv.mousemove(mouseKeeperFunc);$popupDiv.hover(function(){popup.hovered=true;popup.moveOutCnt=0;},function(){popup.hovered=false;});retVal=popup;}return retVal;};this.init=function(){const configDft={notamLayer:{ahpMarkRadius:10,fillColor:"green",fillOpacity:0.35,strokeColor1:"black",strokeColor2:"red"},mousePosition:{format:AwCoordinates.FORMAT.DD_MM_SS_ss,separator:" ",revertLonLat:false},graticule:{leftSideLabels:false,dmTransitionLevel:7,dmsTransitionLevel:11}};_instance.config=AppController.configuration.loadConfigObject(null,configDft);_xtamMarksLayerCtrl=new XtamMarksLayerCtrl();_graticuleCtrl=new OpenLayers.Control.Graticule({autoActivate:false,displayInLayerSwitcher:false,numPoints:4,labelled:true,labelFormat:"dms",leftSideLabels:_instance.config.graticule.leftSideLabels,intervals:[16,8,4,2,1,0.5,0.25,0.166666667]});_graticule2Ctrl=new OpenLayers.Control.Graticule({autoActivate:false,displayInLayerSwitcher:false,numPoints:4,labelled:false,lineSymbolizer:new OpenLayers.Symbolizer.Line({strokeColor:"#bbbbff",strokeWidth:1.5}),intervals:[16,8,4,2,1]});_graticule3Ctrl=new OpenLayers.Control.Graticule({autoActivate:false,displayInLayerSwitcher:false,numPoints:4,labelled:false,lineSymbolizer:new OpenLayers.Symbolizer.Line({strokeColor:"#ffbbbb",strokeWidth:2}),intervals:[10000]});JQ.noConflict();JQ("#"+_mainDivId+" #effectiveDateDiv").hide();_keyboardCtrl=new OpenLayers.Control.KeyboardDefaults();_loadingCtrl=new OpenLayers.Control.LoadingPanel();_rangeCirclesCtrl=new OpenLayers.Control.RangeCircles();_controlPanel=AppController.controlPanel;var mapDiv=mainDivId+'_map';_map=new OpenLayers.Map(mapDiv,{controls:[_keyboardCtrl,new OpenLayers.Control.ScaleLine({geodesic:true,div:JQ(".mapScaleLine").get(0),bottomOutUnits:"NM",bottomInUnits:"NM"}),new OpenLayers.Control.Scale(JQ(".mapScale").get(0),{'geodesic':true,}),_rangeCirclesCtrl,new OpenLayers.Control.MousePosition({div:JQ("#mousePosition").get(0),formatOutput:function(lonLat){const cfg=_instance.config.mousePosition;return AwCoordinates.formatLonLat(lonLat,cfg.format,cfg.separator,cfg.revertLonLat);}}),new OpenLayers.Control.OverviewMap({div:JQ("#"+_mainDivId+" #mapOverview").get(0),mapOptions:{},minRatio:20,maxRatio:25,autoPan:true}),_loadingCtrl],projection:AppController.mapProjection,displayProjection:"EPSG:4326",paddingForPopups:new OpenLayers.Bounds(15,30,15,JQ(".ui-header").height()+5)});const mapSize=_map.getSize();if(!mapSize||mapSize.h<1||mapSize.w<1){return;}var wmsFeatureInfoBuffer=10;if(AWUtils.device.is_mobile()&&window.ontouchstart!==undefined){_navigationCtrl=new OpenLayers.Control.TouchNavigation({autoActivate:false,documentDrag:false,dragPanOptions:{enableKinetic:true}});wmsFeatureInfoBuffer=Math.ceil(AWUtils.getPPI()/7);debug("TouchNavigation initialised!");}else{_navigationCtrl=new OpenLayers.Control.Navigation({autoActivate:false,documentDrag:true,mouseWheelOptions:{interval:600,cumulative:false}});debug("Navigation initialised!");}_map.addControls([_graticuleCtrl,_graticule2Ctrl,_graticule3Ctrl]);_map.addControl(_navigationCtrl);_map.addControl(new OpenLayers.Control.Attribution({div:_controlPanel.getAttributionDiv().get(0)}));_vectorLayer=new OpenLayers.Layer.Vector("vector",{isBaseLayer:false,displayInLayerSwitcher:false,visibility:true,styleMap:new OpenLayers.StyleMap({'default':{strokeColor:"#AA1000",strokeOpacity:1,strokeWidth:3,fillColor:"#FF5500",fillOpacity:0.5,pointRadius:6,pointerEvents:"visiblePainted",label:"${label}",fontColor:"#AA1000",fontSize:"12px",fontFamily:"Courier New, monospace",fontWeight:"bold",labelAlign:"cm",labelXOffset:"${xOffset}",labelYOffset:"15",labelOutlineColor:"white",labelOutlineWidth:3}})});var fplStyle=new OpenLayers.Style({fontFamily:"Sans-serif",strokeColor:getConfigValue2("fplRouteLayer","routeColor","red"),fillColor:"white",strokeWidth:7,pointRadius:2,strokeLinecap:"butt",label:"${label}",labelAlign:"${labelAlign}",labelMargin:"${labelMargin}",labelBackgroundColor:"${labelBackgroundColor}",labelBorderColor:"${labelBorderColor}",labelBorderSize:1.2,labelPadding:"${labelPadding}",labelSelect:"${labelSelect}",fontSize:"12px",angle:"${angle}",fillOpacity:0.5,strokeOpacity:getConfigValue2("fplRouteLayer","routeOpacity",0.5),isSegmentLabel:"${isSegmentLabel}"});var editedVertexStyle=new OpenLayers.Style({pointRadius:14});_fplRouteLayer=new OpenLayers.Layer.Vector("FPL Routes",{isBaseLayer:false,displayInLayerSwitcher:false,visibility:true,renderers:["CustomSVG"],eventListeners:{featureclick:function(e){if(e?.target?.isRouteLabel){_instance.removeRouteFeature(e.feature);return false;}return true;}},styleMap:new OpenLayers.StyleMap({'default':fplStyle,'select':fplStyle,'temporary':fplStyle,'editedVertex':editedVertexStyle})});_flogRouteLayer=new OpenLayers.Layer.Vector("FlightLog Routes",{isBaseLayer:false,displayInLayerSwitcher:false,visibility:true,renderers:["CustomSVG"],styleMap:new OpenLayers.StyleMap({'default':fplStyle,'select':fplStyle,'temporary':fplStyle,'editedVertex':editedVertexStyle})});_flogRoutePreviewStrategy=new OpenLayers.Strategy.AttributeCluster();_flogRoutePreviewStrategy.distance=50;_flogRoutePreviewLayer=new OpenLayers.Layer.Vector("FlightLog Route Preview Layer",{isBaseLayer:false,displayInLayerSwitcher:false,visibility:true,strategies:[_flogRoutePreviewStrategy],styleMap:new OpenLayers.Style({strokeColor:"${borderColor}",strokeWidth:2,label:"${label}",labelAlign:"cb",fontSize:"15px",fontFamily:"Sans-serif",fontWeight:"bold",fillColor:"${color}",fillOpacity:0,pointRadius:6}),lastAttr:true});_notamsLayer=new OpenLayers.Layer.Vector("Notams drawing",{isBaseLayer:false,visibility:true,displayInLayerSwitcher:false,styleMap:new OpenLayers.StyleMap({fillColor:_instance.config.notamLayer.fillColor,fillOpacity:_instance.config.notamLayer.fillOpacity,strokeColor:_instance.config.notamLayer.strokeColor2})});_meteoMarksLayer=new OpenLayers.Layer.Vector("Airport Meteo Marks",{isBaseLayer:false,displayInLayerSwitcher:false,visibility:false,renderers:["FeatureImage"],styleMap:new OpenLayers.StyleMap({pointRadius:getConfigValue2("meteoLayer","ahpMarkRadius",8),fillColor:"${color}",fillOpacity:getConfigValue2("meteoLayer","fillOpacity",0.75),strokeColor:"${strokeColor}"})});_meteoMarksLayer.styleMap.styles.select.defaultStyle=AWUtils.cloneObject(_meteoMarksLayer.styleMap.styles.select.defaultStyle);_meteoMarksLayer.styleMap.styles.select.defaultStyle.fillOpacity=1;_meteoMarksLayer.styleMap.styles.select.defaultStyle.pointRadius+=5;_searchLayer=new OpenLayers.Layer.Vector("searchLayer",{isBaseLayer:false,displayInLayerSwitcher:false,visibility:true,styleMap:new OpenLayers.Style({strokeColor:"blue",strokeWidth:2,label:"${label}",labelYOffset:"15",labelAlign:"cb",fontSize:"15px",fontWeight:"bold",fillColor:"blue",fillOpacity:0.5,pointRadius:6})});checkSecManHeaders=function(request){var secMan=request.getResponseHeader('SecurityManager');if(secMan!==undefined&&typeof secMan==="string"){JQ(_instance).trigger("SecurityManagerError",secMan);}};checkWmsLayerAfterLoad=function(event){if(event.type==="tileloaded"&&event.tile.imgDiv!==null&&event.tile.imgDiv.ResponseHeader!==undefined){var secManHeader=event.tile.imgDiv.ResponseHeader.SecurityManager;if(secManHeader!==undefined&&typeof secManHeader==="string"){JQ(_instance).trigger("SecurityManagerError",secManHeader);}}};showSquareIndicator();debug("WMS Feature Info Buffer: "+wmsFeatureInfoBuffer);_wmsFeatureInfoCtrl=new OpenLayers.Control.WMSGetFeatureInfo({url:getConfigValue3("sources","sdoWms","url","http://localhost/wms"),title:'Identify features by clicking',queryVisible:true,infoFormat:"text/xml",vendorParams:{"geometry":false,"buffer":wmsFeatureInfoBuffer},eventListeners:{getfeatureinfo:function(event){JQ("#wmsFeatureInfoLoading").hide();checkSecManHeaders(event.request);var featuresTable=new FeaturesTable(event.text);AppController.bundleController.getBundle("featureInfo",function(bundle){if(bundle){bundle.showPanel(event.xy,featuresTable);}});},beforegetfeatureinfo:function(evt){JQ("#wmsFeatureInfoLoading").show();},nogetfeatureinfo:function(evt){JQ("#wmsFeatureInfoLoading").show();}}});_wmsQuickInfoCtrl=new OpenLayers.Control.WMSGetFeatureInfo({url:getConfigValue3("sources","sdoWms","url","http://localhost/wms"),title:'Identify features by hover',queryVisible:true,infoFormat:"text/xml",hover:true,popup:null,getInfoForHover:function(evt){this.events.triggerEvent("beforegetfeatureinfo",{xy:evt.xy});if(JQ(".rs-popup-content").length===0){this.request(evt.xy,{hover:true});}},vendorParams:{"geometry":false},eventListeners:{getfeatureinfo:function(event){checkSecManHeaders(event.request);var featuresTable=new FeaturesTable(event.text);_instance.showPopup("wms_quick_info_popup",event.xy,FeatureInfo.getQuickInfo(featuresTable.table));}}});_wmsQuickInfoCtrl.handler.delay=WMS_SELECTION_TIMEOUT;_fplRouteGetFtCtrl=new OpenLayers.Control();OpenLayers.Util.extend(_fplRouteGetFtCtrl,{active:false,draw:function(){this.clickHandler=new OpenLayers.Handler.Click(_fplRouteGetFtCtrl,{"click":this.onClick});},activate:function(){this.active=true;this.clickHandler.activate();_featureSelectorCtrl.deactivate();AppController.bundleController.getBundle("measure",function(bundle){if(bundle){bundle.switchMeasure();}},true);},deactivate:function(){this.active=false;this.clickHandler.deactivate();_featureSelectorCtrl.activate();},onClick:function(evt){this.getFeatures(_map.getLonLatFromPixel(evt.xy));return false;},getFeatures:function(lonLat,feature,vertex){var filter=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.DWITHIN,value:new OpenLayers.Geometry.Point(lonLat.lon,lonLat.lat),distance:5000,distanceUnits:'m',property:"Geometry"});var callback=function(data){var features=(data!==undefined)?data.features:null;JQ(_instance).trigger(AisWeb.EVENT.FPL_ROUTE_OBJECT_RESULT,[features,lonLat,vertex]);OpenLayers.Element.removeClass(_map.viewPortDiv,"olCursorWait");return false;};var featureType=getConfigValue2("newFplRoute","navTypes","Aixm-Dpn");let projection;OpenLayers.Element.addClass(_map.viewPortDiv,"olCursorWait");if(vertex!==undefined&&vertex.geometry!==undefined){var idx=vertex.geometry.index;if(idx==='alt1'||idx==='alt2'){featureType+=" "+getConfigValue2("newFplRoute","altAhpTypes","Aixm-Ahp");}}JQ(_instance).trigger(AisWeb.EVENT.FPL_ROUTE_OBJECT_REQUEST);projection=RsAisOws.getProjectionForTypes(featureType.split(" "));AWUtils.getSdoObject(featureType,AppController.appTime.getTime().toISOString(),projection,filter,callback);}});debug("Hover Feature Selector enabled: "+!('ontouchstart' in window));_hoverFeatureCtrl=new OpenLayers.Control.HoverSelectFeature(_notamsLayer,{hover:!(('ontouchstart' in window)&&AWUtils.device.is_mobile()),dataReceived:function(feature,data){var popup=_instance.actualPopupWindow;if(popup!==null&&typeof popup==="object"){const content=JQ(popup.contentDiv);const notamUl=content.find('.notam-container');const snowtamUl=content.find('.snowtam-container');const ashtamUl=content.find('.ashtam-container');const notamList=data.notams;const snowtamList=data.snowtams;const ashtamList=data.ashtam;content.loading(false);if(notamList!==null){notamUl.empty();for(var i=0;i<notamList.length;i++){var notamObj=notamList[i];var pre=JQ("<pre id="+i+">");if(notamObj.status){pre.addClass("notam-status-"+notamObj.status.toLowerCase());}pre.html(HtmlUtils.removeScriptTag(notamObj.description));pre.find('*').removeAttr('style');pre.appendTo(notamUl);}}if(snowtamList!==null&&snowtamList.length>0){snowtamUl.empty();for(var i=0;i<snowtamList.length;i++){var ashtamObj=snowtamList[i];var pre=JQ("<pre id="+i+">");pre.html(HtmlUtils.removeScriptTag(ashtamObj.description));pre.find('*').removeAttr('style');pre.appendTo(snowtamUl);}}if(ashtamList&&ashtamList.Ashtam){ashtamUl.empty();const ashtamArr=(Array.isArray(ashtamList.Ashtam))?ashtamList.Ashtam:[ashtamList.Ashtam];for(var i=0;i<ashtamArr.length;i++){var ashtamObj=ashtamArr[i];var pre=JQ("<pre id=ashtam_"+i+">");pre.html(HtmlUtils.removeScriptTag(ashtamObj.text));pre.appendTo(ashtamUl);}}if(feature!==undefined&&popup!==null&&typeof popup==="object"){popup.updateSize();popup.panIntoView();}feature.hoverInfo=popup.contentDiv.innerHTML;}},showPopup:function(feature){var content=feature.hoverInfo;var layer=feature.layer;if(JQ.isArray(feature)&&feature.length>0){const msgs=[];const topFeature=feature[feature.length-1];layer=topFeature.layer;for(let i=0;i<feature.length;i++){var f=feature[i];if(f.hoverInfo!==undefined&&f.layer===layer){msgs.push(f.hoverInfo);}}if(msgs.length>0){const msgsElem=JQ('<div class="rs-popup-content-msgs">');msgsElem.append(msgs);content=JQ('<div class="rs-popup-content">');content.append(msgsElem);}feature=topFeature;}else if(Array.isArray(content)){const tmp=JQ('<div class="rs-popup-content">');const msgs=JQ('<div class="rs-popup-content-msgs">');for(let i=0;i<content.length;i++){var f=content[i];msgs.append(JQ(f));}tmp.append(msgs);content=tmp;}if((content===null||content===undefined)&&feature.xtamMarkObj!==undefined){const isStaticTime=(AppController.appTime.getStaticTime()!==null);const xtamMarkObj=feature.xtamMarkObj;const msgs=JQ('<div class="rs-popup-content-msgs">');const type=(xtamMarkObj.type)?xtamMarkObj.type:undefined;const flag=(xtamMarkObj.flag)?xtamMarkObj.flag:"";var contentLabel="";const createContainer=function(name){const retVal=JQ('<div class="aftn-message-preview xtam-container">');const content=JQ('<div class="xtam-default-value">');content.text(name.toUpperCase()+": ");content.append(AWUtils.getNilInfo());retVal.addClass(name+"-container");retVal.append(content);return retVal;};switch(xtamMarkObj.type){case XtamMark.TYPE.FIR:msgs.append(createContainer("ashtam"));msgs.append(createContainer("notam"));break;case XtamMark.TYPE.AD:msgs.append(createContainer("snowtam"));msgs.append(createContainer("notam"));default:break;}if(isStaticTime===false){var msgKey;if(type===XtamMark.TYPE.FIR){msgKey="FeatureInfoPanel.msg.currentlyValidFirMsg";}else{msgKey="FeatureInfoPanel.msg.currentlyValidAdMsg";}contentLabel+="<span class='rs-popup-content-header-message'>"+getLocalizedString(msgKey)+"</span>";}contentLabel+="<span class='rs-popup-content-header-codeId'>"+HtmlUtils.encodeForHTML(xtamMarkObj.code)+"</span>";if(FunctionsController.isFunctionEnabled("notamPopupTxtName",true)){contentLabel+="<div class='rs-popup-content-header-txtName'>"+HtmlUtils.encodeForHTML(xtamMarkObj.name)+"</div>";}content=JQ('<div class="rs-popup-content">');content.append("<h3>"+contentLabel+"</h3>");content.append("<hr>");content.append(msgs);content.append("<hr class='notam-colorLegend'>");content.append(AWUtils.createNotamLegend());content.loading(true);_xtamMarksLayerCtrl.loadDataForMarkFeature(feature,this.dataReceived);}if(typeof content==="object"&&content!==null&&typeof content.html==="function"){AWLocale.processLocalisationOnJQElement(content);if(content.hasClass('rs-popup-content')===false){content=JQ("<div/>").append(content);content.addClass("rs-popup-content");}}if(layer===null){debug("Unexpected error, can not create popup! (layer not defined)");return;}if(content!==undefined){const onCloseFnc=function(e,f){if(f){if(Array.isArray(f)&&f[0].layer){_hoverFeatureCtrl.unselectAll(f);}else if(f.layer){_hoverFeatureCtrl.unselect(f);}}};_instance.showPopup(feature.id+"_popup",this.map.getPixelFromLonLat(this.lastPosition),content,onCloseFnc,feature);}},onBeforeSelect:function(feature){var retVal=false;if(feature instanceof OpenLayers.Feature.Vector){retVal=(feature.layer!==null&&feature.hoverInfo!==undefined||feature.xtamMarkObj!==undefined);}else if(JQ.isArray(feature)&&feature.length>0){var i;for(i=0;i<feature.length;i++){var f=feature[i];if(f.hoverInfo!==undefined||f.xtamMarkObj!==undefined){retVal=true;break;}}}return retVal;},onSelect:function(feature){this.showPopup(feature);},onUnselect:function(feature){const popup=_instance.actualPopupWindow;const layer=feature.layer;if(popup!==undefined&&popup!==null){const $popupDiv=JQ("#"+popup.id);popup.close();}feature.style=null;feature.renderIntent=null;layer.drawFeature(feature);}});_featureSelectorCtrl=new OpenLayers.Control.CustomSelectFeature([_flogRoutePreviewLayer,_vectorLayer,_searchLayer,_fplRouteLayer],{clickout:true,toggle:true,multiple:true,hover:false,box:false,toggleKey:"ctrlKey",multipleKey:"shiftKey"});_featureSelectorCtrl.events.on({'boxselectionend':function(evt){var retVal=true;var selectedFeatures=[];JQ.each(evt.layers,function(index,layer){if(layer.selectedFeatures!==undefined){JQ.merge(selectedFeatures,layer.selectedFeatures);}});if(selectedFeatures.length>0){var featuresCount=selectedFeatures.length;var featuresList=[];var processedFeaturesCounter=0;var ctrl=this;this.addFeatureToList=function(feature){processedFeaturesCounter++;if(feature!==undefined&&feature!==null){featuresList.push(feature);}if(processedFeaturesCounter===featuresCount){AppController.bundleController.getBundle("featureInfo",function(bundle){if(bundle){var featuresTable=new FeaturesTable();JQ.each(featuresList,function(index,aObj){var featureObject=new FeatureObject();featureObject.initFromJson({type:aObj.type,subtype:aObj.subtype,name:aObj.attributes.label,crs:null,source:null,attrs:aObj.data,geometry:{type:"wkt",value:aObj.wkt},olFeature:aObj});featuresTable.table.push(featureObject);});bundle.showPanel(evt.position,featuresTable);}});}};JQ.each(selectedFeatures,function(index,feature){if(feature.type!==undefined){ctrl.addFeatureToList(feature);}else if(feature.attributes.type!==undefined){var prot=new OpenLayers.Protocol.WFS({version:getConfigValue3("sources","sdoWfs","version","1.1.0"),url:getConfigValue3("sources","sdoWfs","url","http://localhost/wfs"),featureNS:"http://www.r-sys.sk/rgis",featurePrefix:"rgis",srsName:_map.projection,maxFeatures:5,featureType:feature.attributes.type,formatOptions:{singleFeatureType:false}});var filter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE,matchCase:false,property:"CODE_ID",value:feature.attributes.codeId});OpenLayers.Element.addClass(ctrl.map.viewPortDiv,"olCursorWait");prot.read({filter:filter,callback:function(result){OpenLayers.Element.removeClass(ctrl.map.viewPortDiv,"olCursorWait");var foundFeatures=result.features;if(foundFeatures!==null&&foundFeatures.length>0){var geom=feature.geometry.clone();var label=feature.attributes.label;var conflict=feature.attributes.conflict;var color=feature.attributes.color;var borderColor=feature.attributes.borderColor;feature.wkt=geom.transform(_map.getProjectionObject(),"EPSG:4326").toString();feature.attributes=foundFeatures[0].attributes;feature.attributes.label=label;feature.attributes.conflict=conflict;feature.attributes.color=color;feature.attributes.borderColor=borderColor;feature.data=foundFeatures[0].data;feature.type=foundFeatures[0].type;ctrl.addFeatureToList(feature);}else{ctrl.addFeatureToList(null);}}});}});retVal=false;}return retVal;}});_fplModifyCtrl=new OpenLayers.Control.ModifyFeature(_flogRouteLayer,{standalone:true,clickout:false,vertexRenderIntent:"editedVertex",virtualStyle:{strokeColor:"gray",pointRadius:14,fillColor:"white",strokeWidth:7,fillOpacity:0.4}});_fplModifyCtrl.handlers.drag.callbacks.up=function(){this.handlers.drag.stopDown=false;if(this._unselect){this.unselectFeature(this._unselect);delete this._unselect;}this.resetVertices();};OpenLayers.Util.extend(_fplModifyCtrl,{scheduledDragging:false,dragStart:function(feature){const pnt=feature.geometry;const wgsPnt=pnt.clone().transform(_map.getProjectionObject(),"EPSG:4326");const params={date:AWUtils.date2yyyymmdd(AppController.appTime.getTime()),lat:wgsPnt.y,lng:wgsPnt.x};OpenLayers.Control.ModifyFeature.prototype.dragStart.apply(this,arguments);this.magDeclination=null;AWDataHandler.getMagVariation(params).then(declination=>{debug("DragStart - declination loaded: "+declination);this.magDeclination=declination;}).catch(err=>console.error("Eror while loading magnetic declination: "+err));if(feature&&this.feature&&feature._index){var route=this.feature;var idx=feature._index;pnt.name="virtual";this.labelFeature=createPointLabelFeature(pnt);this.segmentLabelFeature=createPointLabelFeature(pnt);this.layer.addFeatures([this.labelFeature,this.segmentLabelFeature]);route.labelFeatures.splice(idx,0,this.labelFeature);route.segmentLabels.splice(idx,0,this.segmentLabelFeature);}},resetVertices:function(){if(this.labelFeature!==undefined){this.layer.removeFeatures([this.labelFeature]);}if(this.segmentLabelFeature!==undefined){this.layer.removeFeatures([this.segmentLabelFeature]);}OpenLayers.Control.ModifyFeature.prototype.resetVertices.apply(this,arguments);},collectVertices:function(){this.vertices=[];this.virtualVertices=[];var control=this;function collectComponentVertices(geometry){var i,vertex,component,len;if(geometry.CLASS_NAME==="OpenLayers.Geometry.Point"){vertex=new OpenLayers.Feature.Vector(geometry);vertex._sketch=true;vertex.renderIntent=control.vertexRenderIntent;control.vertices.push(vertex);}else{const numVert=(geometry.components)?geometry.components.length:-1;for(i=0;i<numVert;++i){component=geometry.components[i];if(component.CLASS_NAME==="OpenLayers.Geometry.Point"){vertex=new OpenLayers.Feature.Vector(component);vertex._sketch=true;vertex.renderIntent=control.vertexRenderIntent;control.vertices.push(vertex);}else{collectComponentVertices(component);}}if(numVert>0&&control.createVertices&&geometry.CLASS_NAME!=="OpenLayers.Geometry.MultiPoint"){for(i=0,len=numVert;i<len-1;++i){var prevVertex=geometry.components[i];var nextVertex=geometry.components[i+1];if(prevVertex.CLASS_NAME==="OpenLayers.Geometry.Point"&&nextVertex.CLASS_NAME==="OpenLayers.Geometry.Point"){var x=(prevVertex.x+nextVertex.x)/2;var y=(prevVertex.y+nextVertex.y)/2;var point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(x,y),null,control.virtualStyle);point.geometry.parent=geometry;point._index=i+1;point._sketch=true;control.virtualVertices.push(point);}}}}}collectComponentVertices.call(this,this.feature.geometry);this.layer.addFeatures(this.virtualVertices,{silent:true});this.layer.addFeatures(this.vertices,{silent:true});if(this.feature.assocFeatures!==undefined&&this.feature.assocFeatures.length>0){for(var afi=0;afi<this.feature.assocFeatures.length;afi++){var af=this.feature.assocFeatures[afi];af.geometry.index=af.index;collectComponentVertices.call(this,af.geometry);this.layer.addFeatures(this.vertices,{silent:true});}}},dragVertex:function(vertex,pixel){this.lastDragVertexArgs=arguments;if(!this.scheduledDragging){this.scheduledDragging=true;requestAnimationFrame(()=>{var pos=this.map.getLonLatFromViewPortPx(this.lastDragVertexArgs[1]);const vertexGeometry=this.lastDragVertexArgs[0].geometry;OpenLayers.Control.ModifyFeature.prototype.dragVertex.apply(this,this.lastDragVertexArgs);var vertexIdx=vertexGeometry.index;if(vertexIdx===undefined){vertexIdx=this.feature.geometry.components[0].components.indexOf(vertexGeometry);}if(vertexIdx!==-1&&this.feature.labelFeatures!==undefined){var vertices=this.feature.geometry.getVertices();var segLabel=this.feature.segmentLabels[vertexIdx];if(vertexIdx<vertices.length-1&&segLabel){segLabel.attributes=createRouteSegmentLabelFeature(vertices[vertexIdx],vertices[vertexIdx+1],null,this.magDeclination).attributes;segLabel.move(pos);}if(vertexIdx>0){var prevSegLabel=this.feature.segmentLabels[vertexIdx-1];prevSegLabel.attributes=createRouteSegmentLabelFeature(vertices[vertexIdx-1],vertices[vertexIdx],null,this.magDeclination).attributes;prevSegLabel.move(new OpenLayers.LonLat(prevSegLabel.geometry.x,prevSegLabel.geometry.y));}var vertexLabel=this.feature.labelFeatures[vertexIdx];if(vertexLabel!==undefined){vertexLabel.attributes.label=AwCoordinates.formatLonLat(pos,AwCoordinates.FORMAT.DD_MM_SS_ss," ");vertexLabel.move(pos);}if(vertexIdx<2&&this.feature.segmentLabels.length>0){var azimuth=this.feature.segmentLabels[0].attributes.azimuth;var align;if(azimuth>0&&azimuth<=90)align='rt';else if(azimuth>90&&azimuth<=180)align='rb';else if(azimuth>180&&azimuth<=270)align='lb';elsealign='lt';this.feature.attributes.labelAlign=align;}}this.scheduledDragging=false;});}}});_flogRouteLayer.events.on({featuremodified:function(event){var feature=event.feature;var vertex=_fplModifyCtrl.vertex;var geom=vertex.geometry;if(geom.index===undefined){vertex.virtual=true;geom.index=feature.geometry.components[0].components.indexOf(geom);}else if(feature.flightObject){const route=feature.flightObject.route;let segment=route.getSegment(geom.index);if(segment){segment.hdg=undefined;}if(geom.index>0){segment=route.getSegment(geom.index-1);segment.hdg=undefined;}}_fplModifyCtrl.deactivate();_fplRouteGetFtCtrl.getFeatures(new OpenLayers.LonLat(geom.x,geom.y),feature,vertex);}});this.getMapLonLatCtrl=new OpenLayers.Control.GetMapLonLat();_map.addControl(_wmsQuickInfoCtrl);_map.addControl(_wmsFeatureInfoCtrl);_map.addControl(_featureSelectorCtrl);_map.addControl(_hoverFeatureCtrl);_map.addControl(_fplRouteGetFtCtrl);_map.addControl(_fplModifyCtrl);_map.addControl(this.getMapLonLatCtrl);this.refreshDay();_map.events.register("moveend",null,this.refreshAfterMapChange);_map.events.register("zoomend",null,this.refreshAfterZoomChange);_vectorLayer.events.on({sketchcomplete:function(object){var feature=object.feature;var label=_controlPanel.createFeatureLabel(function(label){var layer=feature.layer;if(label===undefined){layer.removeFeatures(feature);}else{setFeatureLabel(feature,label);if(layer!==undefined){layer.drawFeature(feature);}}});feature.type=AWUtils.featureType.DRAWING;if(!isUndefinedOrIsNull(label)){setFeatureLabel(feature,label);}var epsg4326=new OpenLayers.Projection("EPSG:4326");var geom=feature.geometry.clone();feature.wkt=geom.transform(_map.getProjectionObject(),epsg4326).toString();JQ(_instance).trigger(AisWeb.EVENT.DRAWING_CHANGED);},vertexadded:function(obj){checkDrawingControls(obj.feature);}});getComponentsLength=function(feature){var retVal=0;var geom=feature.geometry;if(geom instanceof OpenLayers.Geometry.LineString){retVal=geom.components.length;}else if(geom instanceof OpenLayers.Geometry.Polygon&&geom.components.length>0){retVal=geom.components[0].components.length;}return retVal;};checkDrawingControls=function(feature){if(feature!==undefined){var c=getActualDrawingController();if(c!==undefined){var cLength=getComponentsLength(feature);var undo=(cLength>2);var redo=false;if(c.handler&&c.handler.redoStack!==null){redo=(c.handler.redoStack!==undefined&&c.handler.redoStack.length>0);}JQ(_instance).trigger(AisWeb.EVENT.DRAWING_CHANGED,{undo:undo,redo:redo,cancel:(cLength>1),create:undo});}}};function setFeatureLabel(feature,label){feature.attributes.label=label;feature.data.CODE_ID=label;}_mapset=AppController.mapset;_mapset.setMap(_map);var separateMapsetItemNames=[];if(config.flFilter!==undefined&&config.flFilter.mapsetItems!==undefined){JQ.each(config.flFilter.mapsetItems,function(index,mapsetItemName){if(separateMapsetItemNames.indexOf(mapsetItemName)===-1){separateMapsetItemNames.push(mapsetItemName);}});}if(config.timeRefresh!==undefined&&config.timeRefresh.mapsetItems!==undefined){JQ.each(config.timeRefresh.mapsetItems,function(index,mapsetItemName){if(separateMapsetItemNames.indexOf(mapsetItemName)===-1){separateMapsetItemNames.push(mapsetItemName);}});}const effAppDateTime=AppController.appTime.getTime();_mapset.addBaseToMap(effAppDateTime,separateMapsetItemNames);_mapset.addOverlaysToMap(effAppDateTime,separateMapsetItemNames);if(typeof MapsetProfile==="function"){var mapsetProfileCfg=(typeof mapsetProfileConfig==='undefined')?null:mapsetProfileConfig;_mapsetProfileCtrl=new MapsetProfile(_mapset,mapsetProfileCfg);}_map.addLayers([_vectorLayer,_notamsLayer,_searchLayer,_flogRouteLayer,_flogRoutePreviewLayer,_fplRouteLayer]);try{if(NotamLayer!==undefined&&AppController.mapset.canCreateSystemLayerForName(NotamLayer.LAYER_NAME)){_notamsMapLayer=new NotamLayer(this);_notamsMapLayer.initMapLayers(_map);}}catch(e){debug("Can not initialize NOTAM Layer: "+e.message);}JQ(".olControlLayerSwitcher").mouseover(function(){_navigationCtrl.deactivate();_wmsFeatureInfoCtrl.deactivate();});JQ(".olControlLayerSwitcher").mouseout(function(){_navigationCtrl.activate();_wmsFeatureInfoCtrl.activate();});if(_map.baseLayer!=undefined){_instance.mapCenter();}_drawingControls={point:new OpenLayers.Control.DrawFeature(_vectorLayer,OpenLayers.Handler.Point),line:new OpenLayers.Control.DrawFeature(_vectorLayer,OpenLayers.Handler.Path,{callbacks:{point:function(vGeom,fGeom){this.layer.events.triggerEvent("vertexadded",{feature:this.handler.getSketch()});}}}),polygon:new OpenLayers.Control.DrawFeature(_vectorLayer,OpenLayers.Handler.Polygon,{callbacks:{point:function(vGeom,fGeom){this.layer.events.triggerEvent("vertexadded",{feature:this.handler.getSketch()});}}}),box:new OpenLayers.Control.DrawFeature(_vectorLayer,OpenLayers.Handler.RegularPolygon,{handlerOptions:{sides:4,irregular:true}}),circle:new OpenLayers.Control.DrawFeature(_vectorLayer,OpenLayers.Handler.RegularPolygon,{handlerOptions:{sides:50}})};for(let key in _drawingControls){_map.addControl(_drawingControls[key]);}if(_controlPanel&&typeof _controlPanel.connectActions==="function"){_controlPanel.connectActions();}JQ.each(_mapset.layers,function(index,layer){layer.events.register("tileloaded",null,checkWmsLayerAfterLoad);});_navigationCtrl.activate();_wmsFeatureInfoCtrl.activate();_wmsQuickInfoCtrl.activate();_featureSelectorCtrl.activate();_hoverFeatureCtrl.activate();JQ(AppController.appTime).on(AwTime.EVENT.STATIC_TIME_CHANGED,function(){if(AppController.appTime.getStaticTime()!==null){var dateStr=AppController.appTime.getStaticTime().toISOString();_wmsFeatureInfoCtrl.vendorParams.time=dateStr;_wmsQuickInfoCtrl.vendorParams.time=dateStr;}else{delete _wmsFeatureInfoCtrl.vendorParams.time;delete _wmsQuickInfoCtrl.vendorParams.time;}AppController.aisWeb.refreshCommon(1);});JQ(document.appCtrl).on(AppController.EVENT.DISTANCE_UNIT_CHANGED,function(e,val){_instance.updateSquareIndicator();_instance.updateScaleLine();});JQ(document.appCtrl).on(AppController.EVENT.FL_FILTER_CHANGED,function(e,val){_instance.refreshFlFilter(val);});_instance.updateScaleLine();_instance.autoRefreshAction(AppController.autoRefresh);_mapset.processSystemLayers();_instance.updateMapContextStyleClass();_instance.setupNotamMode(AppController.userPrefs.getValue("notamMode")||AisWeb.NOTAM_MODES.VALID);this.initialized=true;JQ(_instance).trigger(AisWeb.EVENT.INIT_FINISHED);if(AppController.userPrefs.isValueForName("layerBrowser")){try{let layerPrefs=AppController.userPrefs.getValue("layerBrowser",true);if(layerPrefs.system&&layerPrefs.system.lengt>0){JQ.each(layerPrefs.system,function(index,item){let layers=AppController.aisWeb.getMap().getLayersByName(item.name);if(layers.length>0){layers[0].setVisibility(item.vis);item.visibility=item.vis;}});}if(layerPrefs.mapset){AppController.mapset.setPrefs(layerPrefs.mapset);}}catch(e){debug("Can not restore map layer settings. Saved settings are not correct!");}}JQ(document.appCtrl).on(AppController.EVENT.INIT_FINISHED,_instance.afterAppInitProc);this.refreshCommon();};this.afterAppInitProc=function(){const origLayers=_hoverFeatureCtrl.layers;const newLayers=(origLayers===null)?[_hoverFeatureCtrl.layer]:origLayers;newLayers.push(_xtamMarksLayerCtrl.mapLayer);newLayers.push(_meteoMarksLayer);_hoverFeatureCtrl.setLayer(newLayers);_map.addLayers([_xtamMarksLayerCtrl.mapLayer,_meteoMarksLayer]);};this.logLayers=function(){console.log("Layer List:");JQ.each(_map.layers,function(index,layer){console.log("name: "+layer.name+", visibility: "+layer.visibility+", index: "+_map.getLayerIndex(layer));});};this.enableFeatureInfoController=function(enable){debug("WMS Feature Info cotroller "+((enable)?"enabled":"disabled"));if(enable===true){_wmsFeatureInfoCtrl.activate();_featureSelectorCtrl.deactivate();_featureSelectorCtrl.activate();_hoverFeatureCtrl.deactivate();_hoverFeatureCtrl.activate();}else{_wmsFeatureInfoCtrl.deactivate();}};this.ctrlInfo=function(){console.log("_featureSelectorCtrl: "+_featureSelectorCtrl.active);console.log("_hoverFeatureCtrl: "+_hoverFeatureCtrl.active);console.log("_fplRouteGetFtCtrl: "+_fplRouteGetFtCtrl.active);console.log("_fplModifyCtrl: "+_fplModifyCtrl.active);console.log("_wmsFeatureInfoCtrl: "+_wmsFeatureInfoCtrl.active);console.log("_wmsQuickInfoCtrl: "+_wmsQuickInfoCtrl.active);console.log("_keyboardCtrl: "+_keyboardCtrl.active);};this.enableKeyboardController=function(enable){if(enable===true){_keyboardCtrl.activate();}else{_keyboardCtrl.deactivate();}};this.enableCreateVerticesInFplRoute=function(enable){_fplModifyCtrl.createVertices=enable;};this.getSelectedFplModifyFeature=function(){return _fplModifyCtrl.feature;};this.setSelectedFplModifyFeature=function(feature){if(isUndefinedOrIsNull(feature)){_fplModifyCtrl.feature&&_fplModifyCtrl.unselectFeature(_fplModifyCtrl.feature);}else{_fplModifyCtrl.selectFeature(feature);}};function showSquareIndicator(){JQ("#"+_mainDivId+" #"+AisWeb.squareIndicatorID).html("");};this.mapCenter=function(){const mc=config.mapCenter;if(mc){const zoom=getConfigValue2("mapCenter","zoom",8);const center=AWUtils.getMapCenterConfiguration();_map.setCenter(center,zoom);}};getActualDrawingController=function(){var retVal;for(var key in _drawingControls){var control=_drawingControls[key];if(control.active){retVal=control;break;}}return retVal;};this.switchDrawing=function(param){switch(param){case"undo":var c=getActualDrawingController();if(c){c.undo();checkDrawingControls(c.handler.getSketch());}break;case"redo":var c=getActualDrawingController();if(c){c.redo();checkDrawingControls(c.handler.getSketch());}break;case"cancel":var c=getActualDrawingController();if(c){c.cancel();JQ(_instance).trigger(AisWeb.EVENT.DRAWING_CHANGED);}break;case"create":var c=getActualDrawingController();if(c){c.finishSketch();}break;default:for(var key in _drawingControls){var control=_drawingControls[key];if(param==key){control.activate();}else{control.deactivate();}}};};this.drawingClear=function(){_vectorLayer.removeAllFeatures();};this.addDrawingFeature=function(feature){_vectorLayer.addFeatures(feature);_vectorLayer.events.triggerEvent('sketchcomplete',{feature:feature});};this.showGraticule=function(enabled){if(enabled){_graticuleCtrl.activate();_graticule2Ctrl.activate();_graticule3Ctrl.activate();}else{_graticuleCtrl.deactivate();_graticule2Ctrl.deactivate();_graticule3Ctrl.deactivate();}JQ("body").toggleClass("aw-graticule-on",enabled);};this.isGraticuleVisible=function(){return _graticuleCtrl.active;};this.showFplRoute2=function(fplId,pointList,csign,zoomFlag){try{if(pointList&&pointList.length>0){var points=[];for(var i=0;i<pointList.length;i++){var point=pointList[i];if(point.type==="UNKNOWN"){points[i]=undefined;}else{var lat=point.lat;var lon=point.lng;if(lat&&lon&&lat.length>0&&lon.length>0){var geomPnt=new OpenLayers.Geometry.Point(lon,lat);geomPnt.name=point.name||"???";points[i]=geomPnt;}}}var feature=this.drawRoute(csign,points,null,null,_fplRouteLayer);feature.fplId=fplId;if(zoomFlag){this.zoomToFeature(feature);}}}catch(e){console.log("Error: "+e);}};this.zoomToSdoFeature=function(feature){if(feature!=undefined){_searchLayer.addFeatures([feature]);_instance.zoomToFeature(feature);var geom=feature.geometry.clone();feature.wkt=geom.transform(_map.getProjectionObject(),"EPSG:4326").toString();_featureSelectorCtrl.select(feature);}};this.zoomToFeature=function(feature){if(feature!==undefined&&(feature instanceof OpenLayers.Feature||(JQ.isArray(feature)&&feature.length>0))){var bounds;if(JQ.isArray(feature)){var collection=new OpenLayers.Geometry.Collection();JQ.each(feature,function(i,f){collection.addComponents(f.geometry);});collection.calculateBounds();bounds=collection.bounds;}else{if(feature.geometry instanceof OpenLayers.Geometry.Point){_map.panTo(feature.geometry.getBounds().getCenterLonLat());}else{bounds=feature.geometry.getBounds().clone();}}if(bounds){_map.zoomToExtent(bounds);}}};function createPointLabelFeature(point){var pntLabelOptions={label:(point.name!=undefined)?point.name:"",labelAlign:'ct',strokeColor:getConfigValue2("fplRouteLayer","pointColor","red")};var retVal=new OpenLayers.Feature.Vector(point,pntLabelOptions);retVal.type="Point";return retVal;}function createRouteSegmentLabelFeature(startPoint,endPoint,navigationAzimuth,magDeclinaion){const pntArr=[startPoint,endPoint];const routeSegment=new OpenLayers.Geometry.LineString(pntArr);const decimals=6;const azimuth=AWUtils.getAzimuth(routeSegment,decimals);const distance=routeSegment.getGeodesicLength(_map.projection);const defaultLabelBackgroundColor=getConfigValue2("fplRouteLayer","backgroundColor","white");const opts={label:undefined,angle:undefined,azimuth,navigationAzimuth,distance,speed:undefined,labelAlign:undefined,labelOffset:20,background:true,isSegmentLabel:true,labelBackgroundColor:defaultLabelBackgroundColor,labelBorderColor:getConfigValue2("fplRouteLayer","routeColor","#FF7050")};const retVal=new OpenLayers.Feature.Vector(startPoint,opts);;let distanceStr=AWUtils.calculateDistance(distance,AppController.distanceUnit).toFixed(2);if(navigationAzimuth===null||navigationAzimuth===undefined){const magDecWarnColor=getConfigValue2("fplRouteLayer","magneticDeclinationWarnColor","pink");if(magDeclinaion!==undefined){if(magDeclinaion===null){retVal.attributes.labelBackgroundColor=magDecWarnColor;}retVal.attributes.navigationAzimuth=Math.round(AWUtils.correctAzimuth(azimuth,magDeclinaion));}else{const wgsPoint=startPoint.clone().transform(_map.getProjectionObject(),"EPSG:4326");const params={date:AWUtils.date2yyyymmdd(AppController.appTime.getTime()),lat:wgsPoint.y,lng:wgsPoint.x};retVal.attributes.labelBackgroundColor=magDecWarnColor;AWDataHandler.getMagVariation(params).then(declination=>{retVal.attributes.navigationAzimuth=Math.round(AWUtils.correctAzimuth(azimuth,declination));retVal.attributes.label=AisWeb.createRouteSegmentLabelValue(retVal.attributes);retVal.attributes.labelBackgroundColor=defaultLabelBackgroundColor;if(retVal.layer){retVal.layer.drawFeature(retVal);}}).catch(err=>console.error("Eror while loading magnetic declination: "+err));}}distanceStr=AWUtils.formatDistance(distanceStr,AppController.distanceUnit);if(azimuth<180){retVal.attributes.angle=azimuth-90;retVal.attributes.labelAlign="lc";}else{retVal.attributes.angle=azimuth-270;retVal.attributes.labelAlign="rc";}if(!isNaN(parseInt(startPoint.speed))){retVal.attributes.speed=AWUtils.calculateSpeed(startPoint.speed,startPoint.speedUom);}retVal.attributes.label=AisWeb.createRouteSegmentLabelValue(retVal.attributes);retVal.type="Segment Label";return retVal;}this.drawRoute=function(csign,geomPointsArray,oldFeature,flightObject,mapLayer){let feature;if(oldFeature!=undefined){if(_fplModifyCtrl.feature){_fplModifyCtrl.unselectFeature(_fplModifyCtrl.feature);}_instance.removeRouteFeature(oldFeature,mapLayer);}if(geomPointsArray!=null&&geomPointsArray.length>0){const format=new OpenLayers.Format.WKT();const plotting={enabled:(typeof _controlPanel.isPlottingEnabled==="function"&&_controlPanel.isPlottingEnabled())};var geom="MULTILINESTRING((";var labelFeatureArray=[];var segmentLabelArr=[];var assocFeaturesArr=[];var fplLabelAlign;for(var i=0;i<geomPointsArray.length;i++){var pnt1=geomPointsArray[i];if(pnt1!=undefined){geom+=pnt1.x+" "+pnt1.y;var pnt2=geomPointsArray[i+1];if(i<geomPointsArray.length-1&&pnt2!=undefined){var navAzimuth;try{const oldSegment=flightObject.getRoute().getSegment(i);navAzimuth=oldSegment.hdg;if(navAzimuth&&navAzimuth.length>0)navAzimuth=Math.round(navAzimuth);else{navAzimuth=undefined;}}catch(e){};var segLabelFeature=createRouteSegmentLabelFeature(pnt1,pnt2,navAzimuth);segmentLabelArr.push(segLabelFeature);if(fplLabelAlign==undefined){var azimuth=segLabelFeature.attributes.azimuth;if(azimuth>0&&azimuth<=90)fplLabelAlign='rt';else if(azimuth>90&&azimuth<=180)fplLabelAlign='rb';else if(azimuth>180&&azimuth<=270)fplLabelAlign='lb';elsefplLabelAlign='lt';}geom+=", ";}labelFeatureArray.push(createPointLabelFeature(pnt1));}else{if(geomPointsArray[i-1]!=undefined)geom+="),(";}}geom+="))";geom=geom.replace(',()','');feature=format.read(geom);JQ.each(feature.geometry.getVertices(),function(index,vertex){vertex.index=index;});if(flightObject!=null){if(plotting.enabled){var route=flightObject.getRoute();if(route!=null){var interval=parseInt(route.getTimeSegment());if(interval!=null&&interval!=0){var lastInterval=parseInt(route.getLastTimeSegment());var ts=interval*60;var lts=lastInterval*60;var plotCount=route.getTimeSegmentCount();if(segmentLabelArr.length>0){var segments=[];var scrap=0;var label=0;JQ.each(segmentLabelArr,function(index,segmentLabel){var speedMs=segmentLabel.attributes.speed/3.6;var segmentDistance=segmentLabel.attributes.distance;var marks=[];var gap=speedMs*ts;var i=1,markDistance;if(gap>0){while((markDistance=(gap*i)-(scrap*speedMs))<segmentDistance){label+=interval;marks.push({distance:markDistance,label:label});i++;}}var pnt1=geomPointsArray[index];var pnt2=geomPointsArray[index+1];var seg={point:geomPointsArray[index],angle:AWUtils.getAngle(pnt1.x,pnt1.y,pnt2.x,pnt2.y),marks:marks};var lastGapStart=(gap*(i-1))-(scrap*speedMs);scrap=(segmentDistance-lastGapStart)/speedMs;var routeScrap=scrap;if(index<segmentLabelArr.length){for(var j=index+1;j<segmentLabelArr.length;j++){var nextSegLabel=segmentLabelArr[j];var segSpeedMs=nextSegLabel.attributes.speed/3.6;routeScrap+=nextSegLabel.attributes.distance/segSpeedMs;}}if(plotCount==="l"||routeScrap<ts){var lastMarks=[];i=1;if(lastInterval>0){gap=speedMs*lts;if(gap>100){while(lastGapStart+(gap*i)<segmentDistance){label+=lastInterval;lastMarks.push({distance:lastGapStart+(gap*i)});i++;}}seg.lastMarks=lastMarks;}scrap=0;label=0;}segments.push(seg);});plotting.segments=segments;}}}}}feature.geometry.components[0].plotting=plotting;feature.attributes={label:csign,labelAlign:fplLabelAlign,angle:0,labelOffset:20,background:true,labelSelect:!flightObject,labelBackgroundColor:getConfigValue2("fplRouteLayer","backgroundColor","white"),labelBorderColor:getConfigValue2("fplRouteLayer","routeColor","#FF7050"),strokeColor:getConfigValue2("fplRouteLayer","routeColor","#FF7050")};feature.data={CallSign:csign,Segments:segmentLabelArr.length,Vertices:feature.geometry.components[0].components.length,Length:feature.geometry.getGeodesicLength(_map.projection)};feature.labelFeatures=labelFeatureArray;feature.segmentLabels=segmentLabelArr;feature.assocFeatures=assocFeaturesArr;feature.type=AWUtils.featureType.FPL_ROUTE;var wgsGeom=feature.geometry.clone();feature.wkt=wgsGeom.transform(_map.getProjectionObject(),"EPSG:4326").toString();}if(flightObject){const altAdsFeatures=[];var alt=flightObject.getAlter1();if(alt&&alt.name&&alt.name.length>0&&alt.lat!==undefined&&alt.lng!==undefined&&alt.lat.length>0&&alt.lng.length>0){var altPnt=new OpenLayers.Geometry.Point(alt.getLongitude(),alt.getLatitude());altPnt.name=alt.getName();altPnt=createPointLabelFeature(altPnt);altPnt.index='alt1';altAdsFeatures.push(altPnt);}alt=flightObject.getAlter2();if(alt&&alt.name&&alt.name.length>0&&alt.lat!==undefined&&alt.lng!==undefined&&alt.lat.length>0&&alt.lng.length>0){var altPnt=new OpenLayers.Geometry.Point(alt.getLongitude(),alt.getLatitude());altPnt.name=alt.getName();altPnt=createPointLabelFeature(altPnt);altPnt.index='alt2';altAdsFeatures.push(altPnt);}if(altAdsFeatures.length>0){if(!feature){feature=new OpenLayers.Feature.Vector(new OpenLayers.Geometry());feature.assocFeatures=[];}feature.assocFeatures=feature.assocFeatures.concat(altAdsFeatures);}if(feature){feature.flightObject=flightObject;}}if(feature){_instance.addRouteFeature(feature,mapLayer);if(_fplModifyCtrl.active===true&&mapLayer===_flogRouteLayer){_fplModifyCtrl.selectFeature(feature);}}return feature;};this.drawIbafFlightLogRoute=function(id,name,routePoints){var points=[];var feature;if(routePoints){debug("[IXOweb] drawIbafFlightLogRoute invoked with "+routePoints.length+"points.");JQ.each(routePoints,function(idx,pnt){var coord=AwCoordinates.parseLonLat(pnt.Latitude+" "+pnt.Longitude);if(coord){var p;coord=coord.transform("EPSG:4326",_map.getProjectionObject());p=new OpenLayers.Geometry.Point(coord.lon,coord.lat);if(pnt.PName){p.name=pnt.PName;}points.push(p);}});feature=_instance.drawRoute(name,points,null,null,_fplRouteLayer);if(feature){feature.flightLogId=id;}}else{debug("[IXOweb] drawIbafFlightLogRoute invoked without points. Nothing to draw!");}};this.drawFplRoute=function(csign,geomPointsArray,oldFeature,flightObject){this.drawRoute(csign,geomPointsArray,oldFeature,flightObject,_fplRouteLayer);};this.drawFlightLogRoute=function(csign,geomPointsArray,oldFeature,flightObject){this.drawRoute(csign,geomPointsArray,oldFeature,flightObject,_flogRouteLayer);};this.getMap=function(){return _map;};this.getMapsetProfileController=function(){return _mapsetProfileCtrl;};this.clearNotamsLayer=function(){_notamsLayer.destroyFeatures();};this.addNotamFeature=function(notamFeature){_notamsLayer.addFeatures([notamFeature]);};this.removeNotamFeature=function(notamFeature){_notamsLayer.removeFeatures([notamFeature]);};this.getNotamFeatureById=function(id){return _notamsLayer.getFeatureById(id);};this.addRouteFeature=function(feature,layer=_searchLayer){if(feature){const featuresToAdd=[feature];if(feature.lastLayer){layer=feature.lastLayer;}if(feature.labelFeatures){feature.labelFeatures.forEach((f)=>featuresToAdd.push(f));}if(feature.segmentLabels){feature.segmentLabels.forEach((f)=>featuresToAdd.push(f));}if(feature.assocFeatures&&feature.assocFeatures.length>0){feature.assocFeatures.forEach((f)=>featuresToAdd.push(f));}layer.addFeatures(featuresToAdd);}};this.removeRouteFeature=function(feature,layer){if(feature){layer=layer||feature.layer;if(layer){if(feature.labelFeatures){layer.removeFeatures(feature.labelFeatures);}if(feature.segmentLabels){layer.removeFeatures(feature.segmentLabels);}if(feature.assocFeatures){layer.removeFeatures(feature.assocFeatures);}feature.lastLayer=layer;layer.removeFeatures([feature]);}}};this.toggleFeatureOnMap=function(feature){if(feature){const layer=(feature.layer)?feature.layer:_searchLayer;const foundFeat=layer.getFeatureById(feature.id);if(foundFeat){_instance.removeRouteFeature(feature);}else{_instance.addRouteFeature(feature);}}};this.isFeatureVisible=function(feature){var retVal=false;if(feature!=undefined){var layer=(feature.layer!=null)?feature.layer:_vectorLayer;retVal=layer.getFeatureById(feature.id)!=null;}return retVal;};this.searchSdoObject=function(sdoType,textFilter,worldwide,callbackFnc){var filters=[];var val=textFilter.toLocaleUpperCase();JQ.each(sdoType.attrs,function(index,attr){var f=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE,matchCase:false,property:attr,value:"*"+val+"*"});filters.push(f);});var filter=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR,filters:filters});if(!worldwide){var center=_map.getCenter();var areaFilter=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.DWITHIN,value:new OpenLayers.Geometry.Point(center.lon,center.lat),distance:getConfigValue('searchAreaDistance',500),distanceUnits:'km',property:"Geometry"});filter=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[filter,areaFilter]});}var wfsProt=new OpenLayers.Protocol.WFS({version:getConfigValue3("sources","sdoWfs","version","1.1.0"),url:getConfigValue3("sources","sdoWfs","url","http://localhost/wfs"),featureNS:"http://www.r-sys.sk/rgis",featurePrefix:"rgis",srsName:_map.projection,maxFeatures:500,featureType:sdoType.type,formatOptions:{singleFeatureType:false},featureVersion:AppController.appTime.getTime().toISOString()});return wfsProt.read({filter:filter,callback:callbackFnc});};this.getSdoFeatures=function(sdoTypes,mapExtent,callbackFnc){var filter;if(mapExtent!==null||mapExtent!==undefined){filter=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,value:mapExtent,property:"Geometry"});}AWUtils.getSdoObject(sdoTypes,AppController.appTime.getTime().toISOString(),_map.projection,filter,callbackFnc);};this.getSdoFeaturesIntersects=function(sdoTypes,geometries,callbackFnc){if(sdoTypes.length>0&&JQ.isArray(geometries)&&geometries.length>0){var spatialFilters=[];JQ.each(geometries,function(idx,geom){spatialFilters.push(new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,value:geom,property:"Geometry"}));});var filter=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR,filters:spatialFilters});var wfsProt=new OpenLayers.Protocol.WFS({version:getConfigValue3("sources","sdoWfs","version","1.1.0"),url:getConfigValue3("sources","sdoWfs","url","http://localhost/wfs"),featureNS:"http://www.r-sys.sk/rgis",featurePrefix:"rgis",srsName:_map.projection,maxFeatures:500,featureType:sdoTypes,formatOptions:{singleFeatureType:false},featureVersion:AppController.appTime.getTime().toISOString()});return wfsProt.read({filter:filter,callback:callbackFnc});}};drawFlightInfoBuffer=function(flightRelief,visible){debug("Draw Flight Info Buffer, visibility="+visible);};this.flightPreview=function(flight,aOwner,aShowSegmentErrors,aAddTxt,aErrorPopupText,aErrorAddTxt,closeFunction){if(AWUtils.isUndefinedOrIsNull(flight)===false){AWDataHandler.getReliefForFlight(flight,function(relief){_instance.checkOwnerAndShowFlightPreview(flight,relief,aOwner,aShowSegmentErrors,aAddTxt,aErrorPopupText,aErrorAddTxt,closeFunction);});}else{this.checkOwnerAndShowFlightPreview(null,null,aOwner,aShowSegmentErrors,aAddTxt,aErrorPopupText,aErrorAddTxt,closeFunction);}};this.checkOwnerAndShowFlightPreview=function(flight,relief,aOwner,aShowSegmentErrors,aAdditionalText,aErrorPopupText,aErrorAddTxt,closeFunction){if(AWUtils.isUndefinedOrIsNull(aOwner)===false){if(AWUtils.isUndefinedOrIsNull(flight)===true){if(AisWeb.FlightProfileOwnerID===aOwner){_instance.closeFlightPreview();}}else{_instance.closeFlightPreview();_instance.showFlightPreview(flight,relief,aShowSegmentErrors,aAdditionalText,aErrorPopupText,aErrorAddTxt,closeFunction);AisWeb.FlightProfileOwnerID=aOwner;}}else{_instance.closeFlightPreview();_instance.showFlightPreview(flight,relief,aShowSegmentErrors,aAdditionalText,aErrorPopupText,aErrorAddTxt,closeFunction);}};this.closeFlightPreview=function(){FlightProfile.showFlightProfile(null);_lastReliefData=null;if(_flogRoutePreviewLayer){_flogRoutePreviewLayer.removeAllFeatures();}AisWeb.FlightProfileOwnerID=null;};this.showFlightPreview=function(flight,relief,aShowSegmentErrors,aAdditionalText,aErrorPopupText,aErrorAddTxt,aCloseFunction){FlightProfile.showFlightProfile(flight,aCloseFunction);_lastReliefData=relief;FlightProfile.setFlightProfileData(flight,relief,aShowSegmentErrors,aAdditionalText,aErrorPopupText,aErrorAddTxt);if(relief!=null){var flogPreviewFeatures=[];var format=new OpenLayers.Format.WKT();var areas=relief.getAreas();if(areas!==undefined&&areas.length>0){var conflictAreas=[];JQ.each(areas,function(index,area){if(area.type==="Aixm-Ase-FIR"){return;}var geom=area.getGeometry();if(geom!=undefined){var feature=format.read(geom);feature.geometry.transform("EPSG:4326",_map.getProjectionObject());feature.attributes.label=area.getCode_id();feature.attributes.type=area.getType();feature.attributes.codeId=area.getCode_id();if(area.getConflict()==='1'){feature.attributes.conflict=area.getConflict_desc();feature.attributes.color="red";feature.attributes.borderColor="darkred";conflictAreas.push(feature);}else{feature.attributes.color="green";feature.attributes.borderColor="darkgreen";flogPreviewFeatures.push(feature);}}});}var points=relief.getPoints();if(points!=undefined&&points.length>0){JQ.each(points,function(index,point){var geom=point.getGeometry();if(geom!=undefined){var feature=format.read(geom);feature.geometry.transform("EPSG:4326",_map.getProjectionObject());feature.attributes.label=(point.getTxt_name()=="")?point.getCode_id():point.getTxt_name();feature.attributes.type=point.getType();feature.attributes.codeId=point.getCode_id();flogPreviewFeatures.push(feature);}});}if(conflictAreas!==undefined){JQ.merge(flogPreviewFeatures,conflictAreas);}if(_flogRoutePreviewLayer){_flogRoutePreviewLayer.addFeatures(flogPreviewFeatures);}if(conflictAreas!==undefined){JQ.each(conflictAreas,function(index,area){JQ("#"+area.geometry.id).blink(500,5);});}}};this.showFlightPreviewBuffer=function(visible){drawFlightInfoBuffer(_lastReliefData,visible);};this.getReliefData=function(){return _lastReliefData;};this.getFlightLogRouteLayer=function(){return _flogRouteLayer;};this.getFlightLogRoutePreviewLayer=function(){return _flogRoutePreviewLayer;};this.addLayerToHoverFeatureCtrl=function(newLayer){var origLayers=_hoverFeatureCtrl.layers;var layers=(origLayers===null)?[_hoverFeatureCtrl.layer]:origLayers;layers.push(newLayer);_hoverFeatureCtrl.setLayer(layers);};this.setupMapMode=function(mode,status,data){if(mode!==undefined){var ctrlArr=[],opositeCtrlArr=[],reactivateArr=[];var afterFunc;status=!!(status);switch(mode){case AisWeb.MAP_MODES.CLICK_FEATURE_MODE:ctrlArr.push(_featureSelectorCtrl);if(status){reactivateArr.push(_hoverFeatureCtrl);}break;case AisWeb.MAP_MODES.HOVER_FEATURE_MODE:ctrlArr.push(_hoverFeatureCtrl);break;case AisWeb.MAP_MODES.GET_FPL_ROUTE_FEATURE_MODE:ctrlArr.push(_fplRouteGetFtCtrl);ctrlArr.push(_fplModifyCtrl);if(status){afterFunc=function(){_fplModifyCtrl.moveLayerToTop();if(data!==undefined&&data instanceof OpenLayers.Feature){_fplModifyCtrl.selectFeature(data);}};}else{afterFunc=function(){_fplModifyCtrl.moveLayerBack();};}break;case AisWeb.MAP_MODES.FPL_FEATURE_MODIFY_MODE:ctrlArr.push(_fplModifyCtrl);break;case AisWeb.MAP_MODES.WMS_FEATURE_INFO_MODE:ctrlArr.push(_wmsFeatureInfoCtrl);if(status){reactivateArr.push(_featureSelectorCtrl);reactivateArr.push(_hoverFeatureCtrl);}break;case AisWeb.MAP_MODES.WMS_FEATURE_QUICK_INFO_MODE:ctrlArr.push(_wmsQuickInfoCtrl);break;case AisWeb.MAP_MODES.MEASURING_MODE:break;case AisWeb.MAP_MODES.DRAWING_MODE:break;case AisWeb.MAP_MODES.RANGE_CIRCLES_MODE:ctrlArr.push(_rangeCirclesCtrl);opositeCtrlArr.push(_hoverFeatureCtrl);if(status||_wmsQuickInfoCtrl.active){opositeCtrlArr.push(_wmsQuickInfoCtrl.handler);}if(AWUtils.device.is_mobile()){opositeCtrlArr.push(_wmsFeatureInfoCtrl.handler);}break;default:}if(ctrlArr.length>0){for(var i=0;i<ctrlArr.length;i++){(status)?ctrlArr[i].activate():ctrlArr[i].deactivate();}}if(opositeCtrlArr.length>0){for(var i=0;i<opositeCtrlArr.length;i++){(status)?opositeCtrlArr[i].deactivate():opositeCtrlArr[i].activate();}}if(reactivateArr.length>0){for(var i=0;i<reactivateArr.length;i++){var ctrl=reactivateArr[i];ctrl.deactivate();ctrl.activate();}}if(afterFunc!==undefined){afterFunc();}}};this.addLayerToFeatureSelectorCtrl=function(newLayer){var origLayers=_featureSelectorCtrl.layers;var layers=(origLayers===null)?[_featureSelectorCtrl.layer]:origLayers;layers.push(newLayer);_featureSelectorCtrl.setLayer(layers);};this.getFeatureSelector=function(){return _featureSelectorCtrl;};this.getHoverFeatureController=function(){return _hoverFeatureCtrl;};this.createGpsLocationName=function(latLong,callback,defaultName){if(latLong instanceof OpenLayers.LonLat){latLong.lon=latLong.lon.toFixed(6);latLong.lat=latLong.lat.toFixed(6);_controlPanel.createGpsLocationName(latLong,callback,defaultName);}};this.setupNotamView=function(enabled,mode){if(enabled){_instance.setupNotamMode(mode);}JQ(_instance).trigger(AisWeb.EVENT.SETUP_NOTAM_MODE,{enabled:enabled,mode:mode});};this.setupNotamMode=function(mode){var classPrefix="rs-notam-mode-";var page=JQ('body').pagecontainer("getActivePage");page.removeClass(classPrefix+AisWeb.NOTAM_MODES.EFFECTIVE);page.removeClass(classPrefix+AisWeb.NOTAM_MODES.VALID);if(mode){_instance.actualNotamMode=mode;}page.addClass(classPrefix+_instance.actualNotamMode);};this.setupMeteoView=function(enabled,mode){if(enabled){mode=mode||AisWeb.METEO_MODES.METAR;if(mode===AisWeb.METEO_MODES.METAR){var dttm=AppController.appTime.getTime();_meteoMarksLayer.setVisibility(true);_instance.refreshMeteoLayer(dttm);}}else{_meteoMarksLayer.setVisibility(false);}JQ(_instance).trigger(AisWeb.EVENT.SETUP_METEO_MODE,{enabled:enabled,mode:mode});};switchMapContextLayers=function(){if(getConfigValue3("mapContext",_instance.mapContext,"hideMapsetItemAfterChange",true)){switchMapContextLayer(_instance.prevMapContext,false);}switchMapContextLayer(_instance.mapContext,true);};switchMapContextLayer=function(context,visible){const mapsetItems=getConfigValue3("mapContext",context,"mapsetItems",[]);_instance.setMapsetItemOrSystemLayerVisibility(mapsetItems,visible);switchMapContextModeLayer(context,_instance.getActualModeForMapContext(context),visible);};switchMapContextModeLayer=function(context,mode,visible){const modeCfg=getConfigValue3("mapContext",context,"mode");if(modeCfg){const actMode=_instance.getActualModeForMapContext(context);if(actMode&&modeCfg[actMode]){_instance.setMapsetItemOrSystemLayerVisibility(modeCfg[actMode].mapsetItems,visible);}}};this.setupFuaMode=function(mode){if(_instance.mapContext===AisWeb.MAP_CONTEXT.FUA&&mode!==_instance.actualFuaMode){if(getConfigValue3("mapContext",_instance.mapContext,"hideMapsetItemAfterChange",true)){switchMapContextModeLayer(AisWeb.MAP_CONTEXT.FUA,_instance.actualFuaMode,false);}_instance.actualFuaMode=mode;processFuaMode();switchMapContextModeLayer(AisWeb.MAP_CONTEXT.FUA,_instance.actualFuaMode,true);}};processFuaMode=function(){if(_instance.actualFuaMode===AisWeb.FUA_MODES.TOMORROW){var tomorrow=new Date();var params={wholeDay:true,dataType:AwTime.DATA_TYPE.FUA};tomorrow.setDate(tomorrow.getDate()+1);tomorrow.setSeconds(0,0);AppController.appTime.setStaticTime(tomorrow,params);}else{AppController.appTime.setStaticTime(null,{dataType:AwTime.DATA_TYPE.FUA});}};this.setupFuaView=function(enabled){if(enabled){processFuaMode();}else if(_instance.prevMapContext===AisWeb.MAP_CONTEXT.FUA){AppController.appTime.setStaticTime(null,{dataType:AwTime.DATA_TYPE.FUA});}};this.getActualModeForMapContext=function(mapContext){switch(mapContext){case AisWeb.MAP_CONTEXT.FUA:return _instance.actualFuaMode;break;case AisWeb.MAP_CONTEXT.NOTAM:return _instance.actualNotamMode;break;default:}};this.setupRangeCircles=function(enabled,speed,time,timeArc){if(enabled){var ranges=[];for(var i=timeArc;i<=time;i+=timeArc){var range={value:speed*(i/60),label:i};ranges.push(range);}_instance.setupMapMode(AisWeb.MAP_MODES.RANGE_CIRCLES_MODE,true);_rangeCirclesCtrl.setupRanges(ranges);}else{_instance.setupMapMode(AisWeb.MAP_MODES.RANGE_CIRCLES_MODE,false);}};this.showAdexpFplRoute=function(callsign,adexpData,aDescription,aCallback){_controlPanel.showFplRouteLoadingInfo(aDescription);AWDataHandler.analyzeFplRoute(adexpData,function(data){if(data===undefined){JQMUtil.showInfoMsg("Communication error!",true,false);}else{var errorMsg=data._Error;_controlPanel.closeFplRouteLoadingInfo(aDescription);if(errorMsg!==undefined){setTimeout(function(){var msgTxt="FPL Route Analyze for '"+aDescription+"' error:\n"+errorMsg;JQMUtil.showInfoMsg(msgTxt,true,true);},10);}AppController.aisWeb.showFplRoute2(callsign,data.FplPoint,aDescription,true);if(data.Messages&&data.Messages.Message){const msgArr=(Array.isArray(data.Messages.Message))?data.Messages.Message:[data.Messages.Message];const text=msgArr.join("\n");JQMUtil.showInfoMsg(text,true);}if(aCallback!==undefined){AWUtils.applyFunction(this,aCallback);}}});};this.clearFplRoutes=function(){if(_fplRouteLayer){_fplRouteLayer.removeAllFeatures();}};this.hideFplRoute=function(fplId){if(_fplRouteLayer&&fplId!==undefined){let feature=_fplRouteLayer.getFeatureBy('fplId',fplId);_instance.removeRouteFeature(feature);}};this.hideIbafFlightLogRoute=function(id){if(_fplRouteLayer&&id!==undefined){let feature=_fplRouteLayer.getFeatureBy('flightLogId',id);_instance.removeRouteFeature(feature);}};this.getVisibleFplRoutes=function(){var retVal=[];if(_fplRouteLayer){JQ.each(_fplRouteLayer.features,function(index,feature){if(feature.fplId!==undefined){retVal.push(feature.fplId);}});}return retVal;};this.isVisibleFplRoute=function(fplId){var visRoutes=_instance.getVisibleFplRoutes();return(visRoutes.indexOf(fplId)!==-1);};this.getFplRouteLayer=function(){return _fplRouteLayer;};this.getMapLonLatOnClick=function(callback){if(typeof callback==="function"){this.getMapLonLatCtrl.activate();_instance.enableFeatureInfoController(false);this.getMapLonLatCtrl.getOneClick(function(lonLat){_instance.getMapLonLatCtrl.deactivate();_instance.enableFeatureInfoController(true);callback(lonLat);});}};this.updateSquareIndicator=function(){var squareIndicatorDiv=JQ('#'+AisWeb.squareIndicatorID);var unitStr=AppController.distanceUnit;var mapExtent=_map.getExtent();if(mapExtent!==null){var boundsArray=mapExtent.transform(_map.getProjectionObject(),"EPSG:4326").toArray();var leftBottom=new OpenLayers.LonLat(boundsArray[0],boundsArray[1]);var leftTop=new OpenLayers.LonLat(boundsArray[0],boundsArray[3]);var rightBottom=new OpenLayers.LonLat(boundsArray[2],boundsArray[1]);var rightTop=new OpenLayers.LonLat(boundsArray[2],boundsArray[3]);var verticalCenterLat=rightBottom.lat+((rightTop.lat-rightBottom.lat)/2);var leftCenter=new OpenLayers.LonLat(boundsArray[0],verticalCenterLat);var rightCenter=new OpenLayers.LonLat(boundsArray[2],verticalCenterLat);var horizontalCenterLon=leftBottom.lon+((rightBottom.lon-leftBottom.lon)/2);var topCenter=new OpenLayers.LonLat(horizontalCenterLon,boundsArray[3]);var bottomCenter=new OpenLayers.LonLat(horizontalCenterLon,boundsArray[1]);var widthKm=OpenLayers.Util.distVincenty(leftCenter,rightCenter);var heightKm=OpenLayers.Util.distVincenty(bottomCenter,topCenter);var calculatedWidth=AWUtils.calculateDistance((widthKm*1000),unitStr);var calculatedHeight=AWUtils.calculateDistance((heightKm*1000),unitStr);if(unitStr===AppController.DISTANCE_UNIT.KM){unitStr='km';}if(calculatedHeight<=10){squareIndicatorDiv.text((Math.round(calculatedWidth*100)/100)+" x "+(Math.round(calculatedHeight*100)/100)+" "+unitStr);}else{squareIndicatorDiv.text((Math.round(calculatedWidth*1)/1)+" x "+(Math.round(calculatedHeight*1)/1)+" "+unitStr);}}this.updateScaleLine=function(){if(AppController.distanceUnit===AppController.DISTANCE_UNIT.KM){JQ('.olControlScaleLineTop').show();JQ('.olControlScaleLineBottom').hide();}else{JQ('.olControlScaleLineTop').hide();JQ('.olControlScaleLineBottom').show();}};};this.appendDynamicMapContext=function(contextName,title,tooltip){JQ(_instance).trigger(AisWeb.EVENT.APPEND_DYANIC_MAP_CONTEXT,[contextName,title,tooltip]);};this.setMapContext=function(mapContext){if(mapContext!==_instance.mapContext){_instance.prevMapContext=_instance.mapContext;_instance.mapContext=mapContext;switchMapContextLayers();switch(mapContext){case AisWeb.MAP_CONTEXT.MAP:_instance.setupNotamView(false);_instance.setupMeteoView(false);_instance.setupFuaView(false);break;case AisWeb.MAP_CONTEXT.NOTAM:_instance.setupNotamView(true);_instance.setupMeteoView(false);_instance.setupFuaView(false);break;case AisWeb.MAP_CONTEXT.METEO:_instance.setupMeteoView(true,JQ(".meteo-mode-toolbar select").val());_instance.setupNotamView(false);_instance.setupFuaView(false);break;case AisWeb.MAP_CONTEXT.FUA:_instance.setupMeteoView(false);_instance.setupNotamView(false);_instance.setupFuaView(true);break;default:_instance.setupNotamView(false);_instance.setupMeteoView(false);_instance.setupFuaView(false);break;}_instance.updateMapContextStyleClass();JQ(_instance).trigger(AisWeb.EVENT.SETUP_MAP_CONTEXT,[mapContext,_instance.prevMapContext]);AppController.userPrefs.setValue("mapDataView",mapContext);}};this.updateMapContextStyleClass=function(){var classPrefix="rs-map-context-";var page=JQ('body').pagecontainer("getActivePage");page.removeClass(function(idx,name){var retVal;var res=new RegExp(classPrefix+"[^ ]*").exec(name);if(res){retVal=res.join(" ");}return retVal;});page.addClass(classPrefix+_instance.mapContext);};this.setMapsetItemOrSystemLayerVisibility=function(items,visible){if(items&&JQ.isArray(items)&&items.length>0){JQ.each(items,function(idx,itemName){var mItem=AppController.mapset.getMapsetItem(itemName);if(mItem){AppController.mapset.setMapsetItemVisibility(mItem,visible);}else{var layers=AppController.aisWeb.getMap().getLayersByName(itemName);if(layers&&layers.length>0){layers[0].setVisibility(visible);}}});}};};AisWeb.createRouteSegmentLabelValue=function(opts){let retVal;const distanceStr=AWUtils.calculateDistance(opts.distance,AppController.distanceUnit).toFixed(2);const azimuth=(opts.navigationAzimuth)?opts.navigationAzimuth:Math.round(AWUtils.correctAzimuth(opts.azimuth,0));retVal=azimuth.toString().padStart(3,"0");retVal+=String.fromCharCode(176);retVal+=" "+AWUtils.formatDistance(distanceStr,AppController.distanceUnit);if(!isNaN(opts.speed)&&opts.speed>0){const time=(opts.distance/1000)/opts.speed;retVal+=" "+AWUtils.showHoursInterval(time);}return retVal;};AisWeb.FlightProfileOwnerID=null;AisWeb.MAP_MODES={CLICK_FEATURE_MODE:"clickFeatureMode",HOVER_FEATURE_MODE:"hoverFeatureMode",GET_FPL_ROUTE_FEATURE_MODE:"getFplRouteFeatureMode",FPL_FEATURE_MODIFY_MODE:"fplFeatureModifyMode",WMS_FEATURE_INFO_MODE:"wmsFeatureInfoMode",WMS_FEATURE_QUICK_INFO_MODE:"wmsFeatureQuickInfoMode",MEASURING_MODE:"measuringMode",DRAWING_MODE:"drawingMode",RANGE_CIRCLES_MODE:"rangeCirclesMode"};AisWeb.MAP_CONTEXT={MAP:"clear",NOTAM:"notam",METEO:"meteo",FUA:"fua"};AisWeb.METEO_MODES={METAR:"metar"};AisWeb.FUA_MODES={TODAY:"today",TOMORROW:"tomorrow"};AisWeb.NOTAM_MODES={VALID:"valid",EFFECTIVE:"effective"};AisWeb.EVENT={INIT_FINISHED:"InitFinished",REFRESH_COMMON:"RefreshCommon",SETUP_METEO_MODE:"SetupMeteoMode",SETUP_NOTAM_MODE:"SetupNotamMode",SETUP_MAP_CONTEXT:"SetupMapContext",APPEND_DYANIC_MAP_CONTEXT:"AppendMapContext",DRAWING_CHANGED:"DrawingChanged",FPL_ROUTE_OBJECT_REQUEST:"FplRtObjectRequest",FPL_ROUTE_OBJECT_RESULT:"FplRtObjectResult"};OpenLayers.Renderer.CustomSVG=OpenLayers.Class(OpenLayers.Renderer.SVG,{plotSize:16,plotSizeMin:8,plotMarkLabelSize:20,supported:function(){return true;},closeButton:function(featureId,rounding=5){const rv=this.nodeFactory(featureId+this.LABEL_ID_SUFFIX+"_close","svg");const bg=this.nodeFactory(null,"rect");const icon=this.nodeFactory(null,"path");bg.setAttributeNS(null,"x",0);bg.setAttributeNS(null,"y",0);bg.setAttributeNS(null,"width",20);bg.setAttributeNS(null,"height",20);bg.setAttributeNS(null,"rx",rounding);bg.setAttributeNS(null,"opacity",.1);icon.setAttributeNS(null,"d","m5 5 10 10m-10 0 10-10");icon.setAttributeNS(null,"stroke","#FF0000");icon.setAttributeNS(null,"stroke-width",3);icon.setAttributeNS(null,"fill","none");rv.appendChild(bg);rv.appendChild(icon);return rv;},drawText:function(featureId,style,location){const resolution=this.getResolution();const align=style.labelAlign||"cm";const isRouteLabel=style.isSegmentLabel!==true;const labelSelect=style.labelSelect==="true";const layer=this.map.getLayer(this.container.id);const feature=layer.getFeatureById(featureId);if(feature==null){return;}location=(feature.attributes.centroid?feature.attributes.centroid:location);const labelOffset=feature.attributes.labelOffset||0;const textLabelOffset=(style.labelAlign[0]==='r')?labelOffset*-1:labelOffset;var x=(location.x/resolution+this.left);var y=(location.y/resolution-this.top);var label=this.nodeFactory(featureId+this.LABEL_ID_SUFFIX,"text");var tspan=this.nodeFactory(featureId+this.LABEL_ID_SUFFIX+"_tspan","tspan");var bg;if(style.isSegmentLabel==='true'){bg=this.nodeFactory(featureId+this.LABEL_OUTLINE_SUFFIX,"polygon");}else{bg=this.nodeFactory(featureId+this.LABEL_OUTLINE_SUFFIX,"rect");}label.setAttributeNS(null,"x",x+textLabelOffset);label.setAttributeNS(null,"y",-y);if(style.angle!=="undefined"&&style.angle!==undefined&&style.angle!==0){var rotate='rotate('+style.angle+','+x+","+-y+')';label.setAttributeNS(null,"transform",rotate);}if(style.fontColor){label.setAttributeNS(null,"fill",style.fontColor);}if(style.fontFamily){label.setAttributeNS(null,"font-family",style.fontFamily);}if(style.fontSize){label.setAttributeNS(null,"font-size",style.fontSize);}if(style.fontWeight){label.setAttributeNS(null,"font-weight",style.fontWeight);}if(style.fontStyle){label.setAttributeNS(null,"font-style",style.fontStyle);}if(labelSelect){bg.setAttributeNS(null,"pointer-events","visible");bg.setAttributeNS(null,"cursor","pointer");bg._featureId=featureId;bg._geometry=location;bg._geometryClass=location.CLASS_NAME;bg.isRouteLabel=isRouteLabel;}else{label.setAttributeNS(null,"pointer-events","none");}label.setAttributeNS(null,"text-anchor",OpenLayers.Renderer.SVG.LABEL_ALIGN[align[0]]||"middle");if(AWUtils.isGecko){label.setAttributeNS(null,"dominant-baseline",OpenLayers.Renderer.SVG.LABEL_ALIGN[align[1]]||"central");}else{tspan.setAttributeNS(null,"baseline-shift",OpenLayers.Renderer.SVG.LABEL_VSHIFT[align[1]]||"-35%");}if(style.label!=="undefined"){tspan.textContent=style.label;if(!label.parentNode){label.appendChild(tspan);this.textRoot.appendChild(label);}}var labelW=label.textContent.length>0?label.getBBox().width+labelOffset:0;var res=this.map.getResolution();var meters=labelW*res;if(bg.parentNode)this.textRoot.removeChild(bg);if(feature.showLabel===false||(feature.attributes.distance!==undefined&&(meters>feature.attributes.distance))){this.textRoot.removeChild(label);}else if(feature.attributes.background===true){if(style.labelBackgroundColor||style.labelBorderColor||style.labelBorderSize){const rounding=10;const closeBtn=(labelSelect)?this.closeButton(featureId,rounding):null;let closeBtnWidth;if(style.labelBackgroundColor){bg.setAttributeNS(null,"fill",style.labelBackgroundColor);}if(style.labelBorderColor||style.labelBorderSize){bg.setAttributeNS(null,"stroke",(style.labelBorderColor?style.labelBorderColor:"#000000"));bg.setAttributeNS(null,"stroke-width",(style.labelBorderSize?style.labelBorderSize:"0.5"));}var bbox=label.getBBox();var labelWidth=bbox.width;var labelHeight=bbox.height;var padding=2;if(style.labelPadding&&style.labelPadding!=="undefined"){var pos=style.labelPadding.indexOf("px");if(pos===-1){padding=style.labelPadding;}else{padding=parseInt(style.labelPadding.substr(0,pos));}}var angleCorr=0,correctedAngle;var labelWMargin=10;var bgWidth=labelWidth+padding*2+labelWMargin;var bgHeight=labelHeight+padding*2;if(style.labelAlign[0]==='r'){angleCorr=180;}var bgx=bbox.x-padding;var bgy=bbox.y-padding;if(closeBtn){this.textRoot.appendChild(closeBtn);closeBtnWidth=closeBtn.getBBox().width;bgWidth+=closeBtnWidth;}if(style.isSegmentLabel==='true'){var arrowSize=bgHeight/2;if(angleCorr===180){bgx=x+labelOffset-(labelWMargin/2);}var bgPoints=bgx+","+bgy+" ";bgPoints+=(bgx+bgWidth-arrowSize)+","+bgy+" "+(bgx+bgWidth)+","+(bgy+(bgHeight/2))+" ";bgPoints+=(bgx+bgWidth-arrowSize)+","+(bgy+bgHeight)+" "+bgx+","+(bgy+bgHeight);bg.setAttributeNS(null,"points",bgPoints);correctedAngle=style.angle+angleCorr;if(style.angle||correctedAngle!==0){var rotate='rotate('+correctedAngle+','+x+','+-y+')';bg.setAttribute("x",(x+labelOffset-labelWMargin));bg.setAttribute("transform",rotate);}}else{if(closeBtn){let xPos=bgx-closeBtnWidth;if(style.labelAlign[0]==='l'){xPos+=bgWidth;}else{bgx-=closeBtnWidth;}closeBtn.setAttributeNS(null,"x",xPos);closeBtn.setAttributeNS(null,"y",bgy);}bg.setAttributeNS(null,"x",bgx);bg.setAttributeNS(null,"y",bgy);bg.setAttributeNS(null,"rx",rounding);bg.setAttributeNS(null,"ry",rounding);}bg.setAttributeNS(null,"width",bgWidth+"px");bg.setAttributeNS(null,"height",bgHeight+"px");label.appendChild(bg);this.textRoot.insertBefore(bg,label);}else{console.log("Custom SVG: Label without background or border.");}}},drawLineString:function(node,geometry){var componentsResult=this.getComponentsString(geometry.components);if(componentsResult.path){node.setAttributeNS(null,"points",componentsResult.path);var plotting=geometry.plotting;if(plotting!=null&&plotting.enabled===true){var plotContainerId=node.id+"_plot";var plotContainer=document.getElementById(plotContainerId);var segments=plotting.segments;if(plotContainer!=null){this.vectorRoot.removeChild(plotContainer);}if(segments!=undefined){plotContainer=this.nodeFactory(plotContainerId,"g");this.vectorRoot.appendChild(plotContainer);for(var j=0;j<segments.length;j++){var segment=segments[j];var plotNode=this.createPlotingNode(segment,node._style);if(plotNode!=null){plotContainer.appendChild(plotNode);}}}}return(componentsResult.complete?node:null);}else{return false;}},createPlotMark:function(pnt,distance,size){var res=this.getResolution();var s=size*res;var mapProj=this.map.getProjectionObject();var plotMarkPnt=OpenLayers.Util.destinationVincenty(new OpenLayers.LonLat(pnt.x,pnt.y).transform(mapProj,"EPSG:4326"),90,distance);plotMarkPnt.transform("EPSG:4326",mapProj);var pnt1=new OpenLayers.Geometry.Point(plotMarkPnt.lon,pnt.y+s);var pnt2=new OpenLayers.Geometry.Point(plotMarkPnt.lon,pnt.y-s);return" M"+this.getShortStringWithoutRange(pnt1)+" L"+this.getShortStringWithoutRange(pnt2);},createPlotMarkLabel:function(mark,label){var retVal=this.createNode("text");var pnt=mark.substring(mark.indexOf("L")+1);var rotate='rotate(90,'+pnt+')';var margin=8;pnt=pnt.split(",");retVal.setAttributeNS(null,"x",parseFloat(pnt[0])+margin/2);retVal.setAttributeNS(null,"y",parseFloat(pnt[1])+margin);retVal.setAttributeNS(null,"font-size",this.plotMarkLabelSize);retVal.setAttributeNS(null,"stroke","black");retVal.setAttributeNS(null,"stroke-width",2.2);retVal.setAttributeNS(null,"transform",rotate);retVal.innerHTML=label+"'";return retVal;},createPlotingNode:function(segment,style){var retNode=null;var d="";var labels=this.createNode("g");var i=0;for(;i<segment.marks.length;i++){var mark=segment.marks[i];var plotMark=this.createPlotMark(segment.point,mark.distance,this.plotSize);d+=plotMark;labels.appendChild(this.createPlotMarkLabel(plotMark,mark.label));}if(segment.lastMarks!==undefined){for(i=0;i<segment.lastMarks.length;i++){var mark=segment.lastMarks[i];var plotMark=this.createPlotMark(segment.point,mark.distance,this.plotSizeMin);d+=plotMark;if(mark.label!==undefined)labels.appendChild(this.createPlotMarkLabel(plotMark,mark.label));}}if(d!==""){var rotate='rotate('+segment.angle+','+this.getShortStringWithoutRange(segment.point)+')';var path=this.createNode("path");path.setAttributeNS(null,"d",d);path.setAttributeNS(null,"transform",rotate);labels.setAttributeNS(null,"transform",rotate);var plotMarkColor=(style.plotMarkColor!=undefined)?style.plotMarkColor:"black";var plotMarkWidth=(style.plotMarkWidth!=undefined)?style.plotMarkWidth:3;var plotMarkOpacity=(style.plotMarkOpacity!=undefined)?style.plotMarkOpacity:0.8;path.setAttributeNS(null,"stroke",plotMarkColor);path.setAttributeNS(null,"stroke-width",plotMarkWidth);path.setAttributeNS(null,"stroke-opacity",plotMarkOpacity);retNode=this.createNode("g");retNode.setAttributeNS(null,"desc","ploting");retNode.appendChild(path);retNode.appendChild(labels);}return retNode;},eraseGeometry:function(geometry,featureId){OpenLayers.Renderer.SVG.prototype.eraseGeometry.apply(this,arguments);const plotElelement=OpenLayers.Util.getElement(geometry.id+"_plot");const closeElement=OpenLayers.Util.getElement(featureId+this.LABEL_ID_SUFFIX+"_close");if(plotElelement&&plotElelement.parentNode){plotElelement.parentNode.removeChild(plotElelement);}if(closeElement&&closeElement.parentNode){closeElement.parentNode.removeChild(closeElement);}},getShortStringWithoutRange:function(point){var resolution=this.getResolution();var x=((point.x-this.featureDx)/resolution+this.left);var y=(this.top-point.y/resolution);return x+","+y;},CLASS_NAME:"OpenLayers.Control.CustomSVG"});function RsAisOws(){this.owsWmsCapabilities;this.owsWfsCapabilities;this.owsWcsCapabilities;this.owsWcsCapHash;var _instance=this;this.init=function(){var dft={sdoWms:{version:"1.3.0",url:"http://localhost/wms"},wcs:{version:"1.1.0",url:"http://localhost/wcs"}};this.config=AppController.configuration.loadConfigObject("sources",dft);this.loadOwsWmsCapabilities(function(){JQ(_instance).trigger(RsAisOws.EVENT.INIT_FINISHED);});};this.loadOwsWmsCapabilities=function(callback){OpenLayers.Request.GET({url:_instance.config.sdoWms.url+"?SERVICE=WMS&VERSION="+_instance.config.sdoWms.version+"&REQUEST=GetCapabilities",success:function(response){var xmlFormatObj=new OpenLayers.Format.XML();var xml=xmlFormatObj.read(response.responseText);if(response.responseText.length!==0){var wmsFormatObj=new OpenLayers.Format.WMSCapabilities();_instance.owsWmsCapabilities=wmsFormatObj.read(xml);if(_instance.owsWmsCapabilities!==undefined&&_instance.owsWmsCapabilities.service!==undefined){console.log(_instance.owsWmsCapabilities.service.name+': '+_instance.owsWmsCapabilities.service.title);}if(typeof callback==="function"){callback();}}else{alert("Can not load OWS/WMS capabilities!");}},failure:function(response){debug("OWS/WMS getCapabilities failed with response: "+response);}});};this.loadOwsWcsCapabilities=function(callback){OpenLayers.Request.GET({url:_instance.config.wcs.url+"?SERVICE=WCS&VERSION="+_instance.config.wcs.version+"&REQUEST=GetCapabilities",success:function(response){var xmlFormatObj=new OpenLayers.Format.XML();var xml=xmlFormatObj.read(response.responseText);if(response.responseText.length!==0){var wcsFormatObj=new OpenLayers.Format.WCSCapabilities();const oldHash=_instance.owsWcsCapHash;try{_instance.owsWcsCapabilities=wcsFormatObj.read(xml);_instance.owsWcsCapHash=RsAisOws.createWcsCapabilitiesHash(_instance.owsWcsCapabilities);}catch(e){callback(null,e);}if(_instance.owsWcsCapabilities!==undefined&&_instance.owsWcsCapabilities.service!==undefined){console.log(_instance.owsWcsCapabilities.service.name+': '+_instance.owsWcsCapabilities.service.title);}if(typeof callback==="function"){callback(_instance.owsWcsCapabilities);}if(_instance.owsWcsCapHash!==oldHash){JQ(_instance).trigger(RsAisOws.EVENT.WCS_CAPABILIIES_CHANGED);}}else{callback(null,"Can not load OWS/WCS capabilities!");}},failure:function(xhr){debug("Can not load WCS getCapabilities. Server failure.");callback(null,"OWS/WCS getCapabilities failed with response: "+xhr.statusText);}});};this.getCoverageUrl=function(fileObj){var retVal=_instance.config.wcs.url+"?SERVICE=WCS&VERSION="+_instance.config.wcs.version+"&REQUEST=GetCoverage";var crs=RsAisOws.getPreferredCrs(fileObj);var gridOffset1,gridOffset2;var gridOrigin1,gridOrigin2;var bounds=fileObj.bounds;if(bounds&&crs&&fileObj.boundsTransformated===undefined){var crss=crs.replace("::",":");var crss=crs.split(/.*(EPSG:\d{4,8})/);if(crss.length>1){const reqCrs="EPSG:4326";const tmpCrs=crss[1];if(tmpCrs!==reqCrs){bounds.transform(reqCrs,tmpCrs);fileObj.boundsTransformated=true;}}}if(crs&&crs.toUpperCase().endsWith("IMAGECRS")){const fileType=RsAisOws.getWcsCoverageKeyword(fileObj,"TYPE");const width=getConfigValue3("wcsImages",fileType,"width",1280);const height=getConfigValue3("wcsImages",fileType,"height",674);bounds=new OpenLayers.Bounds(0,0,width,height);gridOffset1=gridOffset2=1;gridOrigin1=gridOrigin2=0;}else{gridOffset1=(fileObj.config&&fileObj.config.gridOffset)?fileObj.config.gridOffset:663.145167;gridOffset2=-gridOffset1;gridOrigin1=bounds.left+gridOffset1;gridOrigin2=bounds.top-(gridOffset1/2);}retVal+="&identifier="+fileObj.identifier;retVal+="&format="+RsAisOws.getPreferredFormat(fileObj);retVal+="&boundingBox="+bounds.toBBOX()+","+crs;retVal+="&gridOffsets="+gridOffset1+","+gridOffset2;retVal+="&gridOrigin="+gridOrigin1+","+gridOrigin2;return retVal;};this.getAllConfiguredTypes=function(){var retVal={};JQ.each(searchSdoTypeConfig,function(i,typeItem){var typesArr=typeItem.type.split(" ");JQ.each(typesArr,function(ii,type){retVal[type]="";});});return Object.keys(retVal);};}RsAisOws.createWcsCapabilitiesHash=function(capabilities){var retVal;if(capabilities&&capabilities.contentMetadata){const contentData=capabilities.contentMetadata;var fileNames="";JQ.each(contentData,function(idx,contentObj){var title=contentObj.title||contentObj.identifier;if(title){fileNames+=title;}});retVal=AWUtils.crc32(fileNames);}return retVal;};RsAisOws.getSdoObjectDescription=function(feature){var retVal=[];var sdoType=RsAisOws.searchSdoKeyForType(feature.type);JQ.each(sdoType.attrs,function(idx,attr){var attrVal=feature.attributes[attr];if(attrVal!==undefined&&attrVal!==""&&retVal.indexOf(attrVal)===-1)retVal.push(attrVal);});return retVal.join(', ');};RsAisOws.getConfigValueFor=function(type,attr){var rv;var key=RsAisOws.searchSdoKeyForType(type);if(key!==undefined){rv=key[attr];}return rv;};RsAisOws.getProjectionForTypes=function(types){let retVal;if(searchSdoTypeConfig){let i=0;while(!retVal&&i<types.length){retVal=RsAisOws.getConfigValueFor(types[i++],"projection");}}return retVal||AppController.aisWeb.getMap().projection;};RsAisOws.getPreferedAttr=function(type){var rv;var key=RsAisOws.searchSdoKeyForType(type);if(key!==undefined){rv=key.preferedAttr;}return rv;};RsAisOws.searchSdoKeyForType=function(type){var rv;var cfg=searchSdoTypeConfig;JQ.each(cfg,function(index,object){if(object.type===type){rv=object;return false;}});if(rv===undefined){JQ.each(cfg,function(index,object){if(object.type.indexOf(type)!==-1){rv=object;return false;}});}return rv;};RsAisOws.getObjectName=function(feature){var retVal;if(feature){var prefAttr=RsAisOws.getPreferedAttr(feature.type);retVal=feature.attributes[prefAttr];if(retVal!==undefined&&retVal.length===0&&feature.attributes["CODE_ID"]){feature.attributes[prefAttr]=retVal=feature.attributes["CODE_ID"];}}return retVal;};RsAisOws.parseWcsCrs=function(file){var suppCrs=file.supportedCRS;if(Array.isArray(suppCrs)&&suppCrs.length===1&&(suppCrs[0].startsWith("PROJCS[")||suppCrs[0].startsWith("+proj="))){suppCrs[0]="EPSG:3857";}};RsAisOws.parseWcsGetCoverage=function(response){var data,image,imageType;var retVal={};if(response){var byteArray=new Uint8Array(response);var sections=Multipart.parse(byteArray,"wcs");if(sections.length>1){var x2js=new X2JS();data=x2js.xml_str2json(sections[0].text);imageType=sections[1].header['content-type'];image=sections[1].file;}}retVal.data=data;retVal.imageType=imageType;retVal.image=image;return retVal;};RsAisOws.getPreferredFormat=function(file){var prefs=["image/png","image/jpg","image/jpeg"];return AWUtils.getPreferredValue(file.supportedFormat,prefs);};RsAisOws.getPreferredCrs=function(file){var prefs=["urn:ogc:def:crs:EPSG::4326"];return AWUtils.getPreferredValue(file.supportedCRS,prefs);};RsAisOws.getWcsCoverageKeyword=function(coverage,keyword){var retVal;if(coverage&&coverage.keywords&&keyword){JQ.each(Object.keys(coverage.keywords),function(idx,row){var rowParts=row.split(/(\w+) (.*)/);if(rowParts.length>2&&keyword.toUpperCase()===rowParts[1]){retVal=rowParts[2];}});}return retVal;};RsAisOws.EVENT={INIT_FINISHED:"InitFinished",WCS_CAPABILIIES_CHANGED:"WcsCapabilitiesChanged"};function AWUtils(){}AWUtils.ua=navigator.userAgent.toLowerCase();AWUtils.isWebKit=/webkit/.test(AWUtils.ua);AWUtils.isGecko=!AWUtils.isWebKit&&/gecko/.test(AWUtils.ua);AWUtils.isIe=!AWUtils.isWebKit&&/msie/.test(AWUtils.ua);AWUtils.isSafari=/safari/.test(AWUtils.ua);var PilotAttributes={VFR_MASK:1,IFR_MASK:2,DRONE_MASK:4};AWUtils.device={is_android:function(){return navigator.userAgent.match(/Android/i);},is_blackberry:function(){return navigator.userAgent.match(/BlackBerry/i);},is_iphone:function(){return navigator.userAgent.match(/iPhone/i);},is_ipad:function(){return navigator.userAgent.match(/iPad/i);},is_ipod:function(){return navigator.userAgent.match(/iPod/i);},is_ios:function(){return navigator.userAgent.match(/iPhone|iPad|iPod|Mac OS/i);},is_windows_phone:function(){return navigator.userAgent.match(/IEMobile/i);},is_mobile:function(){return(AWUtils.device.is_android()||AWUtils.device.is_blackberry()||AWUtils.device.is_ios()||AWUtils.device.is_windows_phone());}};AWUtils.isTouchscreenDevice=function(){return("ontouchstart" in document.documentElement)?true:false;};if(!Date.prototype.toISOString){Date.prototype.toISOString=function(){function pad(n){return n<10?'0'+n:n;}return this.getUTCFullYear()+'-'+pad(this.getUTCMonth()+1)+'-'+pad(this.getUTCDate())+'T'+pad(this.getUTCHours())+':'+pad(this.getUTCMinutes())+':'+pad(this.getUTCSeconds())+'Z';};}if(!('contains' in String.prototype)){String.prototype.contains=function(str){return''.indexOf.call(this,str,0)!==-1;};}if(!Array.prototype.remove){Array.prototype.remove=function(v){this.splice(this.indexOf(v)===-1?this.length:this.indexOf(v),1);};}if(console===undefined){var console=console||{"log":function(){}};}AWUtils.getXhr=function(){var retVal;if(window.XMLHttpRequest){retVal=new XMLHttpRequest();}else{retVal=new ActiveXObject("Microsoft.XMLHTTP");}retVal.timeout=getConfigValue("xhrTimeout",60)*1000;return retVal;};AWUtils.processResponse=function(response,responseRootTag,format="xml"){var retVal;const x2js=new X2JS();const xmlDoc=x2js.parseXmlString(response);if(xmlDoc){retVal=xmlDoc.getElementsByTagName(responseRootTag);if(format==="json"&&retVal&&retVal.length>0){retVal=x2js.xml2json(retVal[0]);}}return retVal;};AWUtils.getHomeUrl=function(){var retVal=(config.homeUrl!==undefined)?config.homeUrl:window.location.href.replace(/\/[^\/]*\/?$/,'/');;if(retVal.charAt(retVal.length-1)!=="/"){retVal+="/";}return retVal;};function arrayBufferToBase64(buffer){var binary='';var bytes=new Uint8Array(buffer);var len=bytes.byteLength;for(var i=0;i<len;i++){binary+=String.fromCharCode(bytes[i]);}return window.btoa(binary);}AWUtils.base64ToArrayBuffer=function(base64){var binary=window.atob(base64);var len=binary.length;var bytes=new Uint8Array(len);for(var i=0;i<len;i++){bytes[i]=binary.charCodeAt(i);}return bytes.buffer;};function dec2bin(dec){return(dec>>>0).toString(2);}AWUtils.date2yyyymmdd=function(aDate,separator){var retVal=null;if(aDate!==null&&aDate!==undefined){var day="0"+aDate.getDate();var month="0"+(aDate.getMonth()+1);var year=aDate.getFullYear();separator=(separator===undefined)?"-":separator;retVal=year+separator+month.substr(month.length-2)+separator+day.substr(day.length-2);}return retVal;};AWUtils.date2ddmmyyyy=function(aDate,separator){var retVal=null;separator=(separator===undefined)?".":separator;if(aDate!==null&&aDate!==undefined){var day="0"+aDate.getDate();var month="0"+(aDate.getMonth()+1);var year=aDate.getFullYear();retVal=day.substr(day.length-2)+separator+month.substr(month.length-2)+separator+year;}return retVal;};AWUtils.dateIsInInterval=function(date,dateFrom,dateTo){var now=date.getTime();return(dateFrom.getTime()<now&&dateTo.getTime()>now);};AWUtils.dateToUTC=function(date){return new Date(date.getUTCFullYear(),date.getUTCMonth(),date.getUTCDate(),date.getUTCHours(),date.getUTCMinutes(),date.getUTCSeconds());};AWUtils.getTimeString=function(date,utcFlag,correctHrZero,withoutSec){var retVal;var h=(utcFlag)?date.getUTCHours():date.getHours();var m=(utcFlag)?AWUtils.addLeadingZero(date.getUTCMinutes(),2):AWUtils.addLeadingZero(date.getMinutes(),2);withoutSec=(withoutSec)?withoutSec:false;h=(correctHrZero)?AWUtils.addLeadingZero(h,2):h;if(withoutSec){retVal=h+":"+m;}else{var s=(utcFlag)?AWUtils.addLeadingZero(date.getUTCSeconds(),2):AWUtils.addLeadingZero(date.getSeconds(),2);retVal=h+":"+m+":"+s;}return retVal;};AWUtils.getCurrentTimeString=function(utcFlag){var today=new Date();var desc=(utcFlag)?"UTC ":"LOC ";var timeStr=AWUtils.getTimeString(today,utcFlag);return desc+timeStr;};AWUtils.getAngle=function(x1,y1,x2,y2){var dx=x2-x1;var dy=y2-y1;var angle=Math.atan2(dx,dy)*180/Math.PI;if(angle<180){angle=angle-90;}else{angle=angle-270;}return angle;};AWUtils.getLastSignificantVertices=function(vertices){let retVal=null;if(vertices.length>1){const p1=vertices[vertices.length-2];const p2=vertices[vertices.length-1];if(p1.equals(p2)){vertices.pop();retVal=AWUtils.getLastSignificantVertices(vertices);}else{retVal={p1,p2};}}return retVal;};AWUtils.getAzimuth=function(geometry,decimals=0){let retVal=null;if(geometry){const vert=AWUtils.getLastSignificantVertices(geometry.getVertices());if(vert){const dx=vert.p2.x-vert.p1.x;const dy=vert.p2.y-vert.p1.y;const angle=parseFloat((Math.atan2(dx,dy)*180/Math.PI).toFixed(decimals));retVal=(angle<1)?360+angle:angle;}}return retVal;};AWUtils.correctAzimuth=function(azimuth,magDeclination){var retVal=azimuth-magDeclination;if(retVal>=360)retVal-=360;else if(retVal<0)retVal+=360;return retVal;};AWUtils.toggleString=function(string,substring,separator,state){var retVal=string;if(substring!==null&&substring!==undefined&&substring.length>0){var items=(!string||string.length===0)?new Array():string.split(separator);var subItems=(substring.length===0)?new Array():substring.split(separator);var found=false;JQ.each(items,function(idx,item){items[idx]=JQ.trim(item);});JQ.each(subItems,function(idx,subitem){subItems[idx]=JQ.trim(subitem);});for(var idx=0;idx<items.length;idx++){for(var subIdx=0;subIdx<subItems.length;subIdx++){if(items[idx]===subItems[subIdx]){if(state===false){items.splice(idx,1);}found=true;}}if(found){break;}}if(state&&found===false){items.push(subItems.join(separator));}retVal=items.join(separator);}return retVal;};function debug(text){if(config.debug===true){var now=new Date();console.log(AWUtils.date2ddmmyyyy(now)+" "+AWUtils.getTimeString(now,false,true)+": "+text);}}AWUtils.setupParamIfValueNotNull=function(object,param,value){if(value||typeof value==="boolean"){if(typeof value==="string"){value=value.trim();if(value.length>0){object[param]=value;}}else{object[param]=value;}}};AWUtils.calculateSpeed=function(value,uom){var retVal=null;switch(uom){case"mph":retVal=value*1.60934;break;case"kts":retVal=value*1.852;break;case"km/h":retVal=value;break;case"m/s":retVal=value*3.6;break;};return parseFloat(retVal);};AWUtils.calculateDistance=function(value,uom){var retVal=value;if(typeof uom==="string"){switch(uom.toUpperCase()){case"NM":retVal=(value/1852);break;case"KM":retVal=(value/1000);break;default:retVal=value;}}return parseFloat(retVal);};AWUtils.formatDistance=function(value,uom){var retVal=value;switch(uom){case"NM":retVal+=" NM";break;case"KM":retVal+=" km";break;default:retVal+=" m";}return retVal;};AWUtils.prepareDistanceInfoItem=function(item,unit){var valItem=item.find(".fi-value");var distance=valItem.attr("value");var dstStr=AWUtils.calculateDistance(distance,unit).toFixed(2);valItem.text(AWUtils.formatDistance(dstStr,unit));};AWUtils.showHoursInterval=function(interval){var hrs=Math.floor(interval);var min=Math.floor((interval-hrs)*60);var sec=Math.round((interval-hrs-(min/60))*3600);if(sec===60){sec=0;min++;}if(min===60){min=0;hrs++;}hrs=(hrs<10)?"0"+hrs:hrs;min=(min<10)?"0"+min:min;sec=(sec<10)?"0"+sec:sec;return hrs+":"+min+":"+sec;};jQuery.fn.horizontalAlign=function(align){var parent=JQ.mobile.activePage;switch(align){case"center":this.css("left",Math.max(0,((parent.width()-JQ(this).outerWidth())/2)+parent.scrollLeft())+"px");break;case"left":this.css("left",0);break;case"right":this.css("right",0);break;}this.css("position","absolute");return this;};jQuery.fn.fitHeightToPage=function(){this.css("bottom",0);return this;};window.rsAnimationTime=550;jQuery.fn.animatedShow=function(callback){var aObj=this;setTimeout(function(){var right=parseInt(aObj.css("right"));if(right===0){aObj.css("right",0-aObj.width()+"px");aObj.show();aObj.animate({"right":0},window.rsAnimationTime,"linear",callback);}else{var pos=parseInt(aObj.css("left"));var ww=JQ(window).width();var left=aObj.width();left=(pos<ww/2)?0-left:ww+left;aObj.css("left",left+"px");aObj.show();aObj.animate({"left":pos},window.rsAnimationTime,"linear",callback);}},1);return this;};jQuery.fn.animatedHide=function(callback){var aObj=this;setTimeout(function(){var right=parseInt(aObj.css("right"));if(right===0){aObj.animate({"right":0-aObj.width()},window.rsAnimationTime,"linear",function(){aObj.hide();aObj.css("right",0);if(callback!==undefined&&typeof callback==='function')callback.call();});}else{var pos=parseInt(aObj.css("left"));var left=aObj.width();var ww=JQ(window).width();left=(pos===0)?0-left:ww+left;aObj.animate({"left":left+"px"},window.rsAnimationTime,"linear",function(){aObj.hide();aObj.css("left",pos);if(callback!==undefined&&typeof callback==='function')callback.call();});}},1);return this;};jQuery.fn.animatedMinimize=function(callback,anime){var title=this.find(".rsys-form-title");var titleHeight=title.css("height");anime=(anime===undefined)?true:anime;var time=(anime)?630:0;this.attr("min-height",this.css("min-height"));this.attr("pref-height",this.css("height"));this.attr("padding-bottom",this.css("padding-bottom"));this.animate({"height":titleHeight,"min-height":0,"padding-bottom":0},time,"linear",function(){title.css("border-bottom-left-radius",title.css("border-top-left-radius"));title.css("border-bottom-right-radius",title.css("border-top-right-radius"));if(callback!==undefined&&typeof callback==='function')callback.call();});return this;};jQuery.fn.animatedMaximize=function(callback,anime){var title=this.find(".rsys-form-title");var obj=this;anime=(anime===undefined)?true:anime;var time=(anime)?630:0;title.css("border-bottom-left-radius",'');title.css("border-bottom-right-radius",'');this.animate({"height":obj.attr("pref-height")},time,"linear",function(){obj.css("min-height",obj.attr("min-height"));obj.css("height",obj.attr("pref-height"));obj.css("padding-bottom",obj.attr("padding-bottom"));obj.removeAttr("min-height");obj.removeAttr("pref-height");obj.removeAttr("padding-bottom");if(callback!==undefined&&typeof callback==='function')callback.call();});return this;};jQuery.fn.periodicClassChange=function(delay,classStr,count,callback){var timerId;var obj=JQ(this);if(delay===undefined||delay<=0){clearInterval(obj.data("classChangeTimerId"));obj.removeData("classChangeTimerId");if(classStr!==undefined){JQ(obj).removeClass(classStr);}}else{timerId=setInterval(function(){if(JQ(obj).hasClass(classStr))JQ(obj).removeClass(classStr);else{JQ(obj).addClass(classStr);if(count!==undefined){count--;if(count<=0){clearInterval(obj.data("classChangeTimerId"));obj.removeData("classChangeTimerId");JQ(obj).removeClass(classStr);AWUtils.applyFunction(this,callback);}}}},delay);obj.data("classChangeTimerId",timerId);}return obj;};jQuery.fn.isPeriodicClassActive=function(){var obj=JQ(this);return(obj.data("classChangeTimerId")!==undefined);};jQuery.fn.blink=function(delay,count){var timerId;var obj=JQ(this);if(delay===0){var timerId=obj.data("blinkTimerId");if(timerId!==undefined){clearInterval(timerId);obj.css('visibility','visible');}}else{if(delay===undefined){delay=1000;}timerId=setInterval(function(){if(JQ(obj).css("visibility")==="visible")JQ(obj).css('visibility','hidden');else{JQ(obj).css('visibility','visible');if(count!==undefined){count--;if(count<=0){clearInterval(obj.data("blinkTimerId"));}}}},delay);obj.data("blinkTimerId",timerId);}};jQuery.fn.floatNumberInput=function(){this.on("keypress",function(event){var ew=event.which;if((ew<46||ew>57||ew===47)&&(ew<0||ew>31)&&ew!==44){event.preventDefault();};var obj=JQ(this);if(ew===44){if(obj.val().indexOf('.')===-1){obj.val(obj.val()+'.');}event.preventDefault();};if(ew==46&&obj.val().indexOf('.')!==-1){event.preventDefault();};});this.bind('copy paste cut',function(e){e.preventDefault();});};jQuery.fn.forceUppercaseInput=function(e){JQ.each(this,function(i,elem){var jElem=JQ(elem);if(jElem.data('forceUppercaseInput')===undefined&&!jElem.attr("data-disable-uppercase-handler")){jElem.data('forceUppercaseInput',true);jElem.keyup(function(e){var charInput=e.keyCode;if((charInput>=65)&&(charInput<=90)&&!e.ctrlKey&&!e.metaKey&&!e.altKEY){var idx=e.target.selectionStart;e.target.value=e.target.value.toUpperCase();e.target.setSelectionRange(idx,idx);}});jElem.css("text-transform","uppercase");}});};jQuery.fn.clearLastActionValue=function(){this.get(0).lastActionValue=null;};jQuery.fn.addCustomAction=function(action){var obj=JQ(this);obj.customAction=action;obj.triggerCustomAction=function(){if(this.lastActionValue!==obj.val()){AWUtils.invokeLater(AWUtils.applyFunction,[null,obj.customAction],350);this.lastActionValue=obj.val();}};this.keypress(function(event){if(event.keyCode===13){obj.triggerCustomAction();}});if(obj.is("input")){obj.blur(function(){obj.triggerCustomAction();return true;});}};function getFrequency(feature){return feature.data["FREQUENCY"];}AWUtils.decodeAixmFeatureType=function(feature,subtype){const featureType=(typeof feature==="object")?feature.type:feature;const filterDef=getConfigValue2("customAixmFeatureNames",featureType);var retVal;if(filterDef){if(typeof filterDef==="string"){retVal=filterDef;}else{var filterFunc;const obj=JQ("<li>");filterFunc=AWUtils.getFilterFunction(filterDef);if(filterFunc){filterDef.type=featureType;obj.data("feature",feature);obj.attr("aixm-type",featureType);if(filterFunc(obj)){retVal=filterDef.name;}}}}if(retVal===undefined){const typeMap={"Aixm-Ahp":"Airport/Heliport","Aixm-Rwy":"Runway","Aixm-Rte":"Enroute","Aixm-Rsg":"Route Segment","Aixm-Dme":"DME","Aixm-Ndb":"NDB","Aixm-Dpn":"DPN","Aixm-Vor":"VOR","Aixm-Tcn":"Tacan","Aixm-Mkr":"Marker","Aixm-Obs":"Obstacle","Aixm-Ase-A":"Airspace A","Aixm-Ase-ADIZ":"Airspace ADIZ","Aixm-Ase-AMA":"Airspace AMA","Aixm-Ase-P":"Airspace P","Aixm-Ase-R":"Airspace R","Aixm-Ase-R-AMC":"Airspace R-AMC","Aixm-Ase-TMA-P":"TMA-P","Aixm-Ase-RAS":"RAS","Aixm-Ase-CTR":"CTR","Aixm-Ase-CTA":"CTA","Aixm-Ase-UTA":"UTA","Aixm-Ase-TMA":"TMA","Aixm-Ase-TSA":"TSA","Aixm-Ase-TRA":"TRA","Aixm-Ase-SECTOR":"Sector","Aixm-Ase-FIR":"FIR","Aixm-Ase-Fua":"FUA"};const decodeSupplementaryType=getConfigValue("decodeSupplementaryFeatureType",true);retVal=typeMap[featureType];retVal=retVal||featureType;if(decodeSupplementaryType&&subtype){switch(retVal){case"TMA":case"CTR":retVal=subtype;break;default:break;}}}return retVal;};AWUtils.compareAttributes=function(obj1,obj2,caseSensitive=true){var retVal=true;if(obj1==null&&obj2==null){retVal=true;}else if((obj1==null&&obj2!=null)||(obj1!=null&&obj2==null)){retVal=false;}else{JQ.each(obj1,function(attr,value){var type=typeof value;if(type==="function"||(typeof attr==="string"&&attr.startsWith("__"))){}else if(!obj2||typeof(obj2[attr])!==type){retVal=false;console.warn("Different values of attribute \""+attr+"\" value1 = \""+value+"\" | value2 = \""+obj2[attr]+"\"");return false;}else if(type==='object'){retVal=AWUtils.compareAttributes(obj2[attr],value);if(!retVal){console.warn("Different values of attribute \""+attr+"\" value1 = \""+value+"\" | value2 = \""+obj2[attr]+"\"");}return retVal;}else if(type==="string"){if(caseSensitive){if(obj2[attr]!==value){retVal=false;console.warn("Different values of attribute \""+attr+"\" value1 = \""+value+"\" | value2 = \""+obj2[attr]+"\"");return false;}}else{if(obj2[attr].toUpperCase()!==value.toUpperCase()){retVal=false;console.warn("Different values of attribute \""+attr+"\" value1 = \""+value+"\" | value2 = \""+obj2[attr]+"\"");return false;}}}else if(obj2[attr]!==value){retVal=false;console.warn("Different values of attribute \""+attr+"\" value1 = \""+value+"\" | value2 = \""+obj2[attr]+"\"");return false;}});if(retVal===true){JQ.each(obj2,function(attr,value){var type=typeof value;if(type==="function"||(typeof attr==="string"&&attr.startsWith("__"))){}else if(!obj1||typeof(obj1[attr])!==type){retVal=false;console.warn("Different values of attribute \""+attr+"\" value1 = \""+value+"\" | value2 = \""+obj1[attr]+"\"");return false;}else if(type==='object'){retVal=AWUtils.compareAttributes(obj1[attr],value);if(!retVal){console.warn("Different values of attribute \""+attr+"\" value1 = \""+value+"\" | value2 = \""+obj1[attr]+"\"");}return retVal;}else if(type==="string"){if(caseSensitive){if(obj1[attr]!==value){retVal=false;console.warn("Different values of attribute \""+attr+"\" value1 = \""+value+"\" | value2 = \""+obj1[attr]+"\"");return false;}}else{if(obj1[attr].toUpperCase()!==value.toUpperCase()){retVal=false;console.warn("Different values of attribute \""+attr+"\" value1 = \""+value+"\" | value2 = \""+obj1[attr]+"\"");return false;}}}else if(obj1[attr]!==value){retVal=false;console.warn("Different values of attribute \""+attr+"\" value1 = "+value+" | value2 = \""+obj1[attr]+"\"");return false;}});}}return retVal;};AWUtils.prepareSvgMapData=function(layers){let svg=null;let wmsParams;let bounds;if(layers&&layers instanceof Array&&layers.length>0){const map=AppController.aisWeb.getMap();const mapExtent=map.getExtent();const origVals={center:map.getCenter(),zoom:map.getZoom()};const border=20;let bbox;bounds=AWUtils.getRouteBounds(layers);map.zoomToExtent(bounds);svg=document.createElementNS("http://www.w3.org/2000/svg","svg");svg.setAttribute("name","IXOweb map data");JQ.each(layers,function(index,layer){var svgContainerId=layer.id+"_root";var svgContainer=document.getElementById(svgContainerId).cloneNode(true);svg.appendChild(svgContainer);});document.body.appendChild(svg);bbox=svg.getBBox();bbox.x-=border;bbox.y-=border;bbox.width+=border*2;bbox.height+=border*2;svg.setAttribute("width",bbox.width);svg.setAttribute("height",bbox.height);svg.setAttribute("viewBox",`${bbox.x} ${bbox.y} ${bbox.width} ${bbox.height}`);svg.setAttribute("preserveAspectRatio","xMinYMin");document.body.removeChild(svg);wmsParams=AWUtils.createWmsParamsForBounds(layers[0],bbox);map.setCenter(origVals.center,origVals.zoom);}return{route:svg,wmsParams:wmsParams,areaOfInterest:bounds};};AWUtils.getRouteBounds=function(layers){const bounds=new OpenLayers.Bounds();JQ.each(layers,function(index,layer){if(typeof layer.getDataExtent==="function"){bounds.extend(layer.getDataExtent());}});return bounds;};AWUtils.createWmsParamsForBounds=function(layer,bounds){let retVal="CRS="+layer.projection.getCode();const lonLat=layer.getLonLatFromViewPortPx(bounds);const lon=lonLat.lon;const lat=lonLat.lat;const res=layer.getResolution();const width=bounds.width*res;const height=bounds.height*res;retVal+="&BBOX="+lon+","+(lat-height)+","+(lon+width)+","+lat;retVal+="&WIDTH="+Math.round(bounds.width)+"&HEIGHT="+Math.round(bounds.height);return retVal;};AWUtils.MeteoCategories={metar:{VFR:1,MARGINAL_VFR:2,IFR:3,INTENSIVE_IFR:4,VERY_INTENSIVE_IFR:5,properties:{1:{text:"VFR",dftColor:"#33CC00",visibility:8000,ceiling:3000},2:{text:"Marginal VFR",dftColor:"#21B99B",visibility:5000,ceiling:1000},3:{text:"IFR",dftColor:"#FF6600",visibility:1500,ceiling:500},4:{text:"Intensive IFR",dftColor:"#FF0000",visibility:800,ceiling:200},5:{text:"Very Intensive IFR",dftColor:"#A41204",visibility:0,ceiling:0}}}};AWUtils.getMetarColor=function(metar){var text;var cat=null;if(metar!==undefined){var visibility=metar.visibility;var ceiling=metar.ceiling;var metarProps=AWUtils.MeteoCategories["metar"].properties;for(var prop in metarProps){var pObj=metarProps[prop];if(visibility>=pObj.visibility&&ceiling>=pObj.ceiling){cat=parseInt(prop);break;}}if(cat===null){text="";}else{text=metarProps[cat].text;}}var color=AWUtils.getMeteoCategoryColor("metar",cat);return{color:color,text:text};};AWUtils.getMeteoCategoryColor=function(meteoMode,categoryCode){var retVal="#F9F9F9";if(categoryCode!==null){retVal=getConfigValue4("meteoLayer","color",meteoMode,categoryCode,AWUtils.MeteoCategories[meteoMode].properties[categoryCode].dftColor);}return retVal;};AWUtils.getMeteoCategoryLegend=function(meteoMode){var retVal=JQ('<div class="meteo-category-legend"></div>');var row1=JQ('<div class="meteo-category-legend-vis"></div>');var row2=JQ('<div class="meteo-category-legend-name"></div>');var row3=JQ('<div class="meteo-category-legend-ceiling"></div>');var meteoCat=AWUtils.MeteoCategories[meteoMode];if(meteoCat!==undefined&&meteoCat.properties!==undefined){var meteoModeProps=meteoCat.properties;row1.append('<div class="meteo-category-legend-vis-title">Visibility [m]</div>');row3.append('<div class="meteo-category-legend-ceiling-title">Ceiling [ft]</div>');JQ.each(meteoModeProps,function(index,prop){var nameDiv=JQ('<div></div>');index=parseInt(index);nameDiv.text(prop.text);nameDiv.addClass('meteo-category-legend-name-'+prop.text);if(index<Object.keys(meteoModeProps).length){var visDiv=JQ('<div></div>');var ceilingDiv=JQ('<div></div>');visDiv.text(prop.visibility);visDiv.addClass('meteo-category-legend-vis-'+prop.visibility);ceilingDiv.text(prop.ceiling);ceilingDiv.addClass('meteo-category-legend-ceiling-'+prop.ceiling);row1.append(visDiv);row3.append(ceilingDiv);}nameDiv.css('background-color',AWUtils.getMeteoCategoryColor(meteoMode,index));row2.append(nameDiv);});row1.hide();row3.hide();retVal.append(row1);retVal.append(row2);retVal.append(row3);if(AWUtils.device.is_mobile()){retVal.on("tap",function(e){if(e.detail===0){if(row1.is(":visible")){JQ(row1).fadeOut();JQ(row3).fadeOut();}else{JQ(row1).fadeIn();JQ(row3).fadeIn();}}});}else{retVal.hover(function(){JQ(row1).fadeIn();JQ(row3).fadeIn();},function(){JQ(row1).fadeOut();JQ(row3).fadeOut();});}}return retVal;};AWUtils.localizeMeteoCategoryLegend=function(){JQ(".meteo-category-legend-vis-title").text(getLocalizedString("Meteo.visibility"));JQ(".meteo-category-legend-ceiling-title").text(getLocalizedString("Meteo.ceiling"));};function getWeatherIconUrl(weatherCode){var retVal;if(weatherCode!==undefined&&weatherCode!==null)retVal="images/mobile/weather_"+weatherCode+".png";return retVal;}function lightenDarkenColor(col,amt){var usePound=false;if(col[0]==="#"){col=col.slice(1);usePound=true;}var num=parseInt(col,16);var r=(num>>16)+amt;if(r>255)r=255;else if(r<0)r=0;var b=((num>>8)&0x00FF)+amt;if(b>255)b=255;else if(b<0)b=0;var g=(num&0x0000FF)+amt;if(g>255)g=255;else if(g<0)g=0;return(usePound?"#":"")+(g|(b<<8)|(r<<16)).toString(16);}function parseCsvLine(csvLine,separator,enableQuotationMarks){function advQuoted(s,index){var len=s.length;var str="";for(var j=index;j<len;j++){if(s[j]==='"'&&j+1<len){if(s[j+1]==='"'){j++;}else if((s[j+1]===separator)||(s[j+1]==='\r')){j++;break;}}else if(s[j]==='"'&&j+1===len){break;}str+=s[j];}return{idx:j,val:str};}function advPlain(s,index){var j=s.indexOf(separator,index);var str,idx;if(j===-1){str=s.substring(index);idx=s.length;}else{str=s.substring(index,j);idx=j;}return{idx:idx,val:str};}var retVal=new Array();if(csvLine!==null&&csvLine!==undefined&&csvLine.length>0){separator=(separator===undefined||separator===null)?",":separator;enableQuotationMarks=(enableQuotationMarks===false)?false:true;for(var i=0;i<csvLine.length;i++){var obj;if(i<csvLine.length&&csvLine[i]==='"'&&enableQuotationMarks){obj=advQuoted(csvLine,++i);}else{obj=advPlain(csvLine,i);}retVal.push(obj.val);i=obj.idx;}}else{retVal.push(csvLine);}return retVal;}AWUtils.meter2Feet=3.2808399;AWUtils.convertToMeter=function(aValue,aUnit){var vfrAltitudeInFeets=1000;if(isUndefinedOrIsNull(aValue)||isUndefinedOrIsNullOrIsEmptyString(aUnit)){return aValue;}aValue=Number(aValue);aUnit=aUnit.trim();var loweredUnit=aUnit.toLowerCase();if(loweredUnit==="f"||loweredUnit==="fl"||loweredUnit==="a"){return(aValue*100.0)/AWUtils.meter2Feet;}if(loweredUnit==="ft"){return aValue/AWUtils.meter2Feet;}else if(aUnit==="S"||aUnit==="M"){return aValue*10.0;}else if(loweredUnit==="vfr"){return vfrAltitudeInFeets/AWUtils.meter2Feet;}else if(loweredUnit==="km"){return aValue*1000.0;}return aValue;};function parseAltitudeOrFl(input){var retVal;var parts=input.split(/^(\d+) ?([a-zA-Z]{0,3})/);if(parts.length===2){retVal=AWUtils.convertToMeter(parts[1],parts[2]);}else{parts=input.split(/^([a-zA-Z]{0,3}) ?(\d+)/);retVal=AWUtils.convertToMeter(parts[2],parts[1]);}if(retVal!==undefined){retVal*=3.2808399;}return retVal;}function isUndefinedOrIsNullOrIsEmptyArray(aObject){if(isUndefinedOrIsNull(aObject)||aObject.length<=0){return true;}return false;}function isUndefinedOrIsNullOrIsEmptyString(aObject){if(isUndefinedOrIsNull(aObject)||(""+aObject).trim().length<=0){return true;}return false;}function isUndefinedOrIsNullOneOf(aObjectArray){if(isUndefinedOrIsNullOrIsEmptyArray(aObjectArray)){return false;}for(var i=0;i<aObjectArray.length;i++){var iObject=aObjectArray[i];if(isUndefinedOrIsNull(iObject)){return true;}}return false;}function isUndefinedOrIsNull(aObject){if(aObject===undefined||aObject===null){return true;}return false;}AWUtils.isNumber=function(n){return!isNaN(parseFloat(n))&&isFinite(n);};function createRoutePoint(flight,segmentIdx,lastPoint){let retVal=null;const route=flight.getRoute();const segment=route.getSegment(segmentIdx);if(segment){let location=(lastPoint===true)?segment.getToPoint():segment.getFromPoint();let lat=location.getLatitude();let lon=location.getLongitude();if(lastPoint&&(lat===undefined||lon===undefined||lat.length===0||lon.length===0)&&segment!=undefined){location=segment.getFromPoint();lat=location.getLatitude();lon=location.getLongitude();}if(lat!==undefined&&lon!=undefined&&lat.length>0&&lon.length>0&&segment!=undefined){retVal=new OpenLayers.Geometry.Point(lon,lat);retVal.name=location.getName();retVal.speed=segment.getIas();retVal.speedUom=segment.getIasUnit();retVal.legTime=route.getTimeSegment();retVal.lastLegTime=route.getLastTimeSegment();retVal.plotCount=route.getTimeSegmentCount();if(retVal.speed===undefined||retVal.speed===null||retVal.speed.length==0){retVal.speed=flight.getIas();retVal.speedUom=flight.getIasUnit();}}}return retVal;}function drawFlightRoute(flight,oldFeature){var retVal=null;if(flight!==undefined){var points=new Array();var route=flight.getRoute().getSegments();var routeName=flight.getRoute().getName();for(var i=0;i<route.length;i++){var point=createRoutePoint(flight,i);if(point!==null){points.push(point);}if(i===route.length-1){var point=createRoutePoint(flight,i,true);if(point!==null){points.push(point);}}};retVal=AppController.aisWeb.drawRoute(routeName,points,oldFeature,flight,AppController.aisWeb.getFlightLogRouteLayer());}return retVal;};AWUtils.setRouteSegmentLabelVisibility=function(routeFeature,visibility){if(routeFeature instanceof OpenLayers.Feature&&JQ.isArray(routeFeature.segmentLabels)&&routeFeature.segmentLabels.length>0){var layer=routeFeature.layer;JQ.each(routeFeature.segmentLabels,function(idx,labelFeature){if(labelFeature.type==="Segment Label"){labelFeature.showLabel=visibility;layer.drawFeature(labelFeature);}});}};AWUtils.getRouteVertexType=function(vertex){var retVal;if(vertex&&vertex.geometry){const vertexIdx=vertex.geometry.index;if(vertexIdx==='alt1'){retVal=Location.TYPE.ALT1;}else if(vertexIdx==='alt2'){retVal=Location.TYPE.ALT2;}else if(vertex.geometry.name==="virtual"){retVal=Location.TYPE.WPT;}else{retVal=FlightPlan.getIndexType(vertexIdx);}}return retVal;};function getAircraftVerticalAngle(ias,iasUnit,rate,rateUnit){var horizontalSpeed=AWUtils.calculateSpeed(ias,iasUnit);var verticalSpeed=AWUtils.calculateSpeed(rate,rateUnit);var length=Math.sqrt((verticalSpeed*verticalSpeed)+(horizontalSpeed*horizontalSpeed));return Math.asin(verticalSpeed/length);};function getAircraftClimbAngle(aircraft){return getAircraftVerticalAngle(aircraft.iasClimb,aircraft.iasClimbUnit,aircraft.climbRate,aircraft.climbRateUnit);};function getAircraftDescentAngle(aircraft){return getAircraftVerticalAngle(aircraft.iasDesc,aircraft.iasDescUnit,aircraft.descentRate,aircraft.descentRateUnit);};AWUtils.addLeadingZero=function(str,max){str=str.toString();return str.length<max?AWUtils.addLeadingZero("0"+str,max):str;};AWUtils.string=function(num,char){var retVal="";if(num>0){for(var i=0;i<num;i++){retVal+=char;}}return retVal;};AWUtils.createSecurityManagerInfoMsg=function(data,xhr){var dataArr=data.split(",");var details=null;var text=getLocalizedString("Messages.unavailableFnc");if(dataArr.length===1){text=getLocalizedString("Messages.csrfProtection");details=(xhr)?"Request: "+xhr.responseURL:null;}else if(dataArr.length>1){var limit=dataArr[1];if(parseInt(limit)===0){text=getLocalizedString("Messages.disabledFnc");details="Function: "+dataArr[0];}else{text=getLocalizedString("Messages.securityViolation");details="Function: "+dataArr[0]+"<br>Limit: "+limit+"<br>Interval: "+dataArr[2]+" sec.";}}return{text:text,details:details};};AWUtils.applyFunction=function(owner,func,params){if(isUndefinedOrIsNull(func)){debug("Can not apply undefined function!");}else if(typeof func==='function'){return func.apply(owner,params);}else{debug("Can not apply function "+func.toString());}};AWUtils.invokeLater=function(func,params,timeout){timeout=timeout||50;return setTimeout(function(){AWUtils.applyFunction(null,func,params);},timeout);};AWUtils.isElementInViewport=function(el){var parent=JQ(el).parent();parent=(parent.length>0)?parent[0]:window;if(typeof jQuery==="function"&&el instanceof jQuery){el=el[0];}var rect=el.getBoundingClientRect();return(rect.top>=0&&rect.left>=0&&rect.bottom<=(parent.innerHeight||document.documentElement.clientHeight)&&rect.right<=(parent.innerWidth||document.documentElement.clientWidth));};AWUtils.scrollToElementIfNeeded=function(el){if(typeof jQuery==="function"&&el instanceof jQuery){el=el[0];}if(AWUtils.isElementInViewport(el)===false){el.scrollIntoView();}};AWUtils.getProviderInfoTag=function(){var retVal=JQ('<div id="appInfo_provider">');var name=JQ('<span id="appInfo_provider_name">');var tel=JQ('<span id="appInfo_provider_tel">');var nameLabel=JQ('<span id="appInfo_provider_nameLabel">Provider:</span');var nameText=JQ('<a id="appInfo_provider_nameText">ANSP</a>');var telLabel=JQ('<span id="appInfo_provider_telLabel">Tel:</span>');var telText=JQ('<span id="appInfo_provider_telText">');const termsFile=getConfigValue("termsFile");nameLabel.attr(AWLocale.LOCALISATION_KEY,'Desktop.provider.name.label');nameText.attr(AWLocale.LOCALISATION_KEY,'Desktop.provider.name.text');telLabel.attr(AWLocale.LOCALISATION_KEY,'Desktop.provider.tel.label');telText.attr(AWLocale.LOCALISATION_KEY,'Desktop.provider.tel.text');nameLabel.attr(AWLocale.COUNTRY_CODE_DEPEND_KEY,true);nameText.attr(AWLocale.COUNTRY_CODE_DEPEND_KEY,true);telLabel.attr(AWLocale.COUNTRY_CODE_DEPEND_KEY,true);telText.attr(AWLocale.COUNTRY_CODE_DEPEND_KEY,true);name.append(nameLabel);name.append(nameText);tel.append(telLabel);tel.append(telText);retVal.append(name);retVal.append(tel);if(termsFile&&AppController&&AppController.aisWeb){const terms=JQ('<span id="appInfo_provider_terms">');terms.attr(AWLocale.LOCALISATION_KEY,'Desktop.termsAndConditions');retVal.append(terms);terms.on("click",(evt)=>{const winMan=AppController.controlPanel.getWindowManager();const content=JQ('<div class="termsContent">');const form=winMan.createForm("termsPanel","Desktop.termsAndConditions",content);content.load(termsFile);form.fitHeightToPage();winMan.showForm(form,AwWinMan.AREA.CENTER,true);});}return retVal;};AWUtils.getGdprInfoTag=function(name,ext){var id="appInfo_gdpr";var pageUrl=function(){return"./gdpr/"+name+"_"+AWLocale.currentAbbr+"."+ext+"?"+new Date().getTime();};return AWUtils.getNewPageTag(id,'Desktop.gdpr.label',pageUrl);};AWUtils.getNewPageTag=function(id,localeKey,pageUrlFunct){var retVal=JQ('<div></div>');var label=JQ('<a>Open new page</a>');label.attr(AWLocale.LOCALISATION_KEY,localeKey);label.attr('href','#');label.attr('id',id+"_label");retVal.attr('id',id);retVal.append(label);label.on("click",function(e){var actualPage=JQ.mobile.activePage;var newPage=AWUtils.createNewPage(id,pageUrlFunct);if(newPage){JQ('body').append(newPage);newPage.on("pagehide",function(e){if(JQ.mobile.activePage.attr("id")===actualPage.attr("id")){newPage.remove();}});newPage.data("prevPage",actualPage);JQ.mobile.changePage(newPage,{transition:'slide'});}});return retVal;};AWUtils.createNewPage=function(id,pageUrlFunct){if(typeof pageUrlFunct==="function"){var retVal=JQ('<div data-role="page" class="data-page">');var header=JQ('<div data-role="header" data-position="fixed"></div>');var content=JQ('<div data-role="content"></div>');var backBtn=JQ('<a data-icon="back" data-iconpos="notext">Back</a>');header.append(backBtn);retVal.append(header);retVal.append(content);retVal.attr('id',id+"_page");backBtn.click(function(){var page=retVal.data("prevPage");JQ.mobile.changePage(page,{transition:'slide',reverse:true});});content.load(pageUrlFunct());}return retVal;};AWUtils.getDisclaimerContainer=function(name,ext,closeBtn){var retVal=JQ('<div id="disclaimer_container">');var textDiv=JQ('<div id="disclaimer_container_text">');var loadText=function(){textDiv.load("./disclaimer/"+name+"_"+AWLocale.currentAbbr+"."+ext+"?"+new Date().getTime());};if(AWLocale.currentAbbr){loadText();}JQ(document).on(AWLocale.EVENT.LOCALE_CHANGED,function(e,abbr){loadText();});if(closeBtn===true){var closeBtn=JQ('<a class="ui-btn-icon-right ui-icon-delete"></a>');retVal.append(closeBtn);closeBtn.click(function(){retVal.hide();retVal.trigger("hide");});}retVal.append(textDiv);return retVal;};AWUtils.createServerMessagesContainer=function(text){var msgDiv=JQ('<div id="messagesDiv"></div>');var msgMarquee=JQ('<div class="marquee"></div>');var msgTextP=JQ('<p>');var msgDivClose=JQ('<a class="messagesDiv-closeBtn ui-icon-delete ui-btn-icon-right"></a>');msgDiv.hide();msgMarquee.append(msgTextP);msgDiv.append(msgMarquee);msgDiv.append(msgDivClose);AWUtils.showServerMessage(msgDiv,text);msgDivClose.on("click",function(e){AWUtils.showServerMessage(msgDiv,"",false);});JQ(document).on(AWLocale.EVENT.LOCALE_CHANGED,function(abbr){msgTextP.text(AWUtils.getCurrentServerMessage(msgDiv));});return msgDiv;};AWUtils.showServerMessage=function(msgDiv,message,stat){var marq=msgDiv.find('.marquee p');msgDiv.data('rawMsg',message);if((message&&message.length>0)||stat===true){msgDiv.slideDown(800);}else if(stat===false){msgDiv.slideUp(800);}marq.text(AWUtils.getCurrentServerMessage(msgDiv));};AWUtils.getCurrentServerMessage=function(msgDiv){var retVal;if(msgDiv&&msgDiv instanceof jQuery){retVal=msgDiv.data('rawMsg');try{var jsonMsg=JSON.parse(retVal);retVal=jsonMsg[AWLocale.currentAbbr];retVal=retVal||jsonMsg[Object.keys(jsonMsg)[0]];}catch(e){}}return retVal;};AWUtils.getLocaleKeyWithCountryCodeDepends=function(countryCode,key){var ccdLocaleKey=`${key}.${countryCode}`;return(countryCode&&AWLocale.isDefinedKey(ccdLocaleKey))?ccdLocaleKey:key;};AWUtils.b64toBlob=function(b64Data,contentType,sliceSize){contentType=contentType||'';sliceSize=sliceSize||512;var byteCharacters=atob(b64Data);var byteArrays=[];for(var offset=0;offset<byteCharacters.length;offset+=sliceSize){var slice=byteCharacters.slice(offset,offset+sliceSize);var byteNumbers=new Array(slice.length);for(var i=0;i<slice.length;i++){byteNumbers[i]=slice.charCodeAt(i);}var byteArray=new Uint8Array(byteNumbers);byteArrays.push(byteArray);}return new Blob(byteArrays,{type:contentType});};var tableSortOrdering={};var upSortingCharKey='upSortingChar';var downSortingCharKey='downSortingChar';var upSortingChar='';var downSortingChar='';function sortTable(aTableSelector,aThElement,aSortFunction){return;var rows;var n=aThElement.prevAll().length;if(aTableSelector.jquery){rows=aTableSelector.find('tbody tr').get();}else{rows=JQ(aTableSelector+' tbody  tr').get();}var thId=aThElement.attr('id');if(thId in tableSortOrdering===false){tableSortOrdering[thId]=-1;}tableSortOrdering[thId]=tableSortOrdering[thId]*-1;var f=tableSortOrdering[thId];var sortingChar='';var thContent=aThElement.html();if(f<0&&aThElement.attr(upSortingCharKey)!==undefined&&aThElement.attr(upSortingCharKey)!==false){thContent=thContent.replace(aThElement.attr(downSortingCharKey),'');sortingChar=aThElement.attr(upSortingCharKey);}else if(aThElement.attr(downSortingCharKey)!==undefined&&aThElement.attr(downSortingCharKey)!==false){thContent=thContent.replace(aThElement.attr(upSortingCharKey),'');sortingChar=aThElement.attr(downSortingCharKey);}clearSortingCharsExceptElement(aThElement);sortingChar=sortingChar.trim();thContent=(''+thContent).trim();aThElement.html(thContent+' '+sortingChar);if(isUndefinedOrIsNull(aSortFunction)===false){rows.sort(function(a,b){return aSortFunction(a,b,n,f);});}else{rows.sort(function(a,b){var A=JQ(a).children('td').eq(n).text().toUpperCase();var B=JQ(b).children('td').eq(n).text().toUpperCase();if(A<B){return-1*f;}if(A>B){return 1*f;}return 0;});}JQ.each(rows,function(index,row){JQ(aTableSelector).children('tbody').append(row);});AWUtils.markEvenTableRows(JQ(aTableSelector));}AWUtils.markEvenTableRows=function(jTable){jTable=(jTable instanceof jQuery)?jTable:JQ(jTable);jTable.find('tr:visible').each(function(index,row){if(index%2===0){JQ(row).addClass("even");}else{JQ(row).removeClass("even");}});};clearSortingCharsExceptElement=function(aThElement){var thId=aThElement.attr("id");var thParent=aThElement.parent();var allThElements=thParent.find("th");for(var i=0;i<allThElements.length;i++){var iThElement=JQ(allThElements[i]);if(isUndefinedOrIsNull(iThElement)===true){continue;}if(iThElement.attr("id")===thId){continue;}var iThContent=iThElement.html();iThContent=iThContent.replace(iThElement.attr(downSortingCharKey),'');iThContent=iThContent.replace(iThElement.attr(upSortingCharKey),'');iThElement.html(iThContent);}};tabs=function(aId,aTabsArray){var retVal=div(null);retVal.attr('data-role','tabs');retVal.attr('id',aId);var navbarDiv=createNavBarDiv(aTabsArray);retVal.append(navbarDiv);var tabContentDivs=createTabContentDivs(aTabsArray);for(var i=0;i<tabContentDivs.length;i++){var iTabContent=tabContentDivs[i];retVal.append(iTabContent);}return retVal;};function TabModel(){this.id;this.name;this.content;this.clickAction;};createNavBarDiv=function(aTabsArray){var retVal=div();retVal.attr('data-role','navbar');var ulElement=ul(null);var isSelectedFirstButton=false;for(var i=0;i<aTabsArray.length;i++){var iTab=aTabsArray[i];if(isUndefinedOrIsNull(iTab)===true){continue;}var tabId=iTab.id;var tabName=iTab.name;var tabButton=createTabButton(tabId,tabName);if(isSelectedFirstButton===false){tabButton.find('a').attr('class','ui-btn-active');isSelectedFirstButton=true;}if(isUndefinedOrIsNull(iTab.clickAction)===false){tabButton.click(iTab.clickAction);}ulElement.append(tabButton);}retVal.append(ulElement);return retVal;};createTabButton=function(tabId,tabName){var linkElement=a('#'+tabId,tabName);linkElement.attr('data-ajax','false');var retValLi=li(linkElement);return retValLi;};createTabContentDivs=function(aTabsArray){var retValArray=[];for(var i=0;i<aTabsArray.length;i++){var iTab=aTabsArray[i];var contentDiv=div(null);contentDiv.attr('id',iTab.id);contentDiv.attr('class','ui-body-d ui-content');contentDiv.append(iTab.content);retValArray.push(contentDiv);}return retValArray;};table=function(aContent,aTableId){var tableElement=element('table',aContent);tableElement.attr('id',aTableId);return tableElement;};thead=function(aContent){var theadElement=element('thead',aContent);return theadElement;};tr=function(aContent){return element('tr',aContent);};td=function(aContent,aWidth){var retVal=element('td',aContent);if(isUndefinedOrIsNull(aWidth)===false){retVal.attr('style','width: '+aWidth+';');}return retVal;};centeredTd=function(aContent,aWidth){var retVal=td(aContent,aWidth);var currentStyle=isUndefinedOrIsNull(retVal.attr('style'))?'':retVal.attr('style');retVal.attr('style',currentStyle+'text-align: center;');return retVal;};ul=function(aContent){return element('ul',aContent);};li=function(aContent){return element('li',aContent);};a=function(aHref,aContent){var retVal=element('a',aContent);retVal.attr('href',aHref);return retVal;};createComplexSortableTh=function(aContent,aBeforeSortFunction,aAfterSortFunction,aSortFunction){var retVal=element('th',aContent);var nextSortableThId=getNextSortableThId();retVal.attr('id',nextSortableThId);retVal.attr(AWLocale.LOCALISATION_KEY,aContent);return retVal;};createSortableTh=function(aContent){return createComplexSortableTh(aContent,null,null,null);};createComplexSortTableFunction=function(aThId,aBeforeSortFunction,aAfterSortFunction,aSortFunction){var sortTableFunction=function(){var thElement=JQ('#'+aThId);sortTable('#'+(thElement.parents('table').attr('id')),thElement,aSortFunction);};var complexSortableFunction=function(){var thElement=JQ('#'+aThId);if(isUndefinedOrIsNull(aBeforeSortFunction)===false){aBeforeSortFunction();}sortTableFunction();if(isUndefinedOrIsNull(aAfterSortFunction)===false){aAfterSortFunction(thElement);}};return complexSortableFunction;};createCollapsibleContent=function(aId,aTitle,aContent){var filtersDiv=JQ('<div id="'+aId+'" data-role="collapsible" data-inset="true" data-collapsed="false" style="width:100%;"></div>');var titleHeader=JQ("<h3>"+aTitle+"</h3>");titleHeader.attr(AWLocale.LOCALISATION_KEY,aTitle);filtersDiv.append(titleHeader);filtersDiv.append(aContent);return filtersDiv;};var currentSortableThIdNumber=0;getNextSortableThId=function(){return'sortablethid'+currentSortableThIdNumber++;};divGridA=function(aContent){var retValDiv=div(aContent);retValDiv.attr('class','ui-grid-a');return retValDiv;};divGridB=function(aContent){var retValDiv=div(aContent);retValDiv.attr('class','ui-grid-b');return retValDiv;};divGridC=function(aContent){var retValDiv=div(aContent);retValDiv.attr('class','ui-grid-c');return retValDiv;};divGridD=function(aContent){var retValDiv=div(aContent);retValDiv.attr('class','ui-grid-d');return retValDiv;};twoRowedDivGridSolo=function(aRow1,aRow2){var blockA=divBlockA(aRow1);blockA.append(aRow2);var retValDiv=divGridSolo(blockA);return retValDiv;};divBlockA=function(aContent){var retValDiv=div(aContent);retValDiv.attr('class','ui-block-a');return retValDiv;};divBlockB=function(aContent){var retValDiv=div(aContent);retValDiv.attr('class','ui-block-b');return retValDiv;};divBlockC=function(aContent){var retValDiv=div(aContent);retValDiv.attr('class','ui-block-c');return retValDiv;};divBlockD=function(aContent){var retValDiv=div(aContent);retValDiv.attr('class','ui-block-d');return retValDiv;};divBlockE=function(aContent){var retValDiv=div(aContent);retValDiv.attr('class','ui-block-e');return retValDiv;};divGridSolo=function(aContent){var retValDiv=div(aContent);retValDiv.attr('class','ui-grid-solo');return retValDiv;};div=function(aContent){return element('div',aContent);};span=function(aContent){return element('span',aContent);};element=function(aName,aContent){var tag=JQ('<'+aName+'></'+aName+'>');if(aContent!==null){tag.append(aContent);}return tag;};createButton=function(aText,aId,aOnclickAction){var retVal=JQ('<input value="'+aText+'" type="button" id="'+aId+'">');retVal.click(aOnclickAction);retVal.attr(AWLocale.LOCALISATION_KEY,aText);return retVal;};createTextInput=function(aPlaceHolder,aId){var placeHolder='';if(aPlaceHolder!==null){placeHolder=aPlaceHolder;}var textInput=JQ('<input name="" id="'+aId+'" value="" placeholder="'+placeHolder+'" type="text">');textInput.attr(AWLocale.LOCALISATION_KEY,aPlaceHolder);return textInput;};labelSuffix='_label';createLabel=function(aText,aForId){var label=JQ('<label id="'+aForId+labelSuffix+'" for="'+aForId+'">'+aText+'</label>');label.attr(AWLocale.LOCALISATION_KEY,aText);return label;};function zeroPad(num,places){var zero=places-num.toString().length+1;return Array(+(zero>0&&zero)).join("0")+num;}AWUtils.formatDateToAisMobile=function(aDate,aFormatAsUtc){if(isUndefinedOrIsNull(aDate)===true){return'';}if(isUndefinedOrIsNull(aFormatAsUtc)===true){aFormatAsUtc=true;}if(aDate instanceof Date===false){aDate=new Date(aDate.toString());}return(''+(aFormatAsUtc===true?aDate.getUTCFullYear():aDate.getFullYear())).substring(2)+''+zeroPad(((aFormatAsUtc===true?aDate.getUTCMonth():aDate.getMonth())+1),2)+''+zeroPad((aFormatAsUtc===true?aDate.getUTCDate():aDate.getDate()),2)+' '+zeroPad((aFormatAsUtc===true?aDate.getUTCHours():aDate.getHours()),2)+':'+zeroPad((aFormatAsUtc===true?aDate.getUTCMinutes():aDate.getMinutes()),2);};AWUtils.formatDate=function(aDate,utcFlag,referenceDate){var retVal=JQ("<span></span>");try{var today=new Date();today.setHours(0,0,0,0);var referenceTime=new Date(referenceDate);referenceTime.setHours(0,0,0,0);referenceTime=referenceTime.getTime();var yesterday=new Date();yesterday.setHours(0,0,0,0);yesterday.setDate(yesterday.getDate()-1);var tomorrow=new Date();tomorrow.setHours(0,0,0,0);tomorrow.setDate(tomorrow.getDate()+1);var year=(utcFlag===true)?aDate.getUTCFullYear():aDate.getFullYear();var month=(utcFlag===true)?aDate.getUTCMonth():aDate.getMonth();var day=(utcFlag===true)?aDate.getUTCDate():aDate.getDate();var time=new Date(year,month,day).getTime();if(referenceTime!==time){if(today.getTime()===time){var span=JQ("<span>Today<span>");span.attr(AWLocale.LOCALISATION_KEY,"Common.today");retVal.append(span);}else if(yesterday.getTime()===time){var span=JQ("<span>Yesterday<span>");span.attr(AWLocale.LOCALISATION_KEY,"Common.yesterday");retVal.append(span);}else if(tomorrow.getTime()===time){var span=JQ("<span>Tomorrow<span>");span.attr(AWLocale.LOCALISATION_KEY,"Common.tomorrow");retVal.append(span);}else{retVal.append(zeroPad(day,2)+"."+zeroPad((month+1),2)+"."+year);}}retVal.data('date',aDate);}catch(e){retVal=aDate;}return retVal;};AWUtils.formatDateTime=function(aDate,utcFlag,referenceDate){var retVal=AWUtils.formatDate(aDate,utcFlag,referenceDate);try{var hrs=(utcFlag===true)?aDate.getUTCHours():aDate.getHours();var minutes=(utcFlag===true)?aDate.getUTCMinutes():aDate.getMinutes();retVal.append(' '+zeroPad(hrs,2)+':'+zeroPad(minutes,2));}catch(e){retVal=aDate;}return retVal;};AWUtils.formatDateTimeInterval=function(aDateTimeFrom,aDateTimeTo,utcFlag,showZoneInfo){var rv=[AWUtils.formatDateTime(aDateTimeFrom,utcFlag)," - ",AWUtils.formatDateTime(aDateTimeTo,utcFlag,aDateTimeFrom)];if(showZoneInfo){rv.push(AWUtils.formatTimeZone(utcFlag));}return rv;};AWUtils.formateDateToHHmmss=function(aDateTimeFrom){if(AWUtils.isString(aDateTimeFrom)===false){return'';}var timeStr=aDateTimeFrom.split('T')[1];if(AWUtils.isUndefinedOrIsNullOrIsEmptyString(timeStr)===true){return'';}return timeStr.substring(0,timeStr.length-1);};AWUtils.formatTimeZone=function(utcFlag){var retVal=JQ('<span>');retVal.addClass("rs-timeZone-info");retVal.attr(AWLocale.LOCALISATION_KEY,(utcFlag)?"Common.utcTime":"Common.localTime");return retVal;};AWUtils.changeTimeZone=function(dateTimeElement,utcFlag){if(dateTimeElement!==undefined&&dateTimeElement instanceof jQuery){var dateTime=dateTimeElement.data('date');if(dateTime!==undefined){var newElem=AWUtils.formatDateTime(dateTime,utcFlag);dateTimeElement.text(newElem.text());}}};AWUtils.convertDateToUtc=function(aDate){var retVal;var year=aDate.getFullYear();var month=aDate.getMonth()+1;var day=aDate.getDate();var hrs=aDate.getHours();var minutes=aDate.getMinutes();var seconds=aDate.getSeconds();retVal=new Date(year+'-'+AWUtils.addLeadingZero(month,2)+'-'+AWUtils.addLeadingZero(day,2)+'T'+AWUtils.addLeadingZero(hrs,2)+':'+AWUtils.addLeadingZero(minutes,2)+':'+AWUtils.addLeadingZero(seconds,2)+'Z');return retVal;};AWUtils.convertDateFromUtc=function(aDate){var retVal=new Date(aDate);retVal.setUTCSeconds(aDate.getTimezoneOffset()*60);return retVal;};AWUtils.isTimeFormatCorrect=function(aTimeHHcolonMM){return AWUtils.isStringCorrectByRegexp(aTimeHHcolonMM,/^[0-2][0-9][:][0-5][0-9]$/);};AWUtils.isDateFormatCorrect=function(aDateYYYYdashMMdashDD){return AWUtils.isStringCorrectByRegexp(aDateYYYYdashMMdashDD,/^[0-9][0-9][0-9][0-9]-[0-1][0-9]-[0-3][0-9]$/);};AWUtils.isSameDate=function(date1,date2,utcFlag=false){const day1=(utcFlag)?date1.getUTCDay():date1.getDay();const day2=(utcFlag)?date2.getUTCDay():date2.getDay();return Math.abs(date1-date2)<(1000*3600*24)&&day1===day2;};AWUtils.isStringCorrectByRegexp=function(aTestString,aRegexp){if(AWUtils.isUndefinedOrIsNullOrIsEmptyString(aTestString)===true){return false;}var patt=new RegExp(aRegexp);var res=patt.test(aTestString);return res;};AWUtils.convertMph2Kts=function(aMph){return Math.round(aMph*0.868976242);};AWUtils.getUrlParams=function(prop){var params={};var search=decodeURIComponent(window.location.href.slice(window.location.href.indexOf('?')+1));var definitions=search.split('&');definitions.forEach(function(val,key){var parts=val.split('=',2);params[parts[0]]=parts[1];});return(prop&&prop in params)?params[prop]:params;};AWUtils.featureType={DRAWING:"drawing",FPL_ROUTE:"Fpl-Route",SYNOP_STATION:"SYNOP Station",USER_POINT:"UserPoint",DRONE_ZONE:"Drone Zone",NO_DRONE_ZONE:"No Drone Zone",ZONE:"Zone"};AWUtils.createFeatureFromUserPoint=function(userPoint){var map=AppController.aisWeb.getMap();var ll=new OpenLayers.LonLat(userPoint.lng,userPoint.lat).transform("EPSG:4326",map.getProjectionObject());var geom=new OpenLayers.Geometry.Point(ll.lon,ll.lat);var attrs={label:userPoint.txt_name,name:userPoint.txt_name,location:AwCoordinates.formatLonLat(ll,AwCoordinates.FORMAT.DD_MM_SS_ss," "),location_str:userPoint.lat_lng_str,remark:userPoint.txt_rmk};var retVal=new OpenLayers.Feature.Vector(geom,attrs);retVal.type=AWUtils.featureType.USER_POINT;return retVal;};AWUtils.getPPI=function(){var DOM_body=document.getElementsByTagName('body')[0];var DOM_div=document.createElement('div');DOM_div.style='width: 1in; visibility:hidden;';DOM_body.appendChild(DOM_div);var w=DOM_div.offsetWidth*window.devicePixelRatio;DOM_body.removeChild(DOM_div);return parseInt(w);};AWUtils.showFullScreenViewer=function(element,extraClass){var fullScreenView=JQ('<div class="full-screen-view"></div>');fullScreenView.html(element.cloneNode(true));fullScreenView.appendTo(JQ.mobile.activePage);if(typeof extraClass!=="undefined"){fullScreenView.addClass(extraClass);}fullScreenView.click(function(e){JQ(this).remove();delete this;});};AWUtils.prototype.loadedLibraryNames;AWUtils.loadedLibraryNames=[];AWUtils.libraryLoader=function(rootDir,version,cssArr,scriptArr){var retVal;rootDir=rootDir||"";if(cssArr!==null&&JQ.isArray(cssArr)){JQ.each(cssArr,function(index,name){var ls=document.createElement('link');ls.rel="stylesheet";ls.href=rootDir+name;ls.type="text/css";if(version){ls.href+="?"+version;}document.getElementsByTagName('head')[0].appendChild(ls);});}if(scriptArr){var _arr;if(JQ.isArray(scriptArr)===false){scriptArr=[scriptArr];}_arr=JQ.map(scriptArr,function(scr){var retVal=0;var scrExtName=(scr.startsWith("/"))?"."+scr:rootDir+scr;if(version){scrExtName+="?"+version;}if(AWUtils.loadedLibraryNames.indexOf(scr)===-1){retVal=JQ.ajax({dataType:"script",url:scrExtName,dataFilter:function(data,status,next){return data.replace('"use strict";',"");}});AWUtils.loadedLibraryNames.push(scr);}return retVal;});_arr.push(JQ.Deferred(function(deferred){JQ(deferred.resolve);}));retVal=JQ.when.apply(JQ,_arr);}return retVal;};AWUtils.formatBytes=function(bytes,precision){var units=['B','KB','MB','GB','TB'];precision=precision||2;bytes=Math.max(bytes,0);var pow=Math.floor((bytes?Math.log(bytes):0)/Math.log(1024));pow=Math.min(pow,units.length-1);bytes/=Math.pow(1024,pow);return Math.round(bytes,precision)+' '+units[pow];};AWUtils.showTooltip=function(o){if(window.enableTooltips!==false){var el=JQ(o.target);var item=el.closest(".tooltip-item");var ttElement=item.children(".tooltip-text").clone();if((o.target.innerText!==ttElement.text())||(o.target.offsetWidth<o.target.scrollWidth)){var globEl=JQ('<div class="tooltip-container tooltip-item"></div>');var pos=el.offset();var rex=pos.left+ttElement.outerWidth();globEl.append(ttElement);JQ('body').append(globEl);if(item.closest(".bottom-tooltip").length>0){const width=ttElement.outerWidth();globEl.addClass('bottom-tooltip');pos.top+=el.outerHeight();pos.left-=-(el.outerWidth()/2)+(width/2);if(pos.left<0){const dist=pos.left*-1;pos.left=5;ttElement.addClass('moved-right-tooltip');}else if(pos.left+width>window.innerWidth){pos.left=window.innerWidth-width-5;ttElement.addClass('moved-left-tooltip');}}else if((item.closest(".left-tooltip").length>0)||rex>window.outerWidth){globEl.addClass('left-tooltip');pos.top-=-(el.outerHeight()/2)+(ttElement.outerHeight()/2);pos.left-=ttElement.outerWidth();}else{pos.top-=-(el.outerHeight()/2)+(ttElement.outerHeight()/2);pos.left+=el.outerWidth();}globEl.css({left:pos.left,top:pos.top});ttElement.css("visibility",'visible');}}};AWUtils.hideTooltip=function(o){JQ('body .tooltip-container').remove();};AWUtils.addLocalizedTooltip=function(object,localeKey){var tip=JQ('<span class="tooltip-text"></span>');if(localeKey){tip.attr(AWLocale.LOCALISATION_KEY,localeKey);tip.text(getLocalizedString(localeKey));}object.append(tip);object.addClass("tooltip-item");object.click(AWUtils.hideTooltip);object.hover(AWUtils.showTooltip,AWUtils.hideTooltip);};AWUtils.removeLocalizedTooltip=function(object){var tip=JQ(object).find('span');tip.remove();object.removeClass("tooltip-item");object.unbind('click');object.unbind('mouseenter mouseleave');};AWUtils.disableSpecialCharsInUserRequest=function(obj){var str=obj.val();var re=/([<>'"])/g;var subst='';if(re.test(str)){JQMUtil.showInfoMsg(getLocalizedString('Common.forbiddenChars'),true);obj.val(str.replace(re,subst));}};function checkAndConvertToUpperCase(aValue){if(isUndefinedOrIsNull(aValue)===true){aValue='';}else{aValue=aValue.toUpperCase();}return aValue;}AWUtils.makeCRCTable=function(){var c;var crcTable=[];for(var n=0;n<256;n++){c=n;for(var k=0;k<8;k++){c=((c&1)?(0xEDB88320^ (c>>>1)):(c>>>1));}crcTable[n]=c;}return crcTable;};AWUtils.crc32=function(str){var crcTable=AWUtils.makeCRCTable();var crc=0^ (-1);for(var i=0;i<str.length;i++){crc=(crc>>>8)^ crcTable[(crc^ str.charCodeAt(i))&0xFF];}return(crc^ (-1))>>>0;};AWUtils.createRandomHash=function(){return Math.random().toString(36).substr(2,7).toUpperCase();};AWUtils.createCommonListItem=function(data,hash,id){const retVal=JQ("<div id="+id+"></div>");const notamListText=JQ("<pre>");try{notamListText.html(data);notamListText.find('*').removeAttr('style');retVal.append(notamListText);if(notamListText.text().length>3){const actions=JQ('<div class="notam_actions">');const hid=hash+"_"+id;actions.append('<label for="notamAddToReport-'+hid+'" localisationkey="MessageViewer.addToReport">Add to report</label>');actions.append('<input id="notamAddToReport-'+hid+'" class="notam_add_to_report" type="checkbox" checked="checked">');retVal.append(actions);}}catch(e){debug("Error while creating list item element with id: "+id);notamListText.text("<error>");}return retVal;};AWUtils.createNotamListItem=function(notamObj,map,hash,id){var retVal;var actions;retVal=AWUtils.createCommonListItem(notamObj.description,hash,id);retVal.data('notamObj',notamObj);if(notamObj.code!==undefined){var code=JQ(notamObj.code).text();if(code.length>0){retVal.attr('code',code);}}if(notamObj.status){retVal.addClass("notam-status-"+notamObj.status.toLowerCase());}actions=retVal.find('.notam_actions');if(notamObj.getOLFeature&&notamObj.getOLFeature(map.baseLayer.projection)){var hid=hash+"_"+id;var chkboxId="notam-chkbox-"+hid;var chkbox=JQ('<input id="'+chkboxId+'" type="checkbox">');var label=JQ('<label for="'+chkboxId+'">Show on map</label>');label.attr('localisationkey','FeatureInfoPanel.showOnMap');label.text(getLocalizedString('FeatureInfoPanel.showOnMap'));chkbox.data('notamObj',notamObj);actions.append(chkbox);actions.append(label);chkbox.change(function(){var no=JQ(this).data('notamObj');var featureObj=no.getOLFeature(map.baseLayer.projection);if(featureObj!==null){featureObj.hoverInfo=no.desc;if(JQ(this).is(":checked")){AppController.aisWeb.addNotamFeature(featureObj);}else{AppController.aisWeb.removeNotamFeature(featureObj);}}});}AWLocale.processLocalisationOnJQElement(actions);return retVal;};AWUtils.getNilInfo=function(){return'<span class="fi-nil-info">NIL</span>';};AWUtils.createNotamListGui=function(notamList){var retVal=JQ('<div class="aftn-message-preview notam-list"></div>');var aisWeb=AppController.aisWeb;var hash=AWUtils.createRandomHash();var nlSize=notamList.length;var map=aisWeb.getMap();retVal.attr('hash',hash);retVal.append(AWUtils.createNotamLegend());if(nlSize===0||(nlSize===1&&!(notamList[0].code||notamList[0].ad_code))){retVal.append(AWUtils.getNilInfo());}else{for(var i=0;i<nlSize;i++){var notamObj=notamList[i];var notamListItem=AWUtils.createNotamListItem(notamObj,map,hash,i);notamListItem.appendTo(retVal);}}AWLocale.processLocalisationOnJQElement(retVal);return retVal;};AWUtils.createNotamListActionsGui=function(notamList,showSelectAll){var retVal=JQ('<div class="notam_list_actions"></div>');var hash=AWUtils.createRandomHash();var reportButton=JQ('<button id="notamReport_'+hash+'" class="notam_report ui-btn ui-corner-all" localisationkey="MessageViewer.reportBtn">Report</button>');retVal.append(reportButton);retVal.attr('hash',hash);if(showSelectAll!==false){var selId="notamSelectAll_"+hash;var selectAll=JQ('<input id="'+selId+'" class="notam_select_all" type="checkbox" checked="checked">');retVal.append(selectAll);retVal.append('<label for="'+selId+'" localisationkey="MessageViewer.selectAll">Select All</label>');selectAll.change(function(){var b=selectAll.is(":checked");notamList.find(".notam-list > div").each(function(idx,notamDiv){JQ(notamDiv).find('.notam_add_to_report').prop("checked",b).checkboxradio("refresh");});});}AWLocale.processLocalisationOnJQElement(retVal);return retVal;};AWUtils.createReportForNotamList=function(notamList,titleKey,preInfo){var formId="notamReportPanel_"+AWUtils.createRandomHash();var winMan=AppController.controlPanel.getWindowManager();var form=winMan.createDocumentViewerForm(formId,titleKey,null,"application/pdf");var htmlReport=JQ('<div></div>');var title=getLocalizedString(titleKey);var elems=notamList.find(".notam-list > div");var appendToZone=true;var actWin=winMan.getActualForm(AwWinMan.AREA.CENTER);if(actWin!==undefined){appendToZone=(actWin.id.indexOf("notamReportPanel_")!==0);}form.fitHeightToPage();form.loading(true);winMan.showForm(form,AwWinMan.AREA.CENTER,appendToZone);if(preInfo!==undefined){htmlReport.append(preInfo);}if(elems.length===0){elems=notamList.find(".notam-list > pre");}elems.each(function(idx,notamDiv){var jNotamDiv=JQ(notamDiv);var selector=jNotamDiv.find('.notam_add_to_report');if(jNotamDiv.is(":visible")&&(selector.length===0||(selector.is(":checked")))){var pre=jNotamDiv.find("pre");if(pre.length>0){var el=JQ("<pre>");el.html(pre.html());htmlReport.append(el);}}});AWDataHandler.convertHtml2Pdf(htmlReport,title,function(pdfData){form.loading(false);if(pdfData!==null&&pdfData!==undefined){var url="data:application/pdf;base64,"+pdfData;form.setSrc(url);}else{JQMUtil.showInfoMsg(getLocalizedString("Common.msg.serverNotResponding"),true);}});};AWUtils.createNotamLegend=function(){const retVal=JQ("<div>");const label=JQ('<label>');const values=JQ('<div>');const publishedVal=JQ("<div>");const activatedVal=JQ("<div>");label.attr(AWLocale.LOCALISATION_KEY,"NotamMode.colorLegend");retVal.append(label);AWLocale.localizeJqElement(publishedVal,"NotamMode.valid");AWLocale.localizeJqElement(activatedVal,"NotamMode.effective");publishedVal.addClass("notam-status-published");activatedVal.addClass("notam-status-activated");values.append(publishedVal);values.append(activatedVal);values.addClass("notam-colorLegend-values");retVal.append(values);retVal.addClass("notam-colorLegend");return retVal;};function printElement(element,title){var printWindow=window.open('','','height=400,width=800');var divContents=(element instanceof jQuery)?element.html():element;var footerText="R-SYS  2022, AISWeb "+AppController.appVersion+AppController.appRevision;title=(title===undefined)?"":title;printWindow.document.write('<html><head><title>'+title+'</title>');printWindow.document.write('</head><body >');printWindow.document.write(divContents);printWindow.document.write('<footer>'+footerText+'</footer>');printWindow.document.write('</body></html>');printWindow.document.close();printWindow.print();}var choosingPointFromMapButtonId=null;var choosingPointFromMapCallBackFnc=null;AWUtils.createChoosePointFromMapButton=function(aButtonID,aCallBackFunction){choosingPointFromMapButtonId=aButtonID;const applyFunction=function(){var chooseFromMapButton=JQ(HtmlUtils.C_HASHTAG_CHAR+choosingPointFromMapButtonId);chooseFromMapButton.attr('chooseFromMap','true');localeObject(HtmlUtils.C_HASHTAG_CHAR+choosingPointFromMapButtonId,'Common.clickToMap');chooseFromMapButton.button('disable');AppController.aisWeb.getMapLonLatOnClick(function(lonLat){disableChoosePointFromMap();aCallBackFunction(AwCoordinates.formatLonLat(lonLat,AwCoordinates.FORMAT.DD_MM_SS_ss," "));});};return createButton("Common.chooseFromMap",choosingPointFromMapButtonId,applyFunction);};function disableChoosePointFromMap(){var buttonIDSelector=HtmlUtils.C_HASHTAG_CHAR+choosingPointFromMapButtonId;var chooseFromMapButton=JQ(buttonIDSelector);chooseFromMapButton.attr('chooseFromMap','false');chooseFromMapButton.button('enable');localeObject(buttonIDSelector,'Common.chooseFromMap');};AWUtils.cloneObject=function(aObject){return JQ.extend(true,{},aObject);};AWUtils.getSdoObject=function(featureType,featureVersion,projection,filter,callback){if(featureType.length>0){var wfsProt=new OpenLayers.Protocol.WFS({version:getConfigValue3("sources","sdoWfs","version","1.1.0"),url:getConfigValue3("sources","sdoWfs","url","http://localhost/wfs"),featureNS:"http://www.r-sys.sk/rgis",featurePrefix:"rgis",srsName:projection,maxFeatures:500,featureType:(JQ.isArray(featureType))?featureType.join(" "):featureType,formatOptions:{singleFeatureType:false},featureVersion:featureVersion});return wfsProt.read({filter:filter,callback:function(data){if(data&&data.features){JQ.each(data.features,function(idx,f){f.source=Location.SOURCE.SDO;});}callback.call(wfsProt.options,data);}});}else{debug("Can not load SDO features. No types defined.");}};AWUtils.createWfsFulltextFilter=function(sdoTypes,text,worldWideFlag){var retVal;var filters=[];var val=text.toLocaleUpperCase();var allAttrs={};JQ.each(sdoTypes,function(i,t){var typeItem=RsAisOws.searchSdoKeyForType(t);JQ.each(typeItem.attrs,function(i,aName){allAttrs[aName]="";});});JQ.each(Object.keys(allAttrs),function(index,attr){var hasProperty=new OpenLayers.Filter.Function({type:'FUNCTION',name:"hasFeatureTypeProperty",params:[attr]});var like=AWUtils.createWfsComparisonFilter(attr,OpenLayers.Filter.Comparison.LIKE,val);var and=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[hasProperty,like]});filters.push(and);});retVal=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR,filters:filters});if(!worldWideFlag){var center=AppController.aisWeb.getMap().getCenter();var areaFilter=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.DWITHIN,value:new OpenLayers.Geometry.Point(center.lon,center.lat),distance:getConfigValue('searchAreaDistance',500),distanceUnits:'km',property:"Geometry"});retVal=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[retVal,areaFilter]});}return retVal;};AWUtils.getMapCenterConfiguration=function(){var lon=getConfigValue2("mapCenter","lon",2183888);var lat=getConfigValue2("mapCenter","lat",6203865);return new OpenLayers.LonLat(lon,lat);};AWUtils.createWfsComparisonFilter=function(propertyName,type,value){var retVal;value=value.replace(/\./g,"\\.");retVal=new OpenLayers.Filter.Comparison({type:type,matchCase:false,property:propertyName,value:"*"+value+"*"});return retVal;};AWUtils.createWfsWaypointFilter=function(text,worldWideFlag){var val=text.toLocaleUpperCase();var filter=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR,filters:[AWUtils.createWfsComparisonFilter("TXT_NAME",OpenLayers.Filter.Comparison.LIKE,val),AWUtils.createWfsComparisonFilter("CODE_ID",OpenLayers.Filter.Comparison.LIKE,val)]});if(!worldWideFlag){var center=AppController.aisWeb.getMap().getCenter();var areaFilter;if(!center){center=AWUtils.getMapCenterConfiguration();}areaFilter=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.DWITHIN,value:new OpenLayers.Geometry.Point(center.lon,center.lat),distance:getConfigValue('searchAreaDistance',700),distanceUnits:'km',property:"Geometry"});filter=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[filter,areaFilter]});}return filter;};AWUtils.createGpsLocation=function(name,lonLat){var loc=new Location(name);loc.setLatitude(lonLat.lat);loc.setLongitude(lonLat.lon);loc.source=Location.SOURCE.GPS;return loc;};AWUtils.searchMapObject=function(e,ui,callback,options){var _instance=e.target;var $ul=JQ(_instance),$input=JQ(ui.input),value=$input.val();var ulHeader=JQ('<div class="ui-header ui-bar-inherit"></div>');var closeBtn=JQ('<a role="button" href="#" class="ui-btn ui-corner-all ui-btn-left ui-btn-icon-notext ui-icon-delete">Close</a>');$ul.html("");$ul.hide();ulHeader.append('<h1 class="ui-title">'+$input.attr('placeholder')+'</h1>');ulHeader.append(closeBtn);var closeFnc=function(event){$input.val(latinize($input.val().toUpperCase()));if(event.keyCode===27||event.type==='vclick'){$ul.html("");$ul.hide();$input.focus();}};$input.on('keyup',closeFnc);closeBtn.on('vclick',closeFnc);if(_instance.lastWfsResponse!==undefined){_instance.lastWfsResponse.priv.abort();if(_instance.lastXhr!==undefined){_instance.lastXhr.abort();delete _instance.lastXhr;}}var coord=AwCoordinates.parseLonLat(value);if(coord!==undefined){var iconObj=$ul.prev().find(".ui-btn-icon-notext");iconObj.removeClass("ui-icon-delete").addClass("ui-icon-loading");setTimeout(function(){$ul.html(ulHeader);var label=AwCoordinates.formatLonLat(coord,AwCoordinates.FORMAT.DD_MM_SS_ss," ");var li=JQ('<li data-icon="location"><a href="#">'+label+'</a></li>');var finish=function(name){var loc;var lonLat=coord.clone();$input.val(name);$ul.html("");$ul.hide();lonLat.transform("EPSG:4326",AppController.aisWeb.getMap().getProjectionObject());loc=AWUtils.createGpsLocation(name,lonLat);loc.wgs=coord;if(typeof callback==="function"){callback(loc);}};$ul.append(li);$ul.listview("refresh");$ul.show();li.click(function(e){if(options&&options.disableGpsName){finish(value);}else{AppController.aisWeb.createGpsLocationName(coord,function(name){finish(name);},value);}});iconObj.removeClass("ui-icon-loading").addClass("ui-icon-delete");},200);}else if(value&&value.length>1){var iconObj=$ul.prev().find(".ui-btn-icon-notext");var syncCnt=0;var resultSync=function(){syncCnt--;if(syncCnt===0){if($ul.find("li").length>0){$ul.show();$ul.listview("refresh");$ul.trigger("updatelayout");}iconObj.removeClass("ui-icon-loading").addClass("ui-icon-delete");ulHeader.removeClass("ui-screen-hidden");$ul.find('li').removeClass('ui-first-child');}};iconObj.removeClass("ui-icon-delete").addClass("ui-icon-loading");$ul.html(ulHeader);if(AppController.bundleController.isBundleConfigured("userPoints")){syncCnt++;AppController.bundleController.getBundle("userPoints",bundle=>{if(bundle){AWDataHandler.getUserPointListByName(value+"%",function(pointList){if(pointList!==null&&pointList.IsError==="false"&&pointList.UserPoints!==undefined){var upa=UserPointsController.getUserPointsArray(pointList);JQ.each(upa,function(index,userPoint){var li=JQ('<li data-icon="location"></li>');var content=JQ('<a href="#">'+userPoint.txt_name+'</a>');var type=JQ('<p>User Point</p>');type.attr(AWLocale.LOCALISATION_KEY,'UserPointsPanel.PointsList');content.append(type);li.attr('type',AWUtils.featureType.USER_POINT);li.append(content);li.prop("userPoint",userPoint);$ul.append(li);});$ul.find('li[type="'+AWUtils.featureType.USER_POINT+'"]').click(function(e){var userPoint=this.userPoint;var lonLat=new OpenLayers.LonLat(parseFloat(userPoint.lng),parseFloat(userPoint.lat)).transform("EPSG:4326",AppController.aisWeb.getMap().getProjectionObject());$input.val(userPoint.txt_name);$ul.html("");$ul.hide();var loc=new Location(userPoint.txt_name);loc.setLatitude(lonLat.lat);loc.setLongitude(lonLat.lon);loc.source=Location.SOURCE.USER_PNT;loc.feature=AWUtils.createFeatureFromUserPoint(userPoint);if(typeof callback==="function"){callback(loc);}});}resultSync();});}else{resultSync();}});}if(options&&options.wfsFilter&&options.wfsFilter instanceof OpenLayers.Filter&&options.sdoTypes){let projection=RsAisOws.getProjectionForTypes(options.sdoTypes);syncCnt++;_instance.lastWfsResponse=AWUtils.getSdoObject(options.sdoTypes,AppController.appTime.getTime().toISOString(),projection,options.wfsFilter,function(response){delete _instance.lastWfsResponse;if(response.features!==null&&response.features.length>0){var wfsFeatures=response.features;if(options.wfsCompareFunction){wfsFeatures.sort(options.wfsCompareFunction);}JQ.each(wfsFeatures,function(i,feature){var desc=RsAisOws.getSdoObjectDescription(feature);var decType=AWUtils.decodeAixmFeatureType(feature);var label=RsAisOws.getObjectName(feature);var pos=feature.geometry;pos.name=label;var li=JQ('<li data-icon="location" type="wfs"></li>');var content=JQ('<a href="#"></a>');content.append('<h2>'+desc+'</h2>');content.append('<p>'+decType+'</p>');li.append(content);li.data("feature",feature);li.attr("aixm-type",feature.type);$ul.append(li);if(options.wfsClientFilter){const filterRes=options.wfsClientFilter(li);li.toggleClass("featureSelectorList-filteredItem",filterRes);}feature.attributes={label:label};});$ul.find('li[type="wfs"]').click(function(e){var feature=JQ(this).data("feature");$input.val(feature.attributes.label);$ul.html("");$ul.hide();var geom=feature.geometry;var loc=new Location(feature.attributes.label);loc.setLatitude(geom.y);loc.setLongitude(geom.x);loc.source=Location.SOURCE.SDO;loc.feature=feature;if(feature.data!==undefined&&feature.data.CODE_ID!==undefined&&feature.data.CODE_ID.length>0&&feature.attributes.label!==feature.data.CODE_ID){loc.codeId=feature.data.CODE_ID;}if(typeof callback==="function"){callback(loc);}AWUtils.scrollToElementIfNeeded($input);});}resultSync();});}else{if(!options.sdoTypes){debug("AWUtils::searchMapObject can not send WFS request, because types not defined!");}if(!options.wfsFilter){debug("AWUtils::searchMapObject can not send WFS request, because filter not defined!");}iconObj.removeClass("ui-icon-loading").addClass("ui-icon-delete");}}else{$ul.find('li').removeClass('ui-first-child');}};AWUtils.downloadFile=function(filename,data){var element=document.createElement('a');element.setAttribute('href','data:text/plain;charset=utf-8,'+encodeURIComponent(data));element.setAttribute('download',filename);element.style.display='none';document.body.appendChild(element);element.click();document.body.removeChild(element);};AWUtils.btoa=function(string){var buffer=new TextEncoder().encode(string);var binary=[];var bytes=new Uint8Array(buffer);for(var i=0,il=bytes.byteLength;i<il;i++){binary.push(String.fromCharCode(bytes[i]));}return btoa(binary.join(''));};AWUtils.sleep=function(milliseconds){var start=new Date().getTime();for(var i=0;i<1e7;i++){if((new Date().getTime()-start)>milliseconds){break;}}};AWUtils.cutAllWordsToMaxlength=function(aMsg,aMaxWordLength){var retVal=HtmlUtils.C_EMPTY;if(HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(aMsg)){return retVal;}var splitedMsg=aMsg.split(HtmlUtils.C_SPACE_CHAR);var cutedArray=[];for(var i=0;i<splitedMsg.length;i++){var iMsgItem=splitedMsg[i];var splitedMsgItem=iMsgItem.split(HtmlUtils.C_SLASH_CHAR);var cutedItems=[];for(var j=0;j<splitedMsgItem.length;j++){var iMsgItemPart=splitedMsgItem[j];if(iMsgItemPart.length>aMaxWordLength){iMsgItemPart=iMsgItemPart.substring(0,aMaxWordLength);}cutedItems.push(iMsgItemPart);}iMsgItem=cutedItems.join(HtmlUtils.C_SLASH_CHAR);cutedArray.push(iMsgItem);}retVal+=cutedArray.join(HtmlUtils.C_SPACE_CHAR);return retVal;};AWUtils.isUndefinedOrIsNullOrIsEmptyString=function(aObject){if(AWUtils.isUndefinedOrIsNull(aObject)||(HtmlUtils.C_EMPTY+aObject).trim().length<=0){return true;}return false;};AWUtils.isUndefinedOrIsNull=function(aObject){if((parseInt(aObject)===Number.NaN&&!aObject)||aObject===undefined||aObject===null||aObject==='UNDEFINED'){return true;}return false;};AWUtils.parseOnlyTimeOfDateInMinutes=function(aInputString){if(HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(aInputString)){return HtmlUtils.C_EMPTY;}var splitedDateTime=aInputString.split(HtmlUtils.C_SPACE_CHAR);var time=splitedDateTime[1];var hours=time.split(HtmlUtils.C_COLON)[0];var minutes=time.split(HtmlUtils.C_COLON)[1];return((hours*60)+(minutes*1));};AWUtils.parseDateTimeToWellFormat=function(aInputString){if(HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(aInputString)){return HtmlUtils.C_EMPTY;}var splitedDateTime=aInputString.split(HtmlUtils.C_SPACE_CHAR);var date=splitedDateTime[0];var retVal=HtmlUtils.C_EMPTY;retVal+='20'+date[0]+date[1];retVal+=HtmlUtils.C_DASH;retVal+=+date[2]+date[3];retVal+=HtmlUtils.C_DASH;retVal+=+date[4]+date[5];retVal+='T';retVal+=splitedDateTime[1];return retVal;};AWUtils.parseDateTimeToHHMM=function(aInputString){if(HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(aInputString)){return HtmlUtils.C_EMPTY;}var splitedDateTime=aInputString.split(HtmlUtils.C_SPACE_CHAR);var splitedTime=splitedDateTime[1].split(HtmlUtils.C_COLON);var retVal=HtmlUtils.C_EMPTY;retVal+=splitedTime[0]+HtmlUtils.C_EMPTY+splitedTime[1];return retVal;};AWUtils.enumFromString=function(enumType,value,defaultValue){var retVal=defaultValue;var vals=Object.values(enumType);if(vals!==undefined&&value!==undefined){for(var i=0;i<vals.length;i++){if(vals[i]===value){retVal=vals[i];}}}return retVal;};AWUtils.createFormHint=function(id,message){const retVal=JQ('<div id="'+id+'_hint" class="rs-hint"></div>');retVal.prop('origId',id);if(message){AWUtils._setupFormHintElementMessage(retVal,message);retVal.data("default",message);}return retVal;};AWUtils.getFormHintElement=function(id){return JQ('#'+id+'_hint');};AWUtils.showFormHintText=function(id,message,errorFlag=true){const text=(typeof message==="object"&&message.text!==undefined)?message.text:getLocalizedString(message);const el=AWUtils.getFormHintElement(id);AWUtils._setupFormHintElementMessage(el,message);el.toggleClass("rs-error-hint",errorFlag);};AWUtils.resetFormHintText=function(id){const el=AWUtils.getFormHintElement(id);const text=el.data("default");AWUtils._setupFormHintElementMessage(el,text);el.toggleClass("rs-error-hint",false);};AWUtils._setupFormHintElementMessage=function(el,message){if(el){el.removeAttr(AWLocale.LOCALISATION_KEY);if(message){if(typeof message==="string"){el.attr(AWLocale.LOCALISATION_KEY,message);AWLocale.processLocalisationOnJQElement(el);}else if(typeof message==="object"&&message.text!==undefined){el.text(message.text);}}else{el.text("");}}};AWUtils.setChangeListenerToLevelSetter=function(aUnitSelect,aValueInput){aUnitSelect.change(function(){var parentValue=JQ(this).val();if(parentValue==='VFR'){var previousVal=aValueInput.val();if(AWUtils.isUndefinedOrIsNullOrIsEmptyString(previousVal)===false){aValueInput.previousVal=previousVal;}else{aValueInput.previousVal=null;}aValueInput.val('');aValueInput.prop('disabled',true);aValueInput.parent().addClass('ui-state-disabled');}else{if(AWUtils.isUndefinedOrIsNull(aValueInput.previousVal)===false){aValueInput.val(aValueInput.previousVal);aValueInput.previousVal=null;}aValueInput.prop('disabled',false);aValueInput.parent().removeClass("ui-state-disabled");}});};AWUtils.isCurrentUserAroSupervisor=function(){var u=AppController.currentLogin;return AWUtils.isUserAroSupervisor(u);};AWUtils.isCurrentUserPilotHOMEBRIEFING=function(){var u=AppController.currentLogin;return AWUtils.isUserPilotHOMEBRIEFING(u);};AWUtils.isUserAroSupervisor=function(aUser){return AWUtils.isUserOfType(aUser,6);};AWUtils.isUserPilotHOMEBRIEFING=function(aUser){return AWUtils.isUserOfType(aUser,2);};AWUtils.isUserOfType=function(aUser,aUserTypeId){if(AWUtils.isUndefinedOrIsNull(aUser)===true||AWUtils.isUndefinedOrIsNull(aUserTypeId)===true){return false;}if(parseInt(aUser.userTypeId)===aUserTypeId){return true;}else{return false;}};AWUtils.getShowOneLetterEquipmentsCfg=function(){return getConfigValue2('fplForm','showOneLetterEquipments',false);};AWUtils.isShowPPRColumnEnabled=function(){return getConfigValue2('flightPlans','showPPRColumn',true);};AWUtils.isAddRmkPhone2OtherInfoEnabled=function(){return getConfigValue('addRmkPhone2OtherInfo',false);};AWUtils.isAddRmkPhone2OtherInfo_NOT_EditableEnabled=function(){return getConfigValue2('fplForm','addRmkPhone2OtherInfo_NOT_Editable',false);};AWUtils.isAddRmkPhone2OtherInfoEditableEnabled=function(){return getConfigValue2('fplForm','addRmkPhone2OtherInfoEditable',false);};AWUtils.convertHHMM2Minutes=function(aHHMMTime){if(AWUtils.isUndefinedOrIsNullOrIsEmptyString(aHHMMTime)===true||(HtmlUtils.C_EMPTY+aHHMMTime).length<4){return aHHMMTime;}var splitedHHMM=aHHMMTime.split("");var hoursTen2Minutes=parseInt(splitedHHMM[0])*600;var hours2Minutes=parseInt(splitedHHMM[1])*60;var tenMinutes=parseInt(splitedHHMM[2])*10;var minutes=parseInt(splitedHHMM[3]);return hoursTen2Minutes+hours2Minutes+tenMinutes+minutes;};AWUtils.convertMinutes2HHMM=function(aMinutes){if(AWUtils.isUndefinedOrIsNullOrIsEmptyString(aMinutes)===true){return aMinutes;}var minutesInt=parseInt(aMinutes);if(minutesInt<60){return zeroPad(minutesInt,4);}var hours=parseInt(HtmlUtils.C_EMPTY+(minutesInt/60));var minutes=minutesInt-(hours*60);return zeroPad(hours,2)+HtmlUtils.C_EMPTY+zeroPad(minutes,2);};AWUtils.convertYYYY_MM_DD2YYMMDD=function(aYYYY_MM_DD){if(AWUtils.isUndefinedOrIsNullOrIsEmptyString(aYYYY_MM_DD)===true||aYYYY_MM_DD.length<10){return aYYYY_MM_DD;}var splitedDate=aYYYY_MM_DD.split("-");if(splitedDate.length<3){return aYYYY_MM_DD;}var year=splitedDate[0];var splitedYear=year.split("");var mm=splitedDate[1];var dd=splitedDate[2];return splitedYear[splitedYear.length-2]+HtmlUtils.C_EMPTY+splitedYear[splitedYear.length-1]+HtmlUtils.C_EMPTY+mm+HtmlUtils.C_EMPTY+dd;};AWUtils.parseYYMMDD=function(dateStr){var retVal;if(dateStr&&dateStr.length===6){const actYYYY=new Date().getFullYear();const actYY=actYYYY%100;var y=parseInt(dateStr.substring(0,2))%100;var m=parseInt(dateStr.substring(2,4))-1;var d=dateStr.substring(4,6);var rvYYYY=(actYYYY-actYY)+y;if(rvYYYY<actYY){rvYYYY+=100;}retVal=new Date(rvYYYY,m,d);}return retVal;};AWUtils.removeDoubleSpaces=function(aString){if(AWUtils.isUndefinedOrIsNullOrIsEmptyString(aString)===true){return aString;}return AWUtils.removeDoubleChars(aString,HtmlUtils.C_SPACE_CHAR);};AWUtils.removeDoubleChars=function(aString,aSearchChar){var doubleChar=aSearchChar+aSearchChar;while(aString.indexOf(doubleChar)>=0){aString=aString.replace(doubleChar,aSearchChar);}return aString;};AWUtils.removeCharsArround=function(aString,aRemovedChar,aArroundChar){if(AWUtils.isUndefinedOrIsNullOrIsEmptyString(aString)===true||AWUtils.isUndefinedOrIsNullOrIsEmptyString(aRemovedChar)===true||AWUtils.isUndefinedOrIsNullOrIsEmptyString(aArroundChar)===true){return aString;}while(aString.includes(aRemovedChar+aArroundChar)===true){aString=aString.replace(aRemovedChar+aArroundChar,aArroundChar);}while(aString.includes(aArroundChar+aRemovedChar)===true){aString=aString.replace(aArroundChar+aRemovedChar,aArroundChar);}return aString;};AWUtils.isArray=function(aArray){if(AWUtils.isUndefinedOrIsNull(aArray)===true){return false;}return JQ.isArray(aArray);};AWUtils.isEmptyString=function(aString){if(AWUtils.isUndefinedOrIsNull(aString)===false&&AWUtils.isString(aString)===true&&(HtmlUtils.C_EMPTY+aString).trim()===HtmlUtils.C_EMPTY){return true;}else{return false;}};AWUtils.isNotEmptyString=function(aString){if(AWUtils.isString(aString)===true&&aString!==HtmlUtils.C_EMPTY){return true;}else{return false;}};AWUtils.isString=function(aText){return AWUtils.isTypeOf(aText,"");};AWUtils.isBoolean=function(aBool){return AWUtils.isTypeOf(aBool,true);};AWUtils.isObject=function(aObject){return AWUtils.isTypeOf(aObject,Object.create({}));};AWUtils.isRsForm=function(aRsForm){return AWUtils.isTypeOf(aRsForm,new RsForm());};AWUtils.isTypeOf=function(aObject,aCheckTypeObject){if(AWUtils.isUndefinedOrIsNull(aObject)===true){return false;}return(typeof(aObject)===typeof(aCheckTypeObject))?true:false;};AWUtils.parseField18IndicatorAttributes=function(aF18Content,aIndicatorName){if(AWUtils.isUndefinedOrIsNullOrIsEmptyString(aIndicatorName)===true||AWUtils.isUndefinedOrIsNullOrIsEmptyString(aF18Content)===true){return[];}var indicatorContent=AWUtils.parseField18IndicatorContent(aF18Content,aIndicatorName);indicatorContent=AWUtils.removeDoubleSpaces(indicatorContent);indicatorContent=AWUtils.removeCharsArround(indicatorContent,' ','/');indicatorContent=indicatorContent.trim();if(AWUtils.isUndefinedOrIsNullOrIsEmptyString(indicatorContent)===true){return[];}return indicatorContent.split(HtmlUtils.C_SPACE_CHAR);};AWUtils.parseField18IndicatorContent=function(aF18Content,aIndicatorName){var retVal=HtmlUtils.C_EMPTY;if(AWUtils.isUndefinedOrIsNullOrIsEmptyString(aIndicatorName)===true||AWUtils.isUndefinedOrIsNullOrIsEmptyString(aF18Content)===true){return retVal;}var indicatorName=(HtmlUtils.C_EMPTY+aIndicatorName).trim();if(indicatorName.endsWith(HtmlUtils.C_SLASH_CHAR)===false){indicatorName+=HtmlUtils.C_SLASH_CHAR;}var splitedByIndicatorName=aF18Content.split(indicatorName);if(splitedByIndicatorName.length<=1){return retVal;}var afterIndicatorString=(HtmlUtils.C_EMPTY+splitedByIndicatorName[1]).trim();var indicatorContentsArray=afterIndicatorString.split(HtmlUtils.C_SLASH_CHAR);if(indicatorContentsArray.length<=1){return indicatorContentsArray[0];}var indicatorContentDirty=indicatorContentsArray[0];indicatorContentDirty=AWUtils.removeDoubleSpaces(indicatorContentDirty);var splitedDirtyContent=indicatorContentDirty.split(HtmlUtils.C_SPACE_CHAR);splitedDirtyContent.pop();return splitedDirtyContent.join(HtmlUtils.C_SPACE_CHAR).trim();};AWUtils.removeField18IndicatorWithContent=function(f18OtherData,aIndicatorName){var retVal=AWUtils.replaceAllStrings('/ ','/',f18OtherData);retVal=AWUtils.replaceAllStrings(' /','/',retVal);var indicatorsContent=AWUtils.parseField18IndicatorContent(retVal,aIndicatorName);retVal=retVal.replace(aIndicatorName+'/'+indicatorsContent,'');return retVal;};AWUtils.replaceAllStrings=function(aSearchedString,aReplacingString,aContentString){while(aContentString.includes(aSearchedString)===true){aContentString=aContentString.replace(aSearchedString,aReplacingString);}return aContentString;};AWUtils.possibleRmkSlashRegexp=/RMK[ ]*\//i;AWUtils.mergeRMKParts=function(aMsg){var retVal=HtmlUtils.C_EMPTY;var RMKContent=HtmlUtils.C_EMPTY;var NotRMKContent=HtmlUtils.C_EMPTY;var splitedRMKArray=aMsg.split(AWUtils.possibleRmkSlashRegexp);if(splitedRMKArray.length>1){for(var i=0;i<splitedRMKArray.length;i++){var splitedContent=splitedRMKArray[i];if(i===0&&aMsg.trim().startsWith("RMK")===false){NotRMKContent+=HtmlUtils.C_SPACE_CHAR+splitedContent;continue;}var nextItemMatch=splitedContent.match(/[ ]+[a-z,A-Z,0-9]+[ ]*\//i);if(nextItemMatch===null){RMKContent+=HtmlUtils.C_SPACE_CHAR+splitedContent;}else{var indexOfNextItemStart=splitedContent.indexOf(nextItemMatch[0]);RMKContent+=HtmlUtils.C_SPACE_CHAR+splitedContent.substring(0,indexOfNextItemStart);NotRMKContent+=HtmlUtils.C_SPACE_CHAR+splitedContent.substring(indexOfNextItemStart);}}retVal+=HtmlUtils.C_SPACE_CHAR+NotRMKContent.trim();retVal+=HtmlUtils.C_SPACE_CHAR+'RMK/'+RMKContent.trim();}else{retVal+=splitedRMKArray[0];}retVal=AWUtils.removeDoubleSpaces(retVal.trim());return retVal;};AWUtils.parseIntElseZero=function(aValue){var parsedInt=parseInt(aValue);return AWUtils.checkNaNElseZero(parsedInt);};AWUtils.parseFloatElseZero=function(aValue){var parsedFloat=parseFloat(aValue);return AWUtils.checkNaNElseZero(parsedFloat);};AWUtils.checkNaNElseZero=function(aValue){if(AWUtils.isUndefinedOrIsNull(aValue)===true||aValue==='NaN'){aValue=0;}return aValue;};AWUtils.parseIntFullString=function(aValue){if(AWUtils.isEmptyString(aValue)===true){return'NaN';}var splitedString=(aValue+HtmlUtils.C_EMPTY).split("");var isNaN=false;for(var i=0;i<splitedString.length;i++){var iStringChar=splitedString[i];var iCharInt=parseInt(iStringChar);if(iCharInt+HtmlUtils.C_EMPTY==='NaN'){isNaN=true;break;}}if(isNaN===true){return'NaN';}return parseInt(aValue);};AWUtils.getDistanceBetweenPoints=function(aX1,aX2,aY1,aY2){var xRoot=aX2-aX1;xRoot=xRoot*xRoot;var yRoot=aY2-aY1;yRoot=yRoot*yRoot;return Math.sqrt(xRoot+yRoot);};AWUtils.isDrawFUAMerged=function(){return getConfigValue2('flightPlans','drawRouteAndShowFUAInOneBtn',false);};AWUtils.getPreferredValue=function(valuesArr,preferredArr){var retVal;if(valuesArr&&valuesArr.length>0){JQ.each(preferredArr,function(idx1,fmt){JQ.each(valuesArr,function(idx2,val){if(val.indexOf(fmt)>-1){retVal=fmt;return false;}});if(retVal){return false;}});if(!retVal){retVal=valuesArr[0];}}if(!retVal){retVal=preferredArr[0];}return retVal;};AWUtils.addNotNullToArray=function(aArray,aItem){if(AWUtils.isUndefinedOrIsNull(aItem)===true||AWUtils.isUndefinedOrIsNull(aArray)===true){return;}aArray.push(aItem);};AWUtils.getFormatOptionsForSendMessagePreview=function(){var alignPreviewText=AWConfigUtils.getAlignPreviewSendMsg();return{'class':'align-paragraph-text-'+alignPreviewText};};AWUtils.parseAndClearIntegerFormat=function(aNumber){if(AWUtils.isUndefinedOrIsNullOrIsEmptyString(aNumber)===true){return null;}var unformatedNumber=AWUtils.clearNumberFormat(aNumber);return parseInt(unformatedNumber);};AWUtils.clearNumberFormat=function(aNumber){if(AWUtils.isUndefinedOrIsNullOrIsEmptyString(aNumber)===true){return aNumber;}var retVal=''+aNumber;retVal=retVal.replace(/,/g,'');return retVal;};AWUtils.getFilterFunction=function(filterDefinition){var retVal;switch(typeof filterDefinition){case"string":retVal=function(obj){const value=obj.attr("aixm-type");return(filterDefinition.indexOf(value)!==-1);};break;case"object":retVal=function(obj){var rv=false;const f=obj.data("feature");if(f&&filterDefinition.type===obj.attr("aixm-type")){const attrs=(Array.isArray(filterDefinition.attributes))?filterDefinition.attributes:[filterDefinition.attributes];var i=0;rv=true;while(rv&&i<attrs.length){const attrObj=attrs[i];if(attrObj&&attrObj.name&&attrObj.value){const attrVal=(f.getAttribute)?f.getAttribute(attrObj.name):(f.attributes&&f.attributes[attrObj.name])?f.attributes[attrObj.name]:null;if(attrVal){if(attrObj.value instanceof RegExp){rv=attrObj.value.test(attrVal);}else{rv=(attrVal===attrObj.value);}}else{rv=false;}}else{rv=false;}i++;}}return rv;};break;default:}return retVal;};AWUtils.addPibButton=function(aFplId,parentElement){if(AppController.bundleController.isBundleConfigured('pib')){var pibBtn=HtmlUtils.buttonWithTooltip('FplMenu.pib','FplMenu.pib');pibBtn.click(function(){AppController.bundleController.getBundle("pib",function(aBundleInstance){if(aBundleInstance){const buffer=1;aBundleInstance.showPibForFpl(aFplId,buffer,JQ(this).parent().data('fplData'));}});});parentElement.append(pibBtn);}};AWUtils.isHeliportName=function(aName){if((''+aName).match(/EH[0-9]{4}/g)===null){return false;}else{return true;}};AWUtils.addMeteoPibButton=function(parentElement){if(AppController.bundleController.isBundleConfigured('meteopib')===false){return;}var meteoPibBtn=HtmlUtils.buttonWithTooltip('METEO PIB','METEO PIB');meteoPibBtn.click(function(){AppController.bundleController.getBundle("meteopib",function(aBundleInstance){if(AWUtils.isUndefinedOrIsNull(aBundleInstance)===true){debug('Bundle instance of "meteopib" is null!');return;}var fpl=parentElement.data('fplData');aBundleInstance.showMeteoPibForFpl(fpl);});});parentElement.append(meteoPibBtn);};AWUtils.createDrawRouteButtonId=function(aCallSign,fplData){var retVal="drawRouteBtn";retVal+=(aCallSign)?"_"+aCallSign:"";retVal+=(fplData&&fplData.EOBD)?"_"+fplData.EOBD:"";retVal+=(fplData&&fplData.EOBT)?"_"+fplData.EOBT:"";return retVal;};AWUtils.createDrawRouteButton=function(aCallSign,adexpFpl,aDescription,aCallback,aFplData,aFlightPlanObject){var drawRouteBtn;if(AppController.aisWeb){const btnId="drawRouteBtn";drawRouteBtn=HtmlUtils.buttonWithTooltip(AWUtils.LOCALEKEY.FplMenu_drawRouteBtnTitle,AWUtils.LOCALEKEY.FplMenu_drawRouteBtnTooltip);drawRouteBtn.attr("id",AWUtils.createDrawRouteButtonId(aCallSign,aFplData));drawRouteBtn.click(()=>{AWUtils.drawRouteButtonAction(aCallSign,adexpFpl,aDescription,aCallback,aFplData,aFlightPlanObject);});if(AppController.aisWeb.getVisibleFplRoutes().indexOf(aCallSign)===-1){AWUtils.setDrawFUAButtonTextsByConfig(drawRouteBtn);}else{AWUtils.setHideFUAButtonTextsByConfig(drawRouteBtn);}}return drawRouteBtn;};AWUtils.drawRouteButtonAction=function(aCallSign,adexpFpl,aDescription,aCallback,aFplData,aFlightPlanObject){const visRoutes=AppController.aisWeb.getVisibleFplRoutes();const isNotVisible=(visRoutes.indexOf(aCallSign)===-1);const drawRouteBtn=JQ("#"+AWUtils.createDrawRouteButtonId(aCallSign,aFplData));if(isNotVisible){aDescription=aDescription.trim();AppController.aisWeb.showAdexpFplRoute(aCallSign,adexpFpl,aDescription,function(data){AWUtils.setHideFUAButtonTextsByConfig(drawRouteBtn);if(aCallback!==undefined){AWUtils.applyFunction(this,aCallback,["drawRoute",true]);}});if(AWUtils.isDrawFUAMerged()===true){var showFua=FlightPlansController.createShowFuaInConflictClickFnc(aFplData,aFlightPlanObject);showFua();}}else{AWUtils.hideRouteAction(aCallSign,aFplData,aCallback);}};AWUtils.hideRouteAction=function(aCallSign,aFplData,aCallback){const drawRouteBtn=JQ("#"+AWUtils.createDrawRouteButtonId(aCallSign,aFplData));AppController.aisWeb.hideFplRoute(aCallSign);if(AWUtils.isDrawFUAMerged()===true){FlightPlansController.closeVerticalProfileIfOpened();}AWUtils.setDrawFUAButtonTextsByConfig(drawRouteBtn);if(aCallback!==undefined){AWUtils.applyFunction(this,aCallback,["drawRoute",false]);}};AWUtils.setDrawFUAButtonTextsByConfig=function(aButton){var btnTitleLoc=AWUtils.LOCALEKEY.FplMenu_drawRouteBtnTitle;var btnTooltipLoc=AWUtils.LOCALEKEY.FplMenu_drawRouteBtnTooltip;if(AWUtils.isDrawFUAMerged()===true){btnTitleLoc=AWUtils.LOCALEKEY.FplMenu_drawRouteFUABtnTitle;btnTooltipLoc=AWUtils.LOCALEKEY.FplMenu_drawRouteFUABtnTooltip;aButton.removeClass('ui-btn-active');}HtmlUtils.setTooltipedButtonTexts(aButton,btnTitleLoc,btnTooltipLoc);};AWUtils.getTimeOffsetHHMMFromNow=function(aMinutes){var retVal=null;if(AWUtils.isUndefinedOrIsNull(aMinutes)===false){var ataDate=new Date();ataDate.setUTCMinutes(ataDate.getUTCMinutes()+new Number(aMinutes));retVal=zeroPad(ataDate.getUTCHours(),2)+''+zeroPad(ataDate.getUTCMinutes(),2);}return retVal;};AWUtils.getDateOffsetFromNow=function(aDayoffset){var retVal=null;if(AWUtils.isUndefinedOrIsNull(aDayoffset)===false){var ataDate=new Date();ataDate.setUTCDate(ataDate.getUTCDate()+new Number(aDayoffset));retVal=ataDate.getUTCFullYear()+'-'+zeroPad((ataDate.getUTCMonth()+1),2)+'-'+zeroPad(ataDate.getUTCDate(),2);}return retVal;};AWUtils.setHideFUAButtonTextsByConfig=function(aButton){var hidebtnTitleLoc=AWUtils.LOCALEKEY.FplMenu_hideRouteBtnTitle;var hidebtnTooltipLoc=AWUtils.LOCALEKEY.FplMenu_hideRouteBtnTooltip;if(AWUtils.isDrawFUAMerged()===true){hidebtnTitleLoc=AWUtils.LOCALEKEY.FplMenu_hideDrawRouteFUABtnTitle;hidebtnTooltipLoc=AWUtils.LOCALEKEY.FplMenu_hideDrawRouteFUABtnTooltip;aButton.addClass('ui-btn-active');}HtmlUtils.setTooltipedButtonTexts(aButton,hidebtnTitleLoc,hidebtnTooltipLoc);};AWUtils.convertTotalEETMinutesForPDF=function(aMinutes){if(AWUtils.isUndefinedOrIsNull(aMinutes)===true){return HtmlUtils.C_EMPTY;}var parsedTotalEetMinutes=parseInt(aMinutes);if(parsedTotalEetMinutes+''==='NaN'||parsedTotalEetMinutes<=0){return HtmlUtils.C_EMPTY;}return zeroPad(convertMinutesToHHMM(parsedTotalEetMinutes),4);};AWUtils.createNotamModeBar=function(){var retVal=JQ('<div class="map-data-view-toolbar notam-mode-toolbar"></div>');var notamModeSelect=JQ('<select data-role="slider" data-mini="true" class="notam-mode-select" data-highlight="true"></select>');function addOption(notamMode){var opt=JQ("<option>");opt.attr('value',notamMode);opt.attr(AWLocale.LOCALISATION_KEY,"NotamMode."+notamMode);if(AppController.userPrefs.getValue("notamMode")===notamMode){opt.attr('selected',"");}notamModeSelect.append(opt);}addOption(AisWeb.NOTAM_MODES.VALID);addOption(AisWeb.NOTAM_MODES.EFFECTIVE);retVal.hide();retVal.append(notamModeSelect);notamModeSelect.change(function(){var val=notamModeSelect.val();AppController.aisWeb.setupNotamView(true,val);AppController.userPrefs.setValue("notamMode",val);});return retVal;};AWUtils.round=function(num,decPlaces){const factOfTen=Math.pow(10,decPlaces);return Math.round(num*factOfTen)/factOfTen;};AWUtils.cleanStr=function(str){while(str.indexOf("\t")>-1){str=str.replace("\t"," ");}while(str.indexOf("  ")>-1){str=str.replace("  "," ");}return str.trim();};AWUtils.LOCALEKEY={FplMenu_drawRouteBtnTitle:'FplMenu.drawRoute',FplMenu_drawRouteBtnTooltip:'FplMenu.drawRoute',FplMenu_hideRouteBtnTitle:'FplMenu.hideRoute',FplMenu_hideRouteBtnTooltip:'FplMenu.hideRoute',FplMenu_drawRouteFUABtnTitle:'FplMenu.drawRouteFUABtnTitle',FplMenu_drawRouteFUABtnTooltip:'FplMenu.drawRouteFUABtnTooltip',FplMenu_hideDrawRouteFUABtnTitle:'FplMenu.hideDrawRouteFUABtnTitle',FplMenu_hideDrawRouteFUABtnTooltip:'FplMenu.hideDrawRouteFUABtnTooltip'};AWUtils.checkAndGetSurveillanceEquipmentValue=function(aSurvEq1,aSurvEq2){if(HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(aSurvEq1)===true){aSurvEq1=HtmlUtils.C_N;}if(HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(aSurvEq2)===true){aSurvEq2=HtmlUtils.C_N;}var retVal=HtmlUtils.C_EMPTY;if(aSurvEq1===HtmlUtils.C_N&&aSurvEq2===HtmlUtils.C_N){retVal=HtmlUtils.C_N;}else if(aSurvEq1!==HtmlUtils.C_N&&aSurvEq2===HtmlUtils.C_N){retVal=aSurvEq1;}else if(aSurvEq1===HtmlUtils.C_N&&aSurvEq2!==HtmlUtils.C_N){retVal=aSurvEq2;}else{retVal=aSurvEq1+aSurvEq2;}return retVal;};AWUtils.gtmTrackFunction=function(functionName){if(window.dataLayer){const obj={"event":"functionActivated","functionName":functionName};window.dataLayer.push(obj);}};AWUtils.createTimeStampElement=function(){const utcFlag=(JQ("#clockDiv").data("utc")!==undefined);const label=JQ('<span>').attr(AWLocale.LOCALISATION_KEY,"Common.generated");return JQ('<span class="rs-timestamp">').append(label).append(AWUtils.getCurrentTimeString(utcFlag));};AWUtils.countryDataModel={"AF":{"phonePrefix":"93","name":"Afghanistan"},"AL":{"phonePrefix":"355","name":"Albania"},"DZ":{"phonePrefix":"213","name":"Algeria"},"AS":{"phonePrefix":"684","name":"American Samoa"},"AD":{"phonePrefix":"376","name":"Andorra"},"AO":{"phonePrefix":"244","name":"Angola"},"AI":{"phonePrefix":"1264","name":"Anguilla"},"AQ":{"phonePrefix":"672","name":"Antarctica"},"AG":{"phonePrefix":"1268","name":"Antigua and Barbuda"},"AR":{"phonePrefix":"54","name":"Argentina"},"AM":{"phonePrefix":"374","name":"Armenia"},"AW":{"phonePrefix":"297","name":"Aruba"},"AU":{"phonePrefix":"61","name":"Australia"},"AT":{"phonePrefix":"43","name":"Austria"},"AZ":{"phonePrefix":"994","name":"Azerbaijan"},"BS":{"phonePrefix":"1242","name":"Bahamas"},"BH":{"phonePrefix":"973","name":"Bahrain"},"BD":{"phonePrefix":"880","name":"Bangladesh"},"BB":{"phonePrefix":"1246","name":"Barbados"},"BY":{"phonePrefix":"375","name":"Belarus"},"BE":{"phonePrefix":"32","name":"Belgium"},"BZ":{"phonePrefix":"501","name":"Belize"},"BJ":{"phonePrefix":"229","name":"Benin"},"BM":{"phonePrefix":"1441","name":"Bermuda"},"BT":{"phonePrefix":"975","name":"Bhutan"},"BO":{"phonePrefix":"591","name":"Bolivia"},"BA":{"phonePrefix":"387","name":"Bosnia and Herzegovina"},"BW":{"phonePrefix":"267","name":"Botswana"},"BV":{"phonePrefix":"","name":"Bouvet Island"},"BR":{"phonePrefix":"55","name":"Brazil"},"IO":{"phonePrefix":"246","name":"British Indian Ocean Territory"},"VG":{"phonePrefix":"1284","name":"British Virgin Islands"},"BN":{"phonePrefix":"673","name":"Brunei Darussalam"},"BG":{"phonePrefix":"359","name":"Bulgaria"},"BF":{"phonePrefix":"226","name":"Burkina Faso"},"BI":{"phonePrefix":"257","name":"Burundi"},"KH":{"phonePrefix":"855","name":"Cambodia"},"CM":{"phonePrefix":"237","name":"Cameroon"},"CA":{"phonePrefix":"1","name":"Canada"},"CV":{"phonePrefix":"238","name":"Cape Verde"},"KY":{"phonePrefix":"1345","name":"Cayman Islands"},"CF":{"phonePrefix":"236","name":"Central African Republic"},"CC":{"phonePrefix":"61","name":"Cocos (Keeling) Islands"},"CO":{"phonePrefix":"57","name":"Colombia"},"KM":{"phonePrefix":"269","name":"Comoros"},"CG":{"phonePrefix":"242","name":"Congo"},"CD":{"phonePrefix":"243","name":"Congo, (Democratic Republic of the)"},"CK":{"phonePrefix":"682","name":"Cook Islands"},"CR":{"phonePrefix":"506","name":"Costa Rica"},"HR":{"phonePrefix":"385","name":"Croatia"},"CU":{"phonePrefix":"53","name":"Cuba"},"CY":{"phonePrefix":"357","name":"Cyprus"},"CZ":{"phonePrefix":"420","name":"Czech Republic"},"DK":{"phonePrefix":"45","name":"Denmark"},"DJ":{"phonePrefix":"253","name":"Djibouti"},"DM":{"phonePrefix":"1767","name":"Dominica"},"DO":{"phonePrefix":"1809","name":"Dominican Republic"},"TP":{"phonePrefix":"670","name":"East Timor"},"EC":{"phonePrefix":"593","name":"Ecuador"},"EG":{"phonePrefix":"20","name":"Egypt"},"SV":{"phonePrefix":"503","name":"El Salvador"},"GQ":{"phonePrefix":"240","name":"Equatorial Guinea"},"ER":{"phonePrefix":"291","name":"Eritrea"},"EE":{"phonePrefix":"372","name":"Estonia"},"ET":{"phonePrefix":"251","name":"Ethiopia"},"FO":{"phonePrefix":"298","name":"Faroe Islands"},"FJ":{"phonePrefix":"679","name":"Fiji"},"FI":{"phonePrefix":"358","name":"Finland"},"FR":{"phonePrefix":"33","name":"France"},"GA":{"phonePrefix":"241","name":"Gabon"},"GM":{"phonePrefix":"220","name":"Gambia"},"GE":{"phonePrefix":"995","name":"Georgia"},"DE":{"phonePrefix":"49","name":"Germany"},"GH":{"phonePrefix":"233","name":"Ghana"},"GI":{"phonePrefix":"350","name":"Gibraltar"},"GB":{"phonePrefix":"44","name":"Great Britain"},"GR":{"phonePrefix":"30","name":"Greece"},"GL":{"phonePrefix":"299","name":"Greenland"},"GD":{"phonePrefix":"1473","name":"Grenada"},"GP":{"phonePrefix":"590","name":"Guadeloupe"},"GU":{"phonePrefix":"1671","name":"Guam"},"GT":{"phonePrefix":"502","name":"Guatemala"},"GG":{"phonePrefix":"44","name":"Guernsey, Alderney and Sark"},"GN":{"phonePrefix":"224","name":"Guinea"},"GW":{"phonePrefix":"245","name":"Guinea-Bissau"},"GY":{"phonePrefix":"592","name":"Guyana"},"HT":{"phonePrefix":"509","name":"Haiti"},"HM":{"phonePrefix":"","name":"Heard and McDonald Islands"},"HN":{"phonePrefix":"504","name":"Honduras"},"HK":{"phonePrefix":"852","name":"Hong Kong"},"HU":{"phonePrefix":"36","name":"Hungary"},"TD":{"phonePrefix":"235","name":"Chad"},"CL":{"phonePrefix":"56","name":"Chile"},"CN":{"phonePrefix":"86","name":"China"},"CX":{"phonePrefix":"61","name":"Christmas Island"},"IS":{"phonePrefix":"354","name":"Iceland"},"IN":{"phonePrefix":"91","name":"India"},"ID":{"phonePrefix":"62","name":"Indonesia"},"IR":{"phonePrefix":"98","name":"Iran"},"IQ":{"phonePrefix":"964","name":"Iraq"},"IE":{"phonePrefix":"353","name":"Ireland"},"IL":{"phonePrefix":"972","name":"Israel"},"IT":{"phonePrefix":"39","name":"Italy"},"CI":{"phonePrefix":"225","name":"Ivory Coast"},"JM":{"phonePrefix":"1876","name":"Jamaica"},"JP":{"phonePrefix":"81","name":"Japan"},"JE":{"phonePrefix":"44","name":"Jersey"},"JO":{"phonePrefix":"962","name":"Jordan"},"KZ":{"phonePrefix":"7","name":"Kazakhstan"},"KE":{"phonePrefix":"254","name":"Kenya"},"KI":{"phonePrefix":"686","name":"Kiribati"},"KP":{"phonePrefix":"850","name":"Korea, Democratic People's Republic of"},"KR":{"phonePrefix":"82","name":"Korea, Republic of"},"KW":{"phonePrefix":"965","name":"Kuwait"},"KG":{"phonePrefix":"996","name":"Kyrgyzstan"},"LA":{"phonePrefix":"856","name":"Lao People's Democratic Republic"},"LV":{"phonePrefix":"371","name":"Latvia"},"LB":{"phonePrefix":"961","name":"Lebanon"},"LS":{"phonePrefix":"266","name":"Lesotho"},"LR":{"phonePrefix":"231","name":"Liberia"},"LY":{"phonePrefix":"218","name":"Libya"},"LI":{"phonePrefix":"423","name":"Liechtenstein"},"LT":{"phonePrefix":"370","name":"Lithuania"},"LU":{"phonePrefix":"352","name":"Luxembourg"},"MO":{"phonePrefix":"853","name":"Macau"},"MK":{"phonePrefix":"389","name":"Macedonia"},"MG":{"phonePrefix":"261","name":"Madagascar"},"MW":{"phonePrefix":"265","name":"Malawi"},"MY":{"phonePrefix":"60","name":"Malaysia"},"MV":{"phonePrefix":"960","name":"Maldives"},"ML":{"phonePrefix":"223","name":"Mali"},"MT":{"phonePrefix":"356","name":"Malta"},"MH":{"phonePrefix":"692","name":"Marshall Islands"},"MQ":{"phonePrefix":"596","name":"Martinique"},"MR":{"phonePrefix":"222","name":"Mauritania"},"MU":{"phonePrefix":"230","name":"Mauritius"},"YT":{"phonePrefix":"262","name":"Mayotte"},"MX":{"phonePrefix":"52","name":"Mexico"},"FM":{"phonePrefix":"691","name":"Micronesia"},"MD":{"phonePrefix":"373","name":"Moldova"},"MC":{"phonePrefix":"377","name":"Monaco"},"MN":{"phonePrefix":"976","name":"Mongolia"},"MS":{"name":"Monserrat"},"MA":{"phonePrefix":"212","name":"Morocco"},"MZ":{"phonePrefix":"258","name":"Mozambique"},"MM":{"phonePrefix":"95","name":"Myanmar"},"NA":{"phonePrefix":"264","name":"Nambia"},"NR":{"phonePrefix":"674","name":"Nauru"},"NP":{"phonePrefix":"977","name":"Nepal"},"NL":{"phonePrefix":"31","name":"Netherlands"},"AN":{"phonePrefix":"599","name":"Netherlands Antilles"},"NC":{"phonePrefix":"687","name":"New Caledonia"},"NZ":{"phonePrefix":"64","name":"New Zealand"},"NI":{"phonePrefix":"505","name":"Nicaragua"},"NE":{"phonePrefix":"227","name":"Niger"},"NG":{"phonePrefix":"234","name":"Nigeria"},"NU":{"phonePrefix":"683","name":"Niue"},"NF":{"phonePrefix":"672","name":"Norfolk Island"},"MP":{"phonePrefix":"1670","name":"Northern Mariana Islands"},"NO":{"phonePrefix":"47","name":"Norway"},"OM":{"phonePrefix":"968","name":"Oman"},"PK":{"phonePrefix":"92","name":"Pakistan"},"PW":{"phonePrefix":"680","name":"Palau"},"PA":{"phonePrefix":"507","name":"Panama"},"PG":{"phonePrefix":"675","name":"Papua New Guinea"},"PY":{"phonePrefix":"595","name":"Paraguay"},"PE":{"phonePrefix":"51","name":"Peru"},"PH":{"phonePrefix":"63","name":"Philippines"},"PN":{"phonePrefix":"870","name":"Pitcairn"},"PL":{"phonePrefix":"48","name":"Poland"},"PT":{"phonePrefix":"351","name":"Portugal"},"PR":{"phonePrefix":"1","name":"Puerto Rico"},"QA":{"phonePrefix":"974","name":"Qatar"},"RO":{"phonePrefix":"40","name":"Romania"},"RU":{"phonePrefix":"7","name":"Russian Federation"},"RW":{"phonePrefix":"250","name":"Rwanda"},"LC":{"phonePrefix":"1758","name":"Saint Lucia"},"WS":{"phonePrefix":"685","name":"Samoa"},"SM":{"phonePrefix":"378","name":"San Marino"},"ST":{"phonePrefix":"239","name":"Sao Tome and Principe"},"SA":{"phonePrefix":"966","name":"Saudi Arabia"},"SN":{"phonePrefix":"221","name":"Senegal"},"RS":{"phonePrefix":"381","name":"Serbia"},"ME":{"phonePrefix":"382","name":"Montenegro"},"SC":{"phonePrefix":"248","name":"Seychelles"},"SL":{"phonePrefix":"232","name":"Sierra Leone"},"SG":{"phonePrefix":"65","name":"Singapore"},"SK":{"phonePrefix":"421","name":"Slovakia"},"SI":{"phonePrefix":"386","name":"Slovenia"},"SB":{"phonePrefix":"677","name":"Solomon Islands"},"SO":{"phonePrefix":"252","name":"Somalia"},"ZA":{"phonePrefix":"27","name":"South Africa"},"GS":{"phonePrefix":"500","name":"South Georgia"},"ES":{"phonePrefix":"34","name":"Spain"},"LK":{"phonePrefix":"94","name":"Sri Lanka"},"SH":{"phonePrefix":"290","name":"St. Helena"},"KN":{"phonePrefix":"1869","name":"St. Kitts and Nevis"},"VC":{"phonePrefix":"1784","name":"St. Vincent and the Grenadines"},"SD":{"phonePrefix":"249","name":"Sudan"},"SR":{"phonePrefix":"597","name":"Suriname"},"SJ":{"phonePrefix":"47","name":"Svalbard and Jan Mayen Islands"},"SZ":{"phonePrefix":"268","name":"Swaziland"},"SE":{"phonePrefix":"46","name":"Sweden"},"CH":{"phonePrefix":"41","name":"Switzerland"},"SY":{"phonePrefix":"963","name":"Syria"},"TW":{"phonePrefix":"886","name":"Taiwan (Republic of China)"},"TJ":{"phonePrefix":"992","name":"Tajikistan"},"TZ":{"phonePrefix":"255","name":"Tanzania"},"TH":{"phonePrefix":"66","name":"Thailand"},"TG":{"phonePrefix":"228","name":"Togo"},"TK":{"phonePrefix":"690","name":"Tokelau"},"TO":{"phonePrefix":"676","name":"Tonga"},"TT":{"phonePrefix":"1868","name":"Trinidad and Tobago"},"TN":{"phonePrefix":"216","name":"Tunisia"},"TR":{"phonePrefix":"90","name":"Turkey"},"TM":{"phonePrefix":"993","name":"Turkmenistan"},"TC":{"phonePrefix":"1649","name":"Turks and Caicos Islands"},"TV":{"phonePrefix":"688","name":"Tuvalu"},"UG":{"phonePrefix":"256","name":"Uganda"},"UA":{"phonePrefix":"380","name":"Ukraine"},"AE":{"phonePrefix":"971","name":"United Arab Emirates"},"UM":{"phonePrefix":"1","name":"United States Minor Outlying Islands"},"VI":{"phonePrefix":"1340","name":"United States Virgin Islands"},"UY":{"phonePrefix":"598","name":"Uruguay"},"US":{"phonePrefix":"1","name":"USA"},"UZ":{"phonePrefix":"998","name":"Uzbekistan"},"VU":{"phonePrefix":"678","name":"Vanuatu"},"VA":{"phonePrefix":"39","name":"Vatican"},"VE":{"phonePrefix":"58","name":"Venezuela"},"VN":{"phonePrefix":"84","name":"Viet Nam"},"WF":{"phonePrefix":"681","name":"Wallis and Futuna Islands"},"EH":{"phonePrefix":"212","name":"Western Sahara"},"YE":{"phonePrefix":"967","name":"Yemen"},"ZM":{"phonePrefix":"260","name":"Zambia"},"ZW":{"phonePrefix":"263","name":"Zimbabwe"}};function FirData(){this.aup=null;this.notam=null;this.sigmet=null;this.setAup=function(val){this.aup=(val==="true"||val===true)?true:false;};this.getAup=function(){return this.aup;};this.setNotam=function(val){this.notam=(val==="true"||val===true)?true:false;};this.getNotam=function(){return this.notam;};this.setSigmet=function(val){this.sigmet=(val==="true"||val===true)?true:false;};this.getSigmet=function(){return this.sigmet;};this.init=function(jsonObject){this.setAup(jsonObject.aup);this.setNotam(jsonObject.notam);this.setSigmet(jsonObject.sigmet);};}function HtmlUtils(){}HtmlUtils.E_A='a';HtmlUtils.E_BUTTON='button';HtmlUtils.E_BR='br';HtmlUtils.E_DIV='div';HtmlUtils.E_FORM='form';HtmlUtils.E_FONT='font';HtmlUtils.E_HR='hr';HtmlUtils.E_IFRAME='iframe';HtmlUtils.E_IMG='img';HtmlUtils.E_INPUT='input';HtmlUtils.E_LABEL='label';HtmlUtils.E_LI='li';HtmlUtils.E_OPTION='option';HtmlUtils.E_P='p';HtmlUtils.E_SELECT='select';HtmlUtils.E_SPAN='span';HtmlUtils.E_TABLE='table';HtmlUtils.E_TBODY='tbody';HtmlUtils.E_TEXTAREA='textarea';HtmlUtils.E_TD='td';HtmlUtils.E_TR='tr';HtmlUtils.E_UL='ul';HtmlUtils.A_ACTION='action';HtmlUtils.A_ALIGN='align';HtmlUtils.A_CELLPADDING='cellpadding';HtmlUtils.A_CELLSPACING='cellspacing';HtmlUtils.A_COLOR='color';HtmlUtils.A_COLSPAN='colspan';HtmlUtils.A_BORDER='border';HtmlUtils.A_WIDTH='width';HtmlUtils.A_CHECKED='checked';HtmlUtils.A_CLASS='class';HtmlUtils.A_AWINPUTRESTRICTION='awinputrestriction';HtmlUtils.A_FOR='for';HtmlUtils.A_HEIGHT='height';HtmlUtils.A_HREF='href';HtmlUtils.A_HSPACE='hspace';HtmlUtils.A_ID='id';HtmlUtils.A_MAXLENGTH='maxlength';HtmlUtils.A_MULTIPLE='multiple';HtmlUtils.A_TYPE='type';HtmlUtils.A_METHOD='method';HtmlUtils.A_NAME='name';HtmlUtils.A_ONCLICK='onclick';HtmlUtils.A_PADDING_BOTTOM='padding-bottom';HtmlUtils.A_PADDING_TOP='padding-top';HtmlUtils.A_READONLY='readonly';HtmlUtils.A_VALIGN='valign';HtmlUtils.A_VALUE='value';HtmlUtils.A_DATA_CACHEVAL='data-cacheval';HtmlUtils.A_DATA_COLLAPSED='data-collapsed';HtmlUtils.A_DATA_INLINE='data-inline';HtmlUtils.A_DATA_ROLE='data-role';HtmlUtils.A_DATA_REL='data-rel';HtmlUtils.A_DATA_TRANSITION='data-transition';HtmlUtils.A_DATA_NATIVE_MENU='data-native-menu';HtmlUtils.A_DISABLED='disabled';HtmlUtils.A_SIZE='size';HtmlUtils.A_SPELLCHECK='spellcheck';HtmlUtils.A_SRC='src';HtmlUtils.A_STYLE='style';HtmlUtils.A_TARGET='target';HtmlUtils.A_TITLE='title';HtmlUtils.A_VSPACE='vspace';HtmlUtils.A_WIDTH='width';HtmlUtils.AV_0='0';HtmlUtils.AV_1='1';HtmlUtils.AV_7='7';HtmlUtils.AV_10='10';HtmlUtils.AV_100_PERCENT='100%';HtmlUtils.AV_120='120';HtmlUtils.AV_2='2';HtmlUtils.AV_20='20';HtmlUtils.AV_25='25';HtmlUtils.AV_2PX='2px';HtmlUtils.AV_3PX='3px';HtmlUtils.AV_3='3';HtmlUtils.AV_30='30';HtmlUtils.AV_33='33';HtmlUtils.AV_4='4';HtmlUtils.AV_5='5';HtmlUtils.AV_50='50';HtmlUtils.AV_6='6';HtmlUtils.AV_60='60';HtmlUtils.AV_80='80';HtmlUtils.AV_ALERT_FIELD='alert-field';HtmlUtils.AV_AIS_MOBILE_DATE_TIME='aisMobileDateTime';HtmlUtils.AV_BOTTOM='bottom';HtmlUtils.AV_CENTER='center';HtmlUtils.AV_DATA_ROLE='data-role';HtmlUtils.AV_FALSE='false';HtmlUtils.AV_FIELD_CONTAIN='fieldcontain';HtmlUtils.AV_FPL_DESC='fpl_desc';HtmlUtils.AV_FPL_INPUT='fpl_input';HtmlUtils.AV_FPL_SIGN='fpl_sign';HtmlUtils.AV_FPL_WINDOW_FORM='fpl_window_form';HtmlUtils.AV_HIDDEN='hidden';HtmlUtils.AV_CHECKBOX='checkbox';HtmlUtils.AV_LEFT='left';HtmlUtils.AV_MULTIPLE='multiple';HtmlUtils.AV_MULTISELECT='multiselect';HtmlUtils.AV_POPUP='popup';HtmlUtils.AV_RIGHT='right';HtmlUtils.AV_FPL_SECTION='fpl_section';HtmlUtils.AV_SELECT_EMER_RADIO='select-emer-radio';HtmlUtils.AV_SELECT_NOMAR='selectNoMar';HtmlUtils.AV_TEXT_TRANSFORM_UPPERCASE='text-transform: uppercase';HtmlUtils.AV_TOP='top';HtmlUtils.AV_TRUE='true';HtmlUtils.AV_TEXT='text';HtmlUtils.AV_FPL_TD='fpl_td';HtmlUtils.AV_UI_CHECKBOX='ui-checkbox';HtmlUtils.AV_UI_GRID_A='ui-grid-a';HtmlUtils.AV_UI_GRID_B='ui-grid-b';HtmlUtils.AV_UI_GRID_SOLO='ui-grid-solo';HtmlUtils.AV_UI_BLOCK_A='ui-block-a';HtmlUtils.AV_UI_BLOCK_B='ui-block-b';HtmlUtils.AV_UI_BLOCK_C='ui-block-c';HtmlUtils.AV_FPL_VALIDATION_MSG='fpl_validation_msg';HtmlUtils.AV_WARN='warn';HtmlUtils.AV_CLASS_FOCUSEDFPLFORMINPUT='focusedFPLFormInput';HtmlUtils.AV_CLASS_FOCUSEDFPLFORMSELECT='focusedFPLFormSelect';HtmlUtils.AV_CLASS_FOCUSEDFPLFORMA='focusedFPLFormA';HtmlUtils.AV_CLASS_FOCUSEDFPLFORMTEXTAREA='focusedFPLFormTextarea';HtmlUtils.AV_CLASS_TOOLTIPEDBUTTONTEXT='tooltipedButtonText';HtmlUtils.C_CLOSE='close';HtmlUtils.C_COLON=':';HtmlUtils.C_SEMICOLON=';';HtmlUtils.C_CHANGE='change';HtmlUtils.C_DASH='-';HtmlUtils.C_DEFAULT_DATE_PLACEHOLDER='YYYY-MM-DD';HtmlUtils.C_DEFAULT_TIME_PLACEHOLDER='HH:MM';HtmlUtils.C_TIME_PLACEHOLDER_HHMM='HHMM';HtmlUtils.C_DATE_ID_SUFFIX='_date';HtmlUtils.C_EMPTY='';HtmlUtils.C_HASHTAG_CHAR='#';HtmlUtils.C_KEYUP='keyup';HtmlUtils.C_LESS_MORE_CHAR='<';HtmlUtils.C_LABEL_SUFFIX='_label';HtmlUtils.C_MORE_LESS_CHAR='>';HtmlUtils.C_NBSP_ENT='&nbsp;';HtmlUtils.C_REFRESH='refresh';HtmlUtils.C_SLASH_CHAR='/';HtmlUtils.C_SPACE_CHAR=' ';HtmlUtils.C_DOUBLE_SPACE_CHAR='  ';HtmlUtils.C_TIME_ID_SUFFIX='_time';HtmlUtils.C_UNDERSCORE='_';HtmlUtils.C_VALIDATION_SUFFIX='_validation';HtmlUtils.C_VISIBILITY='visibility';HtmlUtils.C_VISIBLE='visible';HtmlUtils.C_DISPLAY='display';HtmlUtils.C_NONE='none';HtmlUtils.C_N='n';HtmlUtils.C_ENABLE='enable';HtmlUtils.C_DISABLE='disable';HtmlUtils.C_ALTERNATE_BUTTON_TEXTS='alternateButtonTexts';HtmlUtils.EV_FOCUSIN="focusin";HtmlUtils.EV_FOCUSOUT="focusout";HtmlUtils.contains=function(aMainString,aSubString){return HtmlUtils.contains=HtmlUtils.contains(aMainString,aSubString,false);};HtmlUtils.contains=function(aMainString,aSubString,aCaseSensitive){if(HtmlUtils.isUndefinedOrIsNull(aMainString)===true){aMainString=HtmlUtils.C_EMPTY;}if(HtmlUtils.isUndefinedOrIsNull(aSubString)===true){aSubString=HtmlUtils.C_EMPTY;}if(HtmlUtils.isUndefinedOrIsNull(aCaseSensitive)===true){aCaseSensitive=false;}if(aCaseSensitive===false){aMainString=(HtmlUtils.C_EMPTY+aMainString).toLowerCase();aSubString=(HtmlUtils.C_EMPTY+aSubString).toLowerCase();}return(aMainString.indexOf(aSubString)>-1?true:false);};HtmlUtils.arrayContains=function(aArray,aContainElement){return(aArray.indexOf(aContainElement)>-1?true:false);};HtmlUtils.toUpperCase=function(aString){if(HtmlUtils.isUndefinedOrIsNull(aString)===true){aString=HtmlUtils.C_EMPTY;}return(HtmlUtils.C_EMPTY+aString).toUpperCase();};HtmlUtils.toLowerCase=function(aString){if(HtmlUtils.isUndefinedOrIsNull(aString)===true){aString=HtmlUtils.C_EMPTY;}return aString.toLowerCase();};HtmlUtils.createValidationMsgDiv=function(aID){var retVal=HtmlUtils.div(HtmlUtils.C_EMPTY);retVal.attr(HtmlUtils.A_ID,aID+HtmlUtils.C_VALIDATION_SUFFIX);retVal.attr(HtmlUtils.A_CLASS,HtmlUtils.AV_FPL_VALIDATION_MSG+" ui-content");retVal.attr(HtmlUtils.A_DATA_ROLE,HtmlUtils.AV_POPUP);return retVal;};HtmlUtils.createLabeledCombobox=function(aLabelText,aComboboxId,aValuesArray,aClassName,aHelpMsg){var label=HtmlUtils.createLabel(HtmlUtils.encodeForHTML(aLabelText),aComboboxId);if(HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(aHelpMsg)===false){label=HtmlUtils.createLabelWithHelp(HtmlUtils.encodeForHTML(aLabelText),aComboboxId,aHelpMsg);}var select=HtmlUtils.createSelect(aComboboxId,aValuesArray);var retVal=HtmlUtils.div();retVal.append(label);retVal.append(select);retVal.attr(HtmlUtils.A_CLASS,HtmlUtils.encodeForHTMLAttribute(aClassName));return retVal;};HtmlUtils.createComboboxWithSubmit=function(aLabelText,aComboboxId,aValuesArray,aClassName,aHelpMsg,aButtonAction){var button=HtmlUtils.createButton(aComboboxId,aLabelText,aClassName);if(HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(aHelpMsg)===false){button=HtmlUtils.createLabelWithHelp(aLabelText,aComboboxId,aHelpMsg);}button.css('margin',0);button.click(aButtonAction);var select=HtmlUtils.createSelect(aComboboxId,aValuesArray);var retVal=HtmlUtils.div();retVal.append(select);retVal.append(button);retVal.attr(HtmlUtils.A_CLASS,aClassName);return retVal;};HtmlUtils.createTextInputWithSubmit=function(aLabelText,aComboboxId,aClassName,aHelpMsg,aButtonAction){var button=HtmlUtils.createButton(aComboboxId,aLabelText,aClassName);if(HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(aHelpMsg)===false){button=HtmlUtils.createLabelWithHelp(aLabelText,aComboboxId,aHelpMsg);}button.css('margin',0);button.click(aButtonAction);var inputText=HtmlUtils.createInputText(aComboboxId,HtmlUtils.C_EMPTY);var retVal=HtmlUtils.div();retVal.append(inputText);retVal.append(button);retVal.attr(HtmlUtils.A_CLASS,aClassName);return retVal;};HtmlUtils.createLabeledDatetimePicker=function(aId,aLabelText,aDatePlaceHolder,aTimePlaceholder){if(HtmlUtils.isUndefinedOrIsNull(aDatePlaceHolder)===true){aDatePlaceHolder=HtmlUtils.C_EMPTY;}if(HtmlUtils.isUndefinedOrIsNull(aTimePlaceholder)===true){aTimePlaceholder=HtmlUtils.C_EMPTY;}if(HtmlUtils.isUndefinedOrIsNull(aLabelText)===true){aLabelText=HtmlUtils.C_EMPTY;}var dateID=aId+HtmlUtils.C_DATE_ID_SUFFIX;var timeID=aId+HtmlUtils.C_TIME_ID_SUFFIX;var dateTimeLabel=HtmlUtils.createLabel(HtmlUtils.encodeForHTML(aLabelText),aId);var dateDiv=HtmlUtils.createDateDiv(dateID,HtmlUtils.C_EMPTY,aDatePlaceHolder);var timeDiv=HtmlUtils.createTimeDiv(timeID,HtmlUtils.C_EMPTY,aTimePlaceholder);var dateTimeDiv=HtmlUtils.divGridA(null);dateTimeDiv.append(HtmlUtils.divBlockA(dateDiv));dateTimeDiv.append(HtmlUtils.divBlockB(timeDiv));var retValDiv=HtmlUtils.div(null);retValDiv.attr(HtmlUtils.A_ID,aId);retValDiv.append(dateTimeLabel);retValDiv.append(dateTimeDiv);return retValDiv;};HtmlUtils.createButton=function(aButtonId,aButtonText,aClass){var retValA=HtmlUtils.a(HtmlUtils.encodeForHTML(aButtonText));retValA.attr('href','#');retValA.attr(AWLocale.LOCALISATION_KEY,HtmlUtils.encodeForHTMLAttribute(aButtonText));retValA.attr('data-role','button');retValA.attr(HtmlUtils.A_CLASS,HtmlUtils.encodeForHTMLAttribute(aClass));retValA.attr(HtmlUtils.A_ID,HtmlUtils.encodeForHTMLAttribute(aButtonId));return retValA;};HtmlUtils.createAHyperlinkButtonWithSpanContent=function(aButtonText){var retVal=JQ('<a data-role="button" data-corners="true" data-shadow="true" data-iconshadow="true" data-wrapperels="span" data-theme="c" class="ui-btn ui-shadow ui-btn-corner-all ui-btn-up-c"><span class="ui-btn-inner ui-btn-corner-all"><span class="ui-btn-text">'+aButtonText+'</span></span></a>');return retVal;};HtmlUtils.createAHyperlinkButtonWithSpanContentInline=function(aButtonText){var retVal=JQ('<a data-role="button" data-inline="true" data-corners="true" data-shadow="true" data-iconshadow="true" data-wrapperels="span" data-theme="c" class="ui-btn ui-btn-inline ui-shadow ui-btn-corner-all ui-btn-up-c"><span class="ui-btn-inner ui-btn-corner-all"><span class="ui-btn-text">'+aButtonText+'</span></span></a>');return retVal;};HtmlUtils.createDateDiv=function(aID,aLabelText,aPlaceHolder,aHelpMsg){var dateLabel=HtmlUtils.createLabel(aLabelText,aID);if(HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(aHelpMsg)===false){dateLabel=HtmlUtils.createLabelWithHelp(aLabelText,aID,aHelpMsg);}var datePicker=HtmlUtils.createDateInput(aPlaceHolder,aID);var retVal=HtmlUtils.twoRowedDivGridSolo(dateLabel,datePicker);retVal.addClass(HtmlUtils.AV_AIS_MOBILE_DATE_TIME);return retVal;};HtmlUtils.createTimeDiv=function(aId,aLabelText,aPlaceHolder,aHelpMsg,aAddInputAttrs){var timeLabel=createLabel(aLabelText,aId);if(HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(aHelpMsg)===false){timeLabel=HtmlUtils.createLabelWithHelp(aLabelText,aId,aHelpMsg);}var timePicker=HtmlUtils.createTimeInput(aPlaceHolder,aId,aAddInputAttrs);var retVal=HtmlUtils.twoRowedDivGridSolo(timeLabel,timePicker);retVal.addClass(HtmlUtils.AV_AIS_MOBILE_DATE_TIME);return retVal;};HtmlUtils.createDateInput=function(aPlaceHolder,aId){var datePicker=JQ('<input data-role="datebox" data-mini="true" id="'+HtmlUtils.encodeForHTMLAttribute(aId)+'" type="text" placeholder="'+HtmlUtils.encodeForHTMLAttribute(aPlaceHolder)+'"></input>');datePicker.attr("data-options",'{"mode":"flipbox", "centerHoriz": true}');datePicker.attr(AWLocale.LOCALISATION_KEY,HtmlUtils.encodeForHTMLAttribute(aPlaceHolder));return datePicker;};forceDateboxFocus=function(date){JQ(this.element).focus();};HtmlUtils.createTimeInput=function(aPlaceHolder,aId,aAddInputAttrs){var timePicker=JQ('<input data-role="datebox" data-mini="true" id="'+HtmlUtils.encodeForHTMLAttribute(aId)+'" type="text" placeholder="'+HtmlUtils.encodeForHTMLAttribute(aPlaceHolder)+'"></input>');var opts={"mode":"timeflipbox",lockInput:false};if(AWUtils.isUndefinedOrIsNull(aAddInputAttrs)===false){opts=Object.assign(opts,aAddInputAttrs);}timePicker.attr("data-options",JSON.stringify(opts));timePicker.attr(AWLocale.LOCALISATION_KEY,HtmlUtils.encodeForHTMLAttribute(aPlaceHolder));timePicker.attr(HtmlUtils.A_AWINPUTRESTRICTION,"(^([]|[0-2]|[0-1][0-9]|[2][0-4])([:]|[:][0-5]|[:][0-5][0-9]){0,1}$|^$)");HtmlUtils.checkAndSetFplInputRestrictor(timePicker);return timePicker;};HtmlUtils.createTimeInputHHMM=function(aPlaceHolder,aId,aAdditionalBtnIconClass){var timePickerHHMM=HtmlUtils.createTimeInput(aPlaceHolder,aId);timePickerHHMM.attr(HtmlUtils.A_AWINPUTRESTRICTION,HtmlUtils.IRR_HHMM_MAX2359);HtmlUtils.checkAndSetFplInputRestrictor(timePickerHHMM);var buttonIcon=null;if(AWUtils.isUndefinedOrIsNull(aAdditionalBtnIconClass)===false){buttonIcon='"buttonIcon": "clock '+aAdditionalBtnIconClass+'"';}var dataOptions='{"mode":"timeflipbox", "overrideTimeOutput":"%k%M", "lockInput":false';if(buttonIcon!==null){dataOptions+=', '+buttonIcon;}dataOptions+="}";timePickerHHMM.attr('data-options',dataOptions);return timePickerHHMM;};HtmlUtils.enableTimepicker=function(aTimePicker){HtmlUtils.enableDateBox(aTimePicker);};HtmlUtils.disableTimepicker=function(aTimePicker){HtmlUtils.disableDateBox(aTimePicker);};HtmlUtils.enableDateBox=function(aDateBoxInput){if(AWUtils.isUndefinedOrIsNull(aDateBoxInput)===true){return;}aDateBoxInput.datebox(HtmlUtils.C_ENABLE);};HtmlUtils.disableDateBox=function(aDateBoxInput){if(AWUtils.isUndefinedOrIsNull(aDateBoxInput)===true){return;}aDateBoxInput.datebox(HtmlUtils.C_DISABLE);};HtmlUtils.CalboxINPUTRESTRICTION="^([0-9]{0,4}|[0-9]{4}-([0-1]|((0[1-9]|1[0-2]){1}(-|-([0-3]|0[1-9]|[1-2][0-9]|3[0-1]){0,1}){0,1}){0,1}){0,1})$";HtmlUtils.createCalboxInput=function(aPlaceHolder,aId,aAdditionalBtnIconClass){var retValCalbox=JQ('<input data-mini="true" name="dofSelect" id="'+HtmlUtils.encodeForHTMLAttribute(aId)+'" placeholder="'+HtmlUtils.encodeForHTMLAttribute(aPlaceHolder)+'" type="text" data-role="datebox"></input>');var opts={"mode":"calbox",calControlGroup:true,overrideDateFormat:"%Y-%m-%d",theme:"a",themeDatePick:"b",overrideCalStartDay:1,useClearButton:false,lockInput:false,useTodayButton:true};if(AWUtils.isUndefinedOrIsNull(aAdditionalBtnIconClass)===false){opts["buttonIcon"]="calendar "+aAdditionalBtnIconClass;}retValCalbox.attr("data-options",JSON.stringify(opts));retValCalbox.attr('readonly',false);retValCalbox.attr(HtmlUtils.A_AWINPUTRESTRICTION,HtmlUtils.CalboxINPUTRESTRICTION);HtmlUtils.checkAndSetFplInputRestrictor(retValCalbox);return retValCalbox;};HtmlUtils.createTabs=function(aTabNames,aTabContentElements,aTabClickCallbacks){if(AWUtils.isArray(aTabClickCallbacks)===false){aTabClickCallbacks=[];}var tabNavBar=JQ('<div data-role="navbar"></div>');var tabNavList=JQ('<ul></ul>');tabNavBar.append(tabNavList);var retValTabs=JQ('<div data-role="tabs"></div>');retValTabs.append(tabNavBar);for(var i=0;i<aTabNames.length;i++){var iTabName=aTabNames[i];var iTabCallbackFnc=aTabClickCallbacks[i];var iTabContentElement=aTabContentElements[i];var iTabContentID=iTabContentElement.attr(HtmlUtils.A_ID);var tabNavListItem=JQ('<li><a href="#'+HtmlUtils.encodeForHTMLAttribute(iTabContentID)+'" id="'+HtmlUtils.encodeForHTMLAttribute(iTabContentID)+'Nav" data-ajax="false" '+AWLocale.LOCALISATION_KEY+'='+HtmlUtils.encodeForHTMLAttribute(iTabName)+'>'+HtmlUtils.encodeForHTML(iTabName)+'</a></li>');if(i===0){tabNavListItem.attr(HtmlUtils.A_CLASS,"ui-tabs-active ui-state-active");}tabNavListItem.click(HtmlUtils.getTabClickFunction());if(AWUtils.isUndefinedOrIsNull(iTabCallbackFnc)===false){tabNavListItem.click(iTabCallbackFnc);}tabNavList.append(tabNavListItem);retValTabs.append(iTabContentElement);}return retValTabs;};HtmlUtils._lastClickedTabClass='lastClickedTab';HtmlUtils.tabClickFunction=null;HtmlUtils.getTabClickFunction=function(){if(HtmlUtils.tabClickFunction===null){HtmlUtils.tabClickFunction=function(){JQ(this).parent().find("li[role='tab']").removeClass(HtmlUtils._lastClickedTabClass);JQ(this).addClass(HtmlUtils._lastClickedTabClass);};}return HtmlUtils.tabClickFunction;};HtmlUtils.createMultiSelect=function(aLabelText,aComboboxId,aValuesArray,aClass,aHelpMsg){var multiselectBlock=HtmlUtils.div();var multiselectLabel=HtmlUtils.createLabel(HtmlUtils.encodeForHTML(aLabelText),aComboboxId);if(HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(aHelpMsg)===false){multiselectLabel=HtmlUtils.createLabelWithHelp(HtmlUtils.encodeForHTML(aLabelText),aComboboxId,aHelpMsg);}multiselectBlock.append(multiselectLabel);var multiselectWrapper=HtmlUtils.div();multiselectWrapper.attr(HtmlUtils.A_DATA_ROLE,HtmlUtils.AV_FIELD_CONTAIN);multiselectWrapper.attr(HtmlUtils.A_CLASS,HtmlUtils.AV_SELECT_NOMAR);multiselectWrapper.attr(HtmlUtils.A_CLASS,HtmlUtils.AV_SELECT_NOMAR);var multiselect=HtmlUtils.createSelect(aComboboxId,aValuesArray);multiselect.attr(HtmlUtils.A_MULTIPLE,HtmlUtils.AV_MULTIPLE);multiselect.attr(HtmlUtils.A_CLASS,HtmlUtils.AV_MULTISELECT);multiselect.attr(HtmlUtils.A_DATA_NATIVE_MENU,HtmlUtils.AV_FALSE);multiselect.attr(HtmlUtils.A_NAME,HtmlUtils.encodeForHTMLAttribute(aComboboxId));multiselect.attr(HtmlUtils.A_ID,HtmlUtils.encodeForHTMLAttribute(aComboboxId));multiselectWrapper.append(multiselect);multiselectBlock.append(multiselectWrapper);multiselectBlock.attr(HtmlUtils.A_CLASS,HtmlUtils.encodeForHTMLAttribute(aClass));multiselectBlock.attr(HtmlUtils.A_ID,HtmlUtils.encodeForHTMLAttribute(aComboboxId+FlightPlansValidatorView.S_VALID_CONTAINER));return multiselectBlock;};HtmlUtils.changeMultiselectViewToOneLetter=function(aMultiselectInstance){return;var changedValue=JQ("option:selected",aMultiselectInstance).map(function(a,b){var arr=JQ(this).text().split(":");return arr[0];}).get().join(", ");var multiselectID=JQ(aMultiselectInstance).attr("id");if(AWUtils.isUndefinedOrIsNull(multiselectID)===true){return;}var multiselectID2=null;if(multiselectID.endsWith("PC")===true){multiselectID2=multiselectID.substring(0,multiselectID.length-2);}else{multiselectID2=multiselectID+"PC";}var objectIdsForchange=[multiselectID,multiselectID2];for(var index=0;index<objectIdsForchange.length;++index){var iObjectID=objectIdsForchange[index];JQ("#"+iObjectID+"-button").find("span.multiselect").text(changedValue);}};HtmlUtils.createResponsivePagination=function(aPaginationAction,aCounterPerPageAction,aMaxPageNum){var pagination=JQ('<div class="pagination"></div>');var first=JQ('<a href="#" class="first" data-action="first">&laquo;</a>');var previous=JQ('<a href="#" class="previous" data-action="previous">&lsaquo;</a>');var input=JQ('<input class="paginationInput" type="text" readonly="readonly" data-max-page="'+aMaxPageNum+'" />');var next=JQ('<a href="#" class="next" data-action="next">&rsaquo;</a>');var last=JQ('<a href="#" class="last" data-action="last">&raquo;</a>');pagination.append(first);pagination.append(previous);pagination.append(input);pagination.append(next);pagination.append(last);pagination.jqPagination({paged:function(aPage){if(HtmlUtils.isUndefinedOrIsNull(aPaginationAction)===false){aPaginationAction(aPage);}}});var countPerPageID='countPerPageID';var label=HtmlUtils.createLabel('Count Per Page',countPerPageID);var countPerPageSelect=HtmlUtils.createSelect(countPerPageID,['25','50','75','100']);countPerPageSelect.addClass("countPerPageSelect");countPerPageSelect.change(aCounterPerPageAction);var countPerPageGrid=divGridA();countPerPageGrid.append(divBlockA(label));countPerPageGrid.append(divBlockB(countPerPageSelect));var retVal=divGridC();retVal.addClass('my-breakpoint');retVal.append(divBlockA(pagination));retVal.append(divBlockB(countPerPageGrid));retVal.append(divBlockC());retVal.append(divBlockD());return retVal;};HtmlUtils.createPagination=function(aPaginationAction,aCounterPerPageAction,aMaxPageNum){var retVal=JQ('<div class="pagination">\    <a href="#" class="first" data-action="first">&laquo;</a>\    <a href="#" class="previous" data-action="previous">&lsaquo;</a>\    <input class="paginationInput" type="text" readonly="readonly" data-max-page="'+aMaxPageNum+'" />\    <a href="#" class="next" data-action="next">&rsaquo;</a>\    <a href="#" class="last" data-action="last">&raquo;</a>\    </div>');retVal.jqPagination({paged:function(aPage){if(HtmlUtils.isUndefinedOrIsNull(aPaginationAction)===false){aPaginationAction(aPage);}}});var countPerPageID='countPerPageID';retVal.append(HtmlUtils.createLabel('Count Per Page',countPerPageID));var countPerPageSelect=HtmlUtils.createSelect(countPerPageID,['25','50','75','100']);countPerPageSelect.addClass("countPerPageSelect");countPerPageSelect.change(aCounterPerPageAction);retVal.append(countPerPageSelect);return retVal;};HtmlUtils.createSelect=function(aComboboxId,aValuesArray){if(AWUtils.isUndefinedOrIsNull(aValuesArray)===true){aValuesArray=[];};if(aValuesArray.constructor===Array){return HtmlUtils.createSelectByArray(aComboboxId,aValuesArray);}else{return HtmlUtils.createSelectByMap(aComboboxId,aValuesArray);}};HtmlUtils.createSelectByArray=function(aComboboxId,aValuesArray){var selectElement=HtmlUtils.createSelectCommonElement(aComboboxId);for(var i=0;i<aValuesArray.length;i++){var ikey=aValuesArray[i];var optionElement=HtmlUtils.element(HtmlUtils.E_OPTION,HtmlUtils.encodeForHTML(ikey));optionElement.attr(HtmlUtils.A_ID,aComboboxId+HtmlUtils.C_UNDERSCORE+i);optionElement.attr(HtmlUtils.A_VALUE,HtmlUtils.encodeForHTMLAttribute(ikey));selectElement.append(optionElement);}return selectElement;};HtmlUtils.createSelectByMap=function(aComboboxId,aValuesMap,aKeyAttribute){if(HtmlUtils.isUndefinedOrIsNull(aKeyAttribute)===true){aKeyAttribute=HtmlUtils.A_VALUE;}var selectElement=HtmlUtils.createSelectCommonElement(aComboboxId);for(var iKey in aValuesMap){if(iKey===null||aValuesMap[iKey]===null){continue;}var iValue=aValuesMap[iKey];var optionElement=HtmlUtils.element(HtmlUtils.E_OPTION,HtmlUtils.encodeForHTML(iValue));optionElement.attr(HtmlUtils.A_ID,HtmlUtils.encodeForHTMLAttribute(aComboboxId+HtmlUtils.C_UNDERSCORE+iKey));optionElement.attr(aKeyAttribute,HtmlUtils.encodeForHTMLAttribute(iKey));selectElement.append(optionElement);}return selectElement;};HtmlUtils.createSelectCommonElement=function(aComboboxId){var retVal=HtmlUtils.element(HtmlUtils.E_SELECT,HtmlUtils.C_EMPTY);retVal.attr(HtmlUtils.A_NAME,HtmlUtils.encodeForHTMLAttribute(aComboboxId));retVal.attr(HtmlUtils.A_ID,HtmlUtils.encodeForHTMLAttribute(aComboboxId));return retVal;};HtmlUtils.createLabeledTextInput=function(aLabelName,aInputId,aClassName,aHelpMsg){if(HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(aLabelName)){aLabelName=HtmlUtils.C_EMPTY;}if(HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(aInputId)){aInputId=HtmlUtils.C_EMPTY;}var div=HtmlUtils.div();div.attr(HtmlUtils.A_CLASS,HtmlUtils.encodeForHTMLAttribute(aClassName));var label=HtmlUtils.createLabel(aLabelName,aInputId);if(HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(aHelpMsg)===false){label=HtmlUtils.createLabelWithHelp(aLabelName,aInputId,aHelpMsg);}var input=HtmlUtils.createInputText(aInputId,aInputId);div.append(label);div.append(input);div.attr(HtmlUtils.A_STYLE,'margin-left:0.5em; margin-right:0.5em;');return div;};HtmlUtils.createLabeledTextLabel=function(aLabelName,aInputId,aClassName,aHelpMsg){if(HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(aLabelName)){aLabelName=HtmlUtils.C_EMPTY;}if(HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(aInputId)){aInputId=HtmlUtils.C_EMPTY;}var div=HtmlUtils.div();div.attr(HtmlUtils.A_CLASS,HtmlUtils.encodeForHTMLAttribute(aClassName));var label=HtmlUtils.createLabel(aLabelName,aInputId);if(HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(aHelpMsg)===false){label=HtmlUtils.createLabelWithHelp(aLabelName,aInputId,aHelpMsg);}var labelWithValue=HtmlUtils.label({id:aInputId},'');div.append(label);div.append(labelWithValue);div.attr(HtmlUtils.A_STYLE,'margin-left:0.5em; margin-right:0.5em;');return div;};HtmlUtils.createLabeledCheckbox=function(aCheckBoxId,aLabelName,aChecked,aClass,aHelpMsg){if(isUndefinedOrIsNullOrIsEmptyString(aLabelName)){aLabelName=HtmlUtils.C_EMPTY;}if(isUndefinedOrIsNullOrIsEmptyString(aCheckBoxId)){aCheckBoxId=HtmlUtils.C_EMPTY;}var emptyLabel=HtmlUtils.createLabel(aLabelName,aCheckBoxId);if(HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(aHelpMsg)===false){emptyLabel=HtmlUtils.createLabelWithHelp(aLabelName,aCheckBoxId,aHelpMsg);}var checkboxLabel=HtmlUtils.createLabel(aLabelName,aCheckBoxId);var checkbox=HtmlUtils.createInputCheckbox(aCheckBoxId,aChecked);checkboxLabel.append(checkbox);var retVal=HtmlUtils.div();retVal.attr(HtmlUtils.A_ID,aCheckBoxId);retVal.attr(HtmlUtils.A_CLASS,aClass);retVal.append(emptyLabel);retVal.append(checkboxLabel);return retVal;};HtmlUtils.createNamedCheckbox=function(aCheckBoxId,aName,aChecked){var checkboxLabel=HtmlUtils.createLabel(aName,aCheckBoxId);var checkbox=HtmlUtils.createInputCheckbox(aCheckBoxId,aChecked);checkboxLabel.append(checkbox);return checkboxLabel;};HtmlUtils.createLabelWithHelp=function(aText,aForId,aHelpMsgKey){var label=HtmlUtils.createLabel(aText,aForId);var helpBtn=HtmlUtils.createLocalizedHelpBtn(aHelpMsgKey);var labelSpan=HtmlUtils.span(label);labelSpan.attr(HtmlUtils.A_STYLE,'display: block; width:85%; padding-top: 1.2em;');var helpSpan=HtmlUtils.span(helpBtn);helpSpan.attr(HtmlUtils.A_STYLE,'display: block;');var retValDiv=HtmlUtils.div(null);retValDiv.attr(HtmlUtils.A_STYLE,'display: flex;');retValDiv.append(labelSpan);retValDiv.append(helpSpan);return retValDiv;};HtmlUtils.createHelpBtn=function(aHelpMsg){var retValA=HtmlUtils.a('?');retValA.attr('data-role','button');retValA.click(function(){var popup=JQMUtil.showInfoMsg(aHelpMsg,false,false);});return retValA;};HtmlUtils.createLocalizedHelpBtn=function(aLocKey){var retValA=HtmlUtils.a('?');retValA.attr('data-role','button');retValA.click(function(){var locHelpMessage=getLocalizedString(aLocKey);var popup=JQMUtil.showInfoMsg(HtmlUtils.encodeForHTML(locHelpMessage),false,false);});return retValA;};HtmlUtils.createLabel=function(aText,aForId){var label=HtmlUtils.element(HtmlUtils.E_LABEL,HtmlUtils.encodeForHTML(aText));label.attr(AWLocale.LOCALISATION_KEY,HtmlUtils.encodeForHTMLAttribute(aText));label.attr(HtmlUtils.A_ID,HtmlUtils.encodeForHTMLAttribute(aForId+HtmlUtils.C_LABEL_SUFFIX));label.attr(HtmlUtils.A_FOR,HtmlUtils.encodeForHTMLAttribute(aForId));return label;};HtmlUtils.createInputCheckbox=function(aId,aChecked){var retVal=HtmlUtils.element(HtmlUtils.E_INPUT,null);retVal.attr(HtmlUtils.A_ID,aId);retVal.attr(HtmlUtils.A_TYPE,HtmlUtils.AV_CHECKBOX);retVal.attr(HtmlUtils.A_DATA_CACHEVAL,HtmlUtils.AV_FALSE);if(aChecked===true){retVal.attr(HtmlUtils.A_CHECKED,HtmlUtils.AV_TRUE);}return retVal;};HtmlUtils.createInputText=function(aId,aName){var retVal=HtmlUtils.element(HtmlUtils.E_INPUT,null);retVal.attr(HtmlUtils.A_ID,aId);retVal.attr(HtmlUtils.A_NAME,aName);retVal.attr(HtmlUtils.A_TYPE,HtmlUtils.AV_TEXT);return retVal;};HtmlUtils.createInputHidden=function(aName,aValue){var retVal=HtmlUtils.element(HtmlUtils.E_INPUT,null);retVal.attr(HtmlUtils.A_ID,aName);retVal.attr(HtmlUtils.A_NAME,aName);retVal.attr(HtmlUtils.A_TYPE,HtmlUtils.AV_HIDDEN);retVal.attr(HtmlUtils.A_VALUE,aValue);return retVal;};HtmlUtils.twoRowedDivGridSolo=function(aRow1,aRow2){var blockA=HtmlUtils.divBlockA(aRow1);blockA.append(aRow2);var retValDiv=HtmlUtils.divGridSolo(blockA);return retValDiv;};HtmlUtils.createLabeledInputUnitModel=function(aLabelElement,aInputElement,aUnitElement){var retVal=HtmlUtils.createLabeledInputModel(aLabelElement,aInputElement);retVal.unit=aUnitElement;return retVal;};HtmlUtils.createLabeledInputModel=function(aLabelElement,aInputElement){var retVal={};retVal.label=aLabelElement;retVal.input=aInputElement;return retVal;};HtmlUtils.createAircraftItemRow=function(aLeftModel,aRightModel){return HtmlUtils.createLeftRightInputItemRow(aLeftModel,aRightModel);};HtmlUtils.createLeftRightInputItemRow=function(aLeftModel,aRightModel){var labelGridSolo=HtmlUtils.createLabelsLeftRightGridSolo(aLeftModel.label,aRightModel.label);var inputGridSolo=HtmlUtils.createInputUnitLeftRightGridSolo(aLeftModel,aRightModel);var retVal=HtmlUtils.divGridSolo();retVal.append(labelGridSolo);retVal.append(inputGridSolo);return retVal;};HtmlUtils.create4InputItemsRow=function(aItem1,aItem2,aItem3,aItem4){var labelGridSolo=HtmlUtils.createLabelsLeftRightGridSolo(aLeftModel.label,aRightModel.label);var inputGridSolo=HtmlUtils.createInputUnitLeftRightGridSolo(aLeftModel,aRightModel);var retVal=HtmlUtils.divGridSolo();retVal.append(labelGridSolo);retVal.append(inputGridSolo);return retVal;};HtmlUtils.createLeftCenterRightInputItemRow=function(aLeftModel,aCenterModel,aRightModel){var labelGridSolo=HtmlUtils.createLabelsLeftCenterRightGridSolo(aLeftModel.label,aCenterModel.label,aRightModel.label);var inputGridSolo=HtmlUtils.createInputsLeftCenterRightGridSolo(aLeftModel.input,aCenterModel.input,aRightModel.input);var retVal=HtmlUtils.divGridSolo();retVal.append(labelGridSolo);retVal.append(inputGridSolo);return retVal;};HtmlUtils.createLabelsLeftRightGridSolo=function(aLeftLabelElement,aRightLabelElement){var labelsGridA=HtmlUtils.createLeftRightGridA(aLeftLabelElement,aRightLabelElement);var retVal=HtmlUtils.divGridSolo(labelsGridA);retVal.addClass("labelsLeftRightGridSolo");return retVal;};HtmlUtils.createLabelsLeftCenterRightGridSolo=function(aLeftLabelElement,aCenterElement,aRightLabelElement){var labelsGridB=HtmlUtils.createLeftCenterRightGridB(aLeftLabelElement,aCenterElement,aRightLabelElement);var retVal=HtmlUtils.divGridSolo(labelsGridB);retVal.addClass("labelsLeftCenterRightGridSolo");return retVal;};HtmlUtils.createInputsLeftCenterRightGridSolo=function(aLeftElement,aCenterElement,aRightElement){var labelsGridB=HtmlUtils.createLeftCenterRightGridB(aLeftElement,aCenterElement,aRightElement);var retVal=HtmlUtils.divGridSolo(labelsGridB);retVal.addClass("inputsLeftCenterRightGridSolo");return retVal;};HtmlUtils.createLeftCenterRightGridB=function(aLeftElement,aCenterElement,aRightElement){var retvalGridA=HtmlUtils.divGridB();var labelBlockA=HtmlUtils.divBlockA(aLeftElement);var labelBlockB=HtmlUtils.divBlockB(aCenterElement);var labelBlockC=HtmlUtils.divBlockC(aRightElement);retvalGridA.append(labelBlockA);retvalGridA.append(labelBlockB);retvalGridA.append(labelBlockC);return retvalGridA;};HtmlUtils.createLeftRightGridA=function(aLeftElement,aRightElement){var retvalGridA=HtmlUtils.divGridA();var labelBlockA=HtmlUtils.divBlockA(aLeftElement);var labelBlockB=HtmlUtils.divBlockB(aRightElement);retvalGridA.append(labelBlockA);retvalGridA.append(labelBlockB);return retvalGridA;};HtmlUtils.createInputUnitLeftRightGridSolo=function(aLeftModel,aRightModel){var inputUnitLeftGrid;if(HtmlUtils.isInputOrUnitEmpty(aLeftModel)===true){inputUnitLeftGrid=HtmlUtils.createDivGridSoloForNonemptyInputOrUnit(aLeftModel);}else{inputUnitLeftGrid=HtmlUtils.createLeftRightGridA(aLeftModel.input,aLeftModel.unit);}var inputUnitRightGrid;if(HtmlUtils.isInputOrUnitEmpty(aRightModel)===true){inputUnitRightGrid=HtmlUtils.createDivGridSoloForNonemptyInputOrUnit(aRightModel);}else{inputUnitRightGrid=HtmlUtils.createLeftRightGridA(aRightModel.input,aRightModel.unit);}inputUnitLeftGrid.addClass('inputUnitGrid');inputUnitRightGrid.addClass('inputUnitGrid');var leftRightGridA=HtmlUtils.divGridA();leftRightGridA.append(HtmlUtils.divBlockA(inputUnitLeftGrid));leftRightGridA.append(HtmlUtils.divBlockB(inputUnitRightGrid));var retVal=HtmlUtils.divGridSolo(leftRightGridA);retVal.addClass("inputUnitLeftRightGridSolo");return retVal;};HtmlUtils.isInputOrUnitEmpty=function(aModel){if((HtmlUtils.isUndefinedOrIsNull(aModel.input)===true&&HtmlUtils.isUndefinedOrIsNull(aModel.unit)===false)||(HtmlUtils.isUndefinedOrIsNull(aModel.input)===false&&HtmlUtils.isUndefinedOrIsNull(aModel.unit)===true)){return true;}else{return false;}};HtmlUtils.createDivGridSoloForNonemptyInputOrUnit=function(aModel){var content=null;if((HtmlUtils.isUndefinedOrIsNull(aModel.input)===true&&HtmlUtils.isUndefinedOrIsNull(aModel.unit)===false)||(HtmlUtils.isUndefinedOrIsNull(aModel.input)===false&&HtmlUtils.isUndefinedOrIsNull(aModel.unit)===true)){content=aModel.input;if(HtmlUtils.isUndefinedOrIsNull(aModel.unit)===false){content=aModel.unit;}}return HtmlUtils.divGridSolo(content);};HtmlUtils.twoRowedDivGridSolo=function(aRow1,aRow2){var blockA=HtmlUtils.divBlockA(aRow1);blockA.append(aRow2);var retValDiv=HtmlUtils.divGridSolo(blockA);return retValDiv;};HtmlUtils.createRadioButtonsGroup=function(aLabel,aName,aItemsMap,aClickItemFnc){var fieldSetRetVal=JQ('<fieldset data-role="controlgroup"></fieldset>');if(HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(aLabel)===false){var legend=JQ('<legend  '+AWLocale.LOCALISATION_KEY+'='+aLabel+'>'+aLabel+'</legend>');fieldSetRetVal.append(legend);}var isChecked=false;for(var iKey in aItemsMap){var iValue=aItemsMap[iKey];var iInput=JQ('<input name="'+aName+'" id="'+iKey+'" value="'+iKey+'" type="radio">');if(isChecked===false){iInput.attr("checked","checked");isChecked=true;}if(HtmlUtils.isUndefinedOrIsNull(aClickItemFnc)===false&&HtmlUtils.isFunction(aClickItemFnc)===true){iInput.change(aClickItemFnc);}var iLabel=JQ('<label for="'+iKey+'">'+iValue+'</label>');fieldSetRetVal.append(iInput);fieldSetRetVal.append(iLabel);}return fieldSetRetVal;};function TreeNode(){this._children=[];this._title="Title Of Node";this._htmlContent=null;this._isLeaf=false;this._isCollapsed=true;this._clickAction=function(){};}HtmlUtils.createTreeView=function(aTreeNode){var retValTree=JQ(HtmlUtils.div(''));var treeElement=null;if(aTreeNode instanceof TreeNode){var treeElement=HtmlUtils.createCollapsibleTree(aTreeNode);if(treeElement!==null){retValTree.append(treeElement);retValTree.collapsibleset().collapsibleset("refresh");}}return retValTree;};HtmlUtils.createCollapsibleTree=function(aTreeNode){if(aTreeNode._isLeaf===true){var leafButton=JQ(HtmlUtils.createButton('',aTreeNode._title,''));if(HtmlUtils.isUndefinedOrIsNull(aTreeNode._htmlContent)===false){leafButton.empty();leafButton.removeAttr(AWLocale.LOCALISATION_KEY);leafButton.append(aTreeNode._htmlContent);}else{leafButton.attr(AWLocale.LOCALISATION_KEY,aTreeNode._title);}leafButton.addClass('treeNodeLeafButton');leafButton.click(aTreeNode._clickAction);leafButton.buttonMarkup({});return leafButton;}else if(HtmlUtils.isUndefinedOrIsNull(aTreeNode._children)===false&&aTreeNode._children.length>0){var retTreeNodeView=JQ('<div data-role="collapsible"></div>');if(aTreeNode._isCollapsed===false){retTreeNodeView.attr(HtmlUtils.A_DATA_COLLAPSED,'false');}var header=JQ('<h4>'+aTreeNode._title+'</h4>');header.attr(AWLocale.LOCALISATION_KEY,aTreeNode._title);retTreeNodeView.append(header);for(var i=0;i<aTreeNode._children.length;i++){var iTreeNode=aTreeNode._children[i];if(iTreeNode===null){continue;}var iViewElement=HtmlUtils.createCollapsibleTree(iTreeNode);if(iViewElement===null){continue;}retTreeNodeView.append(iViewElement);}return retTreeNodeView;}else{return null;}};HtmlUtils.checkAndAddAdditionalAttrs=function(aElement,aAdditionalAttrsHashmap){if(AWUtils.isUndefinedOrIsNull(aElement)===true||AWUtils.isUndefinedOrIsNull(aAdditionalAttrsHashmap)===true){return;}for(var iAttrName in aAdditionalAttrsHashmap){var currentAttrValue=aElement.attr(iAttrName);if(AWUtils.isUndefinedOrIsNull(currentAttrValue)===true){currentAttrValue=HtmlUtils.C_EMPTY;}else{currentAttrValue+=HtmlUtils.C_SPACE_CHAR;}var newAttrValue=currentAttrValue+aAdditionalAttrsHashmap[iAttrName];aElement.attr(iAttrName,newAttrValue);}};HtmlUtils.isUndefinedOrIsNullOrIsEmptyString=function(aObject){return AWUtils.isUndefinedOrIsNullOrIsEmptyString(aObject);};HtmlUtils.isUndefinedOrIsNull=function(aObject){return AWUtils.isUndefinedOrIsNull(aObject);};HtmlUtils.isUndefined=function(aObject){if((parseInt(aObject)===Number.NaN&&!aObject)||aObject===undefined||aObject==='UNDEFINED'){return true;}return false;};HtmlUtils.divGridSolo=function(aContent){var retValDiv=HtmlUtils.div(aContent);retValDiv.attr(HtmlUtils.A_CLASS,HtmlUtils.AV_UI_GRID_SOLO);return retValDiv;};HtmlUtils.divGridA=function(aContent){var retValDiv=HtmlUtils.div(aContent);retValDiv.attr(HtmlUtils.A_CLASS,HtmlUtils.AV_UI_GRID_A);return retValDiv;};HtmlUtils.divGridB=function(aContent){var retValDiv=HtmlUtils.div(aContent);retValDiv.attr(HtmlUtils.A_CLASS,HtmlUtils.AV_UI_GRID_B);return retValDiv;};HtmlUtils.divBlockA=function(aContent){var retValDiv=HtmlUtils.div(aContent);retValDiv.attr(HtmlUtils.A_CLASS,HtmlUtils.AV_UI_BLOCK_A);return retValDiv;};HtmlUtils.divBlockB=function(aContent){var retValDiv=HtmlUtils.div(aContent);retValDiv.attr(HtmlUtils.A_CLASS,HtmlUtils.AV_UI_BLOCK_B);return retValDiv;};HtmlUtils.divBlockC=function(aContent){var retValDiv=HtmlUtils.div(aContent);retValDiv.attr(HtmlUtils.A_CLASS,HtmlUtils.AV_UI_BLOCK_C);return retValDiv;};HtmlUtils.div=function(aContent){return HtmlUtils.element(HtmlUtils.E_DIV,aContent);};HtmlUtils.a=function(aContent){return HtmlUtils.element(HtmlUtils.E_A,aContent);};HtmlUtils.buttonFull=function(aAttributes,aContent){var retValBtn=HtmlUtils.elementFull(HtmlUtils.E_BUTTON,aAttributes,aContent);retValBtn.addClass('ui-btn');retValBtn.addClass('ui-shadow');retValBtn.addClass('ui-corner-all');return retValBtn;};HtmlUtils.buttonWithTooltip=function(aButtonTitleLoc,aTooltiploc){var retValBtn=HtmlUtils.buttonFull(null,null);var buttonsTextSpan=JQ('<span>');buttonsTextSpan.addClass(HtmlUtils.AV_CLASS_TOOLTIPEDBUTTONTEXT);if(aButtonTitleLoc){buttonsTextSpan.attr(AWLocale.LOCALISATION_KEY,aButtonTitleLoc);}retValBtn.append(buttonsTextSpan);AWUtils.addLocalizedTooltip(retValBtn,aTooltiploc);return retValBtn;};HtmlUtils.setTooltipedButtonTexts=function(aTooltipedButton,aButtonLoc,aTooltipLoc){HtmlUtils.setElementLocKey('span.'+HtmlUtils.AV_CLASS_TOOLTIPEDBUTTONTEXT,aTooltipedButton,aButtonLoc);HtmlUtils.setElementLocKey('span.tooltip-text',aTooltipedButton,aTooltipLoc);AWLocale.localeAllObjectsWithChildren(aTooltipedButton);};HtmlUtils.setElementLocKey=function(aSelector,aMainElement,aNewLocVal){if(AWUtils.isUndefinedOrIsNullOrIsEmptyString(aMainElement)===true||AWUtils.isUndefinedOrIsNullOrIsEmptyString(aSelector)===true){return;}var changedElement=aMainElement.find(aSelector);if(AWUtils.isUndefinedOrIsNullOrIsEmptyString(changedElement)===true){return;}changedElement.attr(AWLocale.LOCALISATION_KEY,aNewLocVal);};HtmlUtils.br=function(){return HtmlUtils.element(HtmlUtils.E_BR,null);};HtmlUtils.aFull=function(aAttributes,aContent){return HtmlUtils.elementFull(HtmlUtils.E_A,aAttributes,aContent);};HtmlUtils.form=function(aContent){return HtmlUtils.element(HtmlUtils.E_FORM,aContent);};HtmlUtils.font=function(aAttributesMap,aContent){return HtmlUtils.elementFull(HtmlUtils.E_FONT,aAttributesMap,aContent);};HtmlUtils.hr=function(aAttrs){return HtmlUtils.elementFull(HtmlUtils.E_HR,aAttrs,null);};HtmlUtils.iframe=function(aAttrs,aContent){return HtmlUtils.elementFull(HtmlUtils.E_IFRAME,aAttrs,aContent);};HtmlUtils.img=function(aAttrs){return HtmlUtils.elementFull(HtmlUtils.E_IMG,aAttrs,null);};HtmlUtils.input=function(aAttrs){return HtmlUtils.elementFull(HtmlUtils.E_INPUT,aAttrs,null);};HtmlUtils.label=function(aLabelAttributes,aLabelContent){return HtmlUtils.elementFull(HtmlUtils.E_LABEL,aLabelAttributes,aLabelContent);};HtmlUtils.li=function(aLabelAttributes,aLabelContent){return HtmlUtils.elementFull(HtmlUtils.E_LI,aLabelAttributes,aLabelContent);};HtmlUtils.option=function(aAttrs,aContent){return HtmlUtils.elementFull(HtmlUtils.E_OPTION,aAttrs,aContent);};HtmlUtils.p=function(aAttrs,aContent){return HtmlUtils.elementFull(HtmlUtils.E_P,aAttrs,aContent);};HtmlUtils.span=function(aContent){return HtmlUtils.elementFull(HtmlUtils.E_SPAN,{},aContent);};HtmlUtils.table=function(aAttributesMap,aContent){return HtmlUtils.elementFull(HtmlUtils.E_TABLE,aAttributesMap,aContent);};HtmlUtils.tbody=function(aAttributesMap,aContent){return HtmlUtils.elementFull(HtmlUtils.E_TBODY,aAttributesMap,aContent);};HtmlUtils.textArea=function(aAttributes){return HtmlUtils.elementFull(HtmlUtils.E_TEXTAREA,aAttributes);};HtmlUtils.tr=function(aAttributesMap,aContent){return HtmlUtils.elementFull(HtmlUtils.E_TR,aAttributesMap,aContent);};HtmlUtils.td=function(aAttributesMap,aContent){return HtmlUtils.elementFull(HtmlUtils.E_TD,aAttributesMap,aContent);};HtmlUtils.ul=function(aAttributesMap,aContent){return HtmlUtils.elementFull(HtmlUtils.E_UL,aAttributesMap,aContent);};HtmlUtils.elementFull=function(aName,aAttributesMap,aContent){var retValElement=HtmlUtils.element(aName,aContent);if(aAttributesMap===null){aAttributesMap={};}for(var iKey in aAttributesMap){if(!aAttributesMap.hasOwnProperty(iKey)||aAttributesMap[iKey]===null){continue;}retValElement.attr(iKey,aAttributesMap[iKey]);}return retValElement;};HtmlUtils.element=function(aName,aContent){var tag=JQ(HtmlUtils.C_LESS_MORE_CHAR+aName+HtmlUtils.C_MORE_LESS_CHAR+HtmlUtils.C_LESS_MORE_CHAR+HtmlUtils.C_SLASH_CHAR+aName+HtmlUtils.C_MORE_LESS_CHAR);if(aContent!==null){tag.append(aContent);}return tag;};HtmlUtils.checkAndAddSpace=function(aContent){if(HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(aContent)===true){return aContent;}aContent=aContent.trim();if(aContent!==HtmlUtils.C_EMPTY){aContent+=HtmlUtils.C_SPACE_CHAR;}return aContent;};HtmlUtils.isFunction=function(aObjectToCheck){var getType={};return aObjectToCheck&&getType.toString.call(aObjectToCheck)==='[object Function]';};HtmlUtils.cutStringToMaxLength=function(aString,aMaxLength){if(HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(aString)===true||HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(aMaxLength)===true||aString.length<=aMaxLength){return aString;}else{return aString.substring(0,aMaxLength);}};HtmlUtils.setLatinizeWhileTyping=function(aInputObject){aInputObject.keyup(function(){aInputObject.val(latinize(aInputObject.val()));});};HtmlUtils.formateDateToGetFPLArchiveDate=function(aDate){var retVal=HtmlUtils.C_EMPTY;if(HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(aDate)===true){return retVal;}retVal=aDate.getUTCFullYear()+HtmlUtils.C_DASH+zeroPad((aDate.getUTCMonth()+1),2)+HtmlUtils.C_DASH+zeroPad(aDate.getUTCDate(),2);retVal+=HtmlUtils.C_SPACE_CHAR;retVal+=zeroPad(aDate.getUTCHours(),2)+HtmlUtils.C_COLON+zeroPad(aDate.getUTCMinutes(),2);return retVal;};HtmlUtils.encodeForHTMLAttribute=function(aInput){var retVal=HtmlUtils.C_EMPTY;if(HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(aInput)===true){return retVal;}var retVal=(typeof aInput==="object")?aInput.toString():aInput;if(retVal!==undefined&&typeof retVal==="string"){retVal=retVal.replace(/"/g,"&quot;");retVal=retVal.replace(/'/g,"&apos;");}return retVal;};HtmlUtils.encodeForHTML=function(aInput){var retVal=HtmlUtils.C_EMPTY;if(HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(aInput)===true){return retVal;}var retVal=(typeof aInput==="object")?aInput.toString():aInput;if(retVal!==undefined&&typeof retVal==="string"){retVal=retVal.replace(/</g,"&lt;");retVal=retVal.replace(/>/g,"&gt;");retVal=retVal.replace(/&/g,"&amp;");}return retVal;};HtmlUtils.escape=function(aInput){var retVal=(typeof aInput==="object")?aInput.toString():aInput;if(retVal!==undefined&&typeof retVal==="string"){retVal=retVal.replace(/</g,"&lt;");retVal=retVal.replace(/>/g,"&gt;");retVal=retVal.replace(/&/g,"&amp;");retVal=retVal.replace(/"/g,"&quot;");retVal=retVal.replace(/'/g,"&apos;");}return retVal;};HtmlUtils.removeScriptTag=function(aInput){var retVal=aInput;if(typeof retVal==="string"){retVal=retVal.replace(/<script>.*<\/script>/gi,"");}return retVal;};HtmlUtils.isFunction=function(aFunctionObject){var getType={};return aFunctionObject&&getType.toString.call(aFunctionObject)==='[object Function]';};HtmlUtils.isString=function(aStringObject){return((typeof aStringObject)==='string');};HtmlUtils.IRR_HHMM_MAX2359="^(([]|[0-2]|[0-1][0-9]|[2][0-3]|[0-1][0-9][0-5]|[2][0-3][0-5]|[0-1][0-9][0-5][0-9]|[2][0-3][0-5][0-9])$|^$)";HtmlUtils.IRR_HHMM_MAX9959="^(([]|[0-9]|[0-9][0-9]|[0-9][0-9][0-5]|[0-9][0-9][0-5][0-9])$|^$)";HtmlUtils.IRR_COLOURINPUT="^[a-zA-Z\ \b\0]*$";HtmlUtils.IRR_COLOUR_MARKS_INPUT="^[a-zA-Z0-9\ \b\0]*$";HtmlUtils.IRR_DINGHIES_INPUT="^[a-zA-Z0-9\ \b\0]*$";HtmlUtils.IRR_DOUBLE_NUMBER_INPUT="^([0-9]*|[0-9]+[\.]{0,1}[0-9]*)$";HtmlUtils.IRR_INTEGER_NUMBER_INPUT="^[0-9]*$";HtmlUtils.INPUT_DINGHIES_NUMBER_ALLOWED_CHARS='^[0-9]{0,2}$';HtmlUtils.INPUT_DINGHIES_CAPACITY_ALLOWED_CHARS='^[0-9]{0,3}$';HtmlUtils.IRR_TEXTARREA_OTHERS_ALLOWED_CHARS='^[a-zA-Z0-9\ \/\+\b\0\n]*$';HtmlUtils.IRR_COM_NAV_ALLOWED_CHARS='^[a-zA-Z0-9\ \+\b\0\n]*$';HtmlUtils.IRR_AERODROME_ICAO='^([a-z]|[A-Z]|[\b]|[\0]){0,4}$';HtmlUtils.IRR_STAY='^[0-9]{0,4}$';HtmlUtils.IRR_STAY_INFO='^[a-zA-Z0-9\ \b\0\n]*$';HtmlUtils.IRR_POB='^([]*|([tT]{1}|[tT]{1}[bB]{1}|[tT]{1}[bB]{1}[nN]{1})|([0-9]{1,3})|[\b]|[\0])$';HtmlUtils.IRR_AIRCRAFT_ID='^([a-zA-Z0-9\b\0]){0,7}$';HtmlUtils.IRR_FLIGHT_RULES='^([IVYZivyz\b\0]){0,1}$';HtmlUtils.IRR_TYPE_OF_FLIGHT='^([SNGMXsngmx\b\0]){0,1}$';HtmlUtils.IRR_NUMBER_OF_AIRCRAFT='^([1-9]{0,1}|[0-9]{2})$';HtmlUtils.IRR_TYPE_OF_AIRCRAFT='^[a-zA-Z0-9\b\0]{0,4}$';HtmlUtils.IRR_WAKE_TURBULENCE='^([LMHJlmhj\b\0]){0,1}$';HtmlUtils.IRR_EQUIPMENT='^[NnSsAaBbCcDdFfGgHhIiKkLlOoRrTtUuVvWwXxYyZzEeJjMm1-7]{0,46}$';HtmlUtils.IRR_SURVEILLANCE='^[AaCcEeHhIiLlPpSsXxBbUuVvDdGgNn1-2]{0,25}$';HtmlUtils.IRR_CRUISINGSPEED='^([knKN]{1}[0-9]{0,4}|[Mm]{1}[0-9]{0,3})?$';HtmlUtils.IRR_CRUISING_LEVEL='^([fFaA]{1}[0-9]{0,3}|[SsMm]{1}[0-9]{0,4}|[Vv]|[Vv][fF]|[Vv][fF][Rr])?$';HtmlUtils.IRR_EM_RADIO='^[UuVvEe]{0,3}$';HtmlUtils.IRR_SURV_EQUIPMENT='^[PpDdMmJj]{0,4}$';HtmlUtils.IRR_JACKETS='^[LlFfUuVv]{0,4}$';HtmlUtils.IRR_ALPHANUMERIC='^([a-zA-Z0-9\b\0]*)$';HtmlUtils.IRR_ALPHANUMERIC_SPACE='^([a-zA-Z0-9\b\0\ ]*)$';HtmlUtils.IRR_ALPHANUMERIC_SPACE_PLUS='^[a-zA-Z0-9\ \b\0\+]*$';HtmlUtils.IRR_ALPHANUMERIC_SPACE_PLUS_SLASH='^[a-zA-Z0-9\ \/\b\0\+]*$';HtmlUtils.IRR_ALPHANUMERIC_PLUS='^[a-zA-Z0-9\b\0\+]*$';HtmlUtils.IRR_ALPHANUMERIC_SLASH='^[a-zA-Z0-9\/\b\0]*$';HtmlUtils.IRR_ALPHANUMERIC_PLUS_SLASH='^[a-zA-Z0-9\/\+\b\0]*$';HtmlUtils.IRR_NUMERIC='^([0-9\b\0]*)$';HtmlUtils.IRR_ALPHABET='^[a-zA-Z\b\0]*$';HtmlUtils.IRR_ALPHABET_SPACE='^[a-zA-Z\b\0\ ]*$';HtmlUtils.IRR_ALPHABET_PLUS='^[a-zA-Z\b\0\+]*$';HtmlUtils.IRR_ALPHABET_SPACE_PLUS='^[a-zA-Z\ \b\0\+]*$';HtmlUtils.setInputRestrictorDoubleNumber=function(aInputObject){aInputObject.attr(HtmlUtils.A_AWINPUTRESTRICTION,HtmlUtils.IRR_DOUBLE_NUMBER_INPUT);HtmlUtils.checkAndSetFplInputRestrictor(aInputObject);};HtmlUtils.setInputRestrictorIntegerNumber=function(aInputObject){aInputObject.attr(HtmlUtils.A_AWINPUTRESTRICTION,HtmlUtils.IRR_INTEGER_NUMBER_INPUT);HtmlUtils.checkAndSetFplInputRestrictor(aInputObject);};HtmlUtils.checkAndSetFplInputRestrictor=function(aElement){if(HtmlUtils.isUndefinedOrIsNull(aElement.attr(HtmlUtils.A_AWINPUTRESTRICTION))===true){return;}var inputRestrictor=HtmlUtils.createFplInputRestrictor(aElement.attr(HtmlUtils.A_AWINPUTRESTRICTION));aElement.removeAttr(HtmlUtils.A_AWINPUTRESTRICTION);aElement.focus(function(){if(AWUtils.isUndefinedOrIsNull(inputRestrictor.oldValue)===true){inputRestrictor.oldValue=aElement.val();}});aElement.unbind('input.inputRestrictor propertychange.inputRestrictor');aElement.bind('input.inputRestrictor propertychange.inputRestrictor',inputRestrictor);};HtmlUtils.createFplInputRestrictor=function(aAwInputRestriction){var inputRestrictorRetVal=function(e){if(AWUtils.isUndefinedOrIsNullOrIsEmptyString(e)===true||AWUtils.isUndefinedOrIsNullOrIsEmptyString(e.target)===true){return;}var carretPosition=e.target.selectionStart;var sourceElement=JQ(e.target);var elementValue=sourceElement.val();if(HtmlUtils.isUndefinedOrIsNull(inputRestrictorRetVal.oldValue)===true&&inputRestrictorRetVal.oldValue!==HtmlUtils.C_EMPTY){inputRestrictorRetVal.oldValue=elementValue;}var elementRule=aAwInputRestriction;var patt=new RegExp(elementRule);var res=patt.test(elementValue);if(res===false){sourceElement.val(inputRestrictorRetVal.oldValue);carretPosition--;}else{inputRestrictorRetVal.oldValue=elementValue;}e.target.setSelectionRange(carretPosition,carretPosition);};var retVal=inputRestrictorRetVal;return retVal;};HtmlUtils.getPicInputRestrictionRegexp=function(){var picInputRestriction=getConfigValue2('fplForm','picInputRestriction','alphabet ');return HtmlUtils.getInputRestrictionRegexp(picInputRestriction);};HtmlUtils.getOtherInputRestrictionRegexp=function(){var otherInputRestriction=getConfigValue2('fplForm','otherInputRestriction','alphanumeric +/');return HtmlUtils.getInputRestrictionRegexp(otherInputRestriction);};HtmlUtils.getRmkInputRestrictionRegexp=function(){var otherInputRestriction=getConfigValue2('fplForm','rmkInputRestriction','alphanumeric +');return HtmlUtils.getInputRestrictionRegexp(otherInputRestriction);};HtmlUtils.getArcOperatorInputRestrictionRegexp=function(){var otherInputRestriction=getConfigValue2('fplForm','rmkInputRestriction','alphanumeric ');return HtmlUtils.getInputRestrictionRegexp(otherInputRestriction);};HtmlUtils.getInputRestrictionRegexp=function(aCfgValue){var retVal=HtmlUtils.IRR_ALPHABET;if(aCfgValue==='alphabet'){retVal=HtmlUtils.IRR_ALPHABET;}else if(aCfgValue==='alphanumeric'){retVal=HtmlUtils.IRR_ALPHANUMERIC;}else if(aCfgValue==='alphanumeric '){retVal=HtmlUtils.IRR_ALPHANUMERIC_SPACE;}else if(aCfgValue==='alphanumeric +'){retVal=HtmlUtils.IRR_ALPHANUMERIC_SPACE_PLUS;}else if(aCfgValue==='alphanumeric +/'){retVal=HtmlUtils.IRR_ALPHANUMERIC_SPACE_PLUS_SLASH;}else if(aCfgValue==='alphanumeric+'){retVal=HtmlUtils.IRR_ALPHANUMERIC_PLUS;}else if(aCfgValue==='alphanumeric/'){retVal=HtmlUtils.IRR_ALPHANUMERIC_SLASH;}else if(aCfgValue==='alphanumeric+/'){retVal=HtmlUtils.IRR_ALPHANUMERIC_PLUS_SLASH;}else if(aCfgValue==='alphabet+'){retVal=HtmlUtils.IRR_ALPHABET_PLUS;}else if(aCfgValue==='alphabet +'){retVal=HtmlUtils.IRR_ALPHABET_SPACE_PLUS;}else if(aCfgValue==='alphabet '){retVal=HtmlUtils.IRR_ALPHABET_SPACE;}return retVal;};HtmlUtils.setInputTextCharsCheckerWhileTyping=function(aInputObject,aCheckRegexp){aInputObject.attr(HtmlUtils.A_AWINPUTRESTRICTION,aCheckRegexp);HtmlUtils.checkAndSetFplInputRestrictor(aInputObject);};HtmlUtils.setInputRestrTypingPIC=function(aInputElement){var picInputRestrictionRegex=HtmlUtils.getPicInputRestrictionRegexp();HtmlUtils.setInputTextCharsCheckerWhileTyping(aInputElement,picInputRestrictionRegex);};HtmlUtils.setInputRestrTypingCrew=function(aInputElement){HtmlUtils.setInputRestrTypingPIC(aInputElement);};HtmlUtils.setInputRestrTypingAerodromeICAO=function(aInputObject){aInputObject.attr(HtmlUtils.A_AWINPUTRESTRICTION,HtmlUtils.IRR_AERODROME_ICAO);HtmlUtils.checkAndSetFplInputRestrictor(aInputObject);};HtmlUtils.setInputRestrTypingStay=function(aInputObject){aInputObject.attr(HtmlUtils.A_AWINPUTRESTRICTION,HtmlUtils.IRR_HHMM_MAX2359);HtmlUtils.checkAndSetFplInputRestrictor(aInputObject);};HtmlUtils.setInputRestrTypingStayInfo=function(aInputObject){aInputObject.attr(HtmlUtils.A_AWINPUTRESTRICTION,HtmlUtils.IRR_STAY_INFO);HtmlUtils.checkAndSetFplInputRestrictor(aInputObject);};HtmlUtils.fixStringByRegexp=function(aValueString,aAwInputAllowedRegexp){if(AWUtils.isUndefinedOrIsNullOrIsEmptyString(aValueString)===true||AWUtils.isUndefinedOrIsNullOrIsEmptyString(aAwInputAllowedRegexp)===true){return aValueString;}var correctRegexp=new RegExp(aAwInputAllowedRegexp);var valueChars=aValueString.split(HtmlUtils.C_EMPTY);var retVal=HtmlUtils.C_EMPTY;for(var i=0;i<valueChars.length;i++){var iChar=valueChars[i];if(AWUtils.isUndefinedOrIsNull(iChar)===true){continue;}var isCharValid=correctRegexp.test(iChar);if(isCharValid===true){retVal+=iChar;}}return retVal;};HtmlUtils.latinizeLettersEncodeForHtml=function(aString){if(AWUtils.isUndefinedOrIsNull(aString)===true){aString=HtmlUtils.C_EMPTY;}var retVal=HtmlUtils.C_EMPTY+latinize(aString);var splitedRetVal=retVal.split(HtmlUtils.C_SPACE_CHAR);var retValArray=[];for(var i=0;i<splitedRetVal.length;i++){var iRetvalPart=''+splitedRetVal[i];if(AWUtils.isUndefinedOrIsNullOrIsEmptyString(iRetvalPart)===true){retValArray.push(HtmlUtils.C_EMPTY);continue;}retValArray.push(iRetvalPart.replace(/\W/g,''));}retVal=retValArray.join(HtmlUtils.C_SPACE_CHAR);return HtmlUtils.encodeForHTML(retVal);};HtmlUtils.arrayRemoveDuplicateValues=function(aArray){if(AWUtils.isUndefinedOrIsNull(aArray)===true){return;}var retVal=[];for(var i=0;i<aArray.length;i++){var iItem=aArray[i];if(AWUtils.isUndefinedOrIsNull(iItem)===true){continue;}if(retVal.includes(iItem)===false){retVal.push(iItem);}}return retVal;};HtmlUtils.setRestrictionsForColourInput=function(aColourInput){if(AWUtils.isUndefinedOrIsNull(aColourInput)===true){return;}aColourInput.attr(HtmlUtils.A_AWINPUTRESTRICTION,HtmlUtils.IRR_COLOURINPUT);HtmlUtils.checkAndSetFplInputRestrictor(aColourInput);HtmlUtils.setLatinizeWhileTyping(aColourInput);};HtmlUtils.setRestrictionsForColourMarksInput=function(aColourInput){if(AWUtils.isUndefinedOrIsNull(aColourInput)===true){return;}aColourInput.attr(HtmlUtils.A_AWINPUTRESTRICTION,HtmlUtils.IRR_COLOUR_MARKS_INPUT);HtmlUtils.checkAndSetFplInputRestrictor(aColourInput);HtmlUtils.setLatinizeWhileTyping(aColourInput);};HtmlUtils.setRestrictionsForDinghiesInput=function(aColourInput){if(AWUtils.isUndefinedOrIsNull(aColourInput)===true){return;}aColourInput.attr(HtmlUtils.A_AWINPUTRESTRICTION,HtmlUtils.IRR_DINGHIES_INPUT);HtmlUtils.checkAndSetFplInputRestrictor(aColourInput);HtmlUtils.setLatinizeWhileTyping(aColourInput);};HtmlUtils.divGridD=function(aContent){var retValDiv=div(aContent);retValDiv.attr('class','ui-grid-d');return retValDiv;};HtmlUtils.divGridDResponsive=function(aContent){var retValDiv=HtmlUtils.divGridD(aContent);retValDiv.addClass('my-breakpoint');return retValDiv;};HtmlUtils.divGridSolo=function(aContent){var retValDiv=div(aContent);retValDiv.attr('class','ui-grid-solo');return retValDiv;};HtmlUtils.datetimeGridSolo=function(aContent){var retVal=HtmlUtils.divGridSolo(aContent);retVal.addClass('datetime-input-grid');return retVal;};HtmlUtils.initIXOSelectMenu=function(){JQ.widget("mobile.selectmenu",JQ.mobile.selectmenu,{setButtonText:function(){var self=this,selected=this.selected(),text=this.placeholder,span=JQ(document.createElement("span"));alternativebtntext=self.select.data(HtmlUtils.C_ALTERNATE_BUTTON_TEXTS);if(AWUtils.isUndefinedOrIsNull(alternativebtntext)===true){alternativebtntext={};self.select.data(HtmlUtils.C_ALTERNATE_BUTTON_TEXTS,alternativebtntext);}this.button.children("span").not(".ui-li-count").remove().end().end().prepend((function(){if(selected.length){text=selected.map(function(){var value=JQ(this).val();if(value in alternativebtntext){return alternativebtntext[value];}else{return JQ(this).text();}}).get().join(", ");}else{text=self.placeholder;}if(text){span.text(text);}else{span.html("&#160;");}return span.addClass(self.select.attr("class")).addClass(selected.attr("class")).removeClass("ui-screen-hidden");})());},setAlternateButtonTexts:function(aTextMap){this.option("alternatebtntextmap",aTextMap);},_buildList:function(){var retVal=this._super();if(getConfigValue2('fplForm','selectmenuItemCheckBoxPosition','left')==='left'){var anchors=JQ(this.list.find('li>a'));anchors.removeClass('ui-btn-icon-right');anchors.addClass('ui-btn-icon-left');}return retVal;},build:function(){var retVal=this._super();if(this.element.is("select.multiselect")===true&&AWUtils.isUndefinedOrIsNull(this.header)===false){var clearLocKey="Common.clear";var aClearText=getLocalizedString(clearLocKey);var clearBtn=JQ('<a role="button" href="#" class="ui-btn ui-corner-all ui-btn-right"></a>');clearBtn.attr(AWLocale.LOCALISATION_KEY,clearLocKey);clearBtn.text(aClearText);clearBtn.click(function(){var selectmenu=JQ(this).parent().parent().parent();var listItems=selectmenu.find('ul > li');for(var i=0;listItems.length>i;i++){var iListItem=JQ(JQ(this).parent().parent().parent().find('ul > li')[i]);var isSelected=iListItem.attr('aria-selected');if(isSelected==='true'){iListItem.click();}}});var applyLocKey="Common.apply";var aApplyText=getLocalizedString(applyLocKey);var applyBtn=JQ('<a role="button" href="#" class="ui-btn ui-corner-all ui-btn-right"></a>');applyBtn.attr(AWLocale.LOCALISATION_KEY,applyLocKey);applyBtn.text(aApplyText);applyBtn.click(function(){var selectmenu=JQ(this).parent().parent().find('a.ui-icon-delete');selectmenu.click();});var buttons=JQ('<div class="selectmenuTitleBtns"></div>');buttons.append(clearBtn);buttons.append(applyBtn);this.header.append(buttons);this.header.addClass('r_multiselect_header');}return retVal;},_create:function(){var retVal=this._super();this.button.click(function(){JQMUtil.refreshSelectmenuTheme();});return retVal;},open:function(){alert('otvaram');}});JQ.widget("mobile.dialog",JQ.mobile.dialog,{_handlePageBeforeShow:function(){var retVal=this._super();JQ('body').addClass('opened-dialog-page');return retVal;},_handlePageBeforeHide:function(){var retVal=this._super();JQ('body').removeClass('opened-dialog-page');return retVal;}});};HtmlUtils.createProgressBar=function(totalValue){const retVal=JQ('<div class="rs-progressBar">');const valueElement=JQ('<div class="rs-progressBarValue">');const textElement=JQ('<div class="rs-progressBarText">');valueElement.width(0);retVal.append(valueElement);retVal.append(textElement);retVal.data("totalValue",totalValue);retVal.bind("update",(e,value)=>{value=value||valueElement.data("value")+1||1;if(value<=totalValue){const perc=Math.min(parseInt(value/totalValue*100),100);valueElement.width("calc("+perc+"% - 1.4em)");valueElement.data("value",value);textElement.text(perc+"%");}});return retVal;};HtmlUtils.inputCounter=function(inputElement){const charLimit=(inputElement&&inputElement.attr)?parseInt(inputElement.attr("maxlength")):null;const retVal=(charLimit)?JQ('<span>'):undefined;if(retVal){const countEl=JQ("<span>");const textEl=JQ("<span>");const setupEls=function(){const countVal=charLimit-inputElement.val().length;const locKey=(countVal===1)?"char":"chars";textEl.attr(AWLocale.LOCALISATION_KEY,`Common.${locKey}`);countEl.text(countVal);AWLocale.processLocalisationOnJQElement(textEl);};const inputId=inputElement.attr("id");countEl.addClass("rs-input-counter-value");textEl.addClass("rs-input-counter-text");countEl.text(charLimit);inputElement.attr("data-input-counter",true);if(inputId){retVal.attr("data-input-id",inputId);}retVal.addClass("rs-input-counter");retVal.append(countEl);retVal.append(textEl);inputElement.change(setupEls);inputElement.on("keyup keypress",setupEls);setupEls();}return retVal;};function RsForm(id,title,content,release,customClass){var _instance=this;var _jInstance=JQ(this);this.id=id;this.title=title;this.div=JQ('<div id="'+HtmlUtils.encodeForHTMLAttribute(id)+'" class="rsys-panel rsys-form"></div>');this.animationEnabled=true;this.content=content;this.minimizeInProgress=false;if(typeof release==="string"&&customClass===undefined){customClass=release;release=undefined;}this.release=(release===undefined)?true:release;this.retainCount=0;const FORM_HIDDEN_CLASS="rsys-panel-hidden";const FORM_HIDING_CLASS="rsys-panel-hiding";this.init=function(customClass){var titleDiv=JQ('<div class="rsys-form-title">');var titleLabel=JQ('<div class="rsys-form-title-label">');var minimizeBtn=JQ('<a class="ui-icon-carat-u ui-btn-icon-left rsys-form-minimize">');var closeBtn=JQ('<a class="ui-icon-delete ui-btn-icon-right">');var contentDiv=JQ('<div class="rsys-form-content">');minimizeBtn.appendTo(titleDiv);titleLabel.appendTo(titleDiv);closeBtn.appendTo(titleDiv);contentDiv.append(_instance.content);minimizeBtn.attr("id",RsForm.ELEMENT.MINIMIZE_BUUTON_ID);closeBtn.attr("id",RsForm.ELEMENT.CLOSE_BUTTON_ID);titleLabel.attr(AWLocale.LOCALISATION_KEY,this.title);titleLabel.data('masterLocaleKey',this.title);contentDiv.find("input[type='text']").change(function(){if(this.enableSpecialChars!==true){AWUtils.disableSpecialCharsInUserRequest(JQ(this));}});if(customClass!==undefined){_instance.div.addClass(customClass);}localeObject(titleLabel,this.title);minimizeBtn.click(function(e){_instance.minimize();});if(_instance.content instanceof jQuery){_instance.content.on("close",_instance.hide);}closeBtn.click(function(e){_instance.hide(false,e);});_instance.div.append(titleDiv);_instance.div.append(contentDiv);_instance.div.hide();_instance.div.addClass(FORM_HIDDEN_CLASS);};this.addClass=function(className){_instance.div.addClass(className);};this.fitHeightToPage=function(){_instance.div.fitHeightToPage();};this.loading=function(b){_instance.div.loading(b);};this.setAnimationEnabled=function(enable){_instance.animationEnabled=enable;};this.show=function(){this.retainCount++;_instance.div.show();AWUtils.invokeLater(function(){_instance.div.removeClass(FORM_HIDDEN_CLASS);_jInstance.trigger(RsForm.EVENTS.AFTER_SHOW);});};this.minimize=function(){var btn=_instance.div.find('.rsys-form-minimize');var content=_instance.div.find('.rsys-form-content');if(_instance.minimizeInProgress){return;}_instance.minimizeInProgress=true;if(btn.hasClass("ui-icon-carat-u")){JQ(_instance.div).animatedMinimize(function(){btn.removeClass("ui-icon-carat-u");btn.addClass("ui-icon-carat-d");content.hide();_instance.minimizeInProgress=false;},_instance.animationEnabled);}else{content.show();JQ(_instance.div).animatedMaximize(function(){btn.removeClass("ui-icon-carat-d");btn.addClass("ui-icon-carat-u");_instance.minimizeInProgress=false;},_instance.animationEnabled);}};this.isMinimized=function(){var btn=_instance.div.find('.rsys-form-minimize');if(btn.hasClass("ui-icon-carat-u")===true){return false;}else{return true;}};this.isVisible=function(){return(!(_instance.div.hasClass(FORM_HIDDEN_CLASS)||_instance.div.hasClass(FORM_HIDING_CLASS))&&_instance.div.is(":visible"));};this.hide=function(force,origEvent){var closed=false;var canClose=true;if(force===undefined||force===false){canClose=_jInstance.triggerHandler(RsForm.EVENTS.BEFORE_CLOSE,origEvent);canClose=(canClose!==undefined)?canClose:true;}if(canClose){if(_instance.retainCount>0){_instance.retainCount--;}_instance.div.on("transitionend",function(){if(_instance.div.hasClass(FORM_HIDING_CLASS)){_instance.div.hide();_instance.div.removeClass(FORM_HIDING_CLASS);_jInstance.trigger(RsForm.EVENTS.CLOSE,origEvent);if(_instance.release&&_instance.retainCount===0){_instance.destroyForm(origEvent);}}});_instance.div.addClass(FORM_HIDING_CLASS);_instance.div.addClass(FORM_HIDDEN_CLASS);closed=true;}return closed;};this.destroyForm=function(e){var elem=document.getElementById(_instance.div.attr("id"));_instance.div.find('select[multiple="multiple"]').selectmenu("destroy");if(elem&&elem.parentNode!==null){elem.parentNode.removeChild(elem);}else{_instance.div.remove();}_jInstance.trigger(RsForm.EVENTS.AFTER_CLOSE,e);debug("RS-FORM was destroyed ["+_instance.id+"]");};this.on=function(elem,callback){_jInstance.on(elem,callback);};this.one=function(elem,callback){_jInstance.one(elem,callback);};this.init(customClass);};RsForm.EVENTS={AFTER_SHOW:"aftershow",BEFORE_CLOSE:"beforeclose",CLOSE:"close",AFTER_CLOSE:"afterclose"};RsForm.ELEMENT={MINIMIZE_BUUTON_ID:"minimizeButton",CLOSE_BUTTON_ID:"closeButton"};function RsConfiguration(){this.appConfig;var _instance=this;this.loadAppConfig=function(callback){this.appConfig=config;callback(this.appConfig);};this.loadConfigObject=function(nodeName,defaultValuesObject){var retVal=defaultValuesObject;if(typeof retVal==="object"){var keys=Object.keys(defaultValuesObject);var nodeCfg=(this.appConfig)?this.appConfig:undefined;nodeCfg=(nodeCfg&&nodeName)?nodeCfg[nodeName]:nodeCfg;if(nodeCfg){if(keys.length>0){keys.forEach(function(keyName){if(nodeCfg[keyName]!==undefined){retVal[keyName]=_instance.processNode(keyName,defaultValuesObject,nodeCfg,0);}});}}}return retVal;};this.processNode=function(nodeName,dft,cfg,level){var retVal;const dftVal=dft[nodeName];const cfgVal=cfg[nodeName];if(Array.isArray(dftVal)){retVal=(Array.isArray(cfgVal))?cfgVal:dftVal;}else if(dftVal&&typeof dftVal==="object"){const keys=Object.keys(dftVal);retVal=(Array.isArray(dftVal))?[]:{};if(keys.length>0&&cfgVal){keys.forEach(function(keyName){retVal[keyName]=_instance.processNode(keyName,dftVal,cfgVal,level+1);});}else{retVal=(cfgVal)?cfgVal:dftVal;}}else{retVal=(cfgVal===undefined)?dftVal:cfgVal;}return retVal;};}/** * @file awConfigUtils.js je wrapper pre ziskavanie hodnot konfiguracnych poloziek.  * Volania na ziskavanie rovnakej konfiguracnej * polozky z viacerych bundle-ov mozu byt takto na jednom mieste. Taktiez pri zmene * umiestnenia alebo nazvu konfig polozky postacuje zmenit udaj na tomto mieste. *  * @author Matej Ponk <matej.poncak@r-sys.sk> * 27.09.2019 *  * (C) Copyright 2019  R-SYS,s.r.o */function AWConfigUtils(){}AWConfigUtils.getAlignPreviewSendMsg=function(){return getConfigValue('alignAtsMsgPreviewText','left');};AWConfigUtils.getPutDefaultAIPDocToOther=function(){return getConfigValue2('aipViewer','putDefaultAIPDocToOther',true);};AWConfigUtils.getPreffiledDOF=function(){var offset=getConfigValue2('fplForm','dofPreffilOffsetDays',null);return AWUtils.getDateOffsetFromNow(offset);};AWConfigUtils.getPreffiledEOBTHHMM=function(){var offset=getConfigValue2('fplForm','eobtPreffilOffsetMinutes',null);return AWUtils.getTimeOffsetHHMMFromNow(offset);};AWConfigUtils.getPreffiledEOBTInMinutes=function(){var eobtHHMM=AWConfigUtils.getPreffiledEOBTHHMM();if(eobtHHMM===null){return null;}var hours=eobtHHMM.substring(0,2);var minutes=eobtHHMM.substring(2);return(Number(hours)*60)+Number(minutes);};AWConfigUtils.isCloseFplFormAfterSendEnabled=function(){return getConfigValue2('fplForm','closeFlightPlanFormAfterSend',false)};AWConfigUtils.isAdditionalInformationsEnabled=function(){return getConfigValue2('fplForm','enableAdditionalInformations',false)};AWConfigUtils.isShowHeliportNameEnabled=function(){return getConfigValue2('fplForm','showHeliportName',true);};AWConfigUtils.isTranslateALLRouteICAONamesToCoordinatesEnabled=function(){return getConfigValue2('fplForm','translateALLRouteICAONamesToCoordinates',false);};AWConfigUtils.getDefaultAircraftSpeedUnit=function(){return getConfigValue2('aircraft','defaultAircraftSpeedUnit',"km/h");};AWConfigUtils.getShowDeleteButtonArchive=function(){return getConfigValue2('flightPlans','showDeleteButtonArchive',true);};AWConfigUtils.getMinAllowedMinutesEobdt2CurrentVfrWarn=function(){return getConfigValue2('fplForm','minAllowedMinutesEobdt2CurrentVfrWarn',0);};AWConfigUtils.getMinAllowedMinutesEobdt2CurrentIfrWarn=function(){return getConfigValue2('fplForm','minAllowedMinutesEobdt2CurrentIfrWarn',0);};function getConfigValue(key,dftVal){var retVal=dftVal;if(config[key]!=undefined){retVal=config[key];}return retVal;}function getConfigValue2(key1,key2,dftVal){var retVal=dftVal;if(config[key1]!=undefined&&config[key1][key2]!=undefined){retVal=config[key1][key2];}return retVal;}function getConfigValue3(key1,key2,key3,dftVal){var retVal=dftVal;if(config[key1]!=undefined&&config[key1][key2]!=undefined&&config[key1][key2][key3]!=undefined){retVal=config[key1][key2][key3];}return retVal;}function getConfigValue4(key1,key2,key3,key4,dftVal){var retVal=dftVal;if(config[key1]!=undefined&&config[key1][key2]!=undefined&&config[key1][key2][key3]!=undefined&&config[key1][key2][key3][key4]!=undefined){retVal=config[key1][key2][key3][key4];}return retVal;}function AwWinMan(ctrlPanel,rootElem){this.rootElem=rootElem;this.areas={};this.areaModes={};this.animationEnabled=true;var _instance=this;var _ctrlPanel=ctrlPanel;var AREA_MODE={NORMAL:0,APPENDING:1};this.createForm=function(id,title,content,release,customClass){var form=new RsForm(id,title,content,release,customClass);var formDiv=form.div;form.setAnimationEnabled(_instance.animationEnabled);formDiv.addClass('ui-body-'+_ctrlPanel._actualTheme);if(getConfigValue("forceUppercaseInput",false)){upperCaseInputFix(content);}form.on(RsForm.EVENTS.AFTER_CLOSE,function(f){if(form.retainCount===0){removeFormFromArea(form);}});formDiv.find('.rsys-form-title').click(function(){moveToTop(form);});_instance.rootElem.append(formDiv);formDiv.trigger("create");return form;};this.createDocumentViewerForm=function(id,title,src,type,release,customClass){var content=JQ('<iframe width="100%" height="100%">');var form=_instance.createForm(id,title,content,release,customClass);form.setSrc=function(src,name){var downloadLabel=JQ('<p>');var downloadLinkP=JQ('<p class="documentViewer-notSupportedLink">');const downloadLink=JQ('<a target="_blank" href="'+src+'">');if(name){downloadLink.attr("download",name);}downloadLabel.attr(AWLocale.LOCALISATION_KEY,"Common.msg.notSupportedInlinePdf");downloadLink.attr(AWLocale.LOCALISATION_KEY,"Common.msg.openInNewTab");downloadLinkP.append(downloadLink);content.append(downloadLabel);content.append(downloadLinkP);AWLocale.processLocalisationOnJQElement(content);if(AWUtils.isWebKit){var pattern="data:application/pdf;base64,";var docFitMode=(window.innerHeight>window.innerWidth)?"FitV":"FitH";if(src.startsWith(pattern)){var data=src.substr(pattern.length);var blob=AWUtils.b64toBlob(data,"application/pdf");src=URL.createObjectURL(blob);form.on(RsForm.EVENTS.AFTER_CLOSE,function(e){URL.revokeObjectURL(src);});}src+="#view="+docFitMode;downloadLink.attr("href",src);if(AWUtils.device.is_ios()){var linkDiv=JQ('<div class="documentViewer-notSupported">');downloadLinkP.append(downloadLink);linkDiv.append(downloadLabel);linkDiv.append(downloadLinkP);content.before(linkDiv);content.hide();downloadLink.click((e)=>{AwWinMan.openInNewWindow(src);e.preventDefault();form.hide();});return;}}content.attr('src',src);};if(src!==undefined&&src!==null){form.setSrc(src);}if(type!==undefined&&type!==null){content.attr('type',type);}form.div.addClass("documentViewer");content.on('load',function(e,n){var obj=JQ(this);setTimeout(function(){obj.attr("width","100%");obj.attr("value","FitH");},300);});return form;};this.createDialogForm=function(id,title,content,release,customClass){if(AWUtils.isUndefinedOrIsNull(id)===true){id='';}var dialogScreenID=id+'-dialog-background-screen';_ctrlPanel.dialogScreenRequested(dialogScreenID);return this.createForm(id,title,content,release,customClass);};this.showDialogForm=function(form,area,appendFlag){if(AWUtils.isRsForm(form)===false){this.showForm(form,area,appendFlag);return;}var formID='';if(AWUtils.isUndefinedOrIsNull(form.id)===false){formID=form.id;}var dialogScreenID=formID+'-dialog-background-screen';var dialogScreen=JQ('#'+dialogScreenID);form.addClass('aw-dialog-panel');form.on(RsForm.EVENTS.AFTER_SHOW,function(){dialogScreen.loading(false);});form.on(RsForm.EVENTS.AFTER_CLOSE,function(){dialogScreen.remove();});this.showForm(form,area,appendFlag);};this.showForm=function(form,area,appendFlag=false,replaceFlag=false){var actualFormInArea=_instance.getActualForm(area);if(actualFormInArea!==undefined){if(form===actualFormInArea){JQ(form).trigger(RsForm.EVENTS.AFTER_SHOW);return;}else if(appendFlag&&!replaceFlag&&actualFormInArea.id===form.id){var e=form.div.get(0);var parent=e.parentNode;if(parent){parent.removeChild(e);}else{form.div.remove();}return;}else if(replaceFlag&&actualFormInArea.id===form.id){}actualFormInArea.one(RsForm.EVENTS.CLOSE,function(){if(appendFlag){AWUtils.invokeLater(function(){actualFormInArea.retainCount--;});}processShowForm(form,area);setAreaMode(area,AREA_MODE.NORMAL);});if(appendFlag){setAreaMode(area,AREA_MODE.APPENDING);actualFormInArea.retainCount++;form.on(RsForm.EVENTS.CLOSE,function(){if(getAreaMode(area)===AREA_MODE.NORMAL&&_instance.areas[area]&&_instance.areas[area].length>1){try{let oldFormIndex=_instance.areas[area].length-2;let oldForm=_instance.areas[area][oldFormIndex];oldForm.show();}catch(e){debug("Can not restore previous form in "+area+" area.");}}});actualFormInArea.hide();}else{clearArea(area);}}else{processShowForm(form,area);}};this.setAnimation=function(b){_instance.animationEnabled=b;};processShowForm=function(form,area){addFormToArea(form,area);if(typeof _ctrlPanel.setLocalizedTextContent==="function"){_ctrlPanel.setLocalizedTextContent();}else{AWLocale.processLocalisationOnJQElement(form.div);}form.on(RsForm.EVENTS.AFTER_SHOW,function(e){form.div.find("select").each(function(e){JQ(this).selectmenu().selectmenu("refresh");});});moveToTop(form);form.show();};moveToTop=function(form){JQ('.rsys-form-active').removeClass('rsys-form-active');form.div.addClass('rsys-form-active');};addFormToArea=function(form,area){var forms=_instance.areas[area];if(forms===undefined){_instance.areas[area]=[form];}else{var f=_instance.getFormWithId(form.id);if(f&&f.id===form.id){removeFormFromArea(f);}forms.push(form);}form.area=area;form.div.addClass("aw-winman-area-"+area);};removeFormFromArea=function(form){if(form.area){var forms=_instance.areas[form.area];var i=forms.indexOf(form);if(i>-1){forms.splice(i,1);}form.div.removeClass("aw-winman-area-"+form.area);delete form.area;}};getFormIndex=function(form,area){return(_instance.areas[area]!==undefined)?_instance.areas[area].indexOf(form):-1;};this.getActualForm=function(area){var retVal;if(_instance.areas[area]&&_instance.areas[area].length>0){JQ.each(_instance.areas[area],function(idx,form){if(form&&form.isVisible()){retVal=form;return false;}});}return retVal;};this.getFormWithId=function(formId){var retVal;JQ.each(Object.values(AwWinMan.AREA),function(areaIdx,area){JQ.each(_instance.areas[area],function(formIdx,form){if(form.id===formId){retVal=form;return false;}});if(retVal){return false;}});return retVal;};setAreaMode=function(area,mode){_instance.areaModes[area]=mode;};getAreaMode=function(area){var rv=_instance.areaModes[area];if(rv===undefined){rv=AREA_MODE.NORMAL;setAreaMode(area,rv);}return rv;};clearArea=function(area){var forms=_instance.areas[area];if(forms!==undefined){var arr=forms.slice(0);for(var i=0;i<arr.length;i++){var form=arr[i];_instance.areas[area].remove(form);form.hide(true);}}};upperCaseInputFix=function(content){var selector="input[type='text']:not([data-role='datebox']),textarea";if(JQ.isArray(content)){JQ.each(content,function(i,e){e.find(selector).forceUppercaseInput();});}else if(content instanceof jQuery){content.find(selector).forceUppercaseInput();}else{JQ(content).find(selector).forceUppercaseInput();}};};AwWinMan.openInNewWindow=function(data){const pdfDiv=document.createElement('div');pdfDiv.innerHTML='<object style="display:none;" id="docuFrame" type="application/pdf" width="1px" height="1px" data="'+data+'"></object>';document.lastElementChild.appendChild(pdfDiv);var frame=document.getElementById('docuFrame');window.open(frame.data);frame.remove();pdfDiv.remove();};AwWinMan.AREA={LEFT:"left",CENTER:"center",RIGHT:"right"};function AwTime(){this.staticTime={};this.wholeDay;const DEFAULT_STATIC_TIME_NODE_NAME="_main";this.getTime=function(dataType){var retVal;var staticTimeParams=this.getStaticTimeParams(dataType);retVal=(staticTimeParams&&staticTimeParams.date)?staticTimeParams.date:new Date();return retVal;};this.getStaticTimeParams=function(dataType){return(dataType&&this.staticTime[dataType])?this.staticTime[dataType]:this.staticTime[DEFAULT_STATIC_TIME_NODE_NAME];};this.setStaticTime=function(dateTime,params){var newDateTime=(dateTime instanceof Date)?dateTime:null;var dataType=(params&&typeof params.dataType==="string")?params.dataType:null;var wholeDay=(params&&typeof params.wholeDay==="boolean")?params.wholeDay:false;var nodeName=(dataType!==null)?params.dataType:DEFAULT_STATIC_TIME_NODE_NAME;var node=this.staticTime[nodeName];var changed=(!node||(newDateTime!==node.date));if(changed){if(!node){node=this.staticTime[nodeName]={};}node.date=newDateTime;if(newDateTime===null){delete this.staticTime[nodeName];}else if(params){node.wholeDay=wholeDay;}JQ(this).trigger(AwTime.EVENT.STATIC_TIME_CHANGED,[dataType,node]);}};this.getStaticTime=function(dataType){var retVal;var node=(dataType&&this.staticTime[dataType])?this.staticTime[dataType]:this.staticTime[DEFAULT_STATIC_TIME_NODE_NAME];retVal=(node&&node.date)?node.date:null;return retVal;};this.isWholeDay=function(){return(this.wholeDay===undefined)?false:this.wholeDay;};}AwTime.EVENT={STATIC_TIME_CHANGED:"staticTimeChanged"};AwTime.DATA_TYPE={MAP:"map",NOTAM:"notam",METEO:"meteo",FUA:"fua"};function AWLocale(){}AWLocale.LOCALISATION_KEY="localisationkey";AWLocale.LOCALISATION_KEY_TITLE="localisationkeyTitle";AWLocale.COUNTRY_CODE_DEPEND_KEY="localisationCountryCode";AWLocale.prototype.currentAbbr;AWLocale.loadLocale=function(abbr,revision,callbackFnc){var dir="locales/";var url;if(!abbr){return;}url=AWUtils.getHomeUrl()+dir+abbr+".json";if(AWLocale.currentAbbr===abbr){debug("Locale '"+abbr+"' is already loaded! Skip loading ...");if(typeof callbackFnc==='function'){callbackFnc();}return;}loadFinished=function(){var revStr=revision||"";JQ(document).trigger(AWLocale.EVENT.LOCALE_CHANGED,abbr);debug("[AWLocale] loadLocale: "+abbr+", revision: "+revStr);if(typeof callbackFnc==='function'){callbackFnc();}};if(typeof revision==="function"){callbackFnc=revision;revision=undefined;}if(revision!==undefined&&revision.length>0){url+="?"+revision;}JQ.ajax({dataType:"json",url:url,cache:true,success:function(data,status,jqHhr){JQ.i18n.dict=null;JQ.i18n.load(data);AWLocale.currentAbbr=abbr;if(JQ.isArray(config.amendLocaleFiles)&&config.amendLocaleFiles.length>0){loadAmendLocaleFiles(dir,config.amendLocaleFiles,function(){loadBundlesLocaleFiles(loadFinished);});}else{loadBundlesLocaleFiles(loadFinished);}},error:function(jqXhr,status,error){debug("[AWLocale] Can not load file: "+url);if(typeof callbackFnc==='function'){callbackFnc();}}});};loadBundlesLocaleFiles=function(callback){if(typeof AppController==="function"&&AppController.bundleController){var bundleNames=Object.keys(AppController.bundleController.availableBundles);if(bundleNames.length>0){var syncCnt=0;for(var i=0;i<bundleNames.length;i++){var bName=bundleNames[i];var localeFiles=AppController.bundleController.getBundleLocaleFile(bName,AWLocale.currentAbbr);if(localeFiles.length>0){JQ.each(localeFiles,function(idx,localeFileName){if(localeFileName!==undefined){syncCnt++;AWLocale.appendLocale(localeFileName,AppController.appRevision,function(){syncCnt--;if(syncCnt===0&&typeof callback==="function"){callback();}});}});}}}}else if(typeof callback==="function"){callback();}};loadAmendLocaleFiles=function(dir,filenames,callback){var syncCnt=0;var loading=false;var rev=(typeof AppController!=="undefined"&&AppController.appRevision)?AppController.appRevision:"";for(var i=0;i<filenames.length;i++){var arr=filenames[i].split(/(\w*)_(\w{2}).json/);if(arr.length>1&&arr[2]===AWLocale.currentAbbr){var localeFile=dir+filenames[i];loading=true;syncCnt++;AWLocale.appendLocale(localeFile,rev,function(){syncCnt--;if(syncCnt===0&&typeof callback==="function"){callback();}});}}if(!loading&&typeof callback==="function"){callback();}};AWLocale.appendLocale=function(fileUrn,revision,callbackFnc){var url=AWUtils.getHomeUrl()+fileUrn;if(typeof revision==="function"){callbackFnc=revision;revision=undefined;}if(revision!==undefined&&typeof revision==="string"&&revision.length>0){url+="?"+revision;}JQ.ajax({dataType:"json",url:url,cache:true,success:function(data,status,jqHhr){var revStr=revision||"";debug("[AWLocale] appendLocale: "+fileUrn+", revision: "+revStr);JQ.i18n.load(data);if(typeof callbackFnc==='function'){callbackFnc();}},error:function(jqXhr,status,error){debug("[AWLocale] Can not append file: "+url);if(typeof callbackFnc==='function'){callbackFnc();}}});};AWLocale.localizeJqElement=function(element,localeKey){if(element instanceof jQuery){var span=JQ('<span></span>');span.attr(AWLocale.LOCALISATION_KEY,localeKey);element.html(span);}};AWLocale.processLocalisationOnJQElement=function(element){if(element instanceof jQuery){localeJqObject(element,element.attr(AWLocale.LOCALISATION_KEY));element.find("["+AWLocale.LOCALISATION_KEY+"]").each(function(idx,o){var aObj=JQ(o);localeJqObject(aObj,aObj.attr(AWLocale.LOCALISATION_KEY));});}};AWLocale.processGlobalLocalisation=function(){JQ("["+AWLocale.LOCALISATION_KEY+"]").each(function(idx,o){var aObj=JQ(o);localeJqObject(aObj,aObj.attr(AWLocale.LOCALISATION_KEY));});JQ("["+AWLocale.LOCALISATION_KEY_TITLE+"]").each(function(idx,o){var aObj=JQ(o);localeJqObjectTitle(aObj,aObj.attr(AWLocale.LOCALISATION_KEY_TITLE));});};AWLocale.isDefinedKey=function(key){return(JQ.i18n.dict&&JQ.i18n.dict[key]!==undefined);};AWLocale.getLocalizedString=function(key){return getLocalizedString(key);};function getLocalizedString(key){var variableData=null;if(AWUtils.isUndefinedOrIsNull(key)===false){variableData=key.match(/{{[^}{]*}}/gm);if(variableData!==null){variableData.forEach(function(aItem){key=key.replace(aItem,'{{}}');});}}var retVal=JQ.i18n._(key);var pattern=/\$\S*/;var i=0;while(pattern.test(retVal)&&i<5){var s=pattern.exec(retVal)[0];retVal=retVal.replace(s,JQ.i18n._(s.substring(1)));i++;}if(variableData!==null){variableData.forEach(function(aItem){retVal=retVal.replace('{{}}',aItem.replace('{{','').replace('}}',''));});}return retVal;};function localeObject(selector,key){var obj=JQ(selector);localeJqObject(obj,key);};function localeJqObject(obj,origKey){if(obj===null||obj.length===0||obj===''||key===null||key===''){return;}var translated;var key=obj.data("masterLocaleKey")||origKey;if(obj.attr(AWLocale.COUNTRY_CODE_DEPEND_KEY)&&typeof AppController==="object"&&AppController.currentLogin&&AppController.currentLogin.countryCode){var ccdLocaleKey=`${key}._country_${AppController.currentLogin.countryCode}`;key=(AWLocale.isDefinedKey(ccdLocaleKey))?ccdLocaleKey:key;}translated=AWLocale.getLocalizedString(key);if(obj.is("button")||obj.is("th")||(!obj.is(":button")&&obj.hasClass("ui-btn"))){obj.html(translated);}else if(obj.is("div")&&obj.hasClass("rsys-form")){obj.find(".rsys-form-title-label").text(translated);}else if(obj.is("label")||obj.is("a")){obj.text(translated);if(obj.is("a")){var hrefKey;var hk=`${origKey}.href`;if(AWLocale.isDefinedKey(hk)){hrefKey=hk;}if(obj.attr(AWLocale.COUNTRY_CODE_DEPEND_KEY)&&typeof AppController==="object"&&AppController.currentLogin&&AppController.currentLogin.countryCode){var ccdLocaleKey=`${hk}._country_${AppController.currentLogin.countryCode}`;hrefKey=(AWLocale.isDefinedKey(ccdLocaleKey))?ccdLocaleKey:hrefKey;}if(hrefKey){const targetVal=obj.attr("target");obj.attr('href',AWLocale.getLocalizedString(hrefKey));if(targetVal===undefined||targetVal.length===0){obj.attr("target","_top");}}}}else if(obj.is("input")&&obj.attr('placeholder')!==undefined){obj.attr('placeholder',translated);}else if(obj.hasClass('ui-collapsible')){obj.find('.ui-collapsible-heading-toggle').text(translated);}else if(obj.hasClass('ui-collapsible-heading-toggle')){obj.text(translated);}else if(obj.hasClass('ui-collapsible-heading')){obj.find('a').text(translated);}else if(obj.is(":checkbox")){obj.parent().find("label[for='"+obj.attr('id')+"']").html(translated);}else if(obj.is(":button")||obj.hasClass("ui-btn")){obj.prop('value',translated);try{obj.button("refresh");}catch(e){}}else if(obj.is("img")){obj.attr('title',translated);}else if(obj.parent().attr("data-role")==="slider"){const idx=(obj.index()===0)?"b":"a";obj.html(translated);obj.parent().siblings(".ui-slider-track").find(".ui-slider-label-"+idx).html(translated);}else{obj.html(translated);}};localeJqObjectTitle=function(obj,origKey){if(AWUtils.isUndefinedOrIsNullOrIsEmptyString(obj)===true||AWUtils.isUndefinedOrIsNullOrIsEmptyString(origKey)===true){return;}var translated=AWLocale.getLocalizedString(origKey);obj.attr('title',translated);};AWLocale.localeAllObjectsWithChildren=function(aElement){if(isUndefinedOrIsNull(aElement)===true||(aElement instanceof jQuery)===false){return;}var localeString=aElement.attr(AWLocale.LOCALISATION_KEY);if(localeString!==undefined&&localeString!==null&&localeString!==''){localeJqObject(aElement,localeString);}var children=aElement.children();if(children===null||children===''){return;}for(var i=0;i<children.length;i++){var iChild=children[i];AWLocale.localeAllObjectsWithChildren(JQ(iChild));}};AWLocale.EVENT={LOCALE_CHANGED:"localechange"};function AwMenu(parentElement){this.parentElement=parentElement;this.menuElements={};var _instance=this;this.init=function(mainMenuDiv,settingsMenuDiv){var menus=mainMenuDiv;mainMenuDiv.append(createMenuLevelElement(AwMenu.MENU_ROOT_LEVEL_ID));this.menuElements[AwMenu.MENU_TYPE.MAIN]=mainMenuDiv;if(settingsMenuDiv){settingsMenuDiv.append(createMenuLevelElement(AwMenu.MENU_ROOT_LEVEL_ID));this.menuElements[AwMenu.MENU_TYPE.SETTINGS]=settingsMenuDiv;menus.add(settingsMenuDiv);}menus.on("panelclose",function(event,ui){var panel=JQ(event.target);panel.find('.menu-level').not("#menu-level-"+AwMenu.MENU_ROOT_LEVEL_ID).remove();});};this.createMenu=function(){if(typeof config.menu==="object"){var grpNames=Object.keys(config.menu);if(grpNames.length>0){for(var i=0;i<grpNames.length;i++){var grpName=grpNames[i];var grpCfg=config.menu[grpName];if(typeof grpCfg==="object"){var menuType=AWUtils.enumFromString(AwMenu.MENU_TYPE,grpCfg.type,AwMenu.MENU_TYPE.MAIN);_instance.menu.addMenuItem(menuType,new AwMenu.MenuGroupItem(grpName,grpCfg.icon,grpCfg.title));}}}}var bundles=AppController.bundleController.availableBundles;if(bundles!==undefined){var bundleNames=Object.keys(bundles);if(bundleNames.length>0){for(var i=0;i<bundleNames.length;i++){var bname=bundleNames[i];var bundleCfg=bundles[bname];if(bundleCfg!==undefined){if(JQ.isArray(bundleCfg.menu)){JQ.each(bundleCfg.menu,function(i,menuCfg){createBundleMenuItem(bname,menuCfg);});}else if(typeof bundleCfg.menu==="object"){createBundleMenuItem(bname,bundleCfg.menu);}}}}}JQ.each(Object.values(this.menuElements),function(i,menuPanel){AWLocale.processLocalisationOnJQElement(menuPanel);});};createBundleMenuItem=function(bname,menuCfg){var menuType=AWUtils.enumFromString(AwMenu.MENU_TYPE,menuCfg.type,AwMenu.MENU_TYPE.MAIN);var id=(menuCfg.id!==undefined)?menuCfg.id:bname;var menuItem;if(menuCfg.noaction===true){menuItem=new AwMenu.MenuGroupItem(id,menuCfg.icon,menuCfg.title);}else{var action=function(e){var mi=JQ(this).data('menuItem');AppController.bundleController.getBundle(mi.bundleName,function(b,bundleName,id){if(b!==undefined){if(typeof b.menuAction==="function"){b.menuAction(id);}else{debug("Can not run action for bundle: '"+bundleName+"', menu item id: '"+id+"'.");}}},false,mi.id);};menuItem=new AwMenu.MenuActionItem(id,menuCfg.icon,action,menuCfg.title,menuCfg.context);}menuItem.bundleName=bname;_instance.addMenuItem(menuType,menuItem,menuCfg);};this.addMenuItem=function(menuType,menuItem,opts={}){if(menuItem===undefined||(menuItem instanceof AwMenu.MenuActionItem===false&&menuItem instanceof AwMenu.MenuGroupItem===false)){return;}const parentElement=this.getMenuItem(opts.parent);if(parentElement!==undefined){if(parentElement instanceof AwMenu.MenuGroupItem){parentElement.addSubmenuItem(menuItem,opts.index);}else{debug("[AwMenu] Can not create menuItem. Parent is not MenuGroupItem for: '"+menuItem.id+"'. Check attribute 'noaction' for menuItem: '"+opts.parent+"'!");}}else{var menuPanel=this.menuElements[menuType];if(menuPanel){var menuLevelElement=menuPanel.find("#menu-level-"+AwMenu.MENU_ROOT_LEVEL_ID+".menu-level");createMenuItemElement(menuLevelElement,menuItem,opts);}else{debug("Can not create menu item '"+menuItem.id+"'. Menu panel for type '"+menuType+"' not exist!");}}};getMenuItemFromParent=function(menuIds,parent){var retVal;if(JQ.isArray(menuIds)&&parent instanceof AwMenu.MenuGroupItem){var fid=menuIds[0];for(var i=0;i<parent.submenuItems;i++){if(parent.submenuItem[i].id===fid){if(menuIds.length===1){retVal=parent.submenuItems[i];break;}}}if(retVal===undefined&&menuIds.length>1){menuIds.shift();retVal=getMenuItemFromParent(menuIds,retVal);}}return retVal;};this.getMenuItem=function(itemId){var retVal;if(typeof itemId==="string"){if(itemId.indexOf(AwMenu.MENU_ID_PATH_SEPARATOR)>0){var parentElements=itemId.split(AwMenu.MENU_ID_PATH_SEPARATOR);var obj=this.parentElement.find('#menu-item-'+parentElements[0]);if(obj.length>0){parentElements.shift();retVal=getMenuItemFromParent(parentElements,obj.data('menuItem'));}}else{var obj=this.parentElement.find('#menu-item-'+itemId);if(obj.length>0){retVal=obj.data('menuItem');}}}return retVal;};this.recalculateMenuWidth=function(menuPanel){var mi=menuPanel.find('.menu-item');var menuItemCount=mi.length;var menuItemHeight=mi.height();var page=JQ('body').pagecontainer("getActivePage");var pgHeight=page.height()-menuPanel.position().top;var panelWidth=Math.ceil((menuItemCount*menuItemHeight)/pgHeight)*mi.width();menuPanel.width(panelWidth);};createMenuLevelElement=function(levelId){var retVal=JQ('<div class="menu-level"></div>');retVal.attr('id',"menu-level-"+levelId);return retVal;};createMenuItemElement=function(menuLevelElement,menuItem,opts){const index=(opts)?opts.index:undefined;if(FunctionsController.isFunctionEnabled(menuItem.id)){const iconUrl=AWUtils.getHomeUrl()+"images/mobile/"+menuItem.iconName;var menuElement=JQ('<div id="menu-item-'+menuItem.id+'" class="menu-item"><a href="#"><img src="'+iconUrl+'"></a></div>');var existingMenuItems;if(menuItem instanceof AwMenu.MenuActionItem){menuElement.click(function(e){menuLevelElement.css("pointer-events","none");AWUtils.hideTooltip(e);if(menuItem.closePanel){menuLevelElement.closest('.ui-panel').panel("close");}if(typeof menuItem.action==="function"){const params=Array.from(arguments);params.push(menuItem);menuItem.action.apply(this,params);window.setTimeout(()=>{menuLevelElement.css("pointer-events","");},1500);}});if(typeof menuItem.action!=="function"){menuElement.addClass("ui-disabled");}if(menuItem.context!==undefined){if(Array.isArray(menuItem.context)){JQ.each(menuItem.context,function(idx,ctx){menuElement.addClass("menu-item-"+ctx+'-context');});}else{menuElement.addClass("menu-item-"+menuItem.context+'-context');}}}else if(menuItem instanceof AwMenu.MenuGroupItem){menuElement.on("click",function(e){AWUtils.hideTooltip(e);showMenuGroupItem(menuLevelElement,menuItem);});}if(menuItem.localeKey!==undefined){if(menuItem.showLabel){var label=JQ('<div class="menu-itemLabel"></div>');label.attr(AWLocale.LOCALISATION_KEY,menuItem.localeKey);menuElement.append(label);}AWUtils.addLocalizedTooltip(menuElement,menuItem.localeKey);}else{debug("Tooltip not defined for menuItem : "+menuItem.id);}if(opts){if(isNaN(opts.index)===false){menuElement.prop("data-index",opts.index);}if(isNaN(opts.toolbarIndex)===false){menuElement.prop("data-toolbarIndex",opts.toolbarIndex);}}menuElement.data('menuItem',menuItem);menuItem.element=menuElement;existingMenuItems=menuLevelElement.find(".menu-item");if(index===0){menuLevelElement.prepend(menuElement);}else if(index>0&&existingMenuItems.length>0){var i=existingMenuItems.length;existingMenuItems.each(function(idx,mi){var oIdx=JQ(mi).prop('data-index');if(oIdx===undefined||oIdx>index){i=idx;return false;}});if(i<existingMenuItems.length){existingMenuItems.eq(i).before(menuElement);}else{menuLevelElement.append(menuElement);}}else{menuLevelElement.append(menuElement);}}};showMenuGroupItem=function(menuElement,menuItem){if(menuItem===undefined||menuItem instanceof AwMenu.MenuGroupItem===false){return;}var levelElement=createMenuLevelElement(menuItem.id);var backAction=new AwMenu.MenuActionItem("back","Back.png",backMenuAction,"Common.backMenu");backAction.closePanel=false;createMenuItemElement(levelElement,backAction);JQ.each(menuItem.submenuItems,function(i,submenuItem){createMenuItemElement(levelElement,submenuItem);});AWLocale.processLocalisationOnJQElement(levelElement);menuElement.closest('.ui-panel-inner').append(levelElement);};backMenuAction=function(e){JQ(e.currentTarget).closest('.ui-panel-inner').find('.menu-level').not("#menu-level-"+AwMenu.MENU_ROOT_LEVEL_ID).remove();};};AwMenu.MenuActionItem=function(id,iconName,action,localeKey,context){this.id=id;this.iconName=iconName;this.action=action;this.localeKey=localeKey;this.context=context;this.closePanel=true;this.showLabel=false;this.init=function(){if(typeof this.action==="string"&&this.localeKey===undefined){this.localeKey=this.action;this.action=undefined;}};this.setAction=function(action){this.action=action;if(this.element!==undefined){this.element.removeClass("ui-disabled");}};this.init();};AwMenu.MenuGroupItem=function(id,iconName,localeKey){this.id=id;this.iconName=iconName;this.localeKey=localeKey;this.submenuItems=[];this.showLabel=false;this.addSubmenuItem=function(menuItem,index){if(index){this.submenuItems.splice(index,0,menuItem);}else{this.submenuItems.push(menuItem);}};};AwMenu.MENU_TYPE={MAIN:"main",SETTINGS:"settings"};AwMenu.MENU_CONTEXT={MAP:AisWeb.MAP_CONTEXT.MAP,NOTAM:AisWeb.MAP_CONTEXT.NOTAM,METEO:AisWeb.MAP_CONTEXT.METEO,FUA:AisWeb.MAP_CONTEXT.FUA};AwMenu.MENU_ROOT_LEVEL_ID="root";AwMenu.MENU_ID_PATH_SEPARATOR="/";function AwCoordinates(){}AwCoordinates.FORMAT={DD:"ddH dddH",DDMM:"ddmmH dddmmH",DDMMSS:"ddmmssH dddmmssH",DD_ddd:"dd.ddddH ddd.ddddH",DD_MM_SS:"ddmm'ss''H dddmm'ss''H",DD_MM_SS_ss:"ddmm'ss.ss''H dddmm'ss.ss''H"};AwCoordinates.createHintDiv=function(){var retVal=JQ("<div class='coord-hint'></div>");var fmtUl=JQ("<ul></ul>");var localisationKeyValue="PlacesPanel.hintLabel.coords";var hintLabel=getLocalizedString(localisationKeyValue);var labelParagraph=JQ("<p class='coord-hint-label'>"+hintLabel+"</p>");labelParagraph.attr(AWLocale.LOCALISATION_KEY,localisationKeyValue);JQ.each(Object.values(AwCoordinates.FORMAT),function(idx,format){var li=JQ("<li>");li.text(format);fmtUl.append(li);});retVal.append(labelParagraph);retVal.append(fmtUl);return retVal;};AwCoordinates.parseLonLat=function(lonLat){var retVal;var tmp;if(lonLat!==null&&lonLat!==undefined){if((tmp=AwCoordinates.parseDDxDDDx(lonLat))!==undefined){retVal=tmp;}else if((tmp=AwCoordinates.parseDDMMDDDMM(lonLat))!==undefined){retVal=tmp;}else if((tmp=AwCoordinates.parseDDDMMDDMM(lonLat))!==undefined){retVal=tmp;}else if((tmp=AwCoordinates.parseDDDMMSSDDMMSS(lonLat))!==undefined){retVal=tmp;}else if((tmp=AwCoordinates.parseDDMMSSDDDMMSS(lonLat))!==undefined){retVal=tmp;}else if((tmp=AwCoordinates.parseTextDDMMSSxDDMMSSx(lonLat))!==undefined){retVal=tmp;}else if((tmp=AwCoordinates.parseFloatingDeg(lonLat))!==undefined){retVal=tmp;}else if((tmp=AwCoordinates.parseFloatingDeg2(lonLat))!==undefined){retVal=tmp;}else if((tmp=AwCoordinates.parseFloatingDeg3(lonLat))!==undefined){retVal=tmp;}else if((tmp=AwCoordinates.parseLonLatFloatingDeg(lonLat))!==undefined){retVal=tmp;}}return retVal;};AwCoordinates.parseDDxDDDx=function(input){var retVal;var parts=input.split(/^(\d{2})([NSns])\D*(\d{3})([EWew])/);if(parts.length>5){var lat=AwCoordinates.convertDMSToDD(parts[1],0,0,parts[2]);var lon=AwCoordinates.convertDMSToDD(parts[3],0,0,parts[4]);retVal=new OpenLayers.LonLat(lon,lat);}return retVal;};AwCoordinates.parseDDMMDDDMM=function(input){var retVal;var parts=input.split(/^(\d{2})(\d{2})([NSns])\D*(\d{3})(\d{2})([EWew])/);if(parts.length>7){var lat=AwCoordinates.convertDMSToDD(parts[1],parts[2],0,parts[3]);var lon=AwCoordinates.convertDMSToDD(parts[4],parts[5],0,parts[6]);retVal=new OpenLayers.LonLat(lon,lat);}return retVal;};AwCoordinates.parseDDDMMDDMM=function(input){var retVal;var parts=input.split(/^(\d{3})(\d{2})([EWew])\D*(\d{2})(\d{2})([NSns])/);if(parts.length>9){var lon=AwCoordinates.convertDMSToDD(parts[1],parts[2],parts[3]);var lat=AwCoordinates.convertDMSToDD(parts[4],parts[5],parts[6]);retVal=new OpenLayers.LonLat(lon,lat);}return retVal;};AwCoordinates.parseDDDMMSSDDMMSS=function(input){var retVal;var parts=input.split(/^(\d{3})(\d{2})(\d{2}|\d{2}.\d+)([EWew])\D*(\d{2})(\d{2})(\d{2}|\d{2}.\d+)([NSns])/);if(parts.length>9){var lon=AwCoordinates.convertDMSToDD(parts[1],parts[2],parts[3],parts[4]);var lat=AwCoordinates.convertDMSToDD(parts[5],parts[6],parts[7],parts[8]);retVal=new OpenLayers.LonLat(lon,lat);}return retVal;};AwCoordinates.parseDDMMSSDDDMMSS=function(input){var retVal;var parts=input.split(/^(\d{2})(\d{2})(\d{2})([NSns])\D*(\d{3})(\d{2})(\d{2})([EWew])/);if(parts.length>9){var lat=AwCoordinates.convertDMSToDD(parts[1],parts[2],parts[3],parts[4]);var lon=AwCoordinates.convertDMSToDD(parts[5],parts[6],parts[7],parts[8]);retVal=new OpenLayers.LonLat(lon,lat);}return retVal;};AwCoordinates.parseTextDDMMSSxDDMMSSx=function(input){var retVal;var parts=input.split(/^(\d{2})[](\d{2})['](\d{2}[^"']*)["']{1,2}([NSns])\D*(\d{2,3})[](\d{2})['](\d{2}[^"']*)["']{1,2}([EWew])/);if(parts.length>9){var lat=AwCoordinates.convertDMSToDD(parts[1],parts[2],parts[3],parts[4]);var lon=AwCoordinates.convertDMSToDD(parts[5],parts[6],parts[7],parts[8]);retVal=new OpenLayers.LonLat(lon,lat);}return retVal;};AwCoordinates.parseFloatingDeg=function(input){var retVal;var parts=input.split(/^(\d{1,2}\.\d{1,6})([NSns])[^\d]*(\d{1,3}\.\d{1,6})([EWew])/);if(parts.length>5){var lat=AwCoordinates.convertDMSToDD(parts[1],0,0,parts[2]);var lon=AwCoordinates.convertDMSToDD(parts[3],0,0,parts[4]);retVal=new OpenLayers.LonLat(lon,lat);}return retVal;};AwCoordinates.parseFloatingDeg2=function(input){var retVal;var parts=input.split(/^(\d{1,2}\.\d{1,6})\D*(\d{1,3}\.\d{1,6})$/);if(parts.length>2){retVal=new OpenLayers.LonLat(parts[2],parts[1]);}return retVal;};AwCoordinates.parseFloatingDeg3=function(input){var retVal;var parts=input.split(/^([+-]?\d{1,2})[ ,]+([+-]?\d{1,3})$/);if(parts.length>2){retVal=new OpenLayers.LonLat(parts[1],parts[2]);}return retVal;};AwCoordinates.parseLonLatFloatingDeg=function(input){var retVal;var parts=input.split(/^(\d{1,3}\.\d{1,6})\D*(\d{1,2}\.\d{1,6})$/);if(parts.length>2){retVal=new OpenLayers.LonLat(parts[1],parts[2]);}return retVal;};AwCoordinates.convertDMSToDD=function(degrees,minutes,seconds,direction){var dd=parseFloat(degrees)+parseFloat(minutes/60)+parseFloat(seconds/3600);if(direction==="S"||direction==="W"||direction==="s"||direction==="w"){dd*=-1;}return dd;};AwCoordinates.formatLonLat=function(lonLat,format,lonLatSeparator,revertLonLat=false){var retVal;var lat=parseFloat(lonLat.lat);var lon=parseFloat(lonLat.lon);lonLatSeparator=lonLatSeparator||"";if(lat>90||lat<-90){var lonLat=new OpenLayers.LonLat(lon,lat).transform("EPSG:3857","EPSG:4326");lat=lonLat.lat;lon=lonLat.lon;}if(lonLat){switch(format){case AwCoordinates.FORMAT.DD:break;case AwCoordinates.FORMAT.DDMM:var formatedLat=OpenLayers.Util.getFormattedLonLat(lat,'lat','dms');var formatedLatSplited=formatedLat.split(/['"]/);var latDeg=zeroPad(formatedLatSplited[0],2);var secRoundLat=parseInt(formatedLatSplited[2])<30?0:1;var latMin=zeroPad(parseInt(formatedLatSplited[1])+secRoundLat,2);var latUnit=formatedLatSplited[3];var formatedLon=OpenLayers.Util.getFormattedLonLat(lon,'lon','dms');debug("Formated Lon: "+formatedLon);var formatedLonSplited=formatedLon.split(/['"]/);var lonDeg=zeroPad(formatedLonSplited[0],3);var secRoundLon=parseInt(formatedLonSplited[2])<30?0:1;var lonMin=zeroPad(parseInt(formatedLonSplited[1])+secRoundLon,2);var lonUnit=formatedLonSplited[3];if(parseInt(latMin)===60){latMin="00";latDeg=zeroPad(parseInt(latDeg)+1,2);}if(parseInt(lonMin)===60){lonMin="00";lonDeg=zeroPad(parseInt(lonDeg)+1,3);}retVal=latDeg+latMin+latUnit+lonLatSeparator+lonDeg+lonMin+lonUnit;break;case AwCoordinates.FORMAT.DDMMSS:var formatedLat=OpenLayers.Util.getFormattedLonLat(lat,'lat','dms');var formatedLatSplited=formatedLat.split(/['"]/);var latDeg=zeroPad(formatedLatSplited[0],2);var latMin=zeroPad(parseInt(formatedLatSplited[1]),2);var latSec=zeroPad(parseInt(formatedLatSplited[2]).toFixed(0),2);var latUnit=formatedLatSplited[3];var formatedLon=OpenLayers.Util.getFormattedLonLat(lon,'lon','dms');var formatedLonSplited=formatedLon.split(/['"]/);var lonDeg=zeroPad(formatedLonSplited[0],3);var lonMin=zeroPad(parseInt(formatedLonSplited[1]),2);var lonSec=zeroPad(parseInt(formatedLonSplited[2]).toFixed(0),2);var lonUnit=formatedLonSplited[3];retVal=latDeg+latMin+latSec+latUnit+lonLatSeparator+lonDeg+lonMin+lonSec+lonUnit;break;case AwCoordinates.FORMAT.DD_ddd:var absLon,absLat;var dir="SNWE";if(revertLonLat===true){var tmp=lat;dir="WESN";lat=lon;lon=tmp;}absLon=Math.abs(lon);absLat=Math.abs(lat);retVal=(absLat<100&&revertLonLat===true)?"0":"";retVal+=absLat.toFixed(6);retVal+=lat<0?OpenLayers.i18n(dir[0]):OpenLayers.i18n(dir[1]);retVal+=lonLatSeparator;retVal+=(absLon<100&&revertLonLat===false)?"0":"";retVal+=absLon.toFixed(6);retVal+=(lon<0)?OpenLayers.i18n(dir[2]):OpenLayers.i18n(dir[3]);break;case AwCoordinates.FORMAT.DD_MM_SS:break;case AwCoordinates.FORMAT.DD_MM_SS_ss:retVal=OpenLayers.Util.getFormattedLonLat(lat,'lat','dms');retVal+=lonLatSeparator+OpenLayers.Util.getFormattedLonLat(lon,'lon','dms');break;default:break;}}return retVal;};AwCoordinates.convertSec2deg=function(seconds){var retVal=null;if(seconds&&seconds!==null){if(typeof seconds==="string"){seconds=parseFloat(seconds.replace(",","."));}retVal=seconds/3600.0;retVal=Math.round(retVal*1000000.0)/1000000.0;}return retVal;};function AwUserPreferences(){let _instance=this;this.preferences={};this.init=function(){const switchBarDft={worldwideSearch:false,graticule:false,plotting:false};let switchBarConfig=AppController.configuration.loadConfigObject("switchBar",switchBarDft);_instance.setValue("worldwideSearch",switchBarConfig.worldwideSearch,AwUserPreferences.TYPE.BOOL,false);_instance.setValue("graticule",switchBarConfig.graticule,AwUserPreferences.TYPE.BOOL,false);_instance.setValue("plotting",switchBarConfig.plotting,AwUserPreferences.TYPE.BOOL,false);AWDataHandler.getUserPreferences(function(preferences){if(!preferences||preferences.IsError==="true"){JQMUtil.showInfoMsg("Can not load user preferences.\nContinue with default values ...",true,false);}else if(preferences.UserPreferences){let prefs=Array.isArray(preferences.UserPreferences)?preferences.UserPreferences:[preferences.UserPreferences];prefs.forEach(pref=>{if(!pref.name.startsWith("![CDATA[")&&!pref.value.startsWith("![CDATA[")){_instance.preferences[pref.name]=_instance.parsePreference(pref);}});}JQ(_instance).trigger(AwUserPreferences.EVENT.INIT_FINISHED);});};this.parsePreference=function(pref,type){let retVal;if(pref&&pref.value){switch(type||pref.type){case AwUserPreferences.TYPE.NUMBER:retVal=Number(pref.value);break;case AwUserPreferences.TYPE.BOOL:retVal=(pref.value==="true"||pref.value===true)?true:false;break;case AwUserPreferences.TYPE.JSON:try{retVal=JSON.parse(pref.value);}catch(e){debug("[AwUserPreferences] Can not parse JSON preference for name: "+pref.name);retVal=undefined;}break;default:retVal=pref.value.toString();}}return retVal;};this.isValueForName=function(name){return(_instance.preferences[name]!==undefined);};this.setValue=function(name,value,type=AwUserPreferences.TYPE.STRING,store=true,callback){if(typeof store==="function"){callback=store;store=true;}else if(typeof type==="function"){callback=type;type=AwUserPreferences.TYPE.STRING;}_instance.preferences[name]=value;switch(type){case AwUserPreferences.TYPE.BOOL:value=JSON.stringify(value);break;case AwUserPreferences.TYPE.STRING:value=(value)?value.toString():"";break;case AwUserPreferences.TYPE.JSON:value=JSON.stringify(value);break;default:}if(store&&AppController.currentLogin){const prefObj={type:type};prefObj.value=value;AWDataHandler.setUserPreferences(name,value,type,callback);}};this.getValue=function(name,shallBeJson){let retVal=_instance.preferences[name];if(shallBeJson&&typeof retVal==="string"){try{retVal=JSON.parse(retVal);_instance.preferences[name]=retVal;}catch(e){debug("[AwUserPreferences] Can not convert string to JSON preference for name: "+name);retVal=_instance.preferences[name];}}return retVal;};this.getObjectValue=function(name){let retVal=_instance.preferences[name];try{retVal=JSON.parse(retVal.value);}catch(e){debug("[AwUserPreferences] Can not get JSON value for name: "+name);retVal=undefined;}return retVal;};};AwUserPreferences.EVENT={INIT_FINISHED:"init-finished"};AwUserPreferences.TYPE={STRING:"string",NUMBER:"number",BOOL:"boolean",JSON:"json"};function BundleController(){this.availableBundles;this.bundles={};var self=this;this.loadMainConfig=function(callback){JQ.ajax({dataType:"json",url:(config.bundleConfig===undefined)?"js/bundleConfig.json":config.bundleConfig,cache:false,success:function(data,status,jqHhr){debug("[BundleController] Main config loaded!");processMainConfig(data);self.availableBundles=data;if(typeof callback==='function'){callback();}},error:function(jqXhr,status,error){debug("[BundleController] Main config error: "+error);self.availableBundles={};if(typeof callback==='function'){callback();}}});};processMainConfig=function(data){var bundleNames=Object.keys(data);if(bundleNames.length>0){for(var i=0;i<bundleNames.length;i++){var bname=bundleNames[i];var bSettings=data[bname];if(bSettings!==undefined&&bSettings.name!==undefined){delete data[bname];data[bSettings.name]=bSettings;data[bSettings.name]._dirName=bname;delete data[bSettings.name].name;}}}};this.loadAutoInitBundles=function(callback,bundleNames){if(!bundleNames){bundleNames=getAutoInitBundleNames(this.availableBundles);}if(bundleNames.length>0){var bname=bundleNames[0];bundleNames.shift();this.getBundle(bname,function(b){self.loadAutoInitBundles(callback,bundleNames);});}else{callback();}};this.autoInitBundlesCount=function(){return getAutoInitBundleNames(this.availableBundles).length;};getAutoInitBundleNames=function(bundles){var retVal=[];var bundleNames=Object.keys(bundles);if(bundleNames.length>0){for(var i=0;i<bundleNames.length;i++){var bname=bundleNames[i];var bSettings=bundles[bname];if(bSettings!==undefined&&bSettings.autoInit===true){retVal.push(bname);}}}return retVal;};createBundle=function(bundleName,bData,bSettings){var bundle;try{if(bData.mainClass){var fn=(window||this);bundle=new fn[bData.mainClass];}else{bundle={};}bundle.bundleName=bundleName;bundle.bundleConfig=bSettings.config;self.bundles[bundleName]=bundle;JQ(self).trigger(BundleController.EVENT.BUNDLE_INITIALIZED,bundleName);debug("[BundleController] Bundle initialized: "+bundleName);}catch(e){var msg=e.message||"Can not found main class: '"+bData.mainClass+"'!";debug("[BundleController] Can not create bundle '"+bundleName+"'. "+msg);if(e.stack){debug(e.stack);}}return bundle;};getBundlePath=function(bundleName){var retVal;var bSettings=self.availableBundles[bundleName];if(bSettings!==undefined){var bDir=(bSettings._dirName!==undefined)?bSettings._dirName:bundleName;retVal=BundleController.bundleDir+bDir+"/";}return retVal;};loadBundleConfig=function(dir,callback){var cfgName="bundle.json";JQ.ajax({dataType:"json",url:dir+cfgName,cache:false,success:function(bData,status,jqHhr){debug("[BundleController] '"+dir+cfgName+"' loaded.");callback(bData);},error:function(jqXhr,status,error){debug("[BundleController] Can not load bundle config at '"+dir+"'");callback();}});};loadBundle=function(bundleName,dir,bData,callback,callerData){var bSettings=self.availableBundles[bundleName];var task;if(bData.external&&bSettings.externalLoaded!==true){task=AWUtils.libraryLoader(dir,null,null,bData.external);if(task!==undefined){task.done(function(){bSettings.externalLoaded=true;loadBundle(bundleName,dir,bData,callback,callerData);});task.fail(function(a,b,c){debug("[BundleController] Error while loading bundle: "+bundleName+"\nMessage: "+b+"\n"+c+"\n"+a.responseText);callback();});}else{debug("[BundleController] Error while loading bundle: "+bundleName+"\nCheck configuration.");callback();}return;}task=AWUtils.libraryLoader(dir,AppController.appRevision,bData.style,bData.source);if(task!==undefined){bSettings.loading=true;task.done(function(){bSettings.loading=false;callback(createBundle(bundleName,bData,bSettings),bundleName,callerData);});task.fail(function(a,b,c){bSettings.loading=false;debug("[BundleController] Error while loading bundle: "+bundleName+"\nMessage: "+b+"\n"+c+"\n"+a.responseText);callback();});}else{debug("[BundleController] Error while loading bundle: "+bundleName+"\nCheck configuration.");callback();}};this.getBundle=function(bundleName,callback,disableCreation,callerData){var bundle=self.bundles[bundleName];var bSettings=self.availableBundles[bundleName];const funcName="bundle_"+bundleName;disableCreation=disableCreation||false;if(FunctionsController.isFunctionEnabled(funcName)&&bundle===undefined&&bSettings!==undefined&&(bSettings.loading===undefined||bSettings.loading===false)&&disableCreation===false){var dir=getBundlePath(bundleName);loadBundleConfig(dir,function(bData){if(bData!==undefined){if(bData.require!==undefined){processBundleDependency(bData.require,function(){loadBundle(bundleName,dir,bData,callback,callerData);});}else{loadBundle(bundleName,dir,bData,callback,callerData);}}else{callback();}});}else{callback(bundle,bundleName,callerData);}};processBundleDependency=function(bundles,callback){if(JQ.isArray(bundles)&&bundles.length>0){var bIdx=0;var syncFnc=function(){if(--bIdx===0){callback();}};JQ.each(bundles,function(i,bundleName){bIdx++;self.getBundle(bundleName,syncFnc);});}};this.getBundleLocaleFile=function(bundleName,localeAbbr){var retVal=[];var bSettings=this.availableBundles[bundleName];if(bSettings&&bSettings.locales){for(var i=0;i<bSettings.locales.length;i++){var fName=bSettings.locales[i];var arr=fName.split(/(\w*)_(\w{2})/);if(fName===localeAbbr||(arr.length>1&&arr[2]===localeAbbr)){retVal.push(getBundlePath(bundleName)+"locale/"+fName+".json");}}}return retVal;};this.isBundleConfigured=function(aBundleName){return this.availableBundles.hasOwnProperty(aBundleName);};this.isBundleInicialized=function(aBundleName){return(self.bundles[aBundleName]!==undefined);};}BundleController.bundleDir="js/bundles/";BundleController.EVENT={BUNDLE_INITIALIZED:"BundleInitialized"};function AppController(token,ibafToken,sdkAllowOrigin){var _instance=this;this.appDivId='aisWebDiv';this.token=token;this.ibafToken=ibafToken;this.aisWeb;this.controlPanel;this.bundleController;this.sdkAllowOrigin=sdkAllowOrigin;this.init=function(){AppController.divId=this.appDivId;AppController.mapProjection="EPSG:900913";AppController.functionsCtrl=new FunctionsController();AppController.configuration=new RsConfiguration();AWDataHandler.setToken(this.token);if(typeof IbafDataHandler==="function"&&this.ibafToken){IbafDataHandler.setToken(this.ibafToken);}OpenLayers.Request.DEFAULT_CONFIG.headers[AWDataHandler.tokenHeader]=AWDataHandler.token;window.location.hash="";if(this.sdkAllowOrigin){window.addEventListener('message',function(event,a,b){if(~event.origin.indexOf(_instance.sdkAllowOrigin)){if(event.source.ixoWebSdk&&typeof event.data==="object"&&event.data.name==="getIxoWebCtrl"&&typeof event.data.callbackFncName){console.log(event.data);event.source.ixoWebSdk[event.data.callbackFncName](_instance);}else if(event.data==="getDocument"){console.log(event.data);return window.document;}}else{return;}});}JQ(document).on(AWLocale.EVENT.LOCALE_CHANGED,function(e,abbr){var classPrefix="rs-locale-";JQ("html").removeClass(function(idx,name){var retVal;var res=new RegExp(classPrefix+"[^ ]*").exec(name);if(res){retVal=res.join(" ");}return retVal;});JQ("html").addClass(classPrefix+abbr);});_instance.showInitInfo();JQ(AppController.functionsCtrl).on(FunctionsController.EVENT.CONFIG_LOADED,function(){AppController.configuration.loadAppConfig(function(cfg){if(cfg){_instance.mainConfigurationLoaded(cfg);}else{JQMUtil.showInfoMsg("Can not load configuration.<br>Try reload page ...",true,false,function(){window.location.reload();});}});HtmlUtils.initIXOSelectMenu();});AppController.functionsCtrl.init();};this.mainConfigurationLoaded=function(cfg){OpenLayers.ProxyHost=cfg.proxyUrl;AppController.bundleController=this.bundleController=new BundleController();AppController.ows=new RsAisOws();AppController.appTime=new AwTime();this.secondsInterval();AppController.flFilter={lower:getConfigValue2("flFilter","defaultLower",0),upper:getConfigValue2("flFilter","defaultUpper",22000),active:false};if(this.ibafToken&&this.ibafToken.length>0){AWDataHandler.getUserInfo(function(userInfo){_instance.refreshUserInfo(userInfo);_instance.setupAutoLogout();if(userInfo){FunctionsController.addRule(FunctionsController.createRule("PilotAttributes",userInfo.pilotAttributes,FunctionsController.RULE_TYPE.BITMASK));_instance.loadUserPreferences();}else{JQMUtil.showInfoMsg("Loading failed.\nTry reload page ...",true,false,function(){window.location.reload();});}});}else{AppController.userPrefs=new AwUserPreferences();_instance.processUserPreferences();}};this.secondsInterval=function(){JQ(_instance).trigger(AppController.EVENT.SECOND_INTERVAL);window.setTimeout(_instance.secondsInterval,1000);};this.setupAutoLogout=function(){var dft={idleTimeout:60,idleWarning:2,userType:{}};var cfg=AppController.configuration.loadConfigObject("autoLogout",dft);var userTypeCfg=cfg.userType[AppController.currentLogin.userTypeId];AppController.idleTimeout=(userTypeCfg&&userTypeCfg.idleTimeout!==undefined)?userTypeCfg.idleTimeout:cfg.idleTimeout;AppController.idleWarning=(userTypeCfg&&userTypeCfg.idleWarning!==undefined)?userTypeCfg.idleWarning:cfg.idleWarning;if(AppController.idleTimeout!==undefined&&AppController.idleTimeout>0){this.setupActivityMonitor();window.setInterval(this.checkIdleTime,1000);}};this.setupActivityMonitor=function(){this.resetActionTimeStamp();document.onclick=_instance.resetActionTimeStamp;document.onkeypress=_instance.resetActionTimeStamp;};this.resetActionTimeStamp=function(){AppController.lastActionTimeStamp=new Date();};this.checkIdleTime=function(){var now=new Date().getTime();var td=(now-AppController.lastActionTimeStamp.getTime())/60000;if(td>=AppController.idleTimeout){AWDataHandler.userLogout();}else if(td>=AppController.idleTimeout-AppController.idleWarning){JQ(_instance).trigger(AppController.EVENT.AUTO_LOGOUT_WARNING);}};this.showInitInfo=function(){var body=document.createElement("body");var center=document.createElement("div");var ring=document.createElement("div");var text=document.createElement("span");var ver=document.createElement("span");center.className="initializing-center";ring.className="initializing-ring";text.className="initializing-info";ver.className="initializing-ver";ver.innerText=AppController.appVersion;center.append(ring);center.append(text);center.append(ver);body.append(center);document.body=body;};this.loadUserPreferences=function(){AppController.userPrefs=new AwUserPreferences();JQ(AppController.userPrefs).on(AwUserPreferences.EVENT.INIT_FINISHED,()=>{_instance.processUserPreferences();});AppController.userPrefs.init();};this.processUserPreferences=function(){if(AppController.userPrefs.isValueForName("distanceUnit")){AppController.distanceUnit=AppController.userPrefs.getValue("distanceUnit");}else{AppController.distanceUnit=getConfigValue("defaultDistanceUnit",AppController.DISTANCE_UNIT.KM).toUpperCase();}AppController.ows.init();AppController.bundleController.loadMainConfig(function(){_instance.loadLocale();_instance.createMapset();});if(AppController.userPrefs.isValueForName("autoRefresh")){AppController.autoRefresh=AppController.userPrefs.getValue("autoRefresh");}else{AppController.autoRefresh=getConfigValue2("timeRefresh","defaultInterval",1);}};this.loadLocale=function(abbr){if(abbr===undefined||abbr===null){let s=AppController.userPrefs.getValue("userSettings",true);abbr=(s&&s[AppController.LANGUAGE_KEY])||AppController.loginLang||getConfigValue("locale","en");}AWLocale.loadLocale(abbr,AppController.appRevision);};this.createMapset=function(){if(FunctionsController.isFunctionEnabled("map")){AppController.mapset=new Mapset2();JQ(AppController.mapset).on(Mapset2.EVENT.MAPSET_INIT_DONE,function(){AppController.defaultMapsetPrefs=AppController.mapset.getPrefs();if(AppController.userPrefs.isValueForName("layerBrowser")){let layerPrefs=AppController.userPrefs.getValue("layerBrowser",true);AppController.mapset.setPrefs(layerPrefs.mapset);}_instance.loadFqyConfig();});AppController.mapset.loadItemConfig();}else{_instance.runApp();}};this.loadFqyConfig=function(){JQ.ajax({dataType:"json",url:"js/fqyConfig.json",cache:false,success:function(data,status,jqHhr){debug("[init] Frequency config loaded!");AppController.fqyConfig=data;_instance.runApp();},error:function(jqXhr,status,error){debug("[init] Frequency config not found!");AppController.fqyConfig=null;_instance.runApp();}});};this.runApp=function(){var startProc=function(){if(AppController.controlPanel){if(AppController.aisWeb){AppController.aisWeb.init();}JQ(_instance).trigger(AppController.EVENT.INIT_FINISHED);}else{alert("Control Panel not found! Check app. configuration.");}};if(FunctionsController.isFunctionEnabled("map")){AppController.aisWeb=this.aisWeb=new AisWeb(_instance.appDivId);}if(AppController.bundleController.autoInitBundlesCount()>0){AppController.bundleController.loadAutoInitBundles(function(){startProc();_instance.setupAppMode(AppController.appMode);});}else{startProc();}};this.setupAppMode=function(appMode){if(appMode&&functionsAppModeConfig&&functionsAppModeConfig[appMode]&&functionsAppModeConfig[appMode]._autoInitAction){var actionParams=functionsAppModeConfig[appMode]._autoInitAction.split("::");AppController.bundleController.getBundle(actionParams[0],function(b){if(b){var id=(actionParams[1]!==undefined)?actionParams[1]:actionParams[0];if(typeof b.menuAction==="function"){b.menuAction(id);}else{debug("Can not run auto-init action: '"+actionParams[0]+"'.");}}else{debug("Can not found auto-init action: '"+actionParams[0]+"'.");}});}};this.refreshUserInfo=function(userInfo){AppController.currentLogin=userInfo;JQ(_instance).trigger(AppController.EVENT.USER_INFO_CHANGED,userInfo);};this.setDistanceUnit=function(distanceUnit){if(distanceUnit!==AppController.distanceUnit){AppController.distanceUnit=distanceUnit;AppController.userPrefs.setValue("distanceUnit",distanceUnit);JQ(_instance).trigger(AppController.EVENT.DISTANCE_UNIT_CHANGED,distanceUnit);JQ(".dynamic-distance-info-item").each(function(index,item){prepareDistanceInfoItem(JQ(item),distanceUnit);});}};this.setFlFilter=function(values){if(typeof values==="object"){var o={lower:values.lower,upper:values.upper,active:values.active};if(values.active){if(values.customMapsetItemNames!==undefined){o.customMapsetItemNames=values.customMapsetItemNames;}if(values.desc){o.desc=values.desc;}}AppController.flFilter=o;JQ(_instance).trigger(AppController.EVENT.FL_FILTER_CHANGED,AppController.flFilter);}};this.setControlPanel=function(controlPanel){AppController.controlPanel=controlPanel;JQ(_instance).trigger(AppController.EVENT.CONTROL_PANEL_WAS_SET);};this.init();};AppController.EVENT={INIT_FINISHED:"init-finished",DISTANCE_UNIT_CHANGED:"DistanceUnitChanged",FL_FILTER_CHANGED:"FlFilterChanged",USER_INFO_CHANGED:"UserInfoReloaded",AUTO_LOGOUT_WARNING:"AutoLogoutWarning",CONTROL_PANEL_WAS_SET:"ControlPanelWasSet",OPEN_LAYER_MAP_INI:"OpenLayerMapInicialized",DRAW_FLIGH_ROUTE:"DrawFlighRouteFromJSON",CLOCK_TZONE_CHANGED:"ClockTimeZoneChanged",SECOND_INTERVAL:"SecondInterval"};AppController.DISTANCE_UNIT={KM:"KM",NM:"NM"};AppController.prototype.divId;AppController.prototype.functionsCtrl;AppController.prototype.currentLogin;AppController.prototype.appMode;AppController.prototype.loginLang;AppController.prototype.userPrefs;AppController.prototype.ows;AppController.prototype.appVersion;AppController.prototype.appRevision;AppController.prototype.mapset;AppController.prototype.defaultMapsetPrefs;AppController.prototype.aisWeb;AppController.prototype.controlPanel;AppController.prototype.lastActionTimeStamp;AppController.prototype.appTime;AppController.prototype.bundleController;AppController.prototype.fqyConfig;AppController.prototype.mapProjection;AppController.prototype.configuration;AppController.prototype.distanceUnit;AppController.prototype.flFilter;AppController.prototype.autoRefresh;AppController.appVersion="3.14";AppController.LANGUAGE_KEY="language";function FplTablePanel(){this.mFplShowPibID='fplShowPib';this.mFplRefreshID='fplRefresh';this.mFplCorridorID='fplCorridor';this.mShowPibAction=null;this.setShowPibAction=function(aAction){if(isUndefinedOrIsNull(aAction)){this.mShowPibAction=null;}else{this.mShowPibAction=aAction;}};this.createPanelContent=function(){var retVal=JQ('<div class="fplListContent"></div>');var thisInstance=this;var refreshButton=JQ('<button id="'+this.mFplRefreshID+'" class="ui-btn ui-corner-all">Refresh</button>');var corridorContain=JQ('<div class="flex-contain"></div>');var corridorInput=JQ('<input id="'+this.mFplCorridorID+'" data-clear-btn="false" type="number" min="1" max="10" value="2"></input>');var pibButton=JQ('<button id="'+this.mFplShowPibID+'" class="ui-btn ui-corner-all">Show PIB</button>');var listView=JQ('<ul id="fplList" data-role="listview" data-filter="true" data-input="#fplListFilter-input"></ul>');pibButton.button().button("disable");corridorContain.append('<label for="'+this.mFplCorridorID+'">PIB Corridor (km)</label>');corridorContain.append(corridorInput);retVal.append(refreshButton);retVal.append(corridorContain);retVal.append(pibButton);retVal.append('<input id="fplListFilter-input" data-type="search">');retVal.append(listView);refreshButton.on('click',function(){thisInstance.loadAndRefreshFplData();});pibButton.on('click',function(){if(isUndefinedOrIsNull(thisInstance.mShowPibAction)){return;}thisInstance.mShowPibAction();});return retVal;};this.createControlsDiv=function(){var retVal=JQ('<div></div>');return retVal;};this.loadAndRefreshFplData=function(){var thisInstance=this;JQ('#fplList').loading(true);AWDataHandler.getFplsForUserId(function(aData){JQ('#fplList').loading(false);var dataString="()";if(!isUndefinedOrIsNull(aData)){dataString=aData.innerHTML;}var decoder=new FplDecoder();var decodedData=decoder.decode(dataString);thisInstance.refreshListElementData(decodedData);thisInstance.setLocalizedTextContent();});};this.refreshListElementData=function(data){var fplList=JQ('#fplList');fplList.find("li").remove();for(var i=0;i<data.length;i++){var iRowData=data[i];if(isUndefinedOrIsNullOrIsEmptyArray(iRowData)){continue;}var listItem=this.createListItem(iRowData);if(isUndefinedOrIsNull(listItem)){continue;}fplList.append(listItem);}fplList.listview("refresh");fplList.find("li").click(function(){JQ(this).addClass("highlight").siblings().removeClass("highlight");JQ("#fplShowPib").button('enable');});return fplList;};this.createListItem=function(aRowData){if(isUndefinedOrIsNull(aRowData)){aRowData=[];}var li=JQ('<li></li>');li.append("<h2>"+HtmlUtils.encodeForHTML(aRowData[0])+"</h2>");li.append("<p><strong>"+HtmlUtils.encodeForHTML(aRowData[1])+"</strong><em> "+HtmlUtils.encodeForHTML(aRowData[2])+"</em><strong> - "+HtmlUtils.encodeForHTML(aRowData[3])+"</strong></p>");li.append("<p>"+HtmlUtils.encodeForHTML(aRowData[4])+", "+HtmlUtils.encodeForHTML(aRowData[5])+"</p>");li.append("<p>"+HtmlUtils.encodeForHTML(aRowData[6])+", "+HtmlUtils.encodeForHTML(aRowData[7])+"</p>");li.append("<p><code>"+HtmlUtils.encodeForHTML(aRowData[8])+"</code></p>");li.data('rawData',aRowData);return li;};this.setLocalizedTextContent=function(){localeObject('#'+this.mFplShowPibID,'FplPanel.ShowPib');localeObject('#'+this.mFplRefreshID,'FplPanel.Refresh');localeObject('label[for="'+this.mFplCorridorID+'"]','FplPanel.Corridor');};this.getSelectedFpl=function(){var retVal=null;var actLi=JQ("#fplList li.highlight");if(actLi.length>0){var data=actLi.data('rawData');if(data!==undefined){retVal="-ARCID "+data[0];retVal+=" -ADEP "+data[1];retVal+=" -ADES "+data[3];retVal+=" -RFL "+data[5];retVal+=" -SPEED "+data[4];retVal+=" -ROUTE "+data[8];}}return retVal;};this.getBuffer=function(){return JQ("#"+this.mFplCorridorID).val();};this.setBuffer=function(val){JQ("#"+this.mFplCorridorID).val(val);};}function FplDecoder(){this.mRowDelimiter=';';this.mItemDelimiter='|';this.decode=function(aCodedString){if(isUndefinedOrIsNullOrIsEmptyString(aCodedString)){return[];}if(aCodedString.substring(0,1)==="("){aCodedString=aCodedString.substring(1);}if(aCodedString.substring(aCodedString.length-1)===")"){aCodedString=aCodedString.substring(0,aCodedString.length-1);}var rows=aCodedString.split(this.mRowDelimiter);if(isUndefinedOrIsNullOrIsEmptyArray(rows)){return[];}var retVal=[];for(var i=0;i<rows.length;i++){var iRow=rows[i];if(isUndefinedOrIsNullOrIsEmptyString(iRow)){retVal.push([]);continue;}var items=iRow.split(this.mItemDelimiter);if(isUndefinedOrIsNullOrIsEmptyArray(items)){retVal.push([]);continue;}retVal.push(items);}return retVal;};}FunctionsController=function(){var _instance=this;this.init=function(){this.loadConfiguration(function(){JQ(_instance).trigger(FunctionsController.EVENT.CONFIG_LOADED);});};this.loadConfigFile=function(configName,successCallback,errorCallback){JQ.ajax({dataType:"script",url:"js/"+configName,cache:false,success:function(data,status,jqHhr){successCallback(data,status);},error:function(jqXhr,status,error){if(errorCallback){errorCallback(status,error);}else{var msg="Can not load functions configuration!";debug(msg+"\nStatus: "+status+"\nError: "+error);alert("Can not load functions configuration!");}}});};this.loadConfiguration=function(callback){var cfgName=getConfigValue("functionsConfig","functionsConfig.js");this.loadConfigFile(cfgName,function(){_instance.loadGroupConfig(callback);});};this.loadGroupConfig=function(callback){const cfgName=getConfigValue("functionsGroupConfig","functionsGroupConfig.js");this.loadConfigFile(cfgName,()=>_instance.loadAppModeConfig(callback),()=>_instance.loadAppModeConfig(callback));};this.loadAppModeConfig=function(callback){var cfgName=getConfigValue("functionsAppModeConfig","functionsAppModeConfig.js");this.loadConfigFile(cfgName,callback,callback);};};FunctionsController.RULE_TYPE={DEFAULT:0,BITMASK:1};FunctionsController.createRule=function(attrName,value,ruleType){return{name:"@"+attrName,value:value,type:ruleType||FunctionsController.RULE_TYPE.DEFAULT};};FunctionsController.isFunctionEnabled=function(funcName,defaultValue){var retVal=(typeof defaultValue==="boolean")?defaultValue:true;var user=AppController.currentLogin;var userGroup=(user!==null&&user!==undefined&&typeof user.userTypeDesc==="string")?user.userTypeDesc:undefined;if(typeof functionsConfig==="object"&&typeof functionsConfig[funcName]==="boolean"){retVal=functionsConfig[funcName];}if(typeof functionsGroupConfig==="object"&&typeof functionsGroupConfig[userGroup]==="object"){var grpConf=functionsGroupConfig[userGroup];FunctionsController.RuleSet.forEach(function(rule){var ruleRes=FunctionsController.processRule(funcName,grpConf,rule);if(ruleRes!==undefined){retVal=ruleRes;}else if(typeof grpConf[funcName]==="boolean"){retVal=grpConf[funcName];}});}if(retVal&&AppController.appMode&&typeof functionsAppModeConfig==="object"&&typeof functionsAppModeConfig[AppController.appMode]==="object"){var modeCfg=functionsAppModeConfig[AppController.appMode];retVal=(modeCfg[funcName]!==undefined)?modeCfg[funcName]:retVal;}return retVal;};FunctionsController.processRule=function(funcName,conf,rule){var retVal;if(conf!==undefined&&rule!==undefined&&conf[rule.name]!==undefined){var ruleConf=conf[rule.name];var values=Object.keys(ruleConf);var valConf;for(var i=0;i<values.length;i++){var val=values[i];switch(rule.type){case FunctionsController.RULE_TYPE.DEFAULT:if(val===rule.value){valConf=ruleConf[val];}break;case FunctionsController.RULE_TYPE.BITMASK:if(parseInt(val)&parseInt(rule.value)){valConf=ruleConf[val];}break;default:throw"FunctionsController: Unsupported Function RuleType '"+rule.type+"' for function '"+funcName+"'. RuleName = '"+rule.name+"'";}if(valConf!==undefined&&valConf[funcName]!==undefined){retVal=valConf[funcName];break;}}}return retVal;};FunctionsController.prototype.RuleSet;FunctionsController.RuleSet=[];FunctionsController.addRule=function(rule){FunctionsController.RuleSet.push(rule);};FunctionsController.EVENT={CONFIG_LOADED:"configLoaded"};OpenLayers.Renderer.FeatureImage=OpenLayers.Class(OpenLayers.Renderer.Canvas,{initialize:function(containerID,options){OpenLayers.Renderer.Canvas.prototype.initialize.apply(this,arguments);},drawPoint:function(geometry,style,featureId){if(style.graphic!==false){var pt=this.getLocalXY(geometry);var p0=pt[0];var p1=pt[1];if(!isNaN(p0)&&!isNaN(p1)){var twoPi=Math.PI*2;var radius=style.pointRadius;if(style.fill!==false){this.setCanvasStyle("fill",style);this.canvas.beginPath();this.canvas.arc(p0,p1,radius,0,twoPi,true);this.canvas.fill();if(this.hitDetection){this.setHitContextStyle("fill",featureId,style);this.hitContext.beginPath();this.hitContext.arc(p0,p1,radius,0,twoPi,true);this.hitContext.fill();}}if(style.stroke!==false){this.setCanvasStyle("stroke",style);this.canvas.beginPath();this.canvas.arc(p0,p1,radius,0,twoPi,true);this.canvas.stroke();if(this.hitDetection){this.setHitContextStyle("stroke",featureId,style);this.hitContext.beginPath();this.hitContext.arc(p0,p1,radius,0,twoPi,true);this.hitContext.stroke();}this.setCanvasStyle("reset");}var feature=this.features[featureId][0];if(feature&&feature.attributes&&feature.attributes.image){var imgObj=feature.attributes.image;var imgUrl=imgObj.url;var styleCopy=new Object(style);if(typeof imgUrl==="string"){styleCopy.externalGraphic=imgObj.url;styleCopy.graphicXOffset=imgObj.xOffset;styleCopy.graphicYOffset=imgObj.yOffset;styleCopy.graphicWidth=imgObj.width;styleCopy.graphicHeight=imgObj.height;this.drawExternalGraphic(geometry,styleCopy,featureId);}else if(typeof imgUrl==="object"){var xOffset=imgObj.xOffset;var yOffset=imgObj.yOffset;var width=imgObj.width;var height=imgObj.height;for(var idx=0;idx<imgUrl.length;idx++){var img=imgUrl[idx];styleCopy.externalGraphic=img;styleCopy.graphicXOffset=xOffset+(width*idx);styleCopy.graphicYOffset=yOffset;styleCopy.graphicWidth=width;styleCopy.graphicHeight=height;this.drawExternalGraphic(geometry,styleCopy,featureId);}}}}}},CLASS_NAME:"OpenLayers.Renderer.FeatureImage"});function XtamMarksLayerCtrl(){this.config;this.mapLayer;this.displayedZoomLevelWarn=false;var _instance=this;this.init=function(){const notamMarksCfgDft={pointRadius:10,fillColor:"green",fillOpacity:0.35,strokeColor:"black",minZoomLevel:5,flags:{snowtam:"images/mobile/snowtam.png",ashtam:"images/mobile/volcano.png"}};const xtamMarksTypesCfgDft={};this.config=AppController.configuration.loadConfigObject("notamMarks",notamMarksCfgDft);Object.values(XtamMark.TYPE).forEach(function(xtamMarkType){xtamMarksTypesCfgDft[xtamMarkType]={..._instance.config};});notamMarksCfgDft.types=xtamMarksTypesCfgDft;this.config=AppController.configuration.loadConfigObject("notamMarks",this.config);this.createMapLayer();JQ(AppController.aisWeb).on(AisWeb.EVENT.SETUP_NOTAM_MODE,function(evt,params){if(params){if(params.enabled&&_instance.mapLayer.visibility&&_instance.mapLayer.selectedFeatures.length>0){AppController.aisWeb.getHoverFeatureController().unselectAll();}_instance.mapLayer.setVisibility(params.enabled);if(params.enabled===true){_instance.refresh(AppController.appTime.getTime());}}});};this.createMapLayer=function(){const xtamMarksStyleMap=new OpenLayers.StyleMap({pointRadius:this.config.pointRadius,fillColor:this.config.fillColor,fillOpacity:this.config.fillOpacity,strokeColor:this.config.strokeColor});const xtamMarkContext=function(feature){return feature;};const selectedTypes=AWUtils.cloneObject(this.config.types);const selectedColor="blue";Object.values(selectedTypes).forEach((type)=>{type.fillColor=selectedColor;type.pointRadius+=5;});xtamMarksStyleMap.addUniqueValueRules("default","type",this.config.types,xtamMarkContext);xtamMarksStyleMap.addUniqueValueRules("select","type",selectedTypes,xtamMarkContext);this.mapLayer=new OpenLayers.Layer.Vector("Airport NOTAM Marks",{isBaseLayer:false,displayInLayerSwitcher:false,visibility:false,renderers:["FeatureImage"],styleMap:xtamMarksStyleMap});};this.refresh=function(dateTime){if(_instance.mapLayer.visibility){const map=AppController.aisWeb.getMap();if(map.getZoom()>=_instance.config.minZoomLevel){AWDataHandler.loadXtamMarks(dateTime,map,_instance.processDataResponse);_instance.displayedZoomLevelWarn=false;}else if(!_instance.displayedZoomLevelWarn){JQMUtil.showInfoMsg(AWLocale.getLocalizedString("Common.msg.notamMarksZoomLevelInfo"),true);_instance.displayedZoomLevelWarn=true;}}};this.processDataResponse=function(data,customData,xhr){if(xhr&&xhr.status===200&&data&&data.XtamMark){const marks=(Array.isArray(data.XtamMark))?data.XtamMark:[data.XtamMark];_instance.redraw(marks);}};this.redraw=function(data){if(Array.isArray(data)&&data.length>0){const map=AppController.aisWeb.getMap();const epsg4326=new OpenLayers.Projection("EPSG:4326");const projectTo=map.getProjectionObject();const markArr=[];const hoverCtrl=AppController.aisWeb.getHoverFeatureController();const selectedFeatures=_instance.mapLayer.selectedFeatures;const selectedIds=selectedFeatures.map(f=>f.xtamMarkObj.code);data.forEach(markObj=>{const lon=AwCoordinates.convertSec2deg(markObj.lng);const lat=AwCoordinates.convertSec2deg(markObj.lat);if(!markObj.flag){debug("Undefined flag for xtamMark with code: "+markObj.code);}else if(lon!==undefined&&lat!==undefined){const lonLat=new OpenLayers.LonLat(lon,lat).transform(epsg4326,projectTo);const point=new OpenLayers.Geometry.Point(lonLat.lon,lonLat.lat);const attrs={type:markObj.type};_instance.setupFlagImages(markObj,attrs);const mark=new OpenLayers.Feature.Vector(point,attrs,null);mark.xtamMarkObj=markObj;markArr.push(mark);}else{debug("Undefined location for xtamMark with code: "+markObj.code);}});hoverCtrl.unselectArray(selectedFeatures);_instance.mapLayer.removeAllFeatures();if(markArr.length>0){_instance.mapLayer.addFeatures(markArr);if(selectedIds.length>0){const newSelectedFeatures=Array.from(markArr).filter(f=>selectedIds.includes(f.xtamMarkObj.code));newSelectedFeatures.forEach(f=>{hoverCtrl.select(f);});}}}else{_instance.mapLayer.removeAllFeatures();}};this.setupFlagImages=function(markObj,attrs){const iconUrl=[];if(markObj&&markObj.flag){[...markObj.flag].forEach(function(flag){switch(flag){case XtamMark.FLAG.SNOWTAM:iconUrl.push(_instance.config.flags.snowtam);break;case XtamMark.FLAG.ASHTAM:iconUrl.push(_instance.config.flags.ashtam);break;default:break;}});}if(iconUrl.length>0){attrs.image={url:iconUrl+"?"+AppController.appRevision,xOffset:_instance.config.pointRadius+5,width:32,height:32};}};this.loadDataForMarkFeature=function(feature,callbackFnc){const result={};const markObj=feature.xtamMarkObj;const options={date:AppController.appTime.getTime(),notamMode:AppController.aisWeb.actualNotamMode,code:markObj.code};function syncFnc(data,userData,xhr){if(data&&userData){result[userData]=data;if(result.notams&&result.snowtams&&result.ashtam){AWUtils.applyFunction(this,callbackFnc,[feature,result]);}}};if(markObj.flag&&markObj.flag.contains(XtamMark.FLAG.SNOWTAM)){AWDataHandler.getSnowtamsForArp(options,syncFnc,"snowtams");}else{result.snowtams=[];}if(markObj.flag&&markObj.flag.contains(XtamMark.FLAG.ASHTAM)){options.userData="ashtam";AWDataHandler.getAshtamList(options,syncFnc);}else{result.ashtam=[];}AWDataHandler.getNotamsForArp(options,syncFnc,"notams");};this.getSelectedFeatures=function(){return _instance.mapLayer.selectedFeatures;};this.init();}function XtamMark(){}XtamMark.TYPE={AD:"Aerodrome",FIR:"Fir"};XtamMark.FLAG={NOTAM:"N",SNOWTAM:"S",ASHTAM:"A"};function ZoneLayer(zoneType){var _instance=this;this.mapLayer;this.zoneType=zoneType;this.zones;this.zoneMessages;this.appDateType;this.loading;this.initMapLayers=function(map,layerName){var ds=JSON.parse(JSON.stringify(OpenLayers.Feature.Vector.style['default']));var ss=JSON.parse(JSON.stringify(OpenLayers.Feature.Vector.style['select']));var dStyle=OpenLayers.Util.extend(ds,{strokeColor:"${strokeColor}",strokeWidth:"${strokeWidth}",fontColor:"${fontColor}",fontSize:"12px",fontFamily:"Courier New, monospace",fontWeight:"bold",labelAlign:"cb",labelYOffset:"30",labelOutlineColor:"${labelOutlineColor}",labelOutlineWidth:"${labelOutlineWidth}",fillColor:"${fillColor}",fillOpacity:"${fillOpacity}",label:"${label}",pointRadius:"${radius}"});var sStyle=OpenLayers.Util.extend(ss,{labelAlign:"cb",labelYOffset:"30",pointRadius:"${radius}"});var strategies=[];if(FunctionsController.isFunctionEnabled("zoneLayer_featureClustering")){var strategy=new OpenLayers.Strategy.AttributeCluster();strategy.distance=30;strategies.push(strategy);}this.mapLayer=new OpenLayers.Layer.Vector(layerName,{isBaseLayer:false,displayInLayerSwitcher:true,strategies:strategies,styleMap:new OpenLayers.StyleMap({'default':dStyle,'select':sStyle})});this.mapLayer.styleMap.styles.default.context=this.mapLayer.styleMap.styles.select.context={radius:function(feature){var retVal;if(feature.cluster){var dynamicSize=(feature.cluster)?feature.cluster.length:15;retVal=Math.min(Math.round(dynamicSize/10),15)+10;}return retVal;}};map.addLayers([this.mapLayer]);if(AWUtils.device.is_mobile()){AppController.aisWeb.addLayerToFeatureSelectorCtrl(this.mapLayer);}else{AppController.aisWeb.addLayerToFeatureSelectorCtrl(this.mapLayer);AppController.aisWeb.addLayerToHoverFeatureCtrl(this.mapLayer);}this.mapLayer.events.register("visibilitychanged",null,function(e){if(e.object.visibility){_instance.refresh();}});JQ(AppController.mapset).on(Mapset2.EVENT.SYSTEM_LAYER_PROCESSED,function(){_instance.flFilterDepending=isFlFilterDepending(_instance.mapLayer);if(_instance.flFilterDepending){JQ(document.appCtrl).on(AppController.EVENT.FL_FILTER_CHANGED,function(e,val){_instance.refresh();});}});};this.setLabelsVisibility=function(visible){const label=(visible===true)?"${label}":"";_instance.mapLayer.styleMap.styles.default.defaultStyle.label=label;};this.redraw=function(){_instance.mapLayer.redraw();};isFlFilterDepending=function(mapLayer){var retVal=false;var flFilterItemNames=getConfigValue2("flFilter","mapsetItems",[]);if(mapLayer.isInMapset&&mapLayer.mapsetItems){JQ.each(mapLayer.mapsetItems,function(idx,mapsetItem){retVal=(flFilterItemNames.indexOf(mapsetItem.name)!==-1);return retVal;});}else{retVal=(flFilterItemNames.indexOf(mapLayer.name)!==-1);}return retVal;};this.setDateType=function(appDateType){_instance.appDateType=appDateType;};this.refresh=function(date){if(_instance.mapLayer!==undefined&&_instance.mapLayer.map!==undefined){if(_instance.loading===true){debug("Ignored duplicity request to data for zoneLayer: "+_instance.mapLayer.name);}else if(_instance.mapLayer.visibility===true){var params={type:_instance.zoneType};var andFilter=new ZoneFilterLogical(ZoneFilterLogical.TYPE.AND);var statusFilter=new ZoneFilterData();var validityFilter=new ZoneFilterData();var wholeDay=false;if(!date){var stp=AppController.appTime.getStaticTimeParams(_instance.appDateType);date=AppController.appTime.getTime(_instance.appDateType);wholeDay=(stp)?stp.wholeDay:AppController.appTime.isWholeDay();}statusFilter.setStatus(_instance.zoneStatus);validityFilter.setValidity(new ZoneValidityType(date,wholeDay));andFilter.addFilter(statusFilter);andFilter.addFilter(validityFilter);if(_instance.flFilterDepending&&AppController.flFilter.active){var heightFilter=new ZoneFilterData();heightFilter.setHeight(new ZoneHeightLimitType(AppController.flFilter.lower,AppController.flFilter.upper,ZoneModel.HEIGHT_UNIT.FEET,ZoneModel.HEIGHT_UNIT.FEET));andFilter.addFilter(heightFilter);}params.filter=andFilter;_instance.loading=true;AWDataHandler.getAllZones(params,function(data){const canErrorAlert=getConfigValue("zoneLayerAlert",true);_instance.loading=false;if(data!==null){var errCode=parseInt(data.code);if(errCode===0){var zones;var zoneMessages=data.zoneMessage;if(data.userZone){zones=data.userZone;}else if(data.zone){zones=data.zone;}if(zones!==undefined&&JQ.isArray(zones)===false){zones=[zones];}if(zoneMessages!==undefined&&JQ.isArray(zoneMessages)===false){zoneMessages=[zoneMessages];}_instance.zones=zones;_instance.zoneMessages=zoneMessages;_instance.showData();}else{const msg=(data.message)?data.message:"Undefined error from webservice";(canErrorAlert)?JQMUtil.showInfoMsg(msg,true):console.error(msg);}}else{const msg=_instance.mapLayer.name+": Connecting error!";debug("ZoneLayer received null response. ZoneType: "+_instance.zoneType);(canErrorAlert)?JQMUtil.showInfoMsg(msg,true):console.error(msg);}});}}else{debug("Can not load Zone Map Layer! Map not defined. ZoneType: "+_instance.zoneType);}};this.showData=function(){const zoneFeatures=[];const hoverCtrl=AppController.aisWeb.getHoverFeatureController();const selectedFeatures=_instance.mapLayer.selectedFeatures;const selectedIds=selectedFeatures.map(f=>f.data.id);;if(_instance.zones!==undefined&&_instance.zones.length>0){AWUtils.invokeLater(function(){JQ.each(_instance.zones,function(index,zone){var feature=ZonesManager.createZoneFeature(zone);if(feature!==undefined){if(_instance.stripFunc!==undefined&&typeof _instance.stripFunc==="function"){var data={zone:zone,zoneMessages:_instance.zoneMessages,showUserId:true};feature.hoverInfo=AWUtils.applyFunction(_instance,_instance.stripFunc,[data]);}if(_instance.paramsFunc!==undefined&&typeof _instance.paramsFunc==="function"){AWUtils.applyFunction(_instance,_instance.paramsFunc,[zone,feature]);}zoneFeatures.push(feature);}});hoverCtrl.unselectArray(selectedFeatures);_instance.mapLayer.removeAllFeatures();if(zoneFeatures.length>0){_instance.mapLayer.addFeatures(zoneFeatures);if(selectedIds.length>0){const newSelectedFeatures=Array.from(zoneFeatures).filter(f=>selectedIds.includes(f.data.id));hoverCtrl.selectAll(newSelectedFeatures);}}});}else{_instance.mapLayer.removeAllFeatures();}};this.setStripFunction=function(stripFunc){_instance.stripFunc=stripFunc;};this.setFeatureParamsFunction=function(paramsFunc){_instance.paramsFunc=paramsFunc;};this.getLayer=function(){return _instance.mapLayer;};this.setZoneStatus=function(status){this.zoneStatus=status;};this.updateZoneStatus=function(newStatus){var a=(JQ.isArray(this.zoneStatus))?this.zoneStatus.join():this.zoneStatus;var b=(JQ.isArray(newStatus))?newStatus.join():newStatus;if(a!==b){this.zoneStatus=newStatus;this.refresh();}};this.getZoneStatus=function(){return this.zoneStatus;};}function ZoneModel(){}ZoneModel.TYPE={DRONE:"DRONE_ZONE",NO_DRONE:"NO_DRONE_ZONE",E_FUA:"E_FUA",LARA_FUA:"LARA_FUA",CAT_FUA:"CAT_FUA",NOTAM:"NOTAM"};ZoneModel.STATUS={PREPARED:"PREPARED",PUBLISHED:"PUBLISHED",ACTIVATED:"ACTIVATED",FINISHED:"FINISHED",ERASED:"ERASED"};ZoneModel.FEATURE_TYPE={POINT:"POINT",LINE:"LINE",POLYGON:"POLYGON",BOX:"BOX",CIRCLE:"CIRCLE"};ZoneModel.HEIGHT_UNIT={METER:"m",FEET:"ft",FLIGHT_LEVEL:"F",GND:"GND",UNL:"UNL"};ZoneModel.fromWmsFuaFeature=function(feature){var retVal;if(feature&&feature.attrs){var src=feature.attrs;retVal={zone:{_attrs:src,id:HtmlUtils.encodeForHTMLAttribute(src.CODE_ID),type:ZoneModel.TYPE.E_FUA,status:(src.ACTIVATED)?ZoneModel.STATUS.ACTIVATED:ZoneModel.STATUS.PUBLISHED,name:src.TXT_NAME,dateTimeFrom:src.TIME_FROM,dateTimeTo:src.TIME_TO,feature:{Height:{From:src.LOWER_FL_STR,FromUnit:"",To:src.UPPER_FL_STR,ToUnit:""}}}};}return retVal;};class ZoneFilter{constructor(filterName){this.__filterName=filterName;this[filterName]={};}addAttribute(name,value){this[this.__filterName]["_"+name]=value;}addElement(name,value){this[this.__filterName][name]=value;}setElement(name,value){var obj={};obj[name]=value;this[this.__filterName]=obj;};addElementValue(name,value){if(value instanceof ZoneFilter){var filterName=value.__filterName;var arr=this[this.__filterName][name][filterName];if(arr===undefined){arr=[];this[this.__filterName][name][filterName]=arr;}arr.push(value[filterName]);}}};class ZoneValidityType{constructor(date,wholeDay){this.date=date;this.wholeDay=wholeDay;}}class ZoneGeometryType{setWkt(data){this.wkt=data;}}class ZoneHeightLimitType{constructor(from,to,fromUnit,toUnit){if(from&&from.length>0){this.From=from;}if(to&&to.length>0){this.To=to;}if(fromUnit){this.FromUnit=fromUnit;}if(toUnit){this.ToUnit=toUnit;}}}class ZoneFilterLogical extends ZoneFilter{constructor(type){super("logicalFilter");this.addAttribute("type",type);this.addElement("filters",{});}addFilter(filter){this.addElementValue("filters",filter);};};class ZoneFilterParams extends ZoneFilter{constructor(key,value,comparison){super("paramsFilter");this.addElement("key",key);this.addElement("value",value);this.addElement("comparison",comparison);}};class ZoneFilterData extends ZoneFilter{constructor(){super("dataFilter");}setStatus(status){if(Array.isArray(status)===false){status=[status];}this.setElement("status",status);}setValidity(validity){this.setElement("validity",validity);}setGeometry(geometry){this.setElement("geometry",geometry);}setName(name){this.setElement("name",name);}setHeight(height){this.setElement("height",height);}};ZoneFilterLogical.TYPE={AND:"AND",OR:"OR",NOT:"NOT"};ZoneFilterParams.COMPARISION={EQUAL_TO:"EqualTo",GREATER_THAN:"GreaterThan",LESS_THAN:"LessThan",LIKE:"Like"};function ZonesManager(zoneType){var _gui=null;var self=this;var _rqTimeStamp=null;var _stripActionsFunc;var _stripFunc;var _zoneClickFunc;self.mapFeatures=[];self.zoneType=zoneType;self.zoneStatus=["PUBLISHED"];this.getGui=function(addZoneCallback){if(_gui===null){_gui=JQ('<div class="zonesManagerForm"></div>');var controls=JQ('<div class="zonesManager-controls"></div>');var addZoneButton=JQ('<input type="button" id="zonesManager-addZoneBtn" value="Create" data-icon="plus">');var filterInput=JQ('<input id="zonesManager-filterInput" data-type="search" data-wrapper-class="ui-btn zonesManager-filterInputWrapper">');var refreshButton=JQ('<input type="button" id="zonesManager-refreshBtn" value="Refresh" data-icon="refresh">');var updateTime=JQ('<div class="zonesManager-updateTime"></div>');var zoneList=JQ('<ul data-role="listview" id="zonesManager-zoneList" data-filter="true" data-input="#zonesManager-filterInput"></ul>');controls.append(addZoneButton);controls.append(filterInput);controls.append(refreshButton);updateTime.append('<span localisationkey="ZonesManager.updateTime" class="label">Last Update </span>');updateTime.append('<span class="value"></span>');_gui.append(controls);_gui.append(updateTime);_gui.append(zoneList);addZoneButton.click(addZoneCallback);addZoneButton.attr('localisationkey','ZonesManager.createZone');refreshButton.attr('localisationkey','ZonesManager.refresh');refreshButton.click(self.loadData);}return _gui;};this.initMapLayer=function(map,layerName){var ds=JSON.parse(JSON.stringify(OpenLayers.Feature.Vector.style['default']));var ss=JSON.parse(JSON.stringify(OpenLayers.Feature.Vector.style['select']));var dStyle=OpenLayers.Util.extend(ds,{strokeColor:"${strokeColor}",strokeOpacity:"${strokeOpacity}",strokeWidth:"${strokeWidth}",fontColor:"${fontColor}",fontSize:"12px",fontFamily:"Courier New, monospace",fontWeight:"bold",labelAlign:"cb",labelYOffset:"30",labelOutlineColor:"${labelOutlineColor}",labelOutlineWidth:"${labelOutlineWidth}",fillColor:"${fillColor}",fillOpacity:"${fillOpacity}",label:"${label}",graphicName:"${graphicName}"});var sStyle=OpenLayers.Util.extend(ss,{labelAlign:"cb",labelYOffset:"30"});self._mapLayer=new OpenLayers.Layer.Vector(layerName,{isBaseLayer:false,displayInLayerSwitcher:false,visibility:true,styleMap:new OpenLayers.StyleMap({'default':dStyle,'select':sStyle})});map.addLayers([self._mapLayer]);};this.setStripActionsFunction=function(stripActionsFunc){_stripActionsFunc=stripActionsFunc;};this.setStripFunction=function(stripFunc){_stripFunc=stripFunc;};this.setZoneClickFunction=function(clickFunc){_zoneClickFunc=clickFunc;};this.setStatusFilter=function(statusArr){self.zoneStatus=statusArr;};this.loadData=function(){var params={type:self.zoneType};if(self.zoneStatus){var statusFilter=new ZoneFilterData();statusFilter.setStatus(self.zoneStatus);params.filter=statusFilter;}_rqTimeStamp=new Date();if(_gui!==null){_gui.loading(true,true);}AWDataHandler.getZones(params,function(data){_gui.loading(false);if(data!==null){var errCode=parseInt(data.code);if(errCode===0){var zones;var zoneMessages=data.zoneMessage;if(data.userZone){zones=data.userZone;}else if(data.zone){zones=data.zone;}if(zones!==undefined&&JQ.isArray(zones)===false){zones=[zones];}if(zoneMessages!==undefined&&JQ.isArray(zoneMessages)===false){zoneMessages=[zoneMessages];}self.zones=zones;self.zoneMessages=zoneMessages;self.showData(zones,zoneMessages);}else{var msg=(data.message)?data.message:"Undefined error from webservice";JQMUtil.showInfoMsg(msg,true);}}else{JQMUtil.showInfoMsg("Connecting error!",true);}});};this.showData=function(zones,zoneMessages){var zoneList=_gui.find('#zonesManager-zoneList');var selectedId=zoneList.find("li.highlight").attr("id");zoneList.html("");_gui.find('.zonesManager-updateTime .value').html(AWUtils.formatDateTime(_rqTimeStamp));if(zones!==undefined){ZonesManager.setupZonesStatus(zones);JQ.each(zones,function(idx,zone){var data={zone:zone,zoneMessages:zoneMessages,actions:(_stripActionsFunc)?AWUtils.applyFunction(self,_stripActionsFunc,[zone]):undefined};var strip=(_stripFunc)?AWUtils.applyFunction(self,_stripFunc,[data]):self.createZoneStrip(zone,zoneMessages);if(isUndefinedOrIsNull(strip)){return true;}zoneList.append(strip);});zoneList.listview("refresh");zoneList.filterable("refresh");zoneList.find("li").click(function(){self.setSelectedZone(JQ(this).data("zone"),true);});if(selectedId!==undefined){var li=zoneList.find("#"+selectedId);self.setSelectedZone(li.data("zone"),true);}AWLocale.processLocalisationOnJQElement(_gui);}};this.getSelectedListItem=function(){var zoneList=_gui.find('#zonesManager-zoneList');return zoneList.find("li.highlight");};this.getSelectedZone=function(){return self.getSelectedListItem().data('zone');};this.setSelectedZone=function(zoneId,toggleFlag){var zone;if(zoneId instanceof Object){zone=zoneId;zoneId=zone.id;}var zoneList=_gui.find('#zonesManager-zoneList');var zoneLi=zoneList.find("#zonesManager-strip-"+zoneId);if(zoneLi.length>0){if(zone===undefined){zone=zoneLi.data("zone");}(_zoneClickFunc)?AWUtils.applyFunction(self,_zoneClickFunc,[zone,zoneLi.hasClass("highlight")]):self.processZone(zone,zoneLi.hasClass("highlight"));if(toggleFlag){zoneLi.toggleClass("highlight").siblings().removeClass("highlight");}else{zoneLi.addClass("highlight").siblings().removeClass("highlight");}}else{zoneList.find("li").removeClass("highlight");}};this.startRefreshLoop=function(){var now=new Date();var sec=60-now.getSeconds();setTimeout(function(){self.doRefreshLoop();self.refreshLoopId=setInterval(function(){self.doRefreshLoop();},60000);},sec*1000);};this.doRefreshLoop=function(){self.showData(self.zones,self.zoneMessages);};this.stopRefreshLoop=function(){if(self.refreshLoopId!==undefined){clearInterval(self.refreshLoopId);self.refreshLoopId=undefined;}};this.zoomToLayerData=function(){if(self._mapLayer!==undefined){var map=self._mapLayer.map;map.zoomToExtent(self._mapLayer.getDataExtent());}};this.deleteZoneAction=function(zone){JQMUtil.showOptionMsg(getLocalizedString("ZonesManager.deleteQuestion"),[JQMUtil.yesOption,JQMUtil.noOption],function(optionId){if(optionId===JQMUtil.yesOption.id){self.setZoneStatus(zone,ZoneModel.STATUS.ERASED,getLocalizedString("ZonesManager.zoneDeleted"));}});};this.finishZoneAction=function(zone){JQMUtil.showOptionMsg(getLocalizedString("ZonesManager.finishQuestion"),[JQMUtil.yesOption,JQMUtil.noOption],function(optionId){if(optionId===JQMUtil.yesOption.id){self.setZoneStatus(zone,ZoneModel.STATUS.FINISHED,getLocalizedString("ZonesManager.zoneFinished"));}});};this.setZoneStatus=function(zone,status,okMsg){zone.status=status;AWDataHandler.updateZone(zone,function(data){_gui.loading(false);if(data!==null){var errCode=parseInt(data.code);if(errCode===0){JQMUtil.showInfoMsg(okMsg,false,true);self.loadData();}else{var msg=(data.message)?data.message:"Undefined error from webservice";JQMUtil.showInfoMsg(msg,true);}}else{JQMUtil.showInfoMsg("Connecting error!",true);}});};this.createZoneStrip=function(zone){if(isUndefinedOrIsNull(zone)){zone=[];}var li=ZonesManager.createZoneStrip(zone);li.append('<h2>'+HtmlUtils.encodeForHTML(zone.id)+'</h2>');li.append('<p>'+HtmlUtils.encodeForHTML(zone.name)+'</p>');return li;};this.createZoneStripAction=function(type){var retVal=JQ('<div class="zonesManager-strip-action"></div>');retVal.addClass("zonesManager-strip-"+type);return retVal;};this.addFeature=function(feature){var arr=[feature];self.mapFeatures.push(feature);self._mapLayer.addFeatures(arr);};this.clearMapLayer=function(){if(self._mapLayer!==undefined){self._mapLayer.removeFeatures(self.mapFeatures);self.mapFeatures=[];}};this.processZone=function(zone,visible){self.clearMapLayer();if(zone!==undefined&&!visible){try{var feature=ZonesManager.createZoneFeature(zone);self._mapLayer.addFeatures([feature]);}catch(e){JQMUtil.showInfoMsg("Can not create zone feature.",true,true);}}};}ZonesManager.prototype.zoneType;ZonesManager.prototype.zoneStatus;ZonesManager.prototype.mapFeatures;ZonesManager.prototype._mapLayer;ZonesManager.prototype.zones;ZonesManager.prototype.zoneMessages;ZonesManager.prototype.refreshLoopId;ZonesManager.CONFLICT_ZONE_CONFIG_KEY="conflictZone";ZonesManager.DEFAULT_CONFLICT_ZONE_COLOR="red";ZonesManager.DEFAULT_CENTER_GRAPHIC_NAME="cross";ZonesManager.formatHeight=function(val,unit){var meterVal=Math.round(AWUtils.convertToMeter(HtmlUtils.encodeForHTML(val),HtmlUtils.encodeForHTML(unit))*10)/10;var feetVal=(unit==="ft")?val:Math.round(meterVal*AWUtils.meter2Feet);return meterVal+" m ("+feetVal+" ft)";};ZonesManager.formatCoord=function(element,coord){var lonLat;if(coord instanceof OpenLayers.Geometry.Point){lonLat=new OpenLayers.LonLat(coord.x,coord.y);}else if(coord instanceof OpenLayers.LonLat){lonLat=coord;}else if(coord.Lat!==undefined&&coord.Long!==undefined){lonLat=new OpenLayers.LonLat(coord.Long,coord.Lat);}element.val(AwCoordinates.formatLonLat(lonLat,AwCoordinates.FORMAT.DD_MM_SS_ss," "));};ZonesManager.formatStatus=function(status,localeKeyPrefix){var retVal=JQ("<span></span>");if(status!==undefined){retVal.attr('localisationkey',localeKeyPrefix+"."+status.toLowerCase());}else{status="?";}retVal.text(status);return retVal;};ZonesManager.createGeometryFeature=function(geometry){var retVal;if(geometry!==undefined){try{var format=new OpenLayers.Format.WKT();retVal=format.read(geometry.Wkt);}catch(e){}}return retVal;};ZonesManager.createZoneFeature=function(zone){var geom;try{geom=zone.feature.Geometry;}catch(e){}return ZonesManager.createGeometryFeature(geom);};ZonesManager.setupZonesStatus=function(zoneArr){if(JQ.isArray(zoneArr)===false){zoneArr=[zoneArr];}var now=new Date();JQ.each(zoneArr,function(idx,zone){var fromDate=IbafUtils.parseUtcDateString(zone.dateTimeFrom);var toDate=IbafUtils.parseUtcDateString(zone.dateTimeTo);if((toDate<=now)&&(zone.status===ZoneModel.STATUS.PUBLISHED||zone.status===ZoneModel.STATUS.ACTIVATED)){zone.status=ZoneModel.STATUS.FINISHED;}else if((fromDate<=now)&&(zone.status===ZoneModel.STATUS.PUBLISHED)){zone.status=ZoneModel.STATUS.ACTIVATED;}});};ZonesManager.createZoneStrip=function(zone){var retVal=JQ('<li class="zonesManager-strip"></li>');;retVal.addClass('zoneStatus-'+zone.status);retVal.data('zone',zone);retVal.attr('id',"zonesManager-strip-"+zone.id);return retVal;};ZonesManager.createZoneStripLabelledValue=function(localeKey,customClass,value){var retVal=JQ('<div class="zonesManager-strip-labelledValue"></div>');var labelObj=JQ('<span class="label"></span>');var valueObj=JQ('<span class="value"></span>');labelObj.attr('localisationkey',localeKey);valueObj.append(value);retVal.addClass(customClass);retVal.append(labelObj);retVal.append(valueObj);return retVal;};ZonesManager.createZoneStripDescription=function(zone){var desc=zone.desc||"";desc=HtmlUtils.encodeForHTML(desc);desc=desc.replace('\n','<br>');return JQ('<div class="zonesManager-strip-zoneDesc">'+desc+'</div>');};ZonesManager.createZoneMessageItem=function(zoneMsg){if(isUndefinedOrIsNull(zoneMsg)){zoneMsg=[];}var retVal=JQ('<div class="zonesManager-messageItem"></div>');var originator=(zoneMsg.originator)?zoneMsg.originator:"";var dateItem=JQ('<div class="zonesManager-messageItem-date"></div>');dateItem.append(AWUtils.formatDateTime(IbafUtils.parseUtcDateString(zoneMsg.date)));retVal.addClass('zonesManager-messageItem-'+zoneMsg.type);retVal.append(dateItem);retVal.append('<div class="zonesManager-messageItem-originator">'+HtmlUtils.encodeForHTML(originator)+'</div>');retVal.append('<div class="zonesManager-messageItem-text">'+HtmlUtils.encodeForHTML(zoneMsg.text)+'</div>');retVal.data('zoneMsg',zoneMsg);return retVal;};ZonesManager.createZoneMessageItems=function(zoneId,messages){var retVal=[];if(JQ.isArray(messages)){JQ.each(messages,function(index,zoneMsg){if(zoneMsg.zoneId===zoneId){var item=ZonesManager.createZoneMessageItem(zoneMsg);retVal.push(item);}});}return retVal;};ZonesManager.processZoneMessages=function(zoneMessages){if(zoneMessages!==undefined){if(!JQ.isArray(zoneMessages)){zoneMessages=[zoneMessages];}var detailItems=[];var features=[];var infoCnt=0;var warnCnt=0;JQ.each(zoneMessages,function(index,zoneMsg){var msgItem=ZonesManager.createZoneMessageItem(zoneMsg);detailItems.push(msgItem);var conflict=zoneMsg.conflict;if(conflict!==undefined){var feature=ZonesManager.createGeometryFeature(conflict.geometry);if(feature!==undefined){if(conflict.type!==undefined){var label;var color;switch(zoneMsg.type){case"INFO":color="#e7e7c4";infoCnt++;break;case"WARNING":color="#ff9a7a";warnCnt++;break;default:color=ZonesManager.DEFAULT_CONFLICT_ZONE_COLOR;}switch(conflict.type){case"SDO":label="Conflicted Airspace";break;case"DRONE_ZONE":label="Conflicted DroneZone";break;case"NO_DRONE_ZONE":label="Conflicted NoDroneZone";break;default:label="Conflicted UnknownZone";}feature.type="ConflictedZone_"+conflict.type;feature.hoverInfo=msgItem;feature.attributes.label=label;JQ.extend(feature.attributes,ZonesManager.createDefaultStyleConfigItem(ZonesManager.CONFLICT_ZONE_CONFIG_KEY,ZonesManager.DEFAULT_CONFLICT_ZONE_COLOR));feature.attributes.strokeWidth=5;feature.attributes.strokeOpacity=1;}features.push(feature);}}});return{features:features,details:detailItems};}};ZonesManager.getZoneParam=function(zone,key){var retVal=[];if(zone!==undefined&&key!==undefined&&zone.param!==undefined){var params=zone.param;if(JQ.isArray(params)){JQ.each(params,function(idx,param){if(param.Key!==undefined&&param.Key===key){retVal.push(param.Value);}});}else{if(params.Key!==undefined&&params.Key===key){retVal.push(params.Value);}}}return retVal;};ZonesManager.createCenterZoneMark=function(feature,color){var center=feature.geometry.getCentroid();var retVal=new OpenLayers.Feature.Vector(center,{graphicName:ZonesManager.DEFAULT_CENTER_GRAPHIC_NAME,label:"",zoneColor:color});feature.centerMark=retVal;return retVal;};ZonesManager.createStyleConfig=function(rootKey,dftColor){var dftStyle=ZonesManager.createDefaultStyleConfigItem(rootKey,dftColor);var retVal={default:dftStyle};retVal[ZoneModel.STATUS.PREPARED]=ZonesManager.createStyleConfigItem(rootKey,'prepared',dftStyle);retVal[ZoneModel.STATUS.PUBLISHED]=ZonesManager.createStyleConfigItem(rootKey,'published',dftStyle);retVal[ZoneModel.STATUS.ACTIVATED]=ZonesManager.createStyleConfigItem(rootKey,'activated',dftStyle);retVal[ZoneModel.STATUS.FINISHED]=ZonesManager.createStyleConfigItem(rootKey,'finished',dftStyle);return retVal;};ZonesManager.createDefaultStyleConfigItem=function(rootKey,dftColor){var defFillOpacity=0.4;var defStrokeOpacity=1;var defStrokeWidth=2;var subKey="style";var key='default';var retVal={fillColor:getConfigValue4(rootKey,subKey,key,'fillColor',dftColor),fillOpacity:getConfigValue4(rootKey,subKey,key,'fillOpacity',defFillOpacity),strokeColor:getConfigValue4(rootKey,subKey,key,'strokeColor',undefined),strokeOpacity:getConfigValue4(rootKey,subKey,key,'strokeOpacity',defStrokeOpacity),strokeWidth:getConfigValue4(rootKey,subKey,key,'strokeWidth',defStrokeWidth),fontColor:getConfigValue4(rootKey,subKey,key,'fontColor',undefined),labelOutlineColor:getConfigValue4(rootKey,subKey,key,'labelOutlineColor',"white"),labelOutlineWidth:getConfigValue4(rootKey,subKey,key,'labelOutlineWidth',3)};if(retVal.strokeColor===undefined){retVal.strokeColor=retVal.fillColor;}if(retVal.fontColor===undefined){retVal.fontColor=retVal.fillColor;}return retVal;};ZonesManager.createStyleConfigItem=function(rootKey,key,dftStyle){var subKey="style";var retVal={fillColor:getConfigValue4(rootKey,subKey,key,'fillColor',dftStyle.fillColor),fillOpacity:getConfigValue4(rootKey,subKey,key,'fillOpacity',dftStyle.fillOpacity),strokeColor:getConfigValue4(rootKey,subKey,key,'strokeColor',undefined),strokeOpacity:getConfigValue4(rootKey,subKey,key,'strokeOpacity',dftStyle.strokeOpacity),strokeWidth:getConfigValue4(rootKey,subKey,key,'strokeWidth',dftStyle.strokeWidth),fontColor:getConfigValue4(rootKey,subKey,key,'fontColor',undefined),labelOutlineColor:getConfigValue4(rootKey,subKey,key,'labelOutlineColor',dftStyle.labelOutlineColor),labelOutlineWidth:getConfigValue4(rootKey,subKey,key,'labelOutlineWidth',dftStyle.labelOutlineWidth)};if(retVal.strokeColor===undefined){retVal.strokeColor=retVal.fillColor;}if(retVal.fontColor===undefined){retVal.fontColor=retVal.fillColor;}return retVal;};ZonesManager.setupZoneFeatureStyle=function(zone,zoneFeature,styleConfig){var aCfg=styleConfig[zone.status];if(aCfg===undefined){aCfg=styleConfig.default;}JQ.extend(zoneFeature.attributes,aCfg);};ZonesManager.setupZoneFeatureParams=function(zone,feature){if(zone!==undefined&&feature!==undefined){var attrs=feature.data;feature.type=AWUtils.featureType.ZONE;feature.attributes.label="Zone";attrs.id=zone.id;attrs.name=zone.name;attrs.status=zone.status;attrs.heightFrom=zone.feature.Height.From+" "+zone.feature.Height.FromUnit;attrs.heightTo=zone.feature.Height.To+" "+zone.feature.Height.ToUnit;attrs.start=zone.dateTimeFrom;attrs.finish=zone.dateTimeTo;attrs.validity=ZonesGui.createZoneStripDate(zone);attrs.description=zone.desc;}};function ZonesGui(){}ZonesGui.createStrip=function(data){var retVal;if(data&&data.zone&&data.zone.type){switch(data.zone.type){case ZoneModel.TYPE.E_FUA:retVal=ZonesGui.createFuaStrip(data);break;case ZoneModel.TYPE.LARA_FUA:retVal=ZonesGui.createFuaLaraStrip(data);break;case ZoneModel.TYPE.CAT_FUA:retVal=ZonesGui.createFuaCatStrip(data);break;case ZoneModel.TYPE.DRONE:retVal=ZonesGui.createDroneStrip(data);break;case ZoneModel.TYPE.NO_DRONE:retVal=ZonesGui.createNoDroneStrip(data);break;case ZoneModel.TYPE.NOTAM:retVal=ZonesGui.createNotamStrip(data);break;default:retVal=ZonesManager.createZoneStrip(data.zone);}}return retVal;};ZonesGui.createCommonStrip=function(zone){var retVal=JQ('<li class="zonesManager-strip"></li>');;retVal.addClass('zoneStatus-'+zone.status);retVal.data('zone',zone);retVal.attr('id',"zonesManager-strip-"+zone.id);return retVal;};ZonesGui.createFuaStrip=function(data){data=data||{};var zone=data.zone||[];var strip=ZonesGui.createCommonStrip(zone);var height="?";var descriptionDiv=ZonesManager.createZoneStripDescription(zone);strip.addClass("eFuaZoneStrip");if(zone.feature!==undefined){var feature=zone.feature;height=HtmlUtils.encodeForHTML(feature.Height.From)+" "+HtmlUtils.encodeForHTML(feature.Height.FromUnit);height+=" - ";height+=HtmlUtils.encodeForHTML(feature.Height.To)+" "+HtmlUtils.encodeForHTML(feature.Height.ToUnit);}descriptionDiv.addClass("efua-activity");strip.append(ZonesGui.createZoneStripIdent(zone));strip.append('<div class="efua-levels">'+height+'</div>');strip.append(ZonesManager.formatStatus(zone.status,"FuaWindow.efuaStrip.status"));strip.append(descriptionDiv);return strip;};ZonesGui.createFuaCatStrip=function(data){data=data||{};var zone=data.zone;var messages=data.messages;if(isUndefinedOrIsNull(zone)){zone=[];}var strip=ZonesGui.createCommonStrip(zone);var labelledValues1=JQ('<div class="zonesManager-strip-labelledArea zonesManager-strip-section"></div>');var labelledValues2=JQ('<div class="zonesManager-strip-labelledArea zonesManager-strip-section"></div>');var messagesDiv=JQ('<div class="catZoneStrip-messages"></div>');var height=ZonesGui.createZoneStripHeightInterval(zone);var statLocaleKey="CatZonesManager.strip.status";var category=HtmlUtils.encodeForHTML(ZonesManager.getZoneParam(zone,"airspaceElementCategory"));var unit=HtmlUtils.encodeForHTML(ZonesManager.getZoneParam(zone,"unit"));strip.addClass("catZoneStrip");labelledValues1.append(ZonesManager.createZoneStripLabelledValue(statLocaleKey,"catZoneStrip-status",ZonesManager.formatStatus(zone.status,statLocaleKey)));labelledValues1.append(ZonesManager.createZoneStripLabelledValue("CatZonesManager.strip.category","catZoneStrip-category",category));labelledValues1.append(ZonesManager.createZoneStripLabelledValue("CatZonesManager.strip.type","catZoneStrip-type",HtmlUtils.encodeForHTML(ZonesManager.getZoneParam(zone,"airspaceElementType"))));labelledValues2.append(ZonesManager.createZoneStripLabelledValue("CatZonesManager.strip.height","catZoneStrip-height",height));if(unit.length>0){labelledValues2.append(ZonesManager.createZoneStripLabelledValue("CatZonesManager.strip.unit","catZoneStrip-unit",unit));}strip.append(ZonesGui.createZoneStripIdent(zone));strip.append(labelledValues1);strip.append(labelledValues2);if(category===CatZonesManager.ELEMENT_CATEGORY.ROUTE){var parent=labelledValues2;var points=HtmlUtils.encodeForHTML(ZonesManager.getZoneParam(zone,"startPoint"))+" - "+HtmlUtils.encodeForHTML(ZonesManager.getZoneParam(zone,"endPoint"));if(unit.length>0){parent=JQ('<div class="zonesManager-strip-labelledArea"></div>');strip.append(parent);}parent.append(ZonesManager.createZoneStripLabelledValue("CatZonesManager.strip.points","catZoneStrip-points",points));}strip.append(ZonesManager.createZoneStripDescription(zone));strip.append(messagesDiv);messagesDiv.append(ZonesManager.createZoneMessageItems(zone.id,messages));return strip;};ZonesGui.createFuaLaraStrip=function(data){data=data||{};var zone=data.zone;var messages=data.messages;if(isUndefinedOrIsNull(zone)){zone=[];}var strip=ZonesManager.createZoneStrip(zone);var labelledValues=JQ('<div class="zonesManager-strip-labelledArea zonesManager-strip-section"></div>');var messagesDiv=JQ('<div class="laraZoneStrip-messages"></div>');var height=ZonesGui.createZoneStripHeightInterval(zone);strip.addClass("laraZoneStrip");var statLocaleKey="LaraZonesManager.strip.status";labelledValues.append(ZonesManager.createZoneStripLabelledValue(statLocaleKey,"laraZoneStrip-status",ZonesManager.formatStatus(zone.status,statLocaleKey)));labelledValues.append(ZonesManager.createZoneStripLabelledValue("LaraZonesManager.strip.height","laraZoneStrip-height",height));strip.append(ZonesGui.createZoneStripIdent(zone));strip.append(labelledValues);strip.append(ZonesManager.createZoneStripDescription(zone));strip.append(messagesDiv);messagesDiv.append(ZonesManager.createZoneMessageItems(zone.id,messages));return strip;};ZonesGui.createDroneStrip=function(data){data=data||{};var zone=data.zone;var messages=data.zoneMessages;var showUserId=data.showUserId;var actions=data.actions;if(isUndefinedOrIsNull(zone)){zone=[];}showUserId=showUserId||false;var strip=ZonesManager.createZoneStrip(zone);var labelledValues=JQ('<div class="zonesManager-strip-labelledArea zonesManager-strip-section"></div>');var messagesDiv=JQ('<div class="noDroneZoneStrip-messages"></div>');var radius="?";var height="?";var heightLabelKey="DroneZone.strip.height";var missCat=ZonesManager.getZoneParam(zone,"missionOperationalCategory");strip.addClass("droneZoneStrip");if(zone.feature!==undefined){var feature=zone.feature;if(feature.Radius!==undefined){radius=feature.Radius;}if(feature.Height!==undefined&&feature.Height.To!==undefined){height=ZonesManager.formatHeight(feature.Height.To,feature.Height.ToUnit);if(feature.Height.heightForm&&feature.Height.heightForm==="AMSL"){heightLabelKey="DroneZone.strip.height_amsl";}}}strip.append(ZonesGui.createZoneStripIdent(zone));if((AppController.currentLogin!==undefined&&zone.userDesc!==AppController.currentLogin.loginName)||showUserId){strip.append('<div class="droneZoneStrip-userId">'+HtmlUtils.encodeForHTML(zone.userDesc)+'</div>');}if(zone.id&&FunctionsController.isFunctionEnabled("droneZoneStrip_flightNumber",false)){labelledValues.append(ZonesManager.createZoneStripLabelledValue("DroneZone.strip.flightNumber","droneZoneStrip-flightNumber",HtmlUtils.encodeForHTML(zone.id)));}labelledValues.append(ZonesManager.createZoneStripLabelledValue("DroneZone.strip.created","droneZoneStrip-created",AWUtils.formatDateTime(IbafUtils.parseUtcDateString(zone.dateTimeCreated))));labelledValues.append(ZonesManager.createZoneStripLabelledValue("DroneZone.strip.radius","droneZoneStrip-radius",HtmlUtils.encodeForHTML(radius)+" m"));labelledValues.append(ZonesManager.createZoneStripLabelledValue(heightLabelKey,"droneZoneStrip-height",height));if(missCat.length===1){var missCatValSpan=JQ("<span>");const missCatVal=parseInt(missCat[0]);missCatValSpan.attr(AWLocale.LOCALISATION_KEY,"DroneZone.strip.missionCat."+missCatVal);labelledValues.append(ZonesManager.createZoneStripLabelledValue("DroneZone.strip.missionCat","droneZoneStrip-missionCat",missCatValSpan));if(missCatVal>DroneUtils.MISSION_CATEGORY.OPEN){const sdoAuth=ZonesManager.getZoneParam(zone,"sdoAuth");if(sdoAuth.length===0||parseInt(sdoAuth)===0){missCatValSpan.addClass("droneZoneStrip-unauthorizedMissionCat");}}}strip.append(labelledValues);strip.append(ZonesManager.createZoneStripDescription(zone));if(actions!==undefined){var actionsDiv=JQ('<div class="zonesManager-strip-actions"></div>');actionsDiv.append(actions);strip.append(actionsDiv);}strip.append(messagesDiv);messagesDiv.append(ZonesManager.createZoneMessageItems(zone.id,messages));return strip;};ZonesGui.createNoDroneStrip=function(data){data=data||{};var zone=data.zone;var messages=data.zoneMessages;var actions=data.actions;if(isUndefinedOrIsNull(zone)){zone=[];}var strip=ZonesManager.createZoneStrip(zone);var labelledValues=JQ('<div class="zonesManager-strip-labelledArea zonesManager-strip-section"></div>');var messagesDiv=JQ('<div class="noDroneZoneStrip-messages"></div>');var featureType="?";var height=ZonesGui.createZoneStripHeightInterval(zone);const sdoAuth=ZonesManager.getZoneParam(zone,"sdoAuth");strip.addClass("noDroneZoneStrip");if(zone.feature!==undefined){var feature=zone.feature;if(feature.FeatureType!==undefined){featureType=NoDroneUtils.ZONE_TYPE[zone.feature.FeatureType];}}if(featureType===undefined){featureType="UNSUPPORTED";}labelledValues.append(ZonesManager.createZoneStripLabelledValue("NoDroneZone.strip.created","noDroneZoneStrip-created",AWUtils.formatDateTime(IbafUtils.parseUtcDateString(zone.dateTimeCreated))));labelledValues.append(ZonesManager.createZoneStripLabelledValue("NoDroneZone.strip.type","noDroneZoneStrip-type",featureType));labelledValues.append(ZonesManager.createZoneStripLabelledValue("NoDroneZone.strip.height","droneZoneStrip-height",height));if(parseInt(sdoAuth)===1){labelledValues.append(ZonesManager.createZoneStripLabelledValue("NoDroneZone.strip.sdoAuth","noDroneZoneStrip-sdoAuth"));}strip.append(ZonesGui.createZoneStripIdent(zone));strip.append('<div class="noDroneZoneStrip-userId">'+HtmlUtils.encodeForHTML(zone.userDesc)+'</div>');strip.append(labelledValues);strip.append(ZonesManager.createZoneStripDescription(zone));if(actions!==undefined){var actionsDiv=JQ('<div class="zonesManager-strip-actions"></div>');actionsDiv.append(actions);strip.append(actionsDiv);}strip.append(messagesDiv);messagesDiv.append(ZonesManager.createZoneMessageItems(zone.id,messages));return strip;};ZonesGui.createNotamStrip=function(data){data=data||{};var zone=data.zone;var messages=data.zoneMessages;var notamList,strip;var label=JQ("<div>");var messagesDiv=JQ('<div class="noDroneZoneStrip-messages"></div>');if(isUndefinedOrIsNull(zone)){zone=[];}strip=ZonesManager.createZoneStrip(zone);if(zone.name!==undefined&&zone.name.length>0){label.html(zone.name);}else{label.html("Notam Zone");}strip.append(label);notamList=ZonesManager.getZoneParam(zone,"NotamList");if(notamList){var parsed;try{parsed=JSON.parse(notamList);}catch(e){debug("Can not parse NOTAM list: "+e);}if(parsed){var ids=Object.keys(parsed);ids.forEach(id=>{var notamDesc=JQ("<pre>");notamDesc.html(parsed[id]);strip.append(notamDesc);});}}strip.append(messagesDiv);messagesDiv.append(ZonesManager.createZoneMessageItems(zone.id,messages));return strip;};ZonesGui.createZoneStripIdent=function(zone){var retVal=JQ('<div class="zonesManager-strip-ident zonesManager-strip-section"></div>');var dateDiv=JQ('<div class="zonesManager-strip-date"></div>');var typeSpan=JQ('<span class="zonesManager-strip-zoneType"></span>');if(AppController.controlPanel){JQ(document.appCtrl).on(AppController.EVENT.CLOCK_TZONE_CHANGED,function(e,isUtc){dateDiv.html("");dateDiv.append(ZonesGui.createZoneStripDate(zone,isUtc));AWLocale.processLocalisationOnJQElement(dateDiv);});}dateDiv.append(ZonesGui.createZoneStripDate(zone));typeSpan.attr(AWLocale.LOCALISATION_KEY,"ZoneModel.type."+zone.type);retVal.append('<div class="zonesManager-strip-zoneName">'+HtmlUtils.encodeForHTML(zone.name)+'</div>');retVal.append(typeSpan);retVal.append(dateDiv);return retVal;};ZonesGui.createZoneStripDate=function(zone,utcFlag){if(utcFlag===undefined){utcFlag=(JQ("#clockDiv").data("utc")!==undefined);}return AWUtils.formatDateTimeInterval(IbafUtils.parseUtcDateString(zone.dateTimeFrom),IbafUtils.parseUtcDateString(zone.dateTimeTo),utcFlag,true);};ZonesGui.createZoneStripHeightInterval=function(zone){var retVal="?";if(zone.feature!==undefined){var feature=zone.feature;if(feature.Height!==undefined){retVal="";retVal+=(feature.Height.From!==undefined)?ZonesManager.formatHeight(feature.Height.From,feature.Height.FromUnit):"?";retVal+=" - ";retVal+=(feature.Height.To!==undefined)?ZonesManager.formatHeight(feature.Height.To,feature.Height.ToUnit):"?";}}return retVal;};function ItemSorter(aSortableId,aChapters){var SORTABLE_CHECK_BOX_ID_NUMBER=0;this.mSortableUlId=isUndefinedOrIsNullOrIsEmptyString(aSortableId)?'':aSortableId;this.mChapters=isUndefinedOrIsNullOrIsEmptyArray(aChapters)?[]:aChapters;this.mSortableUl=null;this.mUlOptions={};this.mLiOptions={};this.mInputCheckboxOptions={};this.mContentElementOptions={};this.setUlOptions=function(aOptions){if(isUndefinedOrIsNullOrIsEmptyArray(aOptions)){aOptions={};}this.mUlOptions=aOptions;};this.setLiOptions=function(aOptions){if(isUndefinedOrIsNullOrIsEmptyArray(aOptions)){aOptions={};}this.mLiOptions=aOptions;};this.setInputCheckboxOptions=function(aOptions){if(isUndefinedOrIsNullOrIsEmptyArray(aOptions)){aOptions={};}this.mInputCheckboxOptions=aOptions;};this.setSpanContentOptions=function(aOptions){if(isUndefinedOrIsNullOrIsEmptyArray(aOptions)){aOptions={};}this.mContentElementOptions=aOptions;};this.getSortedItems=function(){if(isUndefinedOrIsNull(this.mSortableUl)){return[];}var retVal=[];var allLi=this.mSortableUl.children();if(isUndefinedOrIsNullOrIsEmptyArray(allLi)){return[];}allLi.each(function(index,li){var chkbox=JQ(li).find("input[type='checkbox']");retVal.push({"id":this.id,"enabled":chkbox.prop("checked")});});return retVal;};this.setSortedItems=function(sortedItems){if(typeof sortedItems==="object"&&sortedItems.length>0){var ul=this.mSortableUl;var lis=ul.find("li");JQ.each(sortedItems,function(index,item){var li=JQ(lis[item.id]);ul.append(li);li.find("input").prop("checked",item.enabled).checkboxradio("refresh");});}};this.getSortableUl=function(){if(isUndefinedOrIsNull(this.mSortableUlId)){return'';}var chapters=[];if(!isUndefinedOrIsNullOrIsEmptyArray(this.mChapters)){chapters=this.mChapters;}var retVal=JQ('<ul id="'+this.mSortableUlId+'"></ul>');if(!isUndefinedOrIsNullOrIsEmptyArray(this.mUlOptions)){retVal.attr(this.mUlOptions);}for(var i=0;i<chapters.length;i++){var iChapter=chapters[i];if(isUndefinedOrIsNull(iChapter)){continue;}var li=this.createChapterLiElement(iChapter);retVal.append(li);}this.setSortable(retVal);this.mSortableUl=retVal;return retVal;};this.setSortable=function(aSortable){aSortable.sortable({'containment':'parent','opacity':0.6});};this.createChapterLiElement=function(aChapter){var retVal=JQ(document.createElement('li'));retVal.attr('style','list-style-type: none; left: 3px;');retVal.attr('id',HtmlUtils.encodeForHTMLAttribute(aChapter.mId));retVal.addClass("itemName_"+aChapter.name);if(isUndefinedOrIsNull(aChapter)){return retVal;}var gridDiv=JQ('<div class="ui-grid-a"></div>');var blockDivA=JQ('<div class="ui-block-a" style="width:85%"></div>');var blockDivB=JQ('<div class="ui-block-b" style="width:15%"></div>');gridDiv.append(blockDivA);gridDiv.append(blockDivB);if(!isUndefinedOrIsNullOrIsEmptyArray(this.mLiOptions)){retVal.attr(this.mLiOptions);}this.createSwitchableDiv(blockDivA,aChapter);var iconButton=JQ('<div class="ui-btn ui-input-btn ui-btn-itemButton ui-corner-all ui-shadow ui-icon-segmentUpDown ui-btn-icon-left"></div>');blockDivB.append(iconButton);retVal.append(gridDiv);return retVal;};this.createSwitchableDiv=function(parent,aChapter){if(isUndefinedOrIsNull(aChapter)){return;}var chkId=this.getNextCheckBoxId();var label=JQ('<label>');label.attr('for',HtmlUtils.encodeForHTMLAttribute(chkId));label.attr('localisationkey',HtmlUtils.encodeForHTMLAttribute(aChapter.mLocaleKey));label.text(HtmlUtils.encodeForHTML(aChapter.mLocaleKey));parent.append('<input type="checkbox" id="'+HtmlUtils.encodeForHTMLAttribute(chkId)+'" checked>');parent.append(label);};this.createDefaultCheckBoxInput=function(){var retVal=JQ('<input type="checkbox" id='+this.getNextCheckBoxId()+'>');if(isUndefinedOrIsNullOrIsEmptyArray(this.mInputCheckboxOptions)){retVal.attr(this.mInputCheckboxOptions);}return retVal;};this.getNextCheckBoxId=function(){return'sortableCheckBoxId'+(SORTABLE_CHECK_BOX_ID_NUMBER++);};}function SortableItem(aId,aName){this.mId=isUndefinedOrIsNullOrIsEmptyString(""+aId)?'':aId;this.name=aName;this.mLocaleKey="FlightReportPanel.chapters."+aName;}var ReportChapterType={HEADER:"header",MAP:"map",RELIEF:"relief",WEATHER:"weather",NOTAMS:"notams",COM_NAV:"comnav",ATS_INFO:"atsinfo"};function ReportChapter(reportChapterType){this.name=reportChapterType;this.index=0;this.enabled=true;var _type=reportChapterType;this.getName=function(){return this.name;};this.setIndex=function(index){this.index=index;};this.getIndex=function(){return this.index;};this.setEnabled=function(enabled){this.enabled=enabled;};this.isEnabled=function(){return this.enabled;};this.init=function(jsonObject){if(jsonObject!=undefined){AWUtils.setupParamIfValueNotNull(this,"name",jsonObject.name);AWUtils.setupParamIfValueNotNull(this,"index",jsonObject.index);this.enabled=(jsonObject.enabled===true||jsonObject.enabled==='true')?true:false;}};this.getJson=function(){return{Chapter:this};};}function ReportIndex(){this.Chapter=new Array();var _instance=this;this.add=function(chapter){this.Chapter.push(chapter);};this.init=function(jsonObject){if(jsonObject!==undefined){if(jsonObject.Chapter!==undefined){var fObj=jsonObject.Chapter;if(fObj instanceof Array){JQ.each(fObj,function(index,value){var d=new ReportChapter();d.init(value);_instance.add(d);});}else{var d=new ReportChapter();d.init(fObj);_instance.add(d);}}}};this.size=function(){return this.Chapter.length;};this.at=function(index){return this.Chapter[index];};this.getJson=function(){var obj=Object.create(this);if(obj.Chapter.length===0){obj.add(new ReportChapter(ReportChapterType.HEADER));}return{reportIndex:obj};};}function createReportIndex(){var retVal=new ReportIndex();retVal.add(new ReportChapter(ReportChapterType.HEADER));retVal.add(new ReportChapter(ReportChapterType.MAP));retVal.add(new ReportChapter(ReportChapterType.RELIEF));retVal.add(new ReportChapter(ReportChapterType.WEATHER));retVal.add(new ReportChapter(ReportChapterType.NOTAMS));retVal.add(new ReportChapter(ReportChapterType.COM_NAV));retVal.add(new ReportChapter(ReportChapterType.ATS_INFO));return retVal;}OpenLayers.Control.CustomSelectFeature=OpenLayers.Class(OpenLayers.Control.SelectFeature,{initialize:function(layers,options){OpenLayers.Control.prototype.initialize.apply(this,[options]);var clickHandler=new OpenLayers.Handler.Click(this,{},{boxDivClassName:"olHandlerBoxSelectFeature"});var inst=this;OpenLayers.Util.extend(clickHandler,{pixelTolerance:9,mousedown:function(evt){this.startPosition=evt.xy;},click:function(evt){var retVal=true;let xDistance=Math.abs(evt.xy.x-this.startPosition.x);let yDistance=Math.abs(evt.xy.y-this.startPosition.y);if(xDistance<this.pixelTolerance&&yDistance<this.pixelTolerance){debug("CustomSelectFeature: checking features in click position.");inst.unselectAll();OpenLayers.Handler.Click.prototype.click.apply(this,[evt]);var position=new OpenLayers.Bounds(evt.clientX,evt.clientY,evt.clientX,evt.clientY);retVal=!inst.selectBox(position);debug("CustomSelectFeature: "+((retVal)?"not found":"found"));}return retVal;},touchend:function(evt){var retVal=true;if(this.down){evt.xy=this.last.xy;evt.lastTouches=this.last.touches;this.handleSingle(evt);this.down=null;var position=new OpenLayers.Bounds(evt.xy.x,evt.xy.y,evt.xy.x,evt.xy.y);retVal=!inst.selectBox(position);}return retVal;},touchmove:function(evt){if(this.passesTolerance(evt)===false){this.down=null;}}});if(this.scope===null){this.scope=this;}this.initLayer(layers);var callbacks={click:this.clickFeature,clickout:this.clickoutFeature};if(this.hover){callbacks.over=this.overFeature;callbacks.out=this.outFeature;}this.callbacks=OpenLayers.Util.extend(callbacks,this.callbacks);this.handlers={feature:new OpenLayers.Handler.Feature(this,this.layer,this.callbacks,{geometryTypes:this.geometryTypes}),click:clickHandler};if(this.box){this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},{boxDivClassName:"olHandlerBoxSelectFeature"});}this.handlers.feature.deactivate();},activate:function(){if(!this.active){if(this.layers){this.map.addLayer(this.layer);}this.handlers.click.activate();if(this.box&&this.handlers.box){this.handlers.box.activate();}}return OpenLayers.Control.prototype.activate.apply(this,arguments);},deactivate:function(){if(this.active){this.handlers.click.deactivate();if(this.handlers.box){this.handlers.box.deactivate();}if(this.layers){this.map.removeLayer(this.layer);}}return OpenLayers.Control.prototype.deactivate.apply(this,arguments);},selectBox:function(position){var retVal=false;if(position instanceof OpenLayers.Bounds){var minXY=this.map.getLonLatFromPixel({x:position.left-5,y:position.bottom+5});var maxXY=this.map.getLonLatFromPixel({x:position.right+5,y:position.top-5});var bounds=new OpenLayers.Bounds(minXY.lon,minXY.lat,maxXY.lon,maxXY.lat);if(!this.multipleSelect()){this.unselectAll();}var prevMultiple=this.multiple;this.multiple=true;var layers=this.layers||[this.layer];this.events.triggerEvent("boxselectionstart",{layers:layers});var layer;for(var l=0;l<layers.length;++l){layer=layers[l];for(var i=0,len=layer.features.length;i<len;++i){var feature=layer.features[i];if(!feature.getVisibility()){continue;}if(this.geometryTypes==null||OpenLayers.Util.indexOf(this.geometryTypes,feature.geometry.CLASS_NAME)>-1){if(bounds.toGeometry().intersects(feature.geometry)){if(OpenLayers.Util.indexOf(layer.selectedFeatures,feature)==-1){this.select(feature);retVal=true;}}}}}this.multiple=prevMultiple;this.events.triggerEvent("boxselectionend",{layers:layers,position:position.getCenterPixel()});}return retVal;},setMap:function(map){this.handlers.feature.setMap(map);this.handlers.click.setMap(map);if(this.box){this.handlers.box.setMap(map);}OpenLayers.Control.prototype.setMap.apply(this,arguments);},CLASS_NAME:"OpenLayers.Control.CustomSelectFeature"});OpenLayers.Control.HoverSelectFeature=OpenLayers.Class(OpenLayers.Control,{multiple:false,clickout:true,toggle:false,hover:true,highlightOnly:false,box:false,onBeforeSelect:function(){},onSelect:function(){},onUnselect:function(){},scope:null,geometryTypes:null,layer:null,layers:null,callbacks:null,selectStyle:null,renderIntent:"select",handlers:null,lastPosition:null,scheduledSetupPosition:false,lastSetupPositionEvent:null,highlightedFeature:null,selectionTimeout:1500,initialize:function(layers,options){OpenLayers.Control.prototype.initialize.apply(this,[options]);if(this.scope===null){this.scope=this;}this.initLayer(layers);var callbacks={over:this.overFeature,out:this.outFeature};this.callbacks=OpenLayers.Util.extend(callbacks,this.callbacks);this.handlers={feature:new OpenLayers.Handler.Feature(this,this.layer,this.callbacks,{geometryTypes:this.geometryTypes,stopClick:false,stopDown:false,stopUp:false})};},initLayer:function(layers){if(OpenLayers.Util.isArray(layers)){this.layers=layers;this.layer=new OpenLayers.Layer.Vector.RootContainer(this.id+"_container",{layers:layers});}else{this.layer=layers;}},destroy:function(){if(this.active&&this.layers){this.map.removeLayer(this.layer);}OpenLayers.Control.prototype.destroy.apply(this,arguments);if(this.layers){this.layer.destroy();}},activate:function(){if(!this.active){if(this.layers){this.map.addLayer(this.layer);}this.handlers.feature.activate();if(this.box&&this.handlers.box){this.handlers.box.activate();}this.map.events.register('mousemove',this,this.mouseMove);}return OpenLayers.Control.prototype.activate.apply(this,arguments);},deactivate:function(){if(this.active){this.handlers.feature.deactivate();if(this.handlers.box){this.handlers.box.deactivate();}if(this.layers){this.map.removeLayer(this.layer);}}return OpenLayers.Control.prototype.deactivate.apply(this,arguments);},mouseMove:function(e){this.setupPosition(e);},unselectAll:function(options){var layers=this.layers||[this.layer],layer,feature,l,numExcept;for(l=0;l<layers.length;++l){layer=layers[l];numExcept=0;if(layer.selectedFeatures!=null){while(layer.selectedFeatures.length>numExcept){feature=layer.selectedFeatures[numExcept];if(!options||options.except!=feature){this.unselect(feature);}else{++numExcept;}}}}if(this.highlightedFeature){this.unhighlight(this.highlightedFeature);}this.handlers.feature.feature=null;},clickFeature:function(feature){if(!this.hover){var selected=(OpenLayers.Util.indexOf(feature.layer.selectedFeatures,feature)>-1);if(selected){this.unselectAll({except:feature});}else{if(!this.multipleSelect()){this.unselectAll({except:feature});}this.select(feature);}}},multipleSelect:function(){return false;},clickoutFeature:function(feature){if(!this.hover&&this.clickout){this.unselectAll();}},overFeature:function(feature){if(feature){this.highlight(feature);}},getFeaturesByLastMouseBounds:function(){var retVal=[];var layers=this.layers||[this.layer];var layer;var geometry=this.getBounds().toGeometry();for(var l=0;l<layers.length;++l){layer=layers[l];if(layer.visibility===true){for(var i=0,len=layer.features.length;i<len;++i){var f=layer.features[i];if(this.geometryTypes===null||OpenLayers.Util.indexOf(this.geometryTypes,f.geometry.CLASS_NAME)>-1){if(geometry.intersects(f.geometry)){retVal.push(f);}}}}}if(retVal.length===0&&this.highlightedFeature){retVal.push(this.highlightedFeature);}return retVal;},setupPosition:function(evt){this.lastSetupPositionEvent=evt;if(!this.scheduledSetupPosition){this.scheduledSetupPosition=true;setTimeout(()=>{this.lastPosition=this.map.getLonLatFromPixel(new OpenLayers.Pixel(this.lastSetupPositionEvent.clientX,this.lastSetupPositionEvent.clientY));const features=this.getFeaturesByLastMouseBounds();if(features.length===1){this.select(features[0]);}else if(features.length>1){this.selectAll(features);}this.scheduledSetupPosition=false;},this.selectionTimeout);}},getBounds:function(){const map=this.map;const lastPositionPx=map.getPixelFromLonLat(this.lastPosition);const minXY=map.getLonLatFromPixel({x:lastPositionPx.x-5,y:lastPositionPx.y-5});const maxXY=map.getLonLatFromPixel({x:lastPositionPx.x+5,y:lastPositionPx.y+5});return new OpenLayers.Bounds(minXY.lon,minXY.lat,maxXY.lon,maxXY.lat);},outFeature:function(feature){if(this.highlightOnly){if(feature._lastHighlighter===this.id){if(feature._prevHighlighter&&feature._prevHighlighter!=this.id){delete feature._lastHighlighter;var control=this.map.getControl(feature._prevHighlighter);if(control){control.highlight(feature);}}else{this.unhighlight(feature);}}}else{this.unselectAll();}},highlight:function(feature){var layer=feature.layer;var cont=this.events.triggerEvent("beforefeaturehighlighted",{feature:feature});if(cont!==false){feature._prevHighlighter=feature._lastHighlighter;feature._lastHighlighter=this.id;var style=this.selectStyle||this.renderIntent;layer.drawFeature(feature,style);this.highlightedFeature=feature;this.events.triggerEvent("featurehighlighted",{feature:feature});}},unhighlight:function(feature){if(feature){var layer=feature.layer;if(feature._prevHighlighter==undefined){delete feature._lastHighlighter;}else if(feature._prevHighlighter==this.id){delete feature._prevHighlighter;}else{feature._lastHighlighter=feature._prevHighlighter;delete feature._prevHighlighter;}if(layer){layer.drawFeature(feature,feature.style||feature.layer.style||"default");}if(feature===this.highlightedFeature){this.highlightedFeature=null;}this.events.triggerEvent("featureunhighlighted",{feature:feature});}},select:function(feature){var cont=this.onBeforeSelect.call(this.scope,feature);var layer=feature.layer;if(cont!==false&&layer&&layer.events){cont=layer.events.triggerEvent("beforefeatureselected",{feature:feature});if(cont!==false){layer.selectedFeatures.push(feature);if(!this.handlers.feature.lastFeature){this.handlers.feature.lastFeature=layer.selectedFeatures[0];}this.triggerSelectionEvent(layer,feature);}}},selectAll:function(features){if(features!==undefined&&features.length>0){const topFeature=features[features.length-1];var cont=this.onBeforeSelect.call(this.scope,topFeature);const layer=topFeature.layer;if(cont!==false){cont=layer.events.triggerEvent("beforefeatureselected",{feature:topFeature});if(cont!==false){features.forEach(feature=>{const l=feature.layer;l.selectedFeatures.push(feature);this.highlight(feature);});if(!this.handlers.feature.lastFeature){this.handlers.feature.lastFeature=topFeature;}this.triggerSelectionEvent(layer,features);}}}},triggerSelectionEvent:function(layer,feature){this.onSelect.call(this.scope,feature);layer.events.triggerEvent("featureselected",{feature:feature});},unselect:function(feature){debug("HoverSelectFeature: unselected feature: "+feature.id);var layer=feature.layer;this.unhighlight(feature);OpenLayers.Util.removeItem(layer.selectedFeatures,feature);layer.events.triggerEvent("featureunselected",{feature:feature});this.onUnselect.call(this.scope,feature);},unselectArray:function(featureArray){if(Array.isArray(featureArray)){featureArray.forEach(feature=>this.unselect(feature));}},selectBox:function(position){if(position instanceof OpenLayers.Bounds){var minXY=this.map.getLonLatFromPixel({x:position.left,y:position.bottom});var maxXY=this.map.getLonLatFromPixel({x:position.right,y:position.top});var bounds=new OpenLayers.Bounds(minXY.lon,minXY.lat,maxXY.lon,maxXY.lat);if(!this.multipleSelect()){this.unselectAll();}var prevMultiple=this.multiple;this.multiple=true;var layers=this.layers||[this.layer];this.events.triggerEvent("boxselectionstart",{layers:layers});var layer;for(var l=0;l<layers.length;++l){layer=layers[l];for(var i=0,len=layer.features.length;i<len;++i){var feature=layer.features[i];if(!feature.getVisibility()){continue;}if(this.geometryTypes==null||OpenLayers.Util.indexOf(this.geometryTypes,feature.geometry.CLASS_NAME)>-1){if(bounds.toGeometry().intersects(feature.geometry)){if(OpenLayers.Util.indexOf(layer.selectedFeatures,feature)==-1){this.select(feature);}}}}}this.multiple=prevMultiple;this.events.triggerEvent("boxselectionend",{layers:layers});}},setMap:function(map){this.handlers.feature.setMap(map);if(this.box){this.handlers.box.setMap(map);}OpenLayers.Control.prototype.setMap.apply(this,arguments);},setLayer:function(layers){var isActive=this.active;this.unselectAll();this.deactivate();if(this.layers){this.layer.destroy();this.layers=null;}this.initLayer(layers);this.handlers.feature.layer=this.layer;if(isActive){this.activate();}},CLASS_NAME:"OpenLayers.Control.HoverSelectFeature"});function AircraftUtils(){}AircraftUtils.createChangeFunction=function(aId){var retVal=function(){var parentID=HtmlUtils.C_HASHTAG_CHAR+aId;var value=JQ(parentID+" option:selected").val();var emptyOption=JQ(parentID+" option[value=n]");if(value==="n"){emptyOption.siblings().attr('disabled',true);emptyOption.siblings().attr('selected',false);emptyOption.removeAttr('disabled');}else if(HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(value)===false){emptyOption.siblings().removeAttr('disabled');emptyOption.attr('disabled',true);}else{emptyOption.removeAttr('disabled');emptyOption.siblings().removeAttr('disabled');}JQ(parentID).selectmenu().selectmenu('refresh',true);};return retVal;};AircraftUtils.createEquipmentComSelectDiv=function(aId){var retVal=JQ('<div data-role="fieldcontain" class="selectNoMar">');var select=AircraftUtils.createEquipmentComSelect(aId);retVal.append(select);return retVal;};AircraftUtils.createEquipmentComSelect=function(aId){var retVal=JQ('<select data-native-menu="false" data-mini="true" multiple="multiple" class="multiselect" data-role="none" name="commEquip">');JQ.each(AircraftUtils.EQUIPMENT_SELECT_OPTIONS,function(idx,item){var option=JQ('<option>'+item[1]+'</option>');option.val(item[0]);retVal.append(option);});AircraftUtils.setEquipmentComAlternateText(retVal);retVal.attr(HtmlUtils.A_ID,aId);retVal.change(AircraftUtils.createChangeFunction(aId));return retVal;};AircraftUtils.setEquipmentComAlternateText=function(retVal){if(AWUtils.getShowOneLetterEquipmentsCfg()===false){return;}retVal.data(HtmlUtils.C_ALTERNATE_BUTTON_TEXTS,{'n':'N','s':'S','a':'A','b':'B','c':'C','d':'D','1':'E1','2':'E2','3':'E3','f':'F','g':'G','h':'H','i':'I','4':'J1','5':'J2','6':'J3','7':'J4','8':'J5','9':'J6','0':'J7','k':'K','l':'L','q':'M1','e':'M2','m':'M3','o':'O','r':'R','t':'T','u':'U','v':'V','w':'W','x':'X','y':'Y','z':'Z'});};AircraftUtils.createEquipmentSurvSelectDiv=function(aId){var retVal=JQ('<div data-role="fieldcontain" class="selectNoMar">');var select=AircraftUtils.createEquipmentSurvSelect(aId);retVal.append(select);return retVal;};AircraftUtils.createEquipmentSurvSelect=function(aId){var retVal=JQ('<select data-native-menu="false" data-mini="true" multiple="multiple" class="multiselect" data-role="none" name="commEquip">');retVal.append('<option value="n">N: None</option>');retVal.append('<option value="a">A: Transponder Mode A (4 digits 4 096 codes)</option>');retVal.append('<option value="c">C: Transponder Mode A (4 digits 4096 codes) and Mode C</option>');retVal.append('<option value="e">E: Transponder Mode S, including aircraft identification, pressure-altitude and extended squitter (ADS-B) capability</option>');retVal.append('<option value="h">H: Transponder Mode S, including aircraft identification, pressure-altitude and enhanced surveillance capability</option>');retVal.append('<option value="i">I: Transponder Mode S, including aircraft identification, but  no pressure-altitude capability</option>');retVal.append('<option value="l">L: Transponder Mode S, including aircraft identification, pressure-altitude, extended squitter (ADS-B) and enhanced surveillance capability</option>');retVal.append('<option value="p">P: Transponder Mode S, including pressure-altitude, but no aircraft identification capability</option>');retVal.append('<option value="s">S: Transponder Mode S, including both pressure-altitude and aircraft identification capability</option>');retVal.append('<option value="x">X: Transponder Mode S with neither aircraft identification nor pressure-altitude capability</option>');AircraftUtils.setEquipmentSurvAlternateText(retVal);retVal.attr(HtmlUtils.A_ID,aId);retVal.change(AircraftUtils.createChangeFunction(aId));return retVal;};AircraftUtils.setEquipmentSurvAlternateText=function(retVal){if(AWUtils.getShowOneLetterEquipmentsCfg()===false){return;}retVal.data(HtmlUtils.C_ALTERNATE_BUTTON_TEXTS,{'n':'N','a':'A','c':'C','e':'E','h':'H','i':'I','l':'L','x':'X','p':'P','s':'S'});};AircraftUtils.createEquipmentSurv2SelectDiv=function(aId){var retVal=JQ('<div data-role="fieldcontain" class="selectNoMar">');var select=AircraftUtils.createEquipmentSurv2Select(aId);retVal.append(select);return retVal;};AircraftUtils.createEquipmentSurv2Select=function(aId){var retVal=JQ('<select data-role="none" multiple="multiple" class="multiselect" data-mini="true" data-native-menu="false" name="commEquip">');retVal.append('<option value="n">N: None</option>');retVal.append('<option value="1">B1: ADS-B with dedicated 1090 MHz ADS-B out capability</option>');retVal.append('<option value="2">B2: ADS-B with dedicated 1090 MHz ADS-B out and in capability</option>');retVal.append('<option value="3">U1: ADS-B out capability using UAT</option>');retVal.append('<option value="4">U2: ADS-out and in capability using UAT</option>');retVal.append('<option value="5">V1: ADS-B out capability using VDL Mode 4</option>');retVal.append('<option value="6">V2: ADS-B out and in capability using VDL Mode 4</option>');retVal.append('<option value="7">D1: ADS-C with FANS 1/A capabilities</option>');retVal.append('<option value="8">G1: ADS-C with ATN capabilities</option>');AircraftUtils.setEquipmentSurv2AlternateText(retVal);retVal.attr(HtmlUtils.A_ID,aId);retVal.change(AircraftUtils.createChangeFunction(aId));return retVal;};AircraftUtils.setEquipmentSurv2AlternateText=function(retVal){if(AWUtils.getShowOneLetterEquipmentsCfg()===false){return;}retVal.data(HtmlUtils.C_ALTERNATE_BUTTON_TEXTS,{'n':'N','1':'B1','2':'B2','3':'U1','4':'U2','5':'V1','6':'V2','7':'D1','8':'G1'});};AircraftUtils.EQUIPMENT_SELECT_OPTIONS=[["n","N: No COM/NAV/ approach aid equipment or the equipment is unserviceable"],["s","S: Standard COM/NAV/approach aid equipment"],["a","A: GBAS Landing System"],["b","B: LPV (APV with SBAS)"],["c","C: LORAN C"],["d","D: DME"],["1","E1: FMC WPR ACARS"],["2","E2: D-FIS ACARS"],["3","E3: PDC ACARS"],["f","F: ADF"],["g","G: GNSS"],["h","H: HF RTF"],["i","I: Inertial Navigation"],["4","J1: CPDLC ATN VDL Mode 2"],["5","J2: CPDLC FANS 1/A HFDL"],["6","J3: CPDLC FANS 1/A VDL Mode A"],["7","J4: CPDLC FANS 1/A VDL Mode 2"],["8","J5: CPDLC FANS 1/A SATCOM (INMARSAT)"],["9","J6: CPDLC FANS 1/A SATCOM (MTSAT)"],["0","J7: CPDLC FANS 1/A SATCOM (Iridium)"],["k","K: MLS"],["l","L: ILS"],["q","M1: ATC RTF SATCOM (INMARSAT)"],["e","M2: ATC RTF (MTSAT)"],["m","M3: ATC RTF (Iridium)"],["o","O: VOR"],["r","R: PBN approved"],["t","T: TACAN"],["u","U: UHF RTF"],["v","V: VHF RTF"],["w","W: RVSM approved"],["x","X: MNPS approved"],["y","Y: VHF with 8.33 kHz channel spacing capability"],["z","Z: Other equipment carried or other capabilities"]];function LoginUtils(){}LoginUtils.createLoginDiv=function(page,loginUserFnc,questFnc,enableCaptcha=false){const retVal=JQ('<div id="loginDiv" class="ui-corner-all">');const form=JQ("<form>");const loginLabel=JQ('<label for="loginText" id="loginLabel" >Login:</label>');const loginText=JQ('<input id="login" type="text" required autofocus>');const passwordLabel=JQ('<label for="passwordText" id="passwordLabel" >Password:</label>');const passwordText=JQ('<input id="passwordText" type="password" autocomplete="off" required></input>');const errMsg=JQ('<h5>');const loginButton=JQ('<a id="loginButton" href="#" class="ui-btn ui-shadow ui-corner-all">Login</a>');let verCode,captchaImg;form.append(LoginUtils.createLanguageDiv());form.append(loginLabel);form.append(loginText);form.append(passwordLabel);form.append(passwordText);if(config.debug!==true){loginText.attr("autocomplete","off");}if(enableCaptcha){const captchaImgContainer=JQ('<div class="verification-code-container">');verCode=JQ('<input type="text" id="loginVercode" placeholder="verification code" data-theme="a" data-wrapper-class="vercode-input" autocomplete="off" required>');captchaImg=JQ('<img class="verification-code" src="dataHandler.php?method=captchaGenerate">');form.append(verCode);captchaImgContainer.append(captchaImg);form.append(captchaImgContainer);captchaImg.click(function(){captchaImg.attr('src',"dataHandler.php?method=captchaGenerate&v="+new Date().getTime());});}form.append(errMsg);form.append(loginButton);form.append(LoginUtils.createAppModeButtonsDiv((mode)=>{debug("login with app mode: "+mode);LoginUtils.loginSubmitAction(form,loginUserFnc,mode);}));form.append('<a id="registrationButton" href="#registrationPanel" data-rel="panel" data-position-to="window" class="ui-btn ui-shadow ui-btn-a ui-corner-all">Registration</a>');form.append('<a id="lostPwdButton" href="#lostPwdPanel" data-rel="panel" data-position-to="window" class="ui-btn ui-shadow ui-btn-a ui-corner-all">Lost Password</a>');retVal.append(form);page.append(LoginUtils.createLostPwdPanel());retVal.find('#loginLabel').attr(AWLocale.LOCALISATION_KEY,'LoginPanel.user');retVal.find('#passwordLabel').attr(AWLocale.LOCALISATION_KEY,'LoginPanel.password');retVal.find('#loginButton').attr(AWLocale.LOCALISATION_KEY,'LoginPanel.loginButton');retVal.find('#registrationButton').attr(AWLocale.LOCALISATION_KEY,'LoginPanel.registrationButton');retVal.find('#lostPwdButton').attr(AWLocale.LOCALISATION_KEY,'LoginPanel.lostPwdButton');retVal.find('#guestButton').attr(AWLocale.LOCALISATION_KEY,'LoginPanel.guestButton');if(typeof questFnc==="function"){var guestButton=JQ('<input id="guestButton" type="button" value="Guest"/>');retVal.append(guestButton);guestButton.click(function(){retVal.popup("close");questFnc.apply(this,arguments);});}loginText.focus(function(){this.select();});passwordText.on("keypress",function(e){if(e.keyCode===13){LoginUtils.loginSubmitAction(form,loginUserFnc);}});loginButton.click((e)=>{e.preventDefault();LoginUtils.loginSubmitAction(form,loginUserFnc);});return retVal;};LoginUtils.loginSubmitAction=function(form,loginUserFnc,appMode){var check=true;form.find('input').each(function(){if(JQ.trim(JQ(this).val())===''){check=false;JQ(this).css({"background":"#FFCECE"});}else{JQ(this).css({"border":"","background":""});}});if(check){const login=form.find("#login").val();const passwordInput=form.find("#passwordText");const password=passwordInput.val();const captchaImg=form.find(".verification-code");const errMsg=form.find("h5");const verCode=form.find("#loginVercode");const params={lang:AWLocale.currentAbbr};form.loading(true);errMsg.html("");errMsg.removeAttr(AWLocale.LOCALISATION_KEY);if(appMode){params.appMode=appMode;}if(verCode.length>0){params.captcha=verCode.val();}AWLoginDataHandler.userLogin(login,password,function(loginObj){form.loading(false);if(loginObj===null||loginObj===undefined){errMsg.attr(AWLocale.LOCALISATION_KEY,"LoginPanel.msg.serverNotResponding");}else if(loginObj.LoginOK&&loginObj.LoginOK.toString()==="1"){var userGroup;JQ("#loginPopup").popup("close");if(typeof loginObj.UserTypeCode==='object'){userGroup=loginObj.UserTypeCode.toString();}else{userGroup=getConfigValue("defaultUserGroup");}if(typeof loginUserFnc==='function'){loginUserFnc.apply();}else{debug("Login function not defined.");}}else if(loginObj.authRequired){LoginUtils.twoFactoryAuthLoginDialog(loginObj.authRequired,loginUserFnc);}else if(typeof loginObj==="string"){errMsg.attr(AWLocale.LOCALISATION_KEY,loginObj);if(loginObj==="Messages.captchaError"){verCode.focus();}}else if(Array.isArray(loginObj)){JQ.each(loginObj,function(idx,key){var span=JQ("<span>");span.attr(AWLocale.LOCALISATION_KEY,key);errMsg.append(span);});}else{errMsg.attr(AWLocale.LOCALISATION_KEY,"LoginPanel.msg.invalidLogin");passwordInput.val("");passwordInput.focus();}if(verCode){captchaImg.click();verCode.val("");}AWLocale.processLocalisationOnJQElement(errMsg);},params);}};LoginUtils.twoFactoryAuthLoginDialog=function(codeDestination,loginUserFnc){const loginDiv=JQ('#loginDiv');const loginForm=loginDiv.find('form');const twoFactoryAuthContainer=JQ('<div class="twoFactoryAuth-container">');const label=JQ('<label for="loginCode" id="loginCodeLabel">Code:</label>');const codeDestLabel=JQ('<label id="codeDestLabel">');const codeInput=JQ('<input id="loginCode" type="text" required autofocus>');const sendBtn=JQ('<a id="sendButton" href="#" class="ui-btn ui-shadow ui-corner-all">Send</a>');const cancelBtn=JQ('<a id="cancelButton" href="#" class="ui-btn ui-shadow ui-corner-all">Cancel</a>');const close=()=>{twoFactoryAuthContainer.remove();loginForm.show();};const check=()=>{const code=codeInput.val();AWLoginDataHandler.twoFactorAuth(code,function(response){if(response!==undefined){var retCode=parseInt(response.ErrorCode);if(retCode===0){AWUtils.resetFormHintText("loginCode");loginUserFnc.apply();}else if(retCode===1){AWUtils.showFormHintText("loginCode","LoginPanel.expiredLoginCode");}else if(retCode===3){AWUtils.showFormHintText("loginCode","LoginPanel.interrupted");}else{AWUtils.showFormHintText("loginCode","LoginPanel.invalidLoginCode");}}else{AWUtils.showFormHintText("loginCode","LoginPanel.msg.serverNotResponding");}});};label.attr(AWLocale.LOCALISATION_KEY,'LoginPanel.twoFactorAuthLabel');codeDestLabel.text(codeDestination);loginForm.hide();twoFactoryAuthContainer.append(label);twoFactoryAuthContainer.append(codeDestLabel);twoFactoryAuthContainer.append(codeInput);twoFactoryAuthContainer.append(AWUtils.createFormHint("loginCode"));twoFactoryAuthContainer.append(sendBtn);twoFactoryAuthContainer.append(cancelBtn);loginDiv.prepend(twoFactoryAuthContainer);sendBtn.click(check);cancelBtn.click(close);twoFactoryAuthContainer.trigger("create");AWLocale.processLocalisationOnJQElement(twoFactoryAuthContainer);};LoginUtils.createChangePwdDiv=function(page){const retVal=JQ('<div id="changePwd" class="ui-corner-all">');const form=JQ("<form>");form.append(LoginUtils.createLanguageDiv());var pwdLabel=JQ('<label for="pwdText" id="pwdLabel" >Password:</label>');var rePwdLabel=JQ('<label for="rePwdText" id="rePwdLabel" >Re-Password:</label>');var pwdText=JQ('<input id="pwdText" type="password" autocomplete="off" required></input>');var rePwdText=JQ('<input id="rePwdText" type="password" autocomplete="off" required></input>');var errMsg=JQ('<h5></h5>');var changeButton=JQ('<a id="changeButton" href="#" class="ui-btn ui-shadow ui-corner-all">Change</a>');pwdLabel.attr(AWLocale.LOCALISATION_KEY,"ChangePassword.password");rePwdLabel.attr(AWLocale.LOCALISATION_KEY,"ChangePassword.rePassword");changeButton.attr(AWLocale.LOCALISATION_KEY,"ChangePassword.changePassword");form.append(pwdLabel);form.append(pwdText);form.append(AWUtils.createFormHint("pwd1","Common.passwordHint"));form.append(rePwdLabel);form.append(rePwdText);form.append(AWUtils.createFormHint("pwd2"));form.append(errMsg);form.append(changeButton);retVal.append(form);changeButton.click(function(){var errs=0;var pwdToken=AWUtils.getUrlParams("tn");var newPwd1=form.find("#pwdText").val();var newPwd2=form.find("#rePwdText").val();AWUtils.resetFormHintText("pwd1");AWUtils.resetFormHintText("pwd2");try{Validation.validateMandatory(newPwd1);Validation.validatePassword(newPwd1);if(newPwd1!==newPwd2){AWUtils.showFormHintText("pwd2","Validation.notIdenticalPwds");errs++;}}catch(e){AWUtils.showFormHintText("pwd1",e);errs++;}if(errs===0){form.closest('.rsys-form').loading(true,true);IbafDataHandler.ibafSetPwdToken(pwdToken,newPwd1,function(data){form.closest('.rsys-form').loading(false);changeButton.addClass("ui-disabled");if(typeof data.PwdSet==="object"&&data.PwdSet.toString()==="true"){debug('Password changed sucessfully: ');errMsg.removeClass("alert-field");errMsg.text(getLocalizedString('ChangePassword.changed'));setTimeout(function(){document.location.href=AWUtils.getHomeUrl();},5000);}else{errMsg.addClass("alert-field");errMsg.text(getLocalizedString('ChangePassword.cantChange'));}},function(msg,code){form.closest('.rsys-form').loading(false);debug('Change Password Msg: '+msg);errMsg.addClass("alert-field");errMsg.text(getLocalizedString('ChangePassword.srvError'));});}});return retVal;};LoginUtils.createLostPwdPanel=function(){const retVal=JQ('<div data-role="panel" id="lostPwdPanel" data-position="right" data-display="overlay">');var form=JQ('<form class="rs-jqm-labelled">');var closeBtn=JQ('<a id="closeButton2" data-rel="close" class="ui-btn ui-shadow ui-corner-all ui-icon-delete ui-btn-icon-notext">Close</a>');var captchaImg=JQ('<img class="verification-code" src="dataHandler.php?method=captchaGenerate">');var captchaImgContainer=JQ('<div class="verification-code-container"></div>');var submitButton=JQ('<a id="lostPwdSubmit" href="#" data-disabled="false" class="ui-btn ui-shadow ui-corner-all">Submit</a>');const verCode=JQ('<input type="text" name="lostPwdVercode" id="lostPwdVercode" placeholder="verification code" data-theme="a" data-wrapper-class="vercode-input" autocomplete="off" required>');form.append('<h3>Lost Password</h3>');form.append(closeBtn);form.append('<label for="lostPwdEmail" class="ui-hidden-accessible">Email:</label>');form.append('<input type="text" name="lostPwdEmail" id="lostPwdEmail" value="" placeholder="email" data-theme="a">');form.append(AWUtils.createFormHint("lostPwdEmail"));form.append('<label for="lostPwdVercode" class="ui-hidden-accessible">Re-Type Verification Code</label>');form.append(verCode);captchaImgContainer.append(captchaImg);form.append(captchaImgContainer);form.append(AWUtils.createFormHint("lostPwdVercode"));form.append(submitButton);retVal.append(form);retVal.find('h3').attr(AWLocale.LOCALISATION_KEY,'LostPassword.title');retVal.find('label[for="lostPwdEmail"]').attr(AWLocale.LOCALISATION_KEY,'LostPassword.email');retVal.find('#lostPwdEmail').attr(AWLocale.LOCALISATION_KEY,'LostPassword.email');retVal.find('label[for="lostPwdVercode"]').attr(AWLocale.LOCALISATION_KEY,'LostPassword.vercode');verCode.attr(AWLocale.LOCALISATION_KEY,'LostPassword.vercode');retVal.find('#lostPwdSubmit').attr(AWLocale.LOCALISATION_KEY,'LostPassword.submit');captchaImg.click(function(){captchaImg.attr('src',"dataHandler.php?method=captchaGenerate&v="+new Date().getTime());});submitButton.click(function(e){var email=form.find("#lostPwdEmail").val();var errs=0;try{Validation.validateMandatory(email);Validation.validateLength(email,3,64);Validation.validateEmail(email);AWUtils.resetFormHintText("lostPwdEmail");}catch(e){AWUtils.showFormHintText("lostPwdEmail",e);errs++;}if(errs===0){const params={userEmail:email,captcha:verCode.val()};AWUtils.resetFormHintText("lostPwdVercode");debug("LostPwd form is valid for processing!");retVal.loading(true,true);AWLoginDataHandler.getLostPwd(params,(data)=>{retVal.loading(false);if(data!==undefined&&data.IsError!==undefined&&data.IsError.toString()==="0"){JQMUtil.showInfoMsg(getLocalizedString('LostPassword.successfull'),false);JQ("#lostPwdPanel").panel("close");}else{AWUtils.showFormHintText("Something was wrong! Try again later.");}captchaImg.click();verCode.val("");},(errMsg,errCode)=>{retVal.loading(false);AWUtils.showFormHintText("lostPwdVercode","Invalid email address or verification code");captchaImg.click();verCode.val("");});}else{debug("Lost Password form contains error(-s). Can not continue with processing! (errCont: "+errs+")");}});return retVal;};LoginUtils.createLanguageDiv=function(){var retVal=JQ('<div id="language"></div>');var defaultLocale=getConfigValue("locale","en");var locales=getConfigValue("locales",[defaultLocale]);if(JQ.isArray(locales)){JQ.each(locales,function(i,l){retVal.append(createLocaleItem(l));});}return retVal;function createLocaleItem(abbr){var retVal=JQ('<div class="language-item language-'+abbr+'"></div>');retVal.click(function(){AWLocale.loadLocale(abbr,function(){AWLocale.processGlobalLocalisation();});JQ(this).addClass('language-item-selected').siblings().removeClass('language-item-selected');});return retVal;}};LoginUtils.createAppModeButtonsDiv=function(buttonAction){let retVal;if(typeof functionsAppModeConfig==="object"){let modes=Object.keys(functionsAppModeConfig);retVal=JQ('<div class="app-mode-buttons">');modes=modes.filter(function(name,idx){if(name.indexOf("_")===0){return false;}return true;});if(modes.length===1){const btn=JQ('<button form="">');const mode=modes[0];btn.attr(AWLocale.LOCALISATION_KEY,'AppMode.'+mode);btn.attr('value',mode);retVal.append(btn);if(typeof buttonAction==="function"){btn.click((e)=>{e.preventDefault();buttonAction(mode);});}}else{debug("Support for multi app extra modes not implemented.");}}return retVal;};function AircraftModel(){this.id=null;this.registration=null;this.type=null;this.arcOperator=null;this.colourMark=null;this.fuelTaxi=null;this.fuelTaxiUnit=null;this.fuelLanding=null;this.fuelLandingUnit=null;this.holdingTime=null;this.holdingTimeUnit=null;this.fuelTotal=null;this.fuelTotalUnit=null;this.fuelContingency=null;this.fuelContingencyUnit=null;this.turbulency=null;this.climbRate=null;this.climbRateUnit=null;this.climbRateCeiling=null;this.climbRateCeilingUnit=null;this.iasClimb=null;this.iasClimbUnit=null;this.fuelBurn=null;this.fuelBurnUnit=null;this.fuelBurnClimb=null;this.fuelBurnClimbUnit=null;this.ias=null;this.iasUnit=null;this.fuelBurnCeiling=null;this.fuelBurnCeilingUnit=null;this.ceilingFl=null;this.ceilingFlUnit=null;this.descentRate=null;this.descentRateUnit=null;this.iasDesc=null;this.iasDescUnit=null;this.fuelBurnDesc=null;this.fuelBurnDescUnit=null;this.emergencyRadio=null;this.survivalEquipment=null;this.lifeJacket=null;this.dinghiesNumber=null;this.dinghiesCapacity=null;this.dinghiesCovered=null;this.dinghiesColour=null;this.otherComm=null;this.otherNav=null;this.comNav=null;this.comNavEquipment=null;this.setId=function(id){this.id=id;};this.getId=function(){return this.id;};this.setRegistration=function(registration){this.registration=registration;};this.getRegistration=function(){return this.registration;};this.setType=function(type){this.type=type;};this.getType=function(){return this.type;};this.setArcOperator=function(arcOperator){this.arcOperator=arcOperator;};this.getArcOperator=function(){return this.arcOperator;};this.setColourMark=function(colourMark){this.colourMark=colourMark;};this.getColourMark=function(){return this.colourMark;};this.setFuelTaxi=function(fuelTaxi){this.fuelTaxi=fuelTaxi;};this.getFuelTaxi=function(){return this.fuelTaxi;};this.setFuelTaxiUnit=function(fuelTaxiUnit){this.fuelTaxiUnit=fuelTaxiUnit;};this.getFuelTaxiUnit=function(){return this.fuelTaxiUnit;};this.setFuelLanding=function(fuelLanding){this.fuelLanding=fuelLanding;};this.getFuelLanding=function(){return this.fuelLanding;};this.setFuelLandingUnit=function(fuelLandingUnit){this.fuelLandingUnit=fuelLandingUnit;};this.getFuelLandingUnit=function(){return this.fuelLandingUnit;};this.setHoldingTime=function(holdingTime){this.holdingTime=holdingTime;};this.getHoldingTime=function(){return this.holdingTime;};this.setHoldingTimeUnit=function(holdingTimeUnit){this.holdingTimeUnit=holdingTimeUnit;};this.getHoldingTimeUnit=function(){return this.holdingTimeUnit;};this.setFuelTotal=function(fuelTotal){this.fuelTotal=fuelTotal;};this.getFuelTotal=function(){return this.fuelTotal;};this.setFuelTotalUnit=function(fuelTotalUnit){this.fuelTotalUnit=fuelTotalUnit;};this.getFuelTotalUnit=function(){return this.fuelTotalUnit;};this.setFuelContingency=function(fuelContingency){this.fuelContingency=fuelContingency;};this.getFuelContingency=function(){return this.fuelContingency;};this.setFuelContingencyUnit=function(fuelContingencyUnit){this.fuelContingencyUnit=fuelContingencyUnit;};this.getFuelContingencyUnit=function(){return this.fuelContingencyUnit;};this.setTurbulency=function(turbulency){this.turbulency=turbulency;};this.getTurbulency=function(){return this.turbulency;};this.setClimbRate=function(climbRate){this.climbRate=AWUtils.parseAndClearIntegerFormat(climbRate);};this.getClimbRate=function(){return AWUtils.parseAndClearIntegerFormat(this.climbRate);};this.setClimbRateUnit=function(climbRateUnit){this.climbRateUnit=climbRateUnit;};this.getClimbRateUnit=function(){return this.climbRateUnit;};this.setClimbRateCeiling=function(climbRateCeiling){this.climbRateCeiling=AWUtils.parseAndClearIntegerFormat(climbRateCeiling);};this.getClimbRateCeiling=function(){return AWUtils.parseAndClearIntegerFormat(this.climbRateCeiling);};this.setClimbRateCeilingUnit=function(climbRateCeilingUnit){this.climbRateCeilingUnit=climbRateCeilingUnit;};this.getClimbRateCeilingUnit=function(){return this.climbRateCeilingUnit;};this.setIasClimb=function(iasClimb){this.iasClimb=AWUtils.parseAndClearIntegerFormat(iasClimb);};this.getIasClimb=function(){return AWUtils.parseAndClearIntegerFormat(this.iasClimb);};this.setIasClimbUnit=function(iasClimbUnit){this.iasClimbUnit=iasClimbUnit;};this.getIasClimbUnit=function(){return this.iasClimbUnit;};this.setFuelBurn=function(fuelBurn){this.fuelBurn=fuelBurn;};this.getFuelBurn=function(){return this.fuelBurn;};this.setFuelBurnUnit=function(fuelBurnUnit){this.fuelBurnUnit=fuelBurnUnit;};this.getFuelBurnUnit=function(){return this.fuelBurnUnit;};this.setFuelBurnClimb=function(fuelBurnClimb){this.fuelBurnClimb=fuelBurnClimb;};this.getFuelBurnClimb=function(){return this.fuelBurnClimb;};this.setFuelBurnClimbUnit=function(fuelBurnClimbUnit){this.fuelBurnClimbUnit=fuelBurnClimbUnit;};this.getFuelBurnClimbUnit=function(){return this.fuelBurnClimbUnit;};this.setIas=function(ias){this.ias=AWUtils.parseAndClearIntegerFormat(ias);};this.getIas=function(){return AWUtils.parseAndClearIntegerFormat(this.ias);};this.setIasUnit=function(iasUnit){this.iasUnit=iasUnit;};this.getIasUnit=function(){return this.iasUnit;};this.setFuelBurnCeiling=function(fuelBurnCeiling){this.fuelBurnCeiling=fuelBurnCeiling;};this.getFuelBurnCeiling=function(){return this.fuelBurnCeiling;};this.setFuelBurnCeilingUnit=function(fuelBurnCeilingUnit){this.fuelBurnCeilingUnit=fuelBurnCeilingUnit;};this.getFuelBurnCeilingUnit=function(){return this.fuelBurnCeilingUnit;};this.setCeilingFl=function(ceilingFl){this.ceilingFl=AWUtils.parseAndClearIntegerFormat(ceilingFl);};this.getCeilingFl=function(){return AWUtils.parseAndClearIntegerFormat(this.ceilingFl);};this.setCeilingFlUnit=function(ceilingFlUnit){this.ceilingFlUnit=ceilingFlUnit;};this.getCeilingFlUnit=function(){return this.ceilingFlUnit;};this.setDescentRate=function(descentRate){this.descentRate=AWUtils.parseAndClearIntegerFormat(descentRate);};this.getDescentRate=function(){return AWUtils.parseAndClearIntegerFormat(this.descentRate);};this.setDescentRateUnit=function(descentRateUnit){this.descentRateUnit=descentRateUnit;};this.getDescentRateUnit=function(){return this.descentRateUnit;};this.setIasDesc=function(iasDesc){this.iasDesc=AWUtils.parseAndClearIntegerFormat(iasDesc);};this.getIasDesc=function(){return AWUtils.parseAndClearIntegerFormat(this.iasDesc);};this.setIasDescUnit=function(iasDescUnit){this.iasDescUnit=iasDescUnit;};this.getIasDescUnit=function(){return this.iasDescUnit;};this.setFuelBurnDesc=function(fuelBurnDesc){this.fuelBurnDesc=fuelBurnDesc;};this.getFuelBurnDesc=function(){return this.fuelBurnDesc;};this.setFuelBurnDescUnit=function(fuelBurnDescUnit){this.fuelBurnDescUnit=fuelBurnDescUnit;};this.getFuelBurnDescUnit=function(){return this.fuelBurnDescUnit;};this.setEmergencyRadio=function(emergencyRadio){this.emergencyRadio=emergencyRadio;};this.getEmergencyRadio=function(){return this.emergencyRadio;};this.setSurvivalEquipment=function(survivalEquipment){this.survivalEquipment=survivalEquipment;};this.getSurvivalEquipment=function(){return this.survivalEquipment;};this.setLifeJacket=function(lifeJacket){this.lifeJacket=lifeJacket;};this.getLifeJacket=function(){return this.lifeJacket;};this.setDinghiesNumber=function(dinghiesNumber){this.dinghiesNumber=dinghiesNumber;};this.getDinghiesNumber=function(){return this.dinghiesNumber;};this.setDinghiesCapacity=function(dinghiesCapacity){this.dinghiesCapacity=dinghiesCapacity;};this.getDinghiesCapacity=function(){return this.dinghiesCapacity;};this.setDinghiesCovered=function(dinghiesCovered){this.dinghiesCovered=dinghiesCovered;};this.getDinghiesCovered=function(){return this.dinghiesCovered;};this.setDinghiesColour=function(dinghiesColour){this.dinghiesColour=dinghiesColour;};this.getDinghiesColour=function(){return this.dinghiesColour;};this.setOtherComm=function(otherComm){this.otherComm=otherComm;};this.getOtherComm=function(){return this.otherComm;};this.setOtherNav=function(otherNav){this.otherNav=otherNav;};this.getOtherNav=function(){return this.otherNav;};this.setComNav=function(comNav){this.comNav=comNav;};this.getComNav=function(){return this.comNav;};this.setComNavEquipment=function(comNavEquipment){this.comNavEquipment=comNavEquipment;};this.getComNavEquipment=function(){return this.comNavEquipment;};this.init=function(jsonObject){if(jsonObject!=undefined){AWUtils.setupParamIfValueNotNull(this,"id",jsonObject.id);AWUtils.setupParamIfValueNotNull(this,"registration",jsonObject.registration);AWUtils.setupParamIfValueNotNull(this,"type",jsonObject.type);AWUtils.setupParamIfValueNotNull(this,"arcOperator",jsonObject.arcOperator);AWUtils.setupParamIfValueNotNull(this,"colourMark",jsonObject.colourMark);AWUtils.setupParamIfValueNotNull(this,"fuelTaxi",jsonObject.fuelTaxi);AWUtils.setupParamIfValueNotNull(this,"fuelTaxiUnit",jsonObject.fuelTaxiUnit);AWUtils.setupParamIfValueNotNull(this,"fuelLanding",jsonObject.fuelLanding);AWUtils.setupParamIfValueNotNull(this,"fuelLandingUnit",jsonObject.fuelLandingUnit);AWUtils.setupParamIfValueNotNull(this,"holdingTime",jsonObject.holdingTime);AWUtils.setupParamIfValueNotNull(this,"holdingTimeUnit",jsonObject.holdingTimeUnit);AWUtils.setupParamIfValueNotNull(this,"fuelTotal",jsonObject.fuelTotal);AWUtils.setupParamIfValueNotNull(this,"fuelTotalUnit",jsonObject.fuelTotalUnit);AWUtils.setupParamIfValueNotNull(this,"fuelContingency",jsonObject.fuelContingency);AWUtils.setupParamIfValueNotNull(this,"fuelContingencyUnit",jsonObject.fuelContingencyUnit);AWUtils.setupParamIfValueNotNull(this,"turbulency",jsonObject.turbulency);AWUtils.setupParamIfValueNotNull(this,"climbRate",jsonObject.climbRate);AWUtils.setupParamIfValueNotNull(this,"climbRateUnit",this.convertDistance2SpeedUnit(jsonObject.climbRateUnit));AWUtils.setupParamIfValueNotNull(this,"climbRateCeiling",jsonObject.climbRateCeiling);AWUtils.setupParamIfValueNotNull(this,"climbRateCeilingUnit",this.convertDistance2SpeedUnit(jsonObject.climbRateCeilingUnit));AWUtils.setupParamIfValueNotNull(this,"iasClimb",AWUtils.parseAndClearIntegerFormat(jsonObject.iasClimb));AWUtils.setupParamIfValueNotNull(this,"iasClimbUnit",jsonObject.iasClimbUnit);AWUtils.setupParamIfValueNotNull(this,"fuelBurn",jsonObject.fuelBurn);AWUtils.setupParamIfValueNotNull(this,"fuelBurnUnit",jsonObject.fuelBurnUnit);AWUtils.setupParamIfValueNotNull(this,"fuelBurnClimb",jsonObject.fuelBurnClimb);AWUtils.setupParamIfValueNotNull(this,"fuelBurnClimbUnit",jsonObject.fuelBurnClimbUnit);AWUtils.setupParamIfValueNotNull(this,"ias",AWUtils.parseAndClearIntegerFormat(jsonObject.ias));AWUtils.setupParamIfValueNotNull(this,"iasUnit",jsonObject.iasUnit);AWUtils.setupParamIfValueNotNull(this,"fuelBurnCeiling",jsonObject.fuelBurnCeiling);AWUtils.setupParamIfValueNotNull(this,"fuelBurnCeilingUnit",jsonObject.fuelBurnCeilingUnit);AWUtils.setupParamIfValueNotNull(this,"ceilingFl",jsonObject.ceilingFl);AWUtils.setupParamIfValueNotNull(this,"ceilingFlUnit",jsonObject.ceilingFlUnit);AWUtils.setupParamIfValueNotNull(this,"descentRate",jsonObject.descentRate);AWUtils.setupParamIfValueNotNull(this,"descentRateUnit",this.convertDistance2SpeedUnit(jsonObject.descentRateUnit));AWUtils.setupParamIfValueNotNull(this,"iasDesc",AWUtils.parseAndClearIntegerFormat(jsonObject.iasDesc));AWUtils.setupParamIfValueNotNull(this,"iasDescUnit",jsonObject.iasDescUnit);AWUtils.setupParamIfValueNotNull(this,"fuelBurnDesc",jsonObject.fuelBurnDesc);AWUtils.setupParamIfValueNotNull(this,"fuelBurnDescUnit",jsonObject.fuelBurnDescUnit);AWUtils.setupParamIfValueNotNull(this,"emergencyRadio",jsonObject.emergencyRadio);AWUtils.setupParamIfValueNotNull(this,"survivalEquipment",jsonObject.survivalEquipment);AWUtils.setupParamIfValueNotNull(this,"lifeJacket",jsonObject.lifeJacket);AWUtils.setupParamIfValueNotNull(this,"dinghiesNumber",jsonObject.dinghiesNumber);AWUtils.setupParamIfValueNotNull(this,"dinghiesCapacity",jsonObject.dinghiesCapacity);AWUtils.setupParamIfValueNotNull(this,"dinghiesCovered",jsonObject.dinghiesCovered);AWUtils.setupParamIfValueNotNull(this,"dinghiesColour",jsonObject.dinghiesColour);AWUtils.setupParamIfValueNotNull(this,"otherComm",jsonObject.otherComm);AWUtils.setupParamIfValueNotNull(this,"otherNav",jsonObject.otherNav);AWUtils.setupParamIfValueNotNull(this,"comNav",jsonObject.comNav);AWUtils.setupParamIfValueNotNull(this,"comNavEquipment",jsonObject.comNavEquipment);}};this.convertDistance2SpeedUnit=function(aUnitValue){if(aUnitValue==="m"){return"m/s";}else if(aUnitValue==="f"){return"ft/min";}return aUnitValue;};this.getJson=function(){return{Aircraft:this};};}function AircraftListModel(){this.list=new Array();var _instance=this;this.add=function(aircraft){this.list.push(aircraft);};this.updateAircraft=function(aircraft){const idx=_instance.list.findIndex(ac=>ac.id=aircraft.id);if(idx>-1){_instance.list[idx]=aircraft;}};this.init=function(jsonObject){if(jsonObject!==undefined&&jsonObject.Aircraft!==undefined){var acObj=jsonObject.Aircraft;if(Array.isArray(acObj)===false){acObj=[acObj];}JQ.each(acObj,function(index,value){var ac=new AircraftModel();ac.init(value);_instance.add(ac);});}};this.size=function(){return this.list.length;};this.at=function(index){return this.list[index];};}function Location(name){this.name=(name!==undefined)?name:null;this.lat;this.lng;this.sr;this.ss;this.freq;this.source;this.codeId;this.stay;this.stayInfo;this.ruleChg;this.setName=function(name){this.name=name;};this.getName=function(){return this.name;};this.setLatitude=function(lat){this.lat=lat;};this.getLatitude=function(){return this.lat;};this.setLongitude=function(long){this.lng=long;};this.getLongitude=function(){return this.lng;};this.setSunrise=function(value){this.sr=value;};this.getSunrise=function(){return this.sr;};this.setSunset=function(value){this.ss=value;};this.getSunset=function(){return this.ss;};this.setFrequency=function(value){this.freq=value;};this.getFrequency=function(){return this.freq;};this.isICAOName=function(){var name=this.getName();if(AWUtils.isUndefinedOrIsNullOrIsEmptyString(name)===true||(""+name).trim().length!=4){return false;}return true;};this.init=function(jsonObject){if(jsonObject!=undefined){AWUtils.setupParamIfValueNotNull(this,"id",jsonObject.id);AWUtils.setupParamIfValueNotNull(this,"name",jsonObject.name);AWUtils.setupParamIfValueNotNull(this,"lat",jsonObject.lat);AWUtils.setupParamIfValueNotNull(this,"lng",jsonObject.lng);AWUtils.setupParamIfValueNotNull(this,"ss",jsonObject.ss);AWUtils.setupParamIfValueNotNull(this,"sr",jsonObject.sr);AWUtils.setupParamIfValueNotNull(this,"freq",jsonObject.freq);AWUtils.setupParamIfValueNotNull(this,"source",jsonObject.source);AWUtils.setupParamIfValueNotNull(this,"codeId",jsonObject.codeId);AWUtils.setupParamIfValueNotNull(this,"stay",jsonObject.stay);AWUtils.setupParamIfValueNotNull(this,"stayInfo",jsonObject.stayInfo);AWUtils.setupParamIfValueNotNull(this,"ruleChg",jsonObject.ruleChg);}};}Location.TYPE={ADEP:"adep",ADES:"ades",WPT:"wpt",ALT1:"alt1",ALT2:"alt2"};Location.SOURCE={SDO:"sdo",GPS:"gps",PLACE:"place",USER_PNT:"user"};function RouteSegment(){this.id;this.routeId;this.sequence=null;this.fromPoint=null;this.toPoint=null;this.height;this.heightUnit;this.ias;this.iasUnit;this.hdg;this.distance;this.distanceUnit;this.segmentTime;this.eta;this.ata;this.deltaTime;this.landingTime;this.setId=function(id){this.id=id;};this.getId=function(){return this.id;};this.setRoute=function(route){if(route instanceof FlightRoute)this.routeId=route.getId();elsethis.touteId=route;};this.getRouteId=function(){return this.routeId;};this.setSequence=function(sequence){this.sequence=sequence;};this.getSequence=function(){return this.sequence;};this.setFromPoint=function(location){this.fromPoint=location;};this.getFromPoint=function(){return this.fromPoint;};this.setToPoint=function(location){this.toPoint=location;};this.getToPoint=function(){return this.toPoint;};this.setHeight=function(height){this.height=height;};this.getHeight=function(){return this.height;};this.setHeightUnit=function(heightUnit){this.heightUnit=heightUnit;};this.getHeightUnit=function(){return this.heightUnit;};this.setIas=function(ias){this.ias=ias;};this.getIas=function(){return AWUtils.parseAndClearIntegerFormat(this.ias);};this.setIasUnit=function(iasUnit){this.iasUnit=iasUnit;};this.getIasUnit=function(){return this.iasUnit;};this.setHdg=function(hdg){this.hdg=hdg;};this.getHdg=function(){return this.hdg;};this.setDistance=function(distance){this.distance=parseFloat(distance);};this.getDistance=function(){return this.distance;};this.setDistanceUnit=function(distanceUnit){this.distanceUnit=distanceUnit;};this.getDistanceUnit=function(){return this.distanceUnit;};this.setSegmentTime=function(segmentTime){this.segmentTime=segmentTime;};this.getSegmentTime=function(){return this.segmentTime;};this.setEta=function(eta){this.eta=eta;};this.getEta=function(){return this.eta;};this.setAta=function(ata){this.ata=ata;};this.getAta=function(){return this.ata;};this.setDeltaTime=function(deltaTime){this.deltaTime=deltaTime;};this.getDeltaTime=function(){return this.deltaTime;};this.setLandingTime=function(landingTime){this.landingTime=landingTime;};this.getLandingTime=function(){return this.landingTime;};this.init=function(jsonObject){if(jsonObject!=undefined){AWUtils.setupParamIfValueNotNull(this,"id",jsonObject.id);AWUtils.setupParamIfValueNotNull(this,"sequence",jsonObject.sequence);if(jsonObject.fromPoint!=undefined){this.fromPoint=new Location();this.fromPoint.init(jsonObject.fromPoint);this.fromPoint.__segment=this;}if(jsonObject.toPoint!=undefined){this.toPoint=new Location();this.toPoint.init(jsonObject.toPoint);this.toPoint.__segment=this;}AWUtils.setupParamIfValueNotNull(this,"height",jsonObject.height);AWUtils.setupParamIfValueNotNull(this,"heightUnit",jsonObject.heightUnit);AWUtils.setupParamIfValueNotNull(this,"ias",jsonObject.ias);AWUtils.setupParamIfValueNotNull(this,"iasUnit",jsonObject.iasUnit);AWUtils.setupParamIfValueNotNull(this,"hdg",jsonObject.hdg);AWUtils.setupParamIfValueNotNull(this,"distance",parseFloat(jsonObject.distance));AWUtils.setupParamIfValueNotNull(this,"distanceUnit",jsonObject.distanceUnit);AWUtils.setupParamIfValueNotNull(this,"segmentTime",jsonObject.segmentTime);AWUtils.setupParamIfValueNotNull(this,"eta",jsonObject.eta);AWUtils.setupParamIfValueNotNull(this,"ata",jsonObject.ata);AWUtils.setupParamIfValueNotNull(this,"deltaTime",jsonObject.deltaTime);AWUtils.setupParamIfValueNotNull(this,"landingTime",jsonObject.landingTime);}};this.getJson=function(){return{RouteSegment:this};};}function FlightRoute(){this.id;this.idFlight;this.name=null;this.distance;this.distanceUnit;this.routeTime;this.horizontalBuffer=null;this.horizontalBufferUnit=null;this.verticalBuffer=null;this.verticalBufferUnit=null;this.segment=[];this.timeSegment;this.timeSegmentCount;this.lastTimeSegment;this.setId=function(id){this.id=id;};this.getId=function(){return this.id;};this.setIdFlight=function(idFlight){this.idFlight=idFlight;};this.setName=function(name){this.name=name;};this.getName=function(){return this.name;};this.setDistance=function(distance){this.distance=distance;};this.getDistance=function(){return this.distance;};this.setDistanceUnit=function(distanceUnit){this.distanceUnit=distanceUnit;};this.getDistanceUnit=function(){return this.distanceUnit;};this.setRouteTime=function(routeTime){this.routeTime=routeTime;};this.getRouteTime=function(){return this.routeTime;};this.setHorizontalBuffer=function(horizontalBuffer){this.horizontalBuffer=horizontalBuffer;};this.getHorizontalBuffer=function(){return AWUtils.clearNumberFormat(this.horizontalBuffer);};this.setHorizontalBufferUnit=function(horizontalBufferUnit){this.horizontalBufferUnit=horizontalBufferUnit;};this.getHorizontalBufferUnit=function(){return this.horizontalBufferUnit;};this.setVerticalBuffer=function(verticalBuffer){this.verticalBuffer=verticalBuffer;};this.getVerticalBuffer=function(){return AWUtils.clearNumberFormat(this.verticalBuffer);};this.setVerticalBufferUnit=function(verticalBufferUnit){this.verticalBufferUnit=verticalBufferUnit;};this.getVerticalBufferUnit=function(){return this.verticalBufferUnit;};this.addSegment=function(segment){this.segment.push(segment);segment.__route=this;};this.insertSegmentForPoint=function(fromPointData,atIndex){var newSegment=new RouteSegment();var nextSegment=this.segment[atIndex];var segmentData;segmentData={routeId:this.id,sequence:atIndex,fromPoint:fromPintData,toPoint:nextSegment.fromPoint};segment.init(segmentData);this.segment.splice(atIndex,0,newSegment);};this.getSegment=function(index){return this.segment[index];};this.setSegments=function(segments){this.segment=segments;};this.getSegments=function(){return this.segment;};this.removeSegment=function(segment){if(segment instanceof RouteSegment){var segments=this.segment;JQ.each(segments,function(index){if(segments[index]===segment){segments.splice(index,1);return false;}});}else{this.Segment.splice(segment,1);}};this.setTimeSegment=function(timeSegment){this.timeSegment=timeSegment;};this.getTimeSegment=function(){return this.timeSegment;};this.setTimeSegmentCount=function(timeSegmentCount){this.timeSegmentCount=timeSegmentCount;};this.getTimeSegmentCount=function(){return this.timeSegmentCount;};this.setLastTimeSegment=function(lastTimeSegment){this.lastTimeSegment=lastTimeSegment;};this.getLastTimeSegment=function(){return this.lastTimeSegment;};this.init=function(jsonObject){if(jsonObject!=undefined){AWUtils.setupParamIfValueNotNull(this,"id",jsonObject.id);AWUtils.setupParamIfValueNotNull(this,"name",jsonObject.name);AWUtils.setupParamIfValueNotNull(this,"distance",jsonObject.distance);AWUtils.setupParamIfValueNotNull(this,"distanceUnit",jsonObject.distanceUnit);AWUtils.setupParamIfValueNotNull(this,"routeTime",jsonObject.routeTime);AWUtils.setupParamIfValueNotNull(this,"horizontalBuffer",jsonObject.horizontalBuffer);AWUtils.setupParamIfValueNotNull(this,"horizontalBufferUnit",jsonObject.horizontalBufferUnit);AWUtils.setupParamIfValueNotNull(this,"verticalBuffer",jsonObject.verticalBuffer);AWUtils.setupParamIfValueNotNull(this,"verticalBufferUnit",jsonObject.verticalBufferUnit);var segmentsJsonObj=jsonObject.segment;if(segmentsJsonObj!==undefined){var instance=this;if(Array.isArray(segmentsJsonObj)===false){segmentsJsonObj=[segmentsJsonObj];}JQ.each(segmentsJsonObj,function(index,value){var segment=new RouteSegment();segment.init(value);instance.addSegment(segment);});}AWUtils.setupParamIfValueNotNull(this,"timeSegment",jsonObject.timeSegment);AWUtils.setupParamIfValueNotNull(this,"timeSegmentCount",jsonObject.timeSegmentCount);AWUtils.setupParamIfValueNotNull(this,"lastTimeSegment",jsonObject.lastTimeSegment);}};this.getJson=function(){var retVal={FlightRoute:this};return retVal;};}function Flight(){this.id;this.aircraftId;this.PIC=null;this.crew=null;this.POB=null;this.adep=null;this.ades=null;this.alter1;this.alter2;this.etd;this.eat;this.eet;this.dof=null;this.rule=null;this.type=null;this.ias;this.iasUnit;this.xstat;this.xflag;this.fuel;this.fuelUnit;this.consumption;this.consumptionUnit;this.flevel;this.flevelUnit;this.endurance;this.qnh;this.range;this.route=null;this.Aircraft;this.com;this.nav;this.checkFplValidity;this.AddInfoInstructions;this.AddInfoPilottel;this.AddInfoPilotfax;this.AddInfoPilotmail;this.AddInfoSendertel;this.AddInfoSenderfax;this.AddInfoSendermail;this.setId=function(id){this.id=id;};this.getId=function(){return this.id;};this.setAircraftId=function(aircraftId){this.aircraftId=aircraftId;};this.getAircraftId=function(){return this.aircraftId;};this.setPic=function(pic){this.PIC=pic;};this.getPic=function(){return this.PIC;};this.setCrew=function(crew){this.crew=crew;};this.getCrew=function(){return this.crew;};this.setPob=function(pob){this.POB=pob;};this.getPob=function(){return this.POB;};this.setAdep=function(location){this.adep=location;};this.getAdep=function(){return this.adep;};this.setAdes=function(location){this.ades=location;};this.getAdes=function(){return this.ades;};this.setAlter1=function(location){this.alter1=location;};this.getAlter1=function(){return this.alter1;};this.setAlter2=function(location){this.alter2=location;};this.getAlter2=function(){return this.alter2;};this.setEtd=function(etd){this.etd=etd;};this.getEtd=function(){return this.etd;};this.setEat=function(eat){this.eat=eat;};this.getEat=function(){return this.eat;};this.setEet=function(eet){this.eet=eet;};this.getEet=function(){return this.eet;};this.setDof=function(dof){this.dof=dof;};this.getDof=function(){return this.dof;};this.setRule=function(rule){this.rule=rule;};this.getRule=function(){return this.rule;};this.setType=function(type){this.type=type;};this.getType=function(){return this.type;};this.setIas=function(ias){this.ias=ias;};this.getIas=function(){return AWUtils.parseAndClearIntegerFormat(this.ias);};this.setIasUnit=function(iasUnit){this.iasUnit=iasUnit;};this.getIasUnit=function(){return this.iasUnit;};this.setxstat=function(xstat){this.xstat=xstat;};this.getxstat=function(){return this.xstat;};this.getxflag=function(){return this.xflag;};this.setFuel=function(fuel){this.fuel=fuel;};this.getFuel=function(){return AWUtils.clearNumberFormat(this.fuel);};this.setFuelUnit=function(fuelUnit){this.fuelUnit=fuelUnit;};this.getFuelUnit=function(){return this.fuelUnit;};this.setConsumption=function(consumption){this.consumption=consumption;};this.getConsumption=function(){return AWUtils.clearNumberFormat(this.consumption);};this.setConsumptionUnit=function(consumptionUnit){this.consumptionUnit=consumptionUnit;};this.getConsumptionUnit=function(){return this.consumptionUnit;};this.setFlevel=function(flevel){this.flevel=flevel;};this.getFlevel=function(){return this.flevel;};this.setFlevelUnit=function(flevelUnit){this.flevelUnit=flevelUnit;};this.getFlevelUnit=function(){return this.flevelUnit;};this.setEndurance=function(endurance){this.endurance=endurance;};this.getEndurance=function(){return this.endurance;};this.setQnh=function(qnh){this.qnh=qnh;};this.getQnh=function(){return this.qnh;};this.setRange=function(range){this.range=range;};this.getRange=function(){return this.range;};this.setRoute=function(route){this.route=route;};this.getRoute=function(){return this.route;};this.setAircraft=function(aircraft){this.Aircraft=aircraft;};this.getAircraft=function(){return this.Aircraft;};this.setCom=function(id){this.com=com;};this.getCom=function(){return this.com;};this.setNav=function(id){this.nav=nav;};this.getNav=function(){return this.nav;};this.init=function(jsonObject){AWUtils.setupParamIfValueNotNull(this,"id",jsonObject.id);AWUtils.setupParamIfValueNotNull(this,"aircraftId",jsonObject.aircraftId);AWUtils.setupParamIfValueNotNull(this,"PIC",jsonObject.PIC);AWUtils.setupParamIfValueNotNull(this,"crew",jsonObject.crew);AWUtils.setupParamIfValueNotNull(this,"POB",jsonObject.POB);if(jsonObject.adep!=undefined){this.adep=new Location();this.adep.init(jsonObject.adep);}if(jsonObject.ades!=undefined){this.ades=new Location();this.ades.init(jsonObject.ades);}if(jsonObject.alter1!=undefined){this.alter1=new Location();this.alter1.init(jsonObject.alter1);}if(jsonObject.alter2!=undefined){this.alter2=new Location();this.alter2.init(jsonObject.alter2);}AWUtils.setupParamIfValueNotNull(this,"etd",jsonObject.etd);AWUtils.setupParamIfValueNotNull(this,"eat",jsonObject.eat);AWUtils.setupParamIfValueNotNull(this,"eet",jsonObject.eet);AWUtils.setupParamIfValueNotNull(this,"dof",jsonObject.dof);AWUtils.setupParamIfValueNotNull(this,"rule",jsonObject.rule);AWUtils.setupParamIfValueNotNull(this,"type",jsonObject.type);AWUtils.setupParamIfValueNotNull(this,"ias",jsonObject.ias);AWUtils.setupParamIfValueNotNull(this,"iasUnit",jsonObject.iasUnit);AWUtils.setupParamIfValueNotNull(this,"xstat",jsonObject.xstat);AWUtils.setupParamIfValueNotNull(this,"xflag",jsonObject.xflag);AWUtils.setupParamIfValueNotNull(this,"fuel",jsonObject.fuel);AWUtils.setupParamIfValueNotNull(this,"fuelUnit",jsonObject.fuelUnit);AWUtils.setupParamIfValueNotNull(this,"consumption",jsonObject.consumption);AWUtils.setupParamIfValueNotNull(this,"consumptionUnit",jsonObject.consumptionUnit);AWUtils.setupParamIfValueNotNull(this,"flevel",jsonObject.flevel);AWUtils.setupParamIfValueNotNull(this,"flevelUnit",jsonObject.flevelUnit);AWUtils.setupParamIfValueNotNull(this,"endurance",jsonObject.endurance);AWUtils.setupParamIfValueNotNull(this,"qnh",jsonObject.qnh);AWUtils.setupParamIfValueNotNull(this,"range",jsonObject.range);AWUtils.setupParamIfValueNotNull(this,"com",jsonObject.com);AWUtils.setupParamIfValueNotNull(this,"nav",jsonObject.nav);this.route=new FlightRoute();this.route.init(jsonObject.route);this.route.__flight=this;this.Aircraft=new AircraftModel();this.Aircraft.init(jsonObject.Aircraft);if(this.xflag!==undefined){if(this.xflag.contains("V"))this.checkFplValidity=true;if(this.xflag.contains("U"))this.checkFplValidity=false;}};this.getJson=function(){return{Flight:this};};}function FlightList(){this.list=new Array();var _instance=this;this.add=function(flight){this.list.push(flight);};this.init=function(jsonObject){if(jsonObject!==undefined&&jsonObject.Flight!==undefined){var fObj=jsonObject.Flight;if(fObj instanceof Array){JQ.each(fObj,function(index,value){var f=new Flight();f.init(value);_instance.add(f);});}else{var f=new Flight();f.init(fObj);_instance.add(f);}}};this.size=function(){return this.list.length;};this.at=function(index){return this.list[index];};this.getFlightById=function(id){var retVal=null;JQ.each(this.list,function(index,flight){if(flight.getId()===id){retVal=flight;return false;}});return retVal;};}function Rectangle(){this.x1=null;this.y1=null;this.x2=null;this.y2=null;this.y1Type=null;this.y2Type=null;var mCutHeightLimit=null;this.setX1=function(aX1){this.x1=aX1;};this.getX1=function(){return this.x1;};this.setY1=function(aY1){this.y1=aY1;};this.getY1=function(){return this.y1;};this.setX2=function(aX2){this.x2=aX2;};this.getX2=function(){return this.x2;};this.setY2=function(aY2){this.y2=aY2;};this.getY2=function(){return this.y2;};this.setCutHeightLimit=function(aValue){mCutHeightLimit=aValue;};this.getCutHeightLimit=function(){return mCutHeightLimit;};this.getY1Type=function(){return this.y1Type;};this.setY1Type=function(aY1Type){this.y1Type=aY1Type;};this.getY2Type=function(){return this.y2Type;};this.setY2Type=function(aY2Type){this.y2Type=aY2Type;};this.init=function(jsonObject){if(AWUtils.isUndefinedOrIsNull(jsonObject)===true){return;}AWUtils.setupParamIfValueNotNull(this,"x1",jsonObject.x1);AWUtils.setupParamIfValueNotNull(this,"y1",jsonObject.y1);AWUtils.setupParamIfValueNotNull(this,"x2",jsonObject.x2);AWUtils.setupParamIfValueNotNull(this,"y2",jsonObject.y2);AWUtils.setupParamIfValueNotNull(this,"y1Type",jsonObject.y1Type);AWUtils.setupParamIfValueNotNull(this,"y2Type",jsonObject.y2Type);};this.clone=function(){var retVal=new Rectangle();retVal.setX1(this.getX1());retVal.setY1(this.getY1());retVal.setX2(this.getX2());retVal.setY2(this.getY2());retVal.setY1Type(this.getY1Type());retVal.setY2Type(this.getY2Type());return retVal;};}Rectangle.ALTITUDE_TYPE={AMSL:"0",AGL:"1"};function Area(){this.code_id=null;this.txt_name=null;this.type;this.geometry;this.rectangle=null;this.conflict;this.conflict_desc;this.setCode_id=function(code_id){this.code_id=code_id;};this.getCode_id=function(){return this.code_id;};this.setTxt_name=function(txt_name){this.txt_name=txt_name;};this.getTxt_name=function(){return this.txt_name;};this.getType=function(){return this.type;};this.setType=function(aType){this.type=aType;};this.getGeometry=function(){return this.geometry;};this.addRectangle=function(rectangle){if(this.rectangle===null){this.rectangle=new Array();}this.rectangle.push(rectangle);};this.getRectangle=function(){return this.rectangle;};this.setConflict=function(conflict){this.conflict=conflict;};this.getConflict=function(){return this.conflict;};this.setConflict_desc=function(conflict_desc){this.conflict_desc=conflict_desc;};this.getConflict_desc=function(){return this.conflict_desc;};this.init=function(jsonObject){if(jsonObject!=undefined){AWUtils.setupParamIfValueNotNull(this,"code_id",jsonObject.code_id);AWUtils.setupParamIfValueNotNull(this,"txt_name",jsonObject.txt_name);AWUtils.setupParamIfValueNotNull(this,"type",jsonObject.type);AWUtils.setupParamIfValueNotNull(this,"geometry",jsonObject.geometry);var rectangleJsonObj=jsonObject.rectangle;this.rectangle=new Array();if(rectangleJsonObj!==undefined){if(rectangleJsonObj instanceof Array){var instance=this;JQ.each(rectangleJsonObj,function(index,value){var rect=new Rectangle();rect.init(value);instance.rectangle.push(rect);});}else{var rect=new Rectangle();rect.init(rectangleJsonObj);this.rectangle.push(rect);}}AWUtils.setupParamIfValueNotNull(this,"conflict",jsonObject.conflict);AWUtils.setupParamIfValueNotNull(this,"conflict_desc",jsonObject.conflict_desc);}};this.clone=function(){var clonedArea=new Area();clonedArea.setCode_id(this.getCode_id());clonedArea.setTxt_name(this.getTxt_name());clonedArea.setType(this.getType());if(!isUndefinedOrIsNullOrIsEmptyArray(this.rectangle)){var clonedRectangles=[];for(var j=0;j<this.rectangle.length;j++){var jRectangle=this.rectangle[j];if(!isUndefinedOrIsNull(jRectangle)){var clonedRectangle=jRectangle.clone();clonedRectangles.push(clonedRectangle);}}clonedArea.rectangle=clonedRectangles;}clonedArea.setConflict(this.getConflict());clonedArea.setConflict_desc(this.getConflict_desc());return clonedArea;};}function Point(){this.code_id=null;this.txt_name=null;this.type;this.geometry;this.distance;this.elevation;this.freq;this.setCode_id=function(code_id){this.code_id=code_id;};this.getCode_id=function(){return this.code_id;};this.setTxt_name=function(txt_name){this.txt_name=txt_name;};this.getTxt_name=function(){return this.txt_name;};this.getType=function(){return this.type;};this.getGeometry=function(){return this.geometry;};this.getDistance=function(){return this.distance;};this.setDistance=function(aDistance){this.distance=aDistance;};this.setElevation=function(aElevation){this.elevation=aElevation;};this.getElevation=function(){return this.elevation;};this.getFrequency=function(){return this.freq;};this.init=function(jsonObject){if(jsonObject!=undefined){AWUtils.setupParamIfValueNotNull(this,"code_id",jsonObject.code_id);AWUtils.setupParamIfValueNotNull(this,"txt_name",jsonObject.txt_name);AWUtils.setupParamIfValueNotNull(this,"type",jsonObject.type);AWUtils.setupParamIfValueNotNull(this,"geometry",jsonObject.geometry);AWUtils.setupParamIfValueNotNull(this,"distance",jsonObject.distance);AWUtils.setupParamIfValueNotNull(this,"elevation",jsonObject.elevation);AWUtils.setupParamIfValueNotNull(this,"freq",jsonObject.freq);}};}function Relief(){this.heightStep=null;this.height;this.heightUnit=null;this.area;this.point;this.com;this.nav;this.route;this.getHeightStep=function(){return this.heightStep;};this.setHeightStep=function(aStep){this.heightStep=aStep;};this.getHeightUnit=function(){return this.heightUnit;};this.getHeights=function(){return this.height;};this.setHeights=function(aHeights){this.height=aHeights;};this.getAreas=function(){return this.area;};this.getAreasWithoutFirs=function(){var aAreasArray=this.getAreas();if(isUndefinedOrIsNullOrIsEmptyArray(aAreasArray)===true){return[];}var retVal=[];for(var i=0;i<aAreasArray.length;i++){var iArea=aAreasArray[i];if(isUndefinedOrIsNull(iArea)===true){continue;}if(iArea.type==='Aixm-Ase-FIR'){continue;}retVal.push(iArea);}return retVal;};this.setAreas=function(aAreas){this.area=aAreas;};this.getPoints=function(){return this.point;};this.setPoints=function(aPoints){this.point=aPoints;};this.getCom=function(){return this.com;};this.setCom=function(com){this.com=com;};this.getNav=function(){return this.nav;};this.setNav=function(nav){this.nav=nav;};this.getRouteVerticalBuffer=function(){if(AWUtils.isUndefinedOrIsNull(this.route)===true||AWUtils.isUndefinedOrIsNull(this.route.verticalBuffer)===true){return null;}else{return AWUtils.parseIntElseZero(this.route.verticalBuffer);}};this.getRouteVerticalBufferUnit=function(){if(AWUtils.isUndefinedOrIsNull(this.route)===true||AWUtils.isUndefinedOrIsNullOrIsEmptyString(this.route.verticalBufferUnit)===true){return null;}else{return this.route.verticalBufferUnit;}};this.init=function(jsonObject){if(jsonObject!=undefined&&jsonObject!==""){var instance=this;AWUtils.setupParamIfValueNotNull(this,"heightStep",jsonObject.heightStep);AWUtils.setupParamIfValueNotNull(this,"heightUnit",jsonObject.heightUnit);AWUtils.setupParamIfValueNotNull(this,"height",jsonObject.height);AWUtils.setupParamIfValueNotNull(this,"com",jsonObject.com);AWUtils.setupParamIfValueNotNull(this,"nav",jsonObject.nav);this.area=new Array();if(jsonObject.area!=undefined){var areaObj=jsonObject.area;if(areaObj instanceof Array){JQ.each(areaObj,function(index,value){var area=new Area();area.init(value);instance.area.push(area);});}else{var area=new Area();area.init(areaObj);this.area.push(area);}}this.point=new Array();if(jsonObject.point!=undefined){var pointObj=jsonObject.point;if(pointObj instanceof Array){JQ.each(pointObj,function(index,value){var point=new Point();point.init(value);instance.point.push(point);});}else{var point=new Point();point.init(pointObj);this.point.push(point);}}if(AWUtils.isUndefinedOrIsNull(jsonObject.route)===false){this.route=jsonObject.route;}}};}var svgProfile=null;function AisSvgProfile(aWidth,aHeight){var thisInstance=this;this.x_shift=1;this.font_family="Arial";this.y_shift=0;this.svg_width=(aWidth===undefined||aWidth===null)?750:Number(aWidth);this.svg_height=(aHeight===undefined||aHeight===null)?250:Number(aHeight);this.character_width=4.6;this.background_width=this.svg_width;this.background_height=this.svg_height;this.background_x=0;this.background_y=0;this.background_rx=10;this.background_ry=10;this.background_text="Vertical Profile";this.background_text_padding_top=20;this.chart_lines_padding_left=50;this.chart_lines_padding_top=30;this.axis_line_padding_right=20;this.axis_line_padding_bottom=20;this.axis_line_colour="#ffffff";this.axis_x_dash_length=11;this.axis_x_line_width=2;this.axis_y_dash_length=35;this.axis_text_padding_x=2;this.axis_x_legend_length=17;this.axis_x_dash_step_Km=new AxisDashStep([5,10,50,100,500,1000,5000],1000,(1/1000),'Km','KM');this.axis_x_dash_step_Nm=new AxisDashStep([1,5,10,50,100,500,1000,5000],1852,(1/1852),'Nm','NM');this.axis_x_dash_steps=[this.axis_x_dash_step_Nm,this.axis_x_dash_step_Km];this.axis_x_minimal_dash_step=50;this.meter2Feet=3.2808399;this.vfrAltitudeInFeets=1000;this.axis_y_possible_dash_steps=[5,10,50,100,500,1000,1500,2000,2500,3000,3500,4000,5000,10000,50000,100000,500000,1000000,5000000];this.axis_y_dash_step_feets=new AxisDashStep(this.axis_y_possible_dash_steps,(1/this.meter2Feet),this.meter2Feet,'Feet','NM');this.axis_y_dash_step_meters=new AxisDashStep([5,10,50,100,250,500,1000,1500,2000,2500,3000,3500,4000,5000,10000,50000,100000,500000,1000000,5000000],1,1,'m','KM');this.axis_y_dash_steps=[this.axis_y_dash_step_feets,this.axis_y_dash_step_meters];this.axis_y_dash_text_padding_bottom=2;this.axis_y_minimal_dash_step=12;this.terrain_profile_colour='#656565';this.transmitter_width=21.5;this.transmitter_height=54;this.parachute_width=44;this.parachute_height=67.5;this.parachute_element_id="parachute";this.areas_dronzone=[];this.areas_cutted=[];this.area_text_width=43;this.area_text_padding_x=1;this.area_text_padding_y=8;this.area_text_font_size=10;this.area_icon_padding=5;this.AREA_TYPE={TMA_DEFAULT:{fillColour:'#0400ff',fillOpacity:'0.09803922',strokeColour:'#0083d7',icon:null},CTR_DEFAULT:{fillColour:'#ff0000',fillOpacity:'0.09803922',strokeColour:'#d70000',icon:null},CTR_PARACHUTE:{fillColour:'#ff6f00',fillOpacity:'0.09803922',strokeColour:'#c17927',icon:this.parachute_element_id},CONFLICT:{fillColour:'#F72935',fillOpacity:'0.09803922',strokeColour:'#F72935',icon:null}};this.mFlight=null;this.height_top_buffer=300;this.mDescentDistanceCheckEnablity=false;this.mClimbDistanceCheckEnablity=false;this.mRelief=null;this.waypoint_axis_padding_bottom=5;this.waypoint_axis_padding_left=3;this.waypoint_dash_length=200;this.waypoint_text_font_size=10;var scaleX=1;var mScaleY=1;this.obstacle_antena_id='antena_id';this.obstacle_antena_light_id='antena_light_id';this.obstacle_balloon_id='balloon_id';this.obstacle_building_high_id='building_high_id';this.obstacle_building_high_light_id='building_high_light_id';this.obstacle_cooling_tower_id='cooling_tower_id';this.obstacle_cooling_tower_light_id='cooling_tower_light_id';this.obstacle_chimney_id='chimney_id';this.obstacle_chimney_light_id='chimney_light_id';this.obstacle_mast_power_id='mast_power_id';this.obstacle_mast_power_light_id='mast_power_light_id';this.obstacle_other_obstacles_id='other_obstacles_id';this.obstacle_parachute_id='paraschute_id';this.obstacle_rogallo_id='rogallo_id';this.obstacle_tower_id='tower_id';this.obstacle_tower_light_id='tower_light_id';this.obstacle_wind_power_id='wind_power_id';this.obstacle_wind_power_light_id='wind_power_light_id';this.obstacle_aixm_ahp_id='aixm_ahp_id';this.obstacle_aixm_dme_id='aixm_dme_id';this.obstacle_aixm_vor_id='aixm_vor_id';this.obstacle_aixm_ndb_id='aixm_ndb_id';this.OBSTACLE_TYPE_ANTENA=new ObstacleType(this.obstacle_antena_id,24,54);this.OBSTACLE_TYPE_MAST_POWER=new ObstacleType(this.obstacle_mast_power_id,38,48);this.OBSTACLE_TYPE_BUILDING=new ObstacleType(this.obstacle_building_high_id,24,54);this.OBSTACLE_TYPE_AIXM_AHP=new ObstacleType(this.obstacle_aixm_ahp_id,24,25);this.obstacle_types={antena:this.OBSTACLE_TYPE_ANTENA,antenna:this.OBSTACLE_TYPE_ANTENA,transmission_line:this.OBSTACLE_TYPE_ANTENA,freq_point:this.OBSTACLE_TYPE_ANTENA,antena_light:new ObstacleType(this.obstacle_antena_light_id,22,54),balloon:new ObstacleType(this.obstacle_balloon_id,30,54),building:this.OBSTACLE_TYPE_BUILDING,building_high:this.OBSTACLE_TYPE_BUILDING,building_high_light:new ObstacleType(this.obstacle_building_high_light_id,24,60),cooling_tower:new ObstacleType(this.obstacle_cooling_tower_id,40,48),cooling_tower_light:new ObstacleType(this.obstacle_cooling_tower_light_id,40,54),chimney:new ObstacleType(this.obstacle_chimney_id,8,54),chimney_light:new ObstacleType(this.obstacle_chimney_light_id,14,54),mast:this.OBSTACLE_TYPE_MAST_POWER,mast_power:this.OBSTACLE_TYPE_MAST_POWER,mast_power_light:new ObstacleType(this.obstacle_mast_power_light_id,38,51),other_obstacles:new ObstacleType(this.obstacle_other_obstacles_id,64,44),parachute:new ObstacleType(this.obstacle_parachute_id,32,50),rogallo:new ObstacleType(this.obstacle_rogallo_id,60,40),tower:new ObstacleType(this.obstacle_tower_id,24,45),tower_light:new ObstacleType(this.obstacle_tower_light_id,24,50),wind_power:new ObstacleType(this.obstacle_wind_power_id,29,54),wind_power_light:new ObstacleType(this.obstacle_wind_power_light_id,29,54),aixm_ahp:this.OBSTACLE_TYPE_AIXM_AHP,aixm_dme:new ObstacleType(this.obstacle_aixm_dme_id,24,24),aixm_vor:new ObstacleType(this.obstacle_aixm_vor_id,24,24),aixm_ndb:new ObstacleType(this.obstacle_aixm_ndb_id,24,24)};this.obstacle_default_type_key='other_obstacles';this.dev_test_xml_terrain_profile='./tests/relief.xml';this.transMatrix=[1,0,0,1,0,0];this.usedXScaleStep=0;this.lastXScale=1;this.lastXTranslate=0;this.lastYTranslate=0;this.grey_block_colour='#A6A6A6';this.zoom_step=0.25;this.pan_step=50;this.mPresentationUnit='KM';this.mPresentationUnitAttributeName='unitpresentation';this.mHeightEdges=null;this.mZeroPointViewOfRelief=null;this.FlightProfileHeightDistanceModel=null;this.mKts2FtMin=101.2685;this.mUnit2M_S={"km/h":0.278,"mph":0.447,"kts":0.514,"ft/min":0.0051,"m/s":1};this.mDefaultFlightClimbRate=500;this.mDefaultFlightClimbRateUnit="ft/min";this.mDefaultFlightClimbIas=75;this.mDefaultFlightClimbIasUnit="kts";this.mDefaultFlightDescentRate=1000;this.mDefaultFlightDescentRateUnit="ft/min";this.mDefaultFlightDescentIas=75;this.mDefaultFlightDescentIasUnit="kts";this.mErrorModels=[];svgProfile=this;this.setFlight=function(aFlight){this.mFlight=aFlight;this.clearInternalCache();};this.setRelief=function(aRelief){this.mRelief=aRelief;this.clearInternalCache();};this.setPresentationUnit=function(aPresentationUnit){if(aPresentationUnit===undefined||aPresentationUnit===null){return;}if(aPresentationUnit!=='KM'&&aPresentationUnit!=='NM'){return;}this.mPresentationUnit=aPresentationUnit;};this.repaint=function(){this.repaintPresentationUnits();};this.createSvgProfile=function(){var retVal=this.createSvgStartElement()+this.createSvgElementContent()+this.createSvgEndElement();return retVal;};this.clearInternalCache=function(){this.FlightProfileHeightDistanceModel=null;this.mHeightEdges=null;this.mZeroPointViewOfRelief=null;this.mErrorModels=[];};this.createSvgStartElement=function(){return'<svg xmlns:dc="http://purl.org/dc/elements/1.1/"\n\    xmlns:cc="http://creativecommons.org/ns#"\n\    xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"\n\    xmlns:svg="http://www.w3.org/2000/svg"\n\    xmlns="http://www.w3.org/2000/svg"\n\    xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"\n\    xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"\n\    xmlns:xlink="http://www.w3.org/1999/xlink"\n\    viewBox="0 0 '+this.svg_width+' '+this.svg_height+'"\n\    id="svg2"\n\    version="1.1"\n\    inkscape:version="0.48.5 r10040"\n\    sodipodi:docname="profile.svg">';};this.createSvgElementContent=function(){this.cutHighestData();this.initScaleFactors();this.initDashSteps();var conflictLayerContent='';if(this.isFlightVFR()===false){conflictLayerContent=this.createReliefConflictLayer();}return this.createDefsElement()+this.createSodipodiElement()+this.createMetadataElement()+this.createBackgroundLayer()+this.createAreasLayer()+this.createTerrainProfileLayer()+conflictLayerContent+this.createFlightProfileLayer()+this.createFlightProfileErrorLayer()+this.createObstaclesLayer()+this.createFreqPointsLayer()+this.createWayPointsLayer()+this.createMinimalSafeAltitudeLayer()+this.createChartLineXLayers()+this.createGreyBlocksLayer()+this.createChartLineYLayers()+this.createZoomPanButtonsSvg();};this.createSvgEndElement=function(){return'</svg>';};this.createBackgroundLayer=function(){return this.createSvgGroupString((this.createFullBackground()+this.createBackgroundText()),{"inkscape:label":"Background","inkscape:groupmode":"layer","id":"layer1","style":"display:inline; ","sodipodi:insensitive":"true"});};this.createBackgroundText=function(){var tspan=this.createSvgTspanString(HtmlUtils.encodeForHTML(this.background_text),{"sodipodi:role":"line","id":"tspan2991","x":this.getBackgroundTextX(),"y":this.getBackgroundTextY()});var textElementString=this.createSvgTextString(tspan,{"xml:space":'preserve',"style":'font-size:16px;font-style:normal;font-weight:normal;line-height:125%;letter-spacing:0px;word-spacing:0px;fill:#ffffff;fill-opacity:1;stroke:none;font-family:'+this.font_family,"x":this.getBackgroundTextX(),"y":this.getBackgroundTextY(),"id":"text2989","sodipodi:linespacing":"125%"});return textElementString;};this.createBackgroundRectangle=function(){return this.createEmptyElementString('rect',{"style":'fill:#808080;fill-opacity:0.65822784;fill-rule:evenodd;stroke:#000000;stroke-width:0;stroke-linecap:butt;stroke-linejoin:bevel;stroke-miterlimit:0;stroke-opacity:1;stroke-dasharray:none',"id":'rect2985',"x":this.getBackgroundX(),"y":this.getBackgroundY(),"rx":this.background_rx,"ry":this.background_ry});};this.createFullBackground=function(){return this.createEmptyElementString('rect',{"style":'fill:#808080;fill-opacity:0.9;fill-rule:evenodd;stroke:#000000;stroke-width:0;stroke-linecap:butt;stroke-linejoin:bevel;stroke-miterlimit:0;stroke-opacity:1;stroke-dasharray:none',"id":'rect2986',"x":this.background_x,"y":this.background_y,"width":this.svg_width,"height":this.svg_height});};this.getNettoBackgroundWidth=function(){return this.background_width-this.background_rx*2;};this.getBackgroundHeight=function(){return this.background_height;};this.getXAxisLength=function(){return this.background_width-this.background_rx*2-this.chart_lines_padding_left-this.axis_line_padding_right;};this.getYAxisLength=function(){return this.getZeroPointView().y-this.chart_lines_padding_top-this.y_shift;};this.getBackgroundX=function(){return this.background_x+this.x_shift;};this.getBackgroundY=function(){return this.background_y+this.y_shift;};this.getBackgroundTextX=function(){return(this.background_width/2-this.background_text.length*this.character_width);};this.getBackgroundTextY=function(){return(this.y_shift+this.background_text_padding_top);};this.getFlightClimbRate=function(){var aircraft=this.checkAndGetAircraft();return aircraft.climbRate;};this.getFlightClimbRateUnit=function(){var aircraft=this.checkAndGetAircraft();return aircraft.climbRateUnit;};this.getFlightClimbIas=function(){var aircraft=this.checkAndGetAircraft();return aircraft.iasClimb;};this.getFlightClimbIasUnit=function(){var aircraft=this.checkAndGetAircraft();return aircraft.iasClimbUnit;};this.getFlightDescentRate=function(){var aircraft=this.checkAndGetAircraft();return aircraft.descentRate;};this.getFlightDescentRateUnit=function(){var aircraft=this.checkAndGetAircraft();return aircraft.descentRateUnit;};this.getFlightDescentIas=function(){var aircraft=this.checkAndGetAircraft();return aircraft.iasDesc;};this.getFlightDescentIasUnit=function(){var aircraft=this.checkAndGetAircraft();return aircraft.iasDescUnit;};this.checkAndGetAircraft=function(){var retVal=this.createDefaultAircraft();if(isUndefinedOrIsNull(this.mFlight)||isUndefinedOrIsNull(this.mFlight.getAircraft())){return retVal;}var aircraft=this.mFlight.getAircraft();if(!isUndefinedOrIsNull(aircraft.climbRate)){retVal.climbRate=aircraft.climbRate;}if(!isUndefinedOrIsNullOrIsEmptyString(aircraft.climbRateUnit)&&(aircraft.climbRateUnit in this.mUnit2M_S)){retVal.climbRateUnit=aircraft.climbRateUnit;}if(!isUndefinedOrIsNull(aircraft.iasClimb)){retVal.iasClimb=aircraft.iasClimb;}if(!isUndefinedOrIsNullOrIsEmptyString(aircraft.iasClimbUnit)&&(aircraft.iasClimbUnit in this.mUnit2M_S)){retVal.iasClimbUnit=aircraft.iasClimbUnit;}if(!isUndefinedOrIsNull(aircraft.descentRate)){retVal.descentRate=aircraft.descentRate;}if(!isUndefinedOrIsNullOrIsEmptyString(aircraft.descentRateUnit)&&(aircraft.descentRateUnit in this.mUnit2M_S)){retVal.descentRateUnit=aircraft.descentRateUnit;}if(!isUndefinedOrIsNull(aircraft.iasDesc)){retVal.iasDesc=aircraft.iasDesc;}if(!isUndefinedOrIsNullOrIsEmptyString(aircraft.iasDescUnit)&&(aircraft.iasDescUnit in this.mUnit2M_S)){retVal.iasDescUnit=aircraft.iasDescUnit;}return retVal;};this.createDefaultAircraft=function(){var defaultAircraft=new AircraftModel();defaultAircraft.climbRate=this.mDefaultFlightClimbRate;defaultAircraft.climbRateUnit='ft/min';defaultAircraft.iasClimb=this.mDefaultFlightClimbIas;defaultAircraft.iasClimbUnit='kts';defaultAircraft.descentRate=this.mDefaultFlightDescentRate;defaultAircraft.descentRateUnit='ft/min';;defaultAircraft.iasDesc=this.mDefaultFlightDescentIas;defaultAircraft.iasDescUnit='kts';return defaultAircraft;};this.createFlightProfileLayer=function(){var points=this.getFlightProfilePointsView();if(isUndefinedOrIsNullOrIsEmptyArray(points)){return'';}var pointsString=this.buildStringFromPoints(points);if(isUndefinedOrIsNullOrIsEmptyString(pointsString)){return'';}var path=this.createEmptyElementString('path',{"style":"fill:none;stroke:#ffe700;stroke-width:1.70700002;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none","d":'M '+pointsString,"id":"path3889","inkscape:connector-curvature":"0"});return this.createSvgGroupString(path,{"inkscape:groupmode":"layer","id":"layer3","class":"zoomable panable","inkscape:label":"Flight Profile","sodipodi:insensitive":"true"});};this.createFlightProfileErrorLayer=function(){if(this.mClimbDistanceCheckEnablity===false){return'';}var errorPointsSet=this.getFlightProfileErrorPointsView();if(isUndefinedOrIsNullOrIsEmptyArray(errorPointsSet)){return'';}var paths='';for(var iIndex in errorPointsSet){var iErrorLinePoints=errorPointsSet[iIndex];var pointsString=this.buildStringFromPoints(iErrorLinePoints);if(isUndefinedOrIsNullOrIsEmptyString(pointsString)){continue;}var path=this.createEmptyElementString('path',{"style":"fill:none;stroke:#ff0000;stroke-width:1.70700002;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none","d":'M '+pointsString,"id":"path3889","inkscape:connector-curvature":"0"});paths+=path;}if(isUndefinedOrIsNullOrIsEmptyString(paths)){return'';}return this.createSvgGroupString(paths,{"inkscape:groupmode":"layer","id":"layer31","class":"zoomable panable","inkscape:label":"Flight Profile Error Segments","sodipodi:insensitive":"true"});};this.getFlightProfileErrorPointsView=function(){var retValPoints=[];if(isUndefinedOrIsNull(this.mFlight)){return retValPoints;}var svgErrorPathPoints=[];if(this.isFlightVFR()===true){svgErrorPathPoints=this.getVfrFlightProfilePointsView();}else{var heightDistanceModel=this.convertFlightProfile2HeightDistance(this.mFlight);var heightDistancAtStart=this.createHeightDistanceOfProfileAtDistance(0,null);var heightDistanceWithStart=[];heightDistanceWithStart.push(heightDistancAtStart);heightDistanceWithStart=heightDistanceWithStart.concat(heightDistanceModel);if(isUndefinedOrIsNullOrIsEmptyArray(heightDistanceWithStart)){return retValPoints;}var heightDistanceView=this.scaleHeightDistanceModel2View(heightDistanceWithStart);if(isUndefinedOrIsNullOrIsEmptyArray(heightDistanceView)){return retValPoints;}svgErrorPathPoints=this.convertHeightDistanceModel2SvgErrorPathArray(heightDistanceView);if(isUndefinedOrIsNullOrIsEmptyArray(svgErrorPathPoints)){return retValPoints;}}retValPoints[0]=this.getZeroPointViewOfRelief();retValPoints=retValPoints.concat(svgErrorPathPoints);return retValPoints;};this.getFlightProfilePointsView=function(){var retValPoints=[];if(isUndefinedOrIsNull(this.mFlight)){return retValPoints;}var svgPathPoints=[];if(this.isFlightVFR()===true){svgPathPoints=this.getVfrFlightProfilePointsView();}else{var heightDistanceModel=this.convertFlightProfile2HeightDistance(this.mFlight);if(isUndefinedOrIsNullOrIsEmptyArray(heightDistanceModel)){return retValPoints;}var heightDistanceView=this.scaleHeightDistanceModel2View(heightDistanceModel);if(isUndefinedOrIsNullOrIsEmptyArray(heightDistanceView)){return retValPoints;}svgPathPoints=this.convertHeightDistanceModel2SvgPathModel(heightDistanceView);if(isUndefinedOrIsNullOrIsEmptyArray(svgPathPoints)){return retValPoints;}}retValPoints[0]=this.getZeroPointViewOfRelief();retValPoints=retValPoints.concat(svgPathPoints);return retValPoints;};this.isFlightVFR=function(){return false;};this.getVfrFlightProfilePointsView=function(){var terrainProfilePointsView=this.getTerrainProfilePointsView();if(isUndefinedOrIsNullOrIsEmptyArray(terrainProfilePointsView)){return terrainProfilePointsView;}terrainProfilePointsView.shift();terrainProfilePointsView.pop();var shiftHeight=this.getVfrAltitudeInMeters()*mScaleY;for(var i=0;i<terrainProfilePointsView.length;i++){var iTerrainPoint=terrainProfilePointsView[i];terrainProfilePointsView[i].y=iTerrainPoint.y-shiftHeight;}return terrainProfilePointsView;};this.getVfrAltitudeInMeters=function(){return(this.vfrAltitudeInFeets/this.meter2Feet);};this.convertFlightProfile2HeightDistance=function(aFlight){if(this.FlightProfileHeightDistanceModel!==null){return this.FlightProfileHeightDistanceModel;}var hdSegments=this.converFlightSegmentsToHeightDistanceModel(aFlight);var fullClimbDescentModel=this.addClimbDescentPoints(hdSegments);if(fullClimbDescentModel instanceof SegmentErrorMsgModel){this.mErrorModels.push(fullClimbDescentModel);this.FlightProfileHeightDistanceModel=[];}else{this.setErrorModels(fullClimbDescentModel);this.FlightProfileHeightDistanceModel=fullClimbDescentModel;}return this.FlightProfileHeightDistanceModel;};this.setErrorModels=function(aFullClimbDescentModel){if(AWUtils.isArray(aFullClimbDescentModel)===false){aFullClimbDescentModel=[];}for(var iModelIndex in aFullClimbDescentModel){var iHeightDistance=aFullClimbDescentModel[iModelIndex];if(AWUtils.isUndefinedOrIsNull(iHeightDistance)===true||AWUtils.isUndefinedOrIsNull(iHeightDistance.segmentErrorMsg)===true){continue;}this.mErrorModels.push(iHeightDistance.segmentErrorMsg);}};this.converFlightSegmentsToHeightDistanceModel=function(aFlight){var heightDistanceModel=[];if(isUndefinedOrIsNull(aFlight)||isUndefinedOrIsNull(aFlight.getRoute())||isUndefinedOrIsNullOrIsEmptyArray(aFlight.getRoute().getSegments())){return heightDistanceModel;}var routeSegments=aFlight.getRoute().getSegments();this.fillEmptyHeightFromPrevious(routeSegments);var lastHeight=0;if(!isUndefinedOrIsNull(aFlight.getFlevel())&&!isUndefinedOrIsNull(aFlight.getFlevelUnit())){lastHeight=AWUtils.convertToMeter(aFlight.getFlevel(),aFlight.getFlevelUnit());}var distanceSum=0;for(var i=0;i<routeSegments.length;i++){var iSegment=routeSegments[i];if(isUndefinedOrIsNull(iSegment)||isUndefinedOrIsNull(iSegment.getDistance())){continue;}var iDistance=iSegment.getDistance();var iHeight=iSegment.getHeight();if(isUndefinedOrIsNullOrIsEmptyString(iHeight)){iHeight=lastHeight;}else{iHeight=AWUtils.convertToMeter(iHeight,iSegment.getHeightUnit());}var iFromPointName=this.checkAndGetPointName(iSegment.getFromPoint());var toPointName=this.checkAndGetPointName(iSegment.getToPoint());var iHeightUnit=iSegment.getHeightUnit();var heightDistance=new HeightDistance();heightDistance.height=iHeight;heightDistance.heightUnit=iHeightUnit;heightDistance.distance=iDistance;heightDistance.fromPointName=iFromPointName;heightDistance.toPointName=toPointName;heightDistance.distanceStart=distanceSum;distanceSum=distanceSum+iDistance;heightDistanceModel.push(heightDistance);lastHeight=iHeight;}return heightDistanceModel;};this.fillEmptyHeightFromPrevious=function(routeSegments){var previousHeight='';var previousHeightUnit='';for(var i=0;i<routeSegments.length;i++){var iSegment=routeSegments[i];if(isUndefinedOrIsNull(iSegment)||isUndefinedOrIsNull(iSegment.getDistance())){continue;}if(AWUtils.isUndefinedOrIsNullOrIsEmptyString(iSegment.getHeight())===true){iSegment.height=previousHeight;iSegment.heightUnit=previousHeightUnit;}else{previousHeight=iSegment.getHeight();previousHeightUnit=iSegment.getHeightUnit();}}};this.checkAndGetPointName=function(aPoint){var retVal=null;if(isUndefinedOrIsNull(aPoint)===false&&isUndefinedOrIsNull(aPoint.getName())===false){retVal=aPoint.getName();}return retVal;};this.addClimbDescentPoints=function(aHeightDistanceModel){if(isUndefinedOrIsNullOrIsEmptyArray(aHeightDistanceModel)){return aHeightDistanceModel;}if(aHeightDistanceModel.length>0){var firstHeightDistance=this.createFirstHeightDistanceOfProfile(aHeightDistanceModel[0]);var previousHDSegment=firstHeightDistance;}var lastHDSegmentCloned=aHeightDistanceModel[aHeightDistanceModel.length-1].clone();var retVal=[];var distanceSum=0;for(var i=0;i<aHeightDistanceModel.length;i++){var iHDSegment=aHeightDistanceModel[i];if(isUndefinedOrIsNull(iHDSegment)){continue;}distanceSum+=iHDSegment.distance;if(iHDSegment.heightUnit==='VFR'){this.addVfrFlightProfilHDPointsStart(previousHDSegment,iHDSegment);if(i>=(aHeightDistanceModel.length-1)){this.addVfrFlightProfilHDPointsEnd(previousHDSegment,iHDSegment,distanceSum);}retVal=retVal.concat(iHDSegment.getFlightProfileHDPoints());previousHDSegment=iHDSegment;continue;}var previousHeight=previousHDSegment.height;var currentHeight=iHDSegment.height;if(isUndefinedOrIsNullOneOf([previousHeight,currentHeight])){previousHDSegment=iHDSegment;continue;}if(isUndefinedOrIsNull([previousHDSegment.fromPointName])){previousHDSegment.fromPointName=iHDSegment.fromPointName;}var altitudeChangePoint=this.createAltitudeChangePoint(previousHDSegment,iHDSegment,true);retVal.push(altitudeChangePoint);if(altitudeChangePoint.distance<=iHDSegment.distance){var cutDistance=this.createCutDistancePoint(iHDSegment,altitudeChangePoint.distance);retVal.push(cutDistance);}previousHDSegment=iHDSegment;}var lastSegmentHeightDistance=aHeightDistanceModel[aHeightDistanceModel.length-1];if(lastSegmentHeightDistance.heightUnit==='VFR'){}else{var arrivalProfileHeightDistance=this.createLastHeightDistanceOfProfile(distanceSum,lastSegmentHeightDistance.toPointName);var lastProfileHeightDistance=retVal[retVal.length-1];var lastProfileChangeAltHeightDistance=retVal[retVal.length-2];arrivalProfileHeightDistance.distance=lastSegmentHeightDistance.distance;var beforeAirportChangeAltitude=this.createAltitudeChangePoint(lastSegmentHeightDistance,arrivalProfileHeightDistance,true);var lastSegmentDistance=lastSegmentHeightDistance.distance;var lastSegmentDistanceHalf=lastSegmentDistance/2;if((lastProfileChangeAltHeightDistance.distance+beforeAirportChangeAltitude.distance)>lastSegmentDistance){retVal.pop();lastProfileChangeAltHeightDistance.distance=lastSegmentDistanceHalf;beforeAirportChangeAltitude.distance=lastSegmentDistanceHalf;arrivalProfileHeightDistance.segmentErrorMsg=new SegmentErrorMsgModel();lastProfileChangeAltHeightDistance.segmentErrorMsg=new SegmentErrorMsgModel();}else{lastProfileHeightDistance.distance=lastProfileHeightDistance.distance-beforeAirportChangeAltitude.distance;lastProfileHeightDistance.fromPointName=null;lastProfileHeightDistance.toPointName=null;}arrivalProfileHeightDistance.distance=beforeAirportChangeAltitude.distance;arrivalProfileHeightDistance.fromPointName=null;retVal.push(arrivalProfileHeightDistance);}return retVal;};this.addVfrFlightProfilHDPointsStart=function(aPreviousHeightDistance,aHeightDistance,aFullDistance){if(AWUtils.isUndefinedOrIsNull(aHeightDistance)===true){return;}var segmentDistance=aHeightDistance.getDistanceFloat();var climbDescentDistance=segmentDistance/5;var vfrSegmentStartAbsoluteX=aHeightDistance.getDistanceStartFloat();var vfrSegmentEndAbsoluteX=aHeightDistance.getDistanceStartFloat()+segmentDistance;var vfrReliefPoints=this.getVFRHeightDistancesBetween(vfrSegmentStartAbsoluteX,vfrSegmentEndAbsoluteX);var clonedCurrentHD=aHeightDistance.clone();clonedCurrentHD.distance=0;var previousHeightDistance=aPreviousHeightDistance.clone();if(aPreviousHeightDistance.heightUnit==='VFR'){previousHeightDistance.height=vfrReliefPoints[0].getHeightFloat();clonedCurrentHD.height=vfrReliefPoints[0].getHeightFloat();}else{clonedCurrentHD.height=previousHeightDistance.getHeightFloat();vfrReliefPoints=this.addAltitudeChangePointToVFRStart(previousHeightDistance,vfrReliefPoints);if(vfrReliefPoints.length<=0){clonedCurrentHD.distance=segmentDistance;clonedCurrentHD.height=this.getReliefHeightAtDistance(vfrSegmentEndAbsoluteX)+this.getVfrAltitudeInMeters();var segmetError=this.createErrorMessageModelSegmentIsTooShortForClimb(clonedCurrentHD);clonedCurrentHD.segmentErrorMsg=segmetError;}}var retVal=[];retVal.push(clonedCurrentHD);retVal=retVal.concat(vfrReliefPoints);if(retVal.length>=1){var lastVfrReliefPoint=retVal[retVal.length-1];aHeightDistance.height=lastVfrReliefPoint.getHeightFloat();}aHeightDistance.flightProfileHDPoints=retVal;};this.getVFRHeightDistancesBetween=function(aStartReliefX,aEndReliefX){return this.getHeightDistancesOfReliefBetween(aStartReliefX,aEndReliefX,this.getVfrAltitudeInMeters());};this.getHeightDistancesOfReliefBetween=function(aStartReliefX,aEndReliefX,aHeightShift){var heightDistanceRelief=this.getTerrainProfileAsHeightDistance();var retVal=[];var heightDistanceShift=0;var reliefX=0;let totalDistance=aEndReliefX-aStartReliefX;if(AWUtils.isUndefinedOrIsNull(heightDistanceRelief)===true){return retVal;}if(AWUtils.isNumber(aHeightShift)===true){heightDistanceShift=aHeightShift;}if(totalDistance<1){for(var i=0;i<heightDistanceRelief.length;i++){var iReliefHDPoint=heightDistanceRelief[i];if(AWUtils.isUndefinedOrIsNull(iReliefHDPoint)===true){continue;}var distance=iReliefHDPoint.getDistanceFloat();var height=iReliefHDPoint.getHeightFloat();let nearestData;nearestData=((totalDistance<distance)&&(reliefX+distance>aStartReliefX)&&(reliefX<aEndReliefX));reliefX+=distance;if(!nearestData&&(reliefX<aStartReliefX||reliefX>aEndReliefX)){continue;}var iFinalHD=new HeightDistance();iFinalHD.distance=distance;iFinalHD.height=height+heightDistanceShift;retVal.push(iFinalHD);break;}return retVal;}for(var i=0;i<heightDistanceRelief.length;i++){var iReliefHDPoint=heightDistanceRelief[i];if(AWUtils.isUndefinedOrIsNull(iReliefHDPoint)===true){continue;}var distance=iReliefHDPoint.getDistanceFloat();var height=iReliefHDPoint.getHeightFloat();let nearestData;nearestData=((totalDistance<distance)&&(reliefX+distance>aStartReliefX)&&(reliefX-distance<aEndReliefX));reliefX+=distance;if(!nearestData&&(reliefX+distance<aStartReliefX||reliefX-distance>aEndReliefX)){continue;}var iFinalHD=new HeightDistance();if(reliefX>aEndReliefX){iFinalHD.distance=reliefX-aEndReliefX;}else{iFinalHD.distance=distance;}iFinalHD.height=height+heightDistanceShift;retVal.push(iFinalHD);}return retVal;};this.addAltitudeChangePointToVFRStart=function(aPreviousHeightDistance,vfrReliefPoints){var distanceSumOfPoints=0;var crossingPoint=null;var closestPointDistance=0;var changeAltitudeType=0;if(vfrReliefPoints.length>=1){var previousHeight=0;if(AWUtils.isUndefinedOrIsNull(aPreviousHeightDistance)===false){previousHeight=aPreviousHeightDistance.getHeightFloat();}var firstVfrHeight=0;if(AWUtils.isUndefinedOrIsNull(vfrReliefPoints[0])===false){firstVfrHeight=vfrReliefPoints[0].getHeightFloat();}if(previousHeight>firstVfrHeight){changeAltitudeType=-1;}else if(previousHeight<firstVfrHeight){changeAltitudeType=1;}}for(var i=1;i<(vfrReliefPoints.length-1);i++){var iProfileReliefPoint=vfrReliefPoints[i];if(AWUtils.isUndefinedOrIsNull(iProfileReliefPoint)===true){continue;}distanceSumOfPoints+=iProfileReliefPoint.getDistanceFloat();var endHeightDistancePoint=new HeightDistance();endHeightDistancePoint.height=iProfileReliefPoint.getHeightFloat();endHeightDistancePoint.distance=distanceSumOfPoints;var altitudeChangePoint=null;if(changeAltitudeType>=0){altitudeChangePoint=this.createClimbPointAtDistance(aPreviousHeightDistance,endHeightDistancePoint);}else{altitudeChangePoint=this.createDescentPointAtDistance(aPreviousHeightDistance,endHeightDistancePoint);}var prevVfrPoint=vfrReliefPoints[i-1];var nextVfrPoint=vfrReliefPoints[i+1];var iSurroundingPosition=this.getSurroundingPositionType(prevVfrPoint,altitudeChangePoint,nextVfrPoint);if(iSurroundingPosition===0||iSurroundingPosition!==changeAltitudeType){crossingPoint=altitudeChangePoint;closestPointDistance=distanceSumOfPoints-iProfileReliefPoint.getDistanceFloat();break;}}if(AWUtils.isUndefinedOrIsNull(crossingPoint)===true){return[];}crossingPoint.distance=closestPointDistance;var distanceSum2=0;var retVal=[];retVal.push(crossingPoint);for(var j=0;j<vfrReliefPoints.length;j++){var jProfileReliefPoint=vfrReliefPoints[j];if(AWUtils.isUndefinedOrIsNull(jProfileReliefPoint)===true){continue;}distanceSum2+=jProfileReliefPoint.getDistanceFloat();if(distanceSum2>crossingPoint.getDistanceFloat()){retVal.push(jProfileReliefPoint);}}return retVal;};this.addVfrFlightProfilHDPointsEnd=function(aPreviousHDSegment,aHDSegment,distanceSum){var vfrSegmentdistanceSum=0;var destinationHeight=this.getReliefHeightAtDistance(distanceSum);var destAerodromeHD=new HeightDistance();destAerodromeHD.height=destinationHeight;var vfrFlightProfile=this.getVFRHeightDistancesBetween(aHDSegment.getDistanceStartFloat(),aHDSegment.getDistanceStartFloat()+aHDSegment.getDistanceFloat());if(AWUtils.isArray(vfrFlightProfile)===false){vfrFlightProfile=[];}var flightProfileHDPoints=aHDSegment.getFlightProfileHDPoints();if(flightProfileHDPoints.length===1){var lastHD=flightProfileHDPoints.pop();var firstHD=undefined;var startAltitudeChangeHD=lastHD;var vfrFlightProfileWitFisrt=[];}else{var lastHD=flightProfileHDPoints.pop();var firstHD=flightProfileHDPoints.shift();var startAltitudeChangeHD=flightProfileHDPoints.shift();var vfrFlightProfileWitFisrt=[firstHD];}vfrFlightProfileWitFisrt=vfrFlightProfileWitFisrt.concat(vfrFlightProfile);var distanceChangeHDToAerodrome=0;for(var i=vfrFlightProfileWitFisrt.length-1;i>=1;i--){var iVfrPoint=vfrFlightProfileWitFisrt[i];var iPrevVfrPoint=vfrFlightProfileWitFisrt[i-1];if(AWUtils.isUndefinedOrIsNull(iVfrPoint)===true||AWUtils.isUndefinedOrIsNull(iPrevVfrPoint)===true){continue;}var previousHDHeight=iPrevVfrPoint.getHeightFloat();var endChangeAltitudeHD=iVfrPoint.clone();endChangeAltitudeHD.height=previousHDHeight;distanceChangeHDToAerodrome+=endChangeAltitudeHD.getDistanceFloat();destAerodromeHD.distance=distanceChangeHDToAerodrome;var destAltitudeChangePoint=this.createAltitudeChangePoint(endChangeAltitudeHD,destAerodromeHD);if(AWUtils.isUndefinedOrIsNull(destAltitudeChangePoint.segmentErrorMsg)===true||distanceChangeHDToAerodrome>=aHDSegment.getDistanceFloat()){break;}else{vfrFlightProfileWitFisrt.pop();}}if(AWUtils.isUndefinedOrIsNull(firstHD)===true){var finalVFRFllightProfile=[];}else{var finalVFRFllightProfile=[firstHD];}if(AWUtils.isUndefinedOrIsNull(startAltitudeChangeHD)===true){var bothAltitudeChangeDistance=lastHD.getDistanceFloat()+distanceChangeHDToAerodrome;}else{var bothAltitudeChangeDistance=startAltitudeChangeHD.getDistanceFloat()+distanceChangeHDToAerodrome;}lastHD.height=destAerodromeHD.getHeightFloat();if(bothAltitudeChangeDistance>=aHDSegment.getDistanceFloat()){var halfSegmentDistance=aHDSegment.getDistanceFloat()/2;var halfSegmentReliefHeight=this.getReliefHeightAtDistance(aHDSegment.getDistanceStartFloat()+halfSegmentDistance);var halfSegmentVFRHeight=halfSegmentReliefHeight+this.getVfrAltitudeInMeters();lastHD.distance=halfSegmentDistance;var segmetLastHDError=this.createErrorMessageModelSegmentIsTooShortForDescend(lastHD);lastHD.segmentErrorMsg=segmetLastHDError;if(AWUtils.isUndefinedOrIsNull(startAltitudeChangeHD)===false){startAltitudeChangeHD.distance=halfSegmentDistance;startAltitudeChangeHD.height=halfSegmentVFRHeight;var segmetStartAltitudeError=this.createErrorMessageModelSegmentIsTooShortForDescend(startAltitudeChangeHD);startAltitudeChangeHD.segmentErrorMsg=segmetStartAltitudeError;finalVFRFllightProfile.push(startAltitudeChangeHD);}finalVFRFllightProfile.push(lastHD);}else{if(AWUtils.isUndefinedOrIsNull(startAltitudeChangeHD)===false){finalVFRFllightProfile.push(startAltitudeChangeHD);}var distanceStartToChangeHDEnd=aHDSegment.getDistanceFloat()-distanceChangeHDToAerodrome;var distanceToChangeHDEnd=0;for(var i=0;i<vfrFlightProfile.length;i++){if(AWUtils.isUndefinedOrIsNull(startAltitudeChangeHD)===true){continue;}var iFlightProfileHD=vfrFlightProfile[i];if(AWUtils.isUndefinedOrIsNull(iFlightProfileHD)===true){continue;}distanceToChangeHDEnd+=iFlightProfileHD.getDistanceFloat();if(startAltitudeChangeHD.getDistanceFloat()<=distanceToChangeHDEnd&&distanceToChangeHDEnd<distanceStartToChangeHDEnd){finalVFRFllightProfile.push(iFlightProfileHD);}}lastHD.distance=distanceChangeHDToAerodrome;finalVFRFllightProfile.push(lastHD);}aHDSegment.flightProfileHDPoints=finalVFRFllightProfile;};this.getSurroundingPositionType=function(prevVfrPoint,altitudeChangePoint,nextVfrPoint){var between=this.isPointBetweenSurroundingAltitudes(prevVfrPoint,altitudeChangePoint,nextVfrPoint);var above=this.isPointAboveSurroundingAltitudes(prevVfrPoint,altitudeChangePoint,nextVfrPoint);var under=this.isPointUnderSurroundingAltitudes(prevVfrPoint,altitudeChangePoint,nextVfrPoint);var iSurroundingPosition=0;if(above===true){iSurroundingPosition=1;}else if(under===true){iSurroundingPosition=-1;}return iSurroundingPosition;};this.isPointBetweenSurroundingAltitudes=function(aStartPoint,aMidlePoint,aEndPoint){if(AWUtils.isUndefinedOrIsNull(aStartPoint)===true||AWUtils.isUndefinedOrIsNull(aMidlePoint)===true||AWUtils.isUndefinedOrIsNull(aEndPoint)===true){return false;}var startHeight=aStartPoint.getHeightFloat();var middleHeight=aMidlePoint.getHeightFloat();var endHeight=aEndPoint.getHeightFloat();if((startHeight<=middleHeight&&endHeight>=middleHeight)||(startHeight>=middleHeight&&endHeight<=middleHeight)){return false;}else{return true;}};this.isPointAboveSurroundingAltitudes=function(aStartPoint,aMidlePoint,aEndPoint){if(AWUtils.isUndefinedOrIsNull(aStartPoint)===true||AWUtils.isUndefinedOrIsNull(aMidlePoint)===true||AWUtils.isUndefinedOrIsNull(aEndPoint)===true){return false;}var startHeight=aStartPoint.getHeightFloat();var middleHeight=aMidlePoint.getHeightFloat();var endHeight=aEndPoint.getHeightFloat();if(startHeight<middleHeight&&endHeight<middleHeight){return false;}else{return true;}};this.isPointUnderSurroundingAltitudes=function(aStartPoint,aMidlePoint,aEndPoint){if(AWUtils.isUndefinedOrIsNull(aStartPoint)===true||AWUtils.isUndefinedOrIsNull(aMidlePoint)===true||AWUtils.isUndefinedOrIsNull(aEndPoint)===true){return false;}var startHeight=aStartPoint.getHeightFloat();var middleHeight=aMidlePoint.getHeightFloat();var endHeight=aEndPoint.getHeightFloat();if(startHeight>middleHeight&&endHeight>middleHeight){return false;}else{return true;}};this.createAltitudeChangePointAtDistance=function(aStartHeightDistance,aEndHeightDistance){var retVal=null;var startHeight=aStartHeightDistance.getHeightFloat();var endHeight=aEndHeightDistance.getHeightFloat();var climbPoint=null;var descentPoint=null;if(startHeight<endHeight){climbPoint=this.createClimbPointAtDistance(aStartHeightDistance,aEndHeightDistance);retVal=climbPoint;}else if(startHeight>endHeight){descentPoint=this.createDescentPointAtDistance(aStartHeightDistance,aEndHeightDistance);retVal=descentPoint;}else{var sameHightPoint=this.createDescentPointAtDistance(aStartHeightDistance,aEndHeightDistance);retVal=sameHightPoint;}return retVal;};this.createClimbPointAtDistance=function(aStartHeightDistance,aEndHeightDistance){var climbAngle=this.getFlightClimbAngle();var height=(aEndHeightDistance.getDistanceFloat()*Math.tan(climbAngle));var retVal=new HeightDistance();retVal.height=height+aStartHeightDistance.getHeightFloat();if(height>aEndHeightDistance.getHeightFloat()){retVal.height=aEndHeightDistance.getHeightFloat();}retVal.fromPointName=aEndHeightDistance.fromPointName;retVal.toPointName=aEndHeightDistance.toPointName;retVal.distance=aEndHeightDistance.getDistanceFloat();return retVal;};this.createDescentPointAtDistance=function(aStartHeightDistance,aEndHeightDistance){var descentAngle=this.getFlightDescentAngle();var height=(aEndHeightDistance.getDistanceFloat()*Math.tan(descentAngle));var retVal=new HeightDistance();retVal.height=aStartHeightDistance.getHeightFloat()-height;if(retVal.getHeightFloat()<0){retVal.height=0;}retVal.fromPointName=aEndHeightDistance.fromPointName;retVal.toPointName=aEndHeightDistance.toPointName;retVal.distance=aEndHeightDistance.getDistanceFloat();return retVal;};this.getMaxHeightPoint=function(aHeightDistancePoints){var retVal=null;if(AWUtils.isUndefinedOrIsNull(aHeightDistancePoints)===true){return retVal;}return this.getValidHeightDistanceOfAll(aHeightDistancePoints,function(aLastValidHeightDistance,iHeightDistance){return aLastValidHeightDistance.getHeightFloat()<iHeightDistance.getHeightFloat();});};this.getMinHeightPoint=function(aHeightDistancePoints){var retVal=null;if(AWUtils.isUndefinedOrIsNull(aHeightDistancePoints)===true){return retVal;}return this.getValidHeightDistanceOfAll(aHeightDistancePoints,function(aLastValidHeightDistance,iHeightDistance){return aLastValidHeightDistance.getHeightFloat()>iHeightDistance.getHeightFloat();});};this.getValidHeightDistanceOfAll=function(aHeightDistancePoints,aIsItemValidFnc){var retVal=null;if(AWUtils.isUndefinedOrIsNull(aHeightDistancePoints)===true||AWUtils.isUndefinedOrIsNull(aIsItemValidFnc)===true){return retVal;}aHeightDistancePoints.forEach(function(iHeightDistance,aIndex){if(AWUtils.isUndefinedOrIsNull(iHeightDistance)===true){return;}if(retVal===null){retVal=iHeightDistance;return;}if(aIsItemValidFnc(retVal,iHeightDistance)===true){retVal=iHeightDistance;}});return retVal;};this.createAltitudeChangePoint=function(previousHeightDistance,iHeightDistance,aDoDistanceCheck){var retVal=null;var previousHeight=previousHeightDistance.height;var currentHeight=iHeightDistance.height;var climbPoint=null;var descentPoint=null;if(previousHeight<currentHeight){climbPoint=this.createClimbPoint(previousHeightDistance,iHeightDistance,aDoDistanceCheck);retVal=climbPoint;}else if(previousHeight>currentHeight){descentPoint=this.createDescentPoint(previousHeightDistance,iHeightDistance,aDoDistanceCheck);retVal=descentPoint;}else{var sameHightPoint=this.createDescentPoint(previousHeightDistance,iHeightDistance,aDoDistanceCheck);retVal=sameHightPoint;}return retVal;};this.createFirstHeightDistanceOfProfile=function(aHeightDistance){return this.createHeightDistanceOfProfileAtDistance(0,aHeightDistance.fromPointName);};this.createLastHeightDistanceOfProfile=function(aDistance,aPointName){var retVal=this.createHeightDistanceOfProfileAtDistance(aDistance,aPointName);retVal.distance=0;return retVal;};this.createHeightDistanceOfProfileAtDistance=function(aDistance,aName){var heightAtDistance=this.getReliefHeightAtDistance(aDistance);var retVal=new HeightDistance();retVal.height=heightAtDistance;retVal.distance=aDistance;retVal.fromPointName=aName;retVal.toPointName=aName;return retVal;};this.createErrorMessageModelSegmentIsTooShortForDescend=function(aHeightDistance){var retVal=this.createErrorMessageModelSegment(aHeightDistance);retVal.title=getLocalizedString("FlightProfile.tooSmallSegmet");retVal.message=getLocalizedString('FlightProfile.segmentIsTooSmallForDescend');return retVal;};this.createErrorMessageModelSegmentIsTooShortForClimb=function(aHeightDistance){var retVal=this.createErrorMessageModelSegment(aHeightDistance);retVal.title=getLocalizedString("FlightProfile.tooSmallSegmet");retVal.message=getLocalizedString('FlightProfile.segmentIsTooSmallForClimb');return retVal;};this.createErrorMessageModelSegment=function(aHeightDistance){var retVal=new SegmentErrorMsgModel();var fromPointName=HtmlUtils.C_EMPTY;if(AWUtils.isUndefinedOrIsNull(aHeightDistance.fromPointName)===false){fromPointName=aHeightDistance.fromPointName;}var toPointName=HtmlUtils.C_EMPTY;if(AWUtils.isUndefinedOrIsNull(aHeightDistance.toPointName)===false){toPointName=aHeightDistance.toPointName;}retVal.segmentName=fromPointName+" - "+toPointName;retVal.segmentHeight=aHeightDistance.height;retVal.segmentDistance=aHeightDistance.distance;return retVal;};this.createClimbPoint=function(previousHeightDistance,iHeightDistance,aDoDistanceCheck){var climbAngle=this.getFlightClimbAngle();var distance=((iHeightDistance.height-previousHeightDistance.height)/Math.tan(climbAngle));var retVal=new HeightDistance();retVal.distance=distance;if(distance>iHeightDistance.distance){retVal.distance=iHeightDistance.distance;if(this.isFlightVFR()===false){var segmetClimbError=this.createErrorMessageModelSegmentIsTooShortForClimb(iHeightDistance);retVal.segmentErrorMsg=segmetClimbError;}}retVal.fromPointName=iHeightDistance.fromPointName;retVal.toPointName=iHeightDistance.toPointName;retVal.height=iHeightDistance.height;return retVal;};this.isClimbDistanceCheckEnabled=function(){if(AWUtils.isBoolean(this.mClimbDistanceCheckEnablity)===false){return false;}else{return this.mClimbDistanceCheckEnablity;}};this.setClimbDistanceCheck=function(aEnabled){if(AWUtils.isBoolean(aEnabled)===false){this.mClimbDistanceCheckEnablity=false;}else{this.mClimbDistanceCheckEnablity=aEnabled;}};this.createDescentPoint=function(previousHeightDistance,iHeightDistance,aDoDistanceCheck){var descentAngle=this.getFlightDescentAngle();var distance=((previousHeightDistance.height-iHeightDistance.height)/Math.tan(descentAngle));var retVal=new HeightDistance();if(distance>iHeightDistance.distance){retVal.distance=iHeightDistance.distance;if(this.isFlightVFR()===false){var segmetDescentError=this.createErrorMessageModelSegmentIsTooShortForDescend(iHeightDistance);retVal.segmentErrorMsg=segmetDescentError;}}else{retVal.distance=distance;}retVal.height=iHeightDistance.height;retVal.fromPointName=iHeightDistance.fromPointName;retVal.toPointName=iHeightDistance.toPointName;return retVal;};this.isDescentDistanceCheckEnabled=function(){if(AWUtils.isBoolean(this.mDescentDistanceCheckEnablity)===false){return false;}else{return this.mDescentDistanceCheckEnablity;}};this.setDescentDistanceCheck=function(aEnabled){if(AWUtils.isBoolean(aEnabled)===false){this.mDescentDistanceCheckEnablity=false;}else{this.mDescentDistanceCheckEnablity=aEnabled;}};this.createCutDistancePoint=function(aHeightDistance,aDistance){var retVal=new HeightDistance();retVal.distance=aHeightDistance.distance-aDistance;retVal.height=aHeightDistance.height;retVal.fromPointName=null;retVal.toPointName=null;return retVal;};this.getFlightClimbAngle=function(){var horizontalSpeed=this.getFlightClimbIas()*this.mUnit2M_S[this.getFlightClimbIasUnit()];var verticalSpeed=this.getFlightClimbRate()*this.mUnit2M_S[this.getFlightClimbRateUnit()];var climbLength=Math.sqrt((verticalSpeed*verticalSpeed)+(horizontalSpeed*horizontalSpeed));var climbAngle=0;if(climbLength!==0){climbAngle=Math.asin(verticalSpeed/climbLength);}return climbAngle;};this.getFlightDescentAngle=function(){var horizontalSpeed=this.getFlightDescentIas()*this.mUnit2M_S[this.getFlightDescentIasUnit()];var verticalSpeed=this.getFlightDescentRate()*this.mUnit2M_S[this.getFlightDescentRateUnit()];var descentLength=Math.sqrt((verticalSpeed*verticalSpeed)+(horizontalSpeed*horizontalSpeed));var descentAngle=0;if(descentLength!==0){descentAngle=Math.asin(verticalSpeed/descentLength);}return descentAngle;};this.getLowestReliefHeightBetweenDistances=function(aStartDistance,aEndDistance){var minHeightFnc=function(aHeight,aAtDistance){if(AWUtils.isNumber(aHeight)===false){return false;}if(AWUtils.isUndefinedOrIsNull(minHeightFnc.mMinHeight)===true){minHeightFnc.mMinHeight=aHeight;}if(minHeightFnc.mMinHeight>aHeight){minHeightFnc.mMinHeight=aHeight;}return false;};this.getFilteredReliefHeightsBetweenDistances(aStartDistance,aEndDistance,minHeightFnc);return minHeightFnc.mMinHeight;};this.getHighetsReliefHeightBetweenDistances=function(aStartDistance,aEndDistance){var maxHeightFnc=function(aHeight,aAtDistance){if(AWUtils.isNumber(aHeight)===false){return false;}if(AWUtils.isUndefinedOrIsNull(maxHeightFnc.mMaxHeight)===true){maxHeightFnc.mMaxHeight=aHeight;}if(maxHeightFnc.mMaxHeight<aHeight){maxHeightFnc.mMaxHeight=aHeight;}return false;};this.getFilteredReliefHeightsBetweenDistances(aStartDistance,aEndDistance,maxHeightFnc);return maxHeightFnc.mMaxHeight;};this.getFilteredReliefHeightsBetweenDistances=function(aStartDistance,aEndDistance,aTestFnc){if(isUndefinedOrIsNull(this.mRelief)||AWUtils.isUndefinedOrIsNull(this.mRelief.getHeightStep())===true||AWUtils.isNumber(aStartDistance)===false||AWUtils.isNumber(aEndDistance)===false||AWUtils.isUndefinedOrIsNull(aTestFnc)===true){return null;}aStartDistance=Number(aStartDistance);aEndDistance=Number(aEndDistance);var retVal=[];var heightStep=Number(this.mRelief.getHeightStep());aEndDistance+=heightStep;var currentDistance=aStartDistance;var currentHeight=null;while(currentDistance<aEndDistance){currentHeight=this.getReliefHeightAtDistance(currentDistance);if(currentHeight===null){continue;}if(aTestFnc(currentHeight,currentDistance)===true){retVal.push(currentHeight);}currentDistance+=heightStep;}return retVal;};this.getReliefHeightAtDistance=function(aDistance){if(isUndefinedOrIsNull(aDistance)){return null;}if(isUndefinedOrIsNull(this.mRelief)){return null;}var heights=this.mRelief.getHeights();var heightStep=this.mRelief.getHeightStep();if(isUndefinedOrIsNullOrIsEmptyArray(heights)||isUndefinedOrIsNull(heightStep)){return null;}heightStep=Number(heightStep);var heightStepSum=0;var retVal=0;for(var i=0;(i<heights.length&&heightStepSum<=aDistance);i++){var iHeight=heights[i];if(!isUndefinedOrIsNull(iHeight)){retVal=Number(heights[i]);}heightStepSum=heightStepSum+heightStep;}return retVal;};this.getZeroPointView=function(){var xZeroValue=this.chart_lines_padding_left;var yZeroValue=(this.background_height+this.y_shift-this.axis_line_padding_bottom);return{x:xZeroValue,y:yZeroValue};};this.createTerrainProfileLayer=function(){var terrainPoints=this.getTerrainProfilePointsView();if(isUndefinedOrIsNullOrIsEmptyArray(terrainPoints)){return'';}var pointString=this.buildStringFromPoints(terrainPoints);if(isUndefinedOrIsNullOrIsEmptyString(pointString)){return'';}var path=this.createEmptyElementString('path',{"style":'fill:'+this.terrain_profile_colour+';stroke:'+this.terrain_profile_colour+';stroke-width:1;stroke-linecap:butt;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none',"d":'M '+pointString,"id":"path3892","inkscape:connector-curvature":"0"});return this.createSvgGroupString(path,{"inkscape:groupmode":"layer","id":"layer4","class":"zoomable","inkscape:label":"Terrain Profile","sodipodi:insensitive":"true","style":"display:inline"});};this.getTerrainProfilePointsView=function(){if(isUndefinedOrIsNull(this.mRelief)){return[];}var heightDistance=this.getTerrainProfileAsHeightDistance();if(isUndefinedOrIsNullOrIsEmptyArray(heightDistance)){return[];}var scaledHeightDistanceView=this.scaleHeightDistanceModel2View(heightDistance);if(isUndefinedOrIsNullOrIsEmptyArray(scaledHeightDistanceView)){return[];}var svgPathPoints=this.convertHeightDistanceModel2SvgPathModel(scaledHeightDistanceView);if(isUndefinedOrIsNullOrIsEmptyArray(svgPathPoints)){return[];}var zeroPoint=[this.getZeroPointView(),this.getZeroPointViewOfRelief()];svgPathPoints=zeroPoint.concat(svgPathPoints);svgPathPoints[svgPathPoints.length]={x:svgPathPoints[(svgPathPoints.length-1)].x,y:this.getZeroPointView().y};return svgPathPoints;};this.getZeroPointViewOfRelief=function(){if(this.mZeroPointViewOfRelief!==null){return this.mZeroPointViewOfRelief;}if(isUndefinedOrIsNull(this.mRelief)||isUndefinedOrIsNullOrIsEmptyArray(this.mRelief.getHeights())){return this.getZeroPointView();}var heights=this.mRelief.getHeights();var heightEdges=this.getHeightEdges(heights);if(isUndefinedOrIsNull(heightEdges)){return this.getZeroPointView();}this.mZeroPointViewOfRelief={x:this.getZeroPointView().x,y:this.getZeroPointView().y-(heights[0]*mScaleY)};return this.mZeroPointViewOfRelief;};this.scaleHeightDistanceModel2View=function(aHeightDistanceModel){var retVal=[];if(isUndefinedOrIsNullOrIsEmptyArray(aHeightDistanceModel)||isUndefinedOrIsNullOneOf([scaleX,mScaleY])){return retVal;}for(var i=0;i<aHeightDistanceModel.length;i++){var iHeightDistance=aHeightDistanceModel[i];if(isUndefinedOrIsNull(iHeightDistance)||isUndefinedOrIsNullOneOf([iHeightDistance.height,iHeightDistance.distance])){continue;}var newHeightDistance=new HeightDistance();newHeightDistance.height=(iHeightDistance.height*mScaleY);newHeightDistance.distance=(iHeightDistance.distance*scaleX);newHeightDistance.fromPointName=iHeightDistance.fromPointName;newHeightDistance.toPointName=iHeightDistance.toPointName;newHeightDistance.segmentErrorMsg=iHeightDistance.segmentErrorMsg;retVal.push(newHeightDistance);}return retVal;};this.convertHeightDistanceModel2SvgPathModel=function(aHeightDistance){var retVal=[];if(isUndefinedOrIsNullOrIsEmptyArray(aHeightDistance)){return retVal;}var viewPoints=[];var zeroY=this.getZeroPointView().y;var zeroX=this.getZeroPointView().x;var distance_sum=0;for(var i=0;i<aHeightDistance.length;i++){try{var currentHeightDistance=aHeightDistance[i];if(isUndefinedOrIsNull(currentHeightDistance)||isUndefinedOrIsNullOneOf([currentHeightDistance.height,currentHeightDistance.distance])){continue;}var height=Number(currentHeightDistance.height);var distance=Number(currentHeightDistance.distance);distance_sum=distance_sum+distance;viewPoints.push({x:(zeroX+distance_sum),y:(zeroY-height)});}catch(ex){}}return viewPoints;};this.convertHeightDistanceModel2SvgErrorPathArray=function(aHeightDistances){var retVal=[];if(isUndefinedOrIsNullOrIsEmptyArray(aHeightDistances)){return retVal;}var viewPoints=[];var errorPoints=[];var zeroY=this.getZeroPointView().y;var zeroX=this.getZeroPointView().x;var distance_sum=0;for(var i=0;i<aHeightDistances.length;i++){try{var iHeightDistance=aHeightDistances[i];if(isUndefinedOrIsNull(iHeightDistance)||isUndefinedOrIsNullOneOf([iHeightDistance.height,iHeightDistance.distance])){continue;}var height=Number(iHeightDistance.height);var distance=Number(iHeightDistance.distance);distance_sum=distance_sum+distance;viewPoints.push({x:(zeroX+distance_sum),y:(zeroY-height)});if(AWUtils.isUndefinedOrIsNull(iHeightDistance.segmentErrorMsg)===false){var viewPointsCount=viewPoints.length;var iStartErrorPoint=viewPoints[viewPointsCount-2];var iEndErrorPoint=viewPoints[viewPointsCount-1];errorPoints.push([iStartErrorPoint,iEndErrorPoint]);}}catch(ex){}}return errorPoints;};this.getHeightDistanceEdges=function(aHeightDistanceModel){var retVal={heightMin:null,heightMax:null,distanceSum:null};if(isUndefinedOrIsNullOrIsEmptyArray(aHeightDistanceModel)){retVal.heightMin=0;retVal.heightMax=0;retVal.distanceSum=0;return retVal;}for(var i=0;i<aHeightDistanceModel.length;i++){try{var iEntry=aHeightDistanceModel[i];if(isUndefinedOrIsNull(iEntry)||isUndefinedOrIsNullOneOf([iEntry.height,iEntry.distance])){continue;}var thisHeight=Number(iEntry.height);var thisDistance=Number(iEntry.distance);if(retVal.heightMin===null){retVal.heightMin=thisHeight;}else if(retVal.heightMin>thisHeight){retVal.heightMin=thisHeight;}if(retVal.heightMax===null){retVal.heightMax=thisHeight;}else if(retVal.heightMax<thisHeight){retVal.heightMax=thisHeight;}if(retVal.distanceSum===null){retVal.distanceSum=thisDistance;}else{retVal.distanceSum=retVal.distanceSum+thisDistance;}}catch(e){dump('Error: During getHeightDistanceEdges:  '+e);}}return retVal;};this.cutHighestData=function(){var heightCutLimit=this.getHeightCutLimit();if(isUndefinedOrIsNull(heightCutLimit)||heightCutLimit<=0){return;}this.cutAreaHeights(heightCutLimit);};this.getHeightCutLimit=function(){var retVal=0;var reliexMax=this.getReliefMaxYRange();if(reliexMax!==undefined&&reliexMax!==null&&reliexMax>retVal){retVal=reliexMax;}var flightMax=this.getFlightMaxYRange();if(flightMax!==undefined&&flightMax!==null&&flightMax>retVal){retVal=flightMax;}return retVal;};this.cutAreaHeights=function(aCutLimit){this.areas_cutted=[];if(isUndefinedOrIsNull(this.mRelief)||isUndefinedOrIsNull(aCutLimit)){return;}var areas=this.mRelief.getAreasWithoutFirs();if(isUndefinedOrIsNullOrIsEmptyArray(areas)){return;}for(var i=0;i<areas.length;i++){var iArea=areas[i];if(isUndefinedOrIsNull(iArea)){continue;}var clonedArea=iArea.clone();this.cutAreaHeight(aCutLimit,clonedArea);this.areas_cutted.push(clonedArea);}};this.cutAreaHeight=function(aCutLimit,iArea){var rectangles=iArea.getRectangle();if(isUndefinedOrIsNullOrIsEmptyArray(rectangles)){return;}var clonedRectangle=rectangles.concat([]);rectangles.length=0;for(var k=0;k<clonedRectangle.length;k++){var kRectangle=clonedRectangle[k];if(AWUtils.isUndefinedOrIsNull(kRectangle)===true){continue;}kRectangle.setCutHeightLimit(aCutLimit);var y1=Number(kRectangle.getY1());var y2=Number(kRectangle.getY2());if(y1!==undefined&&y1!==null&&y1>aCutLimit){continue;}if(y2!==undefined&&y2!==null&&y2>aCutLimit){y2=aCutLimit;kRectangle.setY2(y2);iArea.isCut=true;}rectangles.push(kRectangle);}};this.initDashSteps=function(){for(var i=0;i<this.axis_x_dash_steps.length;i++){var iAxisXDashStep=this.axis_x_dash_steps[i];iAxisXDashStep.setAxisLength(this.getXAxisLength());iAxisXDashStep.setScaleFactor(scaleX);iAxisXDashStep.setMinimalDashStep(this.axis_x_minimal_dash_step);}for(var i=0;i<this.axis_y_dash_steps.length;i++){var iAxisYDashStep=this.axis_y_dash_steps[i];iAxisYDashStep.setAxisLength(this.getYAxisLength());iAxisYDashStep.setScaleFactor(mScaleY);iAxisYDashStep.setMinimalDashStep(this.axis_y_minimal_dash_step);}};this.initScaleFactors=function(){this.initScaleFactorX();this.initScaleFactorY();};this.initScaleFactorX=function(){var maxX=this.getMaxXRange();if(isUndefinedOrIsNull(maxX)){scaleX=1;}else{scaleX=this.getStepScaleViewX(maxX);}};this.initScaleFactorY=function(){var maxY=this.getMaxYRange();if(isUndefinedOrIsNull(maxY)){mScaleY=1;}else{mScaleY=this.getStepScaleViewY(maxY);}};this.getMaxXRange=function(){var retVal=0;var reliefMaxXRange=this.getReliefMaxXRange();if(reliefMaxXRange&&reliefMaxXRange>retVal){retVal=reliefMaxXRange;}var flightMaxXRange=this.getFlightMaxXRange();if(flightMaxXRange&&flightMaxXRange>retVal){retVal=flightMaxXRange;}var areaMaxXRange=this.getAreaMaxXRange();if(areaMaxXRange&&areaMaxXRange>retVal){retVal=areaMaxXRange;}var pointMaxXRange=this.getPointMaxXRange();if(pointMaxXRange&&pointMaxXRange>retVal){retVal=pointMaxXRange;}return retVal;};this.getReliefMaxXRange=function(){if(isUndefinedOrIsNull(this.mRelief)||isUndefinedOrIsNull(this.mRelief.getHeights())){return 0;}var heights=this.mRelief.getHeights();var heightStep=Number(this.mRelief.getHeightStep());if(isUndefinedOrIsNullOrIsEmptyArray(heights)||isUndefinedOrIsNull(heightStep)){return 0;}var absolutRangeX=heights.length*heightStep;return absolutRangeX;};this.getFlightMaxXRange=function(){if(isUndefinedOrIsNull(this.mFlight)||isUndefinedOrIsNull(this.mFlight.getRoute())||isUndefinedOrIsNullOrIsEmptyArray(this.mFlight.getRoute().getSegments())){return 0;}var sumRoute=0;var segments=this.mFlight.getRoute().getSegments();for(var i=0;i<segments.length;i++){var iSegment=segments[i];if(isUndefinedOrIsNull(iSegment)||isUndefinedOrIsNull(iSegment.getDistance())){continue;}var distance=Number(iSegment.getDistance());sumRoute=sumRoute+distance;}return sumRoute;};this.getAreaMaxXRange=function(){if(isUndefinedOrIsNull(this.mRelief)||isUndefinedOrIsNullOrIsEmptyArray(this.areas_cutted)){return 0;}var areas=this.areas_cutted;var maxXRange=0;for(var i=0;i<areas.length;i++){var iArea=areas[i];if(isUndefinedOrIsNull(iArea)||isUndefinedOrIsNullOrIsEmptyArray(iArea.getRectangle())){continue;}var rectangles=iArea.getRectangle();for(var j=0;j<rectangles.length;j++){if(isUndefinedOrIsNull(rectangles[j])||isUndefinedOrIsNull(rectangles[j].getX2())){continue;}var x2=Number(rectangles[j].getX2());if(x2>maxXRange){maxXRange=x2;}}}return maxXRange;};this.getPointMaxXRange=function(){if(isUndefinedOrIsNull(this.mRelief)||isUndefinedOrIsNullOrIsEmptyArray(this.mRelief.getPoints())){return 0;}var points=this.mRelief.getPoints();var maxDistance=0;for(var i=0;i<points.length;i++){var iPoint=points[i];if(isUndefinedOrIsNull(iPoint)||isUndefinedOrIsNull(iPoint.getDistance())){continue;}var distance=Number(iPoint.getDistance());if(distance>maxDistance){maxDistance=distance;}}return maxDistance;};this.getReliefMaxYRange=function(){if(isUndefinedOrIsNull(this.mRelief)||isUndefinedOrIsNullOrIsEmptyArray(this.mRelief.getHeights())){return 0;}var heights=this.mRelief.getHeights();var heightEdges=this.getHeightEdges(heights);if(isUndefinedOrIsNull(heightEdges)||isUndefinedOrIsNullOneOf([heightEdges.min,heightEdges.max])){return 0;}var absolutRangeY=heightEdges.max-heightEdges.min;return absolutRangeY;};this.getMaxYRange=function(){var retVal=0;var reliefMaxYRange=this.getReliefMaxYRange();if(reliefMaxYRange&&reliefMaxYRange>retVal){retVal=reliefMaxYRange;}var flightMaxYRange=this.getFlightMaxYRange();if(flightMaxYRange&&flightMaxYRange>retVal){retVal=flightMaxYRange;}var areaMaxYRange=this.getAreaMaxYRange();if(areaMaxYRange&&areaMaxYRange>retVal){retVal=areaMaxYRange;}var pointMaxYRange=this.getPointMaxYRange();if(pointMaxYRange&&pointMaxYRange>retVal){retVal=pointMaxYRange;}return retVal;};this.getReliefMaxYRange=function(){if(isUndefinedOrIsNull(this.mRelief)||isUndefinedOrIsNullOrIsEmptyArray(this.mRelief.getHeights())||isUndefinedOrIsNull(this.mRelief.getHeightStep())||this.mRelief.getHeightStep()<=0){return 0;}var heights=this.mRelief.getHeights();var maxHeight=0;for(var i=0;i<heights.length;i++){var iHeight=heights[i];if(isUndefinedOrIsNull(iHeight)){continue;}iHeight=Number(iHeight);if(iHeight>maxHeight){maxHeight=iHeight;}}return maxHeight;};this.getFlightMaxYRange=function(){if(isUndefinedOrIsNull(this.mFlight)||isUndefinedOrIsNull(this.mFlight.getRoute())||isUndefinedOrIsNullOrIsEmptyArray(this.mFlight.getRoute().getSegments())){return 0;}var maxHeight=null;var segments=this.mFlight.getRoute().getSegments();var absoluteDistance=0;for(var i=0;i<segments.length;i++){var iSegment=segments[i];if(isUndefinedOrIsNull(iSegment)||isUndefinedOrIsNull(iSegment.getHeight())||AWUtils.isUndefinedOrIsNull(iSegment.getHeightUnit())){continue;}var height=null;if(iSegment.getHeightUnit().toLowerCase()==='vfr'){var maxVFRHeight=this.getHighetsReliefHeightBetweenDistances(absoluteDistance,absoluteDistance+Number(iSegment.getDistance()));height=maxVFRHeight+this.getVfrAltitudeInMeters();}else{var segmentHeight=Number(iSegment.getHeight());height=AWUtils.convertToMeter(segmentHeight,iSegment.getHeightUnit());}absoluteDistance+=iSegment.getDistance();if(isUndefinedOrIsNull(height)){continue;}if(height>maxHeight){maxHeight=height;}}if(isUndefinedOrIsNull(maxHeight)){if(!isUndefinedOrIsNull(this.mFlight.getFlevel())&&!isUndefinedOrIsNull(this.mFlight.getFlevelUnit())){maxHeight=AWUtils.convertToMeter(this.mFlight.getFlevel(),this.mFlight.getFlevelUnit());}}var verticalBuffer=this.mRelief.getRouteVerticalBuffer();var verticalBufferUnit=this.mRelief.getRouteVerticalBufferUnit();if(AWUtils.isUndefinedOrIsNull(verticalBuffer)===false&&AWUtils.isUndefinedOrIsNull(verticalBufferUnit)===false&&maxHeight!==null){maxHeight+=AWUtils.convertToMeter(verticalBuffer,verticalBufferUnit,this.height_top_buffer);}if(isUndefinedOrIsNull(maxHeight)){maxHeight=0;}return maxHeight;};this.getAreaMaxYRange=function(){if(isUndefinedOrIsNull(this.mRelief)){return 0;}var areas=this.areas_cutted;if(isUndefinedOrIsNullOrIsEmptyArray(areas)){return 0;}var maxYRange=0;for(var i=0;i<areas.length;i++){var iArea=areas[i];if(isUndefinedOrIsNull(iArea)||isUndefinedOrIsNullOrIsEmptyArray(iArea.getRectangle())){continue;}var rectangles=iArea.getRectangle();for(var j=0;j<rectangles.length;j++){if(isUndefinedOrIsNull(rectangles[j])||isUndefinedOrIsNull(rectangles[j].getY2())){continue;}var y2=Number(rectangles[j].getY2());if(y2>maxYRange){maxYRange=y2;}}}return maxYRange;};this.getPointMaxYRange=function(){return 0;};this.mTerrainProfileHeightDistance=null;this.getTerrainProfileAsHeightDistance=function(){if(this.mTerrainProfileHeightDistance===null){if(AWUtils.isUndefinedOrIsNull(this.mRelief)===true){this.mTerrainProfileHeightDistance=[];}else{this.mTerrainProfileHeightDistance=this.convertTerrainProfile2HeightDistance(this.mRelief);}}return this.mTerrainProfileHeightDistance;};this.convertTerrainProfile2HeightDistance=function(aRelief){var heightDistanceModel=[];if(isUndefinedOrIsNull(aRelief)||isUndefinedOrIsNullOrIsEmptyArray(aRelief.getHeights())||isUndefinedOrIsNull(aRelief.getHeightStep())){return heightDistanceModel;}var heights=aRelief.getHeights();var step=aRelief.getHeightStep();for(var i=0;i<heights.length;i++){var iHeight=heights[i];if(isUndefinedOrIsNull(iHeight)){continue;}var heightDistance=new HeightDistance();heightDistance.height=iHeight;heightDistance.distance=step;heightDistanceModel.push(heightDistance);}return heightDistanceModel;};this.getStepScaleViewY=function(aRangeY){var yAxisLength=this.getYAxisLength();if(isUndefinedOrIsNull(aRangeY)||isUndefinedOrIsNull(yAxisLength)||yAxisLength<=0){return 1;}return yAxisLength/((aRangeY===undefined||aRangeY===null||aRangeY===0)?1:aRangeY);};this.getStepScaleViewX=function(aRangeX){var xAxisLength=this.getXAxisLength();if(isUndefinedOrIsNull(aRangeX)||isUndefinedOrIsNull(xAxisLength)||xAxisLength<=0){return 1;}return(xAxisLength)/((aRangeX===undefined||aRangeX===null||aRangeX===0)?1:aRangeX);};this.getHeightEdges=function(aHeights){if(this.mHeightEdges!==null){return this.mHeightEdges;}var retVal={min:null,max:null};if(isUndefinedOrIsNullOrIsEmptyArray(aHeights)){retVal.min=0;retVal.max=0;return retVal;}for(var i=0;i<aHeights.length;i++){try{var iHeight=aHeights[i];if(isUndefinedOrIsNull(iHeight)){continue;}iHeight=Number(iHeight);if(retVal.min===null){retVal.min=iHeight;}else if(retVal.min>iHeight){retVal.min=iHeight;}if(retVal.max===null){retVal.max=iHeight;}else if(retVal.max<iHeight){retVal.max=iHeight;}}catch(e){dump('Error: during getHeightEdges : '+e);}}this.mHeightEdges=retVal;return this.mHeightEdges;};this.buildStringFromPoints=function(aPoints){if(isUndefinedOrIsNullOrIsEmptyArray(aPoints)){return'';}var pointsString='';for(var i=0;i<aPoints.length;i++){var iCurrentPoint=aPoints[i];if(isUndefinedOrIsNull(iCurrentPoint)||isUndefinedOrIsNullOneOf([iCurrentPoint.x,iCurrentPoint.y])){continue;}pointsString=pointsString+' '+iCurrentPoint.x+','+iCurrentPoint.y;}return pointsString;};this.createAreasLayer=function(){if(isUndefinedOrIsNull(this.mRelief)||isUndefinedOrIsNullOrIsEmptyArray(this.areas_cutted)){return'';}var areas=this.areas_cutted;var areasRectanglesViews=[];for(var i=0;i<areas.length;i++){var iArea=areas[i];if(isUndefinedOrIsNull(iArea)||isUndefinedOrIsNullOrIsEmptyArray(iArea.getRectangle())){continue;}var areaRectanglesViews=this.createAreaRectanglesViews(iArea);areasRectanglesViews=areasRectanglesViews.concat(areaRectanglesViews);}return this.createAreasSvgGroup(areasRectanglesViews);};this.createAreaRectanglesViews=function(iArea){var maxAreaRectHeight=this.background_height;var iRectangleArray=iArea.getRectangle();var areasRectanglesView=[];for(var j=0;j<iRectangleArray.length;j++){var jRectangle=iRectangleArray[j];var areaView=this.createAreaRectangleView(iArea,jRectangle);if(AWUtils.isUndefinedOrIsNull(areaView)===true){continue;}areasRectanglesView.push(areaView);var thisAreaRectHeight=areaView.y-areaView.height;if(thisAreaRectHeight<maxAreaRectHeight){maxAreaRectHeight=thisAreaRectHeight;}}if(iArea.isCut){for(var k=0;k<areasRectanglesView.length;k++){var kRectangleView=areasRectanglesView[k];if((kRectangleView.y-kRectangleView.height)===maxAreaRectHeight){kRectangleView.isCut=true;}}}return areasRectanglesView;};this.createAreaRectangleView=function(aArea,aRectangle){if(isUndefinedOrIsNull(aRectangle)||isUndefinedOrIsNullOneOf([aRectangle.getX1(),aRectangle.getY1(),aRectangle.getX2(),aRectangle.getY2()])){return null;}if(aArea.type==='DroneZone'||aArea.type==='NoDroneZone'){return this.createAGLAreaRectangleView(aArea,aRectangle);}else{return this.createAMSLAreaRectangleView(aArea,aRectangle);}return null;};this.createAMSLAreaRectangleView=function(iArea,jRectangle){var x1View=this.convertWorldX2ViewX(jRectangle.getX1());var y1View=this.convertWorldY2ViewY(jRectangle.getY1());var x2View=this.convertWorldX2ViewX(jRectangle.getX2());var y2View=this.convertWorldY2ViewY(jRectangle.getY2());var areaView=this.createCommonAreaView(iArea);areaView.setWidth(x2View-x1View);areaView.setHeight(y1View-y2View);areaView.setX(x1View);areaView.setY(y2View);areaView.setY1HeightType(jRectangle.getY1Type());areaView.setY2HeightType(jRectangle.getY2Type());return areaView;};this.createAGLAreaRectangleView=function(iArea,jRectangle){var shiftHeightDistBottom=new HeightDistance(jRectangle.getY1(),jRectangle.getX1());var shiftHeightDistTop=new HeightDistance(jRectangle.getY2(),jRectangle.getX1());var bottomLineHeightDistances=this.createReliefHeightDistancesForBottom(jRectangle);var topLineHeightDistances=this.createReliefHeightDistancesForTop(jRectangle);var scaledBottomHeightDistView=this.scaleWorldHeightDistances2ViewHeightDistances(bottomLineHeightDistances,shiftHeightDistBottom,jRectangle.getY1Type());var scaledTopHeightDistView=this.scaleWorldHeightDistances2ViewHeightDistances(topLineHeightDistances,shiftHeightDistTop,jRectangle.getY2Type());var viewAreaHeightDistanceChain=this.compileTopAndYBottomHeightDist(scaledBottomHeightDistView,scaledTopHeightDistView);this.convertScaledHeightDistances2ProfileViewBox(viewAreaHeightDistanceChain);var x1View=this.convertWorldX2ViewX(jRectangle.getX1());var y1View=this.convertWorldY2ViewY(jRectangle.getY1());var x2View=this.convertWorldX2ViewX(jRectangle.getX2());var y2View=this.convertWorldY2ViewY(jRectangle.getY2());var rectangleHeightView=y1View-y2View;var rectangleWidthView=x2View-x1View;var areaView=this.createCommonAreaView(iArea);areaView.setWidth(rectangleWidthView);areaView.setHeight(rectangleHeightView);areaView.setX(x1View);if(viewAreaHeightDistanceChain.length>0){areaView.setY(viewAreaHeightDistanceChain[(viewAreaHeightDistanceChain.length-1)].height);}else{areaView.setY(y1View);}areaView.setY1HeightType(jRectangle.getY1Type());areaView.setY2HeightType(jRectangle.getY2Type());areaView.setPolygonHeightDistViewsArray(viewAreaHeightDistanceChain);areaView.setBorderPathsHeightDistViewsArray(viewAreaHeightDistanceChain);return areaView;};this.createReliefHeightDistancesForBottom=function(jRectangle){var y1Type=jRectangle.getY1Type();var y2Type=jRectangle.getY2Type();var reliefHeightDistancesForBottom=[];if(y1Type===Rectangle.ALTITUDE_TYPE.AGL){reliefHeightDistancesForBottom=this.getHeightDistancesOfReliefBetween(jRectangle.getX1(),Number(jRectangle.getX2()));if(reliefHeightDistancesForBottom.length>0){reliefHeightDistancesForBottom[0].distance=0;reliefHeightDistancesForBottom=this.convertDistances2RelativeToFirstPoint(reliefHeightDistancesForBottom);}}var bottomLineHeightDistances=[];if(y1Type===Rectangle.ALTITUDE_TYPE.AMSL){var bottomLeft=new HeightDistance(jRectangle.getY1(),0);var bottomRight=new HeightDistance(jRectangle.getY1(),jRectangle.getX2()-jRectangle.getX1());bottomLineHeightDistances.push(bottomLeft);bottomLineHeightDistances.push(bottomRight);}else if(y1Type===Rectangle.ALTITUDE_TYPE.AGL){bottomLineHeightDistances=reliefHeightDistancesForBottom;}return bottomLineHeightDistances;};this.createReliefHeightDistancesForTop=function(jRectangle){var y1Type=jRectangle.getY1Type();var y2Type=jRectangle.getY2Type();var reliefHeightDistancesForTop=[];if(y2Type===Rectangle.ALTITUDE_TYPE.AGL){reliefHeightDistancesForTop=this.getHeightDistancesOfReliefBetween(jRectangle.getX1(),jRectangle.getX2());if(reliefHeightDistancesForTop.length>0){reliefHeightDistancesForTop[0].distance=0;reliefHeightDistancesForTop=this.convertDistances2RelativeToFirstPoint(reliefHeightDistancesForTop);}}var topLineHeightDistances=[];if(y2Type===Rectangle.ALTITUDE_TYPE.AMSL){var topLeft=new HeightDistance(jRectangle.getY2(),0);var topRight=new HeightDistance(jRectangle.getY2(),jRectangle.getX2()-jRectangle.getX1());topLineHeightDistances.push(topLeft);topLineHeightDistances.push(topRight);}else if(y2Type===Rectangle.ALTITUDE_TYPE.AGL){topLineHeightDistances=reliefHeightDistancesForTop;}return topLineHeightDistances;};this.shiftHeightDistancesToRelief=function(viewAreaHeightDistanceChain,viewShift){viewAreaHeightDistanceChain.forEach(function(iHeightDistance){iHeightDistance.height=iHeightDistance.height+viewShift;});};this.cutHeightDistancesToTheEdgeOfView=function(aHeightDistanceArray){var retVal=[];aHeightDistanceArray.forEach(function(iHeightDistance){var clonedHD=iHeightDistance.clone();if(clonedHD.height<thisInstance.chart_lines_padding_top){clonedHD.height=thisInstance.chart_lines_padding_top;}retVal.push(clonedHD);});return retVal;};this.cutHeightDistancesToBorderLinesArray=function(aHeightDistanceArray){var retVal=[];var onePathArray=[];var heightDistanceArray=aHeightDistanceArray.concat([]);var lastElement=heightDistanceArray.pop();heightDistanceArray.unshift(lastElement);var doesCrateNewOnePathArray=false;var previousHeightDistance=null;var isPreviousCutted=null;heightDistanceArray.forEach(function(iHeightDistance){var isCurrentCutted=false;var clonedHD=iHeightDistance.clone();if(clonedHD.height>thisInstance.chart_lines_padding_top){onePathArray.push(clonedHD);isCurrentCutted=false;}else{if(onePathArray.length<=0||isPreviousCutted===false){clonedHD.height=thisInstance.chart_lines_padding_top;onePathArray.push(clonedHD);}isCurrentCutted=true;}if(isPreviousCutted!==null&&isPreviousCutted!==isCurrentCutted){retVal.push(onePathArray);onePathArray=[];}isPreviousCutted=isCurrentCutted;return;if(clonedHD.height>thisInstance.chart_lines_padding_top){onePathArray.push(clonedHD);}else if(onePathArray.length===0){clonedHD.height=thisInstance.chart_lines_padding_top;onePathArray.push(clonedHD);}else if(onePathArray.length>0){clonedHD.height=thisInstance.chart_lines_padding_top;onePathArray.push(clonedHD);retVal.push(onePathArray);onePathArray=[];}});if(onePathArray.length>0){retVal.push(onePathArray);}return retVal;};this.convertDistances2RelativeToFirstPoint=function(aHeightDistances){if(AWUtils.isArray(aHeightDistances)===false){return aHeightDistances;}var retVal=[];var distanceShift=0;for(var i=0;i<aHeightDistances.length;i++){var iHeightDistance=aHeightDistances[i];if(i===0){retVal.push(iHeightDistance);distanceShift=distanceShift+iHeightDistance.distance;continue;}distanceShift=distanceShift+iHeightDistance.distance;iHeightDistance.distance=distanceShift;retVal.push(iHeightDistance);}return retVal;};this.convertScaledHeightDistances2ProfileViewBox=function(aHeightDistances){if(AWUtils.isArray(aHeightDistances)===false){return aHeightDistances;}var zeroPointY=this.getZeroPointView().y;aHeightDistances.forEach(function(iHeightDistance){if(AWUtils.isUndefinedOrIsNull(iHeightDistance)===true){return;}iHeightDistance.height=zeroPointY-iHeightDistance.height;iHeightDistance.distance=iHeightDistance.distance+thisInstance.chart_lines_padding_left;});};this.createCommonAreaView=function(iArea){var areaType=this.AREA_TYPE.TMA_DEFAULT;var secondLineText=null;if(iArea.conflict){areaType=this.AREA_TYPE.CONFLICT;}var firstLineText=(""+(isUndefinedOrIsNullOrIsEmptyString(iArea.code_id)?"":iArea.code_id)).trim();if(firstLineText.length<=0){firstLineText=(""+(isUndefinedOrIsNullOrIsEmptyString(iArea.txt_name)?"":iArea.txt_name)).trim();}var decodedType=AWUtils.decodeAixmFeatureType(iArea.type);decodedType=this.changeDecodedAreaTypeForVerticalProfile(decodedType);if(isUndefinedOrIsNullOrIsEmptyString(decodedType)===false){firstLineText=firstLineText+' - '+decodedType.trim();}var retVal=new AreaView(""+firstLineText,null,null,null,null,areaType,secondLineText);return retVal;};this.changeDecodedAreaTypeForVerticalProfile=function(decodedType){const decodedTypeMap={"Aixm-Ase-PROTECT":""};if(decodedTypeMap[decodedType]!=undefined){return decodedTypeMap[decodedType];}else{return decodedType;}};this.compileTopAndYBottomHeightDist=function(aBottomHeightDistViewchain,aTopHeightDistViewchain){var retVal=[];retVal=retVal.concat(aBottomHeightDistViewchain);retVal=retVal.concat(aTopHeightDistViewchain.reverse());return retVal;};this.scaleWorldHeightDistances2ViewHeightDistances=function(aWorldHightDistances,aWorldShiftHeightDist,yType){var retVal=[];for(var i=0;i<aWorldHightDistances.length;i++){var iReliefPntHeightDist=aWorldHightDistances[i];if(AWUtils.isUndefinedOrIsNull(iReliefPntHeightDist)===true){continue;}iReliefPntHeightDist=iReliefPntHeightDist.clone();if(AWUtils.isUndefinedOrIsNull(aWorldShiftHeightDist)===false){if(AWUtils.isNumber(aWorldShiftHeightDist.height)===true){if(yType===Rectangle.ALTITUDE_TYPE.AMSL){iReliefPntHeightDist.height=iReliefPntHeightDist.height;}else{iReliefPntHeightDist.height=iReliefPntHeightDist.height+aWorldShiftHeightDist.height;}}if(AWUtils.isNumber(aWorldShiftHeightDist.distance)===true){iReliefPntHeightDist.distance=iReliefPntHeightDist.distance+aWorldShiftHeightDist.distance;}}var viewHD=this.scaleWorldHeightDist2ViewHeightDist(iReliefPntHeightDist);retVal.push(viewHD);}return retVal;};this.convertWorldHeightDistances2ViewHeightDistances=function(aWorldHightDistances,aWorldShiftHeightDist){var retVal=[];for(var i=0;i<aWorldHightDistances.length;i++){var iReliefPntHeightDist=aWorldHightDistances[i];if(AWUtils.isUndefinedOrIsNull(iReliefPntHeightDist)===true){continue;}iReliefPntHeightDist=iReliefPntHeightDist.clone();if(AWUtils.isUndefinedOrIsNull(aWorldShiftHeightDist)===false){if(AWUtils.isNumber(aWorldShiftHeightDist.height)===true){iReliefPntHeightDist.height=iReliefPntHeightDist.height+aWorldShiftHeightDist.height;}if(AWUtils.isNumber(aWorldShiftHeightDist.distance)===true){iReliefPntHeightDist.distance=iReliefPntHeightDist.distance+aWorldShiftHeightDist.distance;}}var viewHD=this.convertWorldHeightDist2ViewHeightDist(iReliefPntHeightDist);retVal.push(viewHD);}return retVal;};this.convertWorldHeightDist2ViewHeightDist=function(aWorldHightDist){var retVal=new HeightDistance();retVal.height=this.convertWorldY2ViewY(aWorldHightDist.height);retVal.distance=this.convertWorldX2ViewX(aWorldHightDist.distance);return retVal;};this.scaleWorldHeightDist2ViewHeightDist=function(aWorldHightDist){var retVal=new HeightDistance();retVal.height=this.scaleWorldY2ViewY(aWorldHightDist.height);retVal.distance=this.scaleWorldX2ViewX(aWorldHightDist.distance);return retVal;};this.convertWorldX2ViewX=function(aXWorld){var zeroPoint=this.getZeroPointView();var xView=zeroPoint.x+this.scaleWorldX2ViewX(aXWorld);return xView;};this.convertWorldY2ViewY=function(aYWorld){var zeroPoint=this.getZeroPointView();var yView=zeroPoint.y-this.scaleWorldY2ViewY(aYWorld);if(yView>zeroPoint.y){yView=zeroPoint.y;}return yView;};this.scaleWorldX2ViewX=function(aXWorld){var xWorldNumber=Number(aXWorld);return(xWorldNumber*scaleX);};this.scaleWorldY2ViewY=function(aYWorld){var yWorldNumber=Number(aYWorld);return(yWorldNumber*mScaleY);};this.parseTypeName=function(aTypeName){if(isUndefinedOrIsNull(aTypeName)){return'';}var areaTypeName="";var splitedType=aTypeName.split("-");if(isUndefinedOrIsNullOrIsEmptyArray(splitedType)){return'';}areaTypeName=splitedType[(splitedType.length-1)];return areaTypeName;};this.createAreasSvgGroup=function(aAreasArray){if(isUndefinedOrIsNullOrIsEmptyArray(aAreasArray)){return'';}var areasString='';for(var i=0;i<aAreasArray.length;i++){var iArea=aAreasArray[i];if(isUndefinedOrIsNull(iArea)){continue;}areasString=areasString+this.createAreaElementString(iArea);}return'<svg viewBox="0 '+thisInstance.chart_lines_padding_top+' '+this.svg_width+' '+this.svg_height+'" \n\                y="'+thisInstance.chart_lines_padding_top+'">'+this.createSvgGroupString(areasString,{"inkscape:groupmode":"layer","id":"layer6","inkscape:label":"Areas","style":"display:inline","sodipodi:insensitive":"true"})+'</svg>';};this.createAreaElementString=function(aArea){if(isUndefinedOrIsNull(aArea)||isUndefinedOrIsNull(aArea.type)){return'';}var iconString=this.createAreaIconString(aArea);var areaFillRect=this.createAreaFillRect(aArea);var areaCutLinePath=this.createAreaCutLinePath(aArea);var areaNameTspan=this.createAreaNameTspan(aArea);var areaDescriptionTspan=this.createAreaDescriptionTspan(aArea);var areaText=this.createAreaSvgTextString(aArea,areaNameTspan+areaDescriptionTspan);var areaGroupString=this.createSvgGroupString(areaFillRect+areaCutLinePath+areaText,{});return areaGroupString+iconString;};this.createAreaFillRect=function(aArea){var type=aArea.type;var fillColour=type.fillColour;var fillOpacity=type.fillOpacity;var strokeColour=(aArea.isCut?type.fillColour:type.strokeColour);var strokeWidth=(aArea.isCut?0:1.15237308);var heightDistView=aArea.getPolygonHeightDistViewsArray();var svgElementStyle='fill:'+fillColour+';fill-opacity:'+fillOpacity+';';var retVal='';if(AWUtils.isUndefinedOrIsNull(heightDistView)===false){svgElementStyle+='stroke:'+type.strokeColour+';stroke-width:1.15237308;stroke-linecap:butt;stroke-linejoin:bevel;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none;stroke-dashoffset:0';retVal=this.createEmptyElementString('polygon',{"class":"zoomable","points":aArea.createSVGPolygonPointsStr(),"id":"polygon3944","style":svgElementStyle});}else{svgElementStyle+='stroke:'+strokeColour+';stroke-width:'+strokeWidth+'0;stroke-linecap:butt;stroke-linejoin:bevel;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none;stroke-dashoffset:0';retVal=this.createEmptyElementString('rect',{"class":"zoomable","style":svgElementStyle,"id":"rect3944","width":aArea.width,"height":aArea.height,"x":aArea.x,"y":this.getAreaY(aArea)});}return retVal;};this.createAreaCutLinePath=function(aArea){var type=aArea.type;var retVal='';var heightDistView=aArea.getPolygonHeightDistViewsArray();if(AWUtils.isUndefinedOrIsNull(heightDistView)===false){var pathArray=aArea.createSVGPathsArray();pathArray.forEach(function(iPath){retVal+=thisInstance.createEmptyElementString('path',{"class":"zoomable","style":'fill:none;stroke:'+type.strokeColour+';stroke-width:1.70700002;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none',"d":iPath,"id":"path3889","inkscape:connector-curvature":"0"});});}else if(aArea.isCut===true){retVal=this.createEmptyElementString('path',{"class":"zoomable","style":'fill:none;stroke:'+type.strokeColour+';stroke-width:1.70700002;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none',"d":'M '+aArea.x+','+this.getAreaY(aArea)+' '+aArea.x+','+(this.getAreaY(aArea)+aArea.height)+' '+(aArea.x+aArea.width)+','+(this.getAreaY(aArea)+aArea.height)+' '+(aArea.x+aArea.width)+','+this.getAreaY(aArea),"id":"path3889","inkscape:connector-curvature":"0"});}return retVal;};this.createBorderAreaPaths=function(pointsArray){};this.createAreaNameTspan=function(aArea){var areaTextY=this.getAreaY(aArea);if(areaTextY<thisInstance.chart_lines_padding_top){areaTextY=thisInstance.chart_lines_padding_top;}var textLabel_1_X=(aArea.x+this.area_text_padding_x);var textLabel_1_Y=(areaTextY+this.area_text_padding_y);var notOverlayedXY=this.getNotOverlayedLabelXY(textLabel_1_X,textLabel_1_Y,this.area_text_font_size,aArea.name,ALLOWED_TEXT_SHIFT_MODE.Y);var textLabel_1_X=notOverlayedXY.x;var textLabel_1_Y=notOverlayedXY.y;var areaNameTspan=this.createSvgTspanString(HtmlUtils.encodeForHTML(aArea.name),{"class":"semanticzoomable","sodipodi:role":"line","x":textLabel_1_X,"y":textLabel_1_Y,"id":"tspan3969"});return areaNameTspan;};this.createAreaDescriptionTspan=function(aArea){var textLabel_1_X=(aArea.x+this.area_text_padding_x);var textLabel_1_Y=(this.getAreaY(aArea)+this.area_text_padding_y);var textLabel_2_X=textLabel_1_X;var textLabel_2_Y=textLabel_1_Y+this.area_text_font_size;var notOverlayed2XY=this.getNotOverlayedLabelXY(textLabel_2_X,textLabel_2_Y,this.area_text_font_size,aArea.secondLineText,ALLOWED_TEXT_SHIFT_MODE.Y);var textLabel_2_X=notOverlayed2XY.x;var textLabel_2_Y=notOverlayed2XY.y;var retVal='';if(aArea.secondLineText){retVal=this.createSvgTspanString(HtmlUtils.encodeForHTML(aArea.secondLineText),{"class":"semanticzoomable","sodipodi:role":"line","x":textLabel_2_X,"y":textLabel_2_Y,"id":"tspan3970"});}return retVal;};this.createAreaSvgTextString=function(aArea,aText){var areaText=this.createSvgTextString(aText,{"xml:space":"preserve","style":'font-size:'+this.area_text_font_size+'px;font-style:normal;font-weight:bold;line-height:125%;letter-spacing:0px;word-spacing:0px;fill:#ffffff;fill-opacity:1;stroke:none;display:inline;font-family:'+this.font_family+';-inkscape-font-specification:'+this.font_family+' Bold',"x":(aArea.x+this.area_text_padding_x),"y":(this.getAreaY(aArea)+this.area_text_padding_y),"id":"text3915-2","sodipodi:linespacing":"125%"});return areaText;};this.simpleFontWidthScaleFactor=0.6;this.forbidenLabelAreas=[];var ALLOWED_TEXT_SHIFT_MODE={X:0,Y:1,XY:2};this.getNotOverlayedLabelXY=function(aSuggestedX,aSuggestedY,aFontsize,aText,aAllowedShiftMode){if(isUndefinedOrIsNull(aAllowedShiftMode)===true){aAllowedShiftMode=ALLOWED_TEXT_SHIFT_MODE.XY;}if(isUndefinedOrIsNullOrIsEmptyString(aText)===true){return{x:aSuggestedX,y:aSuggestedY};}var absoluteX=aSuggestedX;var absoluteY=aSuggestedY;var areaHeight=aFontsize;var width=aText.length*aFontsize*this.simpleFontWidthScaleFactor;var suggestedLabelArea=new AreaView(aText,width,areaHeight,absoluteX,absoluteY);var isInForbidenArea=true;while(isInForbidenArea===true){isInForbidenArea=false;for(var i=0;i<this.forbidenLabelAreas.length;i++){var iForbidenLabelArea=this.forbidenLabelAreas[i];if(this.areBoxesInConflict(iForbidenLabelArea,suggestedLabelArea)===true){isInForbidenArea=true;break;}}if(isInForbidenArea===true){if(aAllowedShiftMode===ALLOWED_TEXT_SHIFT_MODE.X||aAllowedShiftMode===ALLOWED_TEXT_SHIFT_MODE.XY){suggestedLabelArea.x=suggestedLabelArea.x+1;}if(aAllowedShiftMode===ALLOWED_TEXT_SHIFT_MODE.Y||aAllowedShiftMode===ALLOWED_TEXT_SHIFT_MODE.XY){suggestedLabelArea.y=suggestedLabelArea.y+1;}}}this.forbidenLabelAreas.push(suggestedLabelArea);var retVal={x:suggestedLabelArea.x,y:suggestedLabelArea.y};return retVal;};this.areBoxesInConflict=function(aArea1,aArea2){var box1Points=[aArea1.getUpperLeftXY(),aArea1.getUpperRightXY(),aArea1.getLowerLeftXY(),aArea1.getLowerRightXY()];var box2Point1=aArea2.getUpperLeftXY();var box2Point2=aArea2.getLowerRightXY();for(var i=0;i<box1Points.length;i++){var iBox1Point=box1Points[i];if(iBox1Point.x>=box2Point1.x&&iBox1Point.x<=box2Point2.x&&iBox1Point.y>=box2Point1.y&&iBox1Point.y<=box2Point2.y){return true;}}return false;};this.getAreaY=function(aArea){if(isUndefinedOrIsNull(aArea)||isUndefinedOrIsNull(aArea.y)){return 0;}return aArea.y+this.y_shift;};this.createAreaIconString=function(aArea){if(isUndefinedOrIsNull(aArea)||isUndefinedOrIsNull(aArea.type)||isUndefinedOrIsNullOrIsEmptyString(aArea.type.icon)||isUndefinedOrIsNullOneOf([aArea.y,aArea.x])){return'';}return this.createEmptyElementString('use',{"xlink:href":'#'+aArea.type.icon,"x":(aArea.x+this.area_icon_padding),"y":(aArea.y+this.area_icon_padding+this.y_shift)});};this.getCtrAreasView=function(){var retVal=[];var ctr1=new AreaView("LZTT CTR",78,42,5,72,this.AREA_TYPE.CTR_DEFAULT);var ctr2=new AreaView("LZKZ CTR",132,42,371,72,this.AREA_TYPE.CTR_DEFAULT);var ctr3=new AreaView("LZSV CTR",72,103,107,10,this.AREA_TYPE.CTR_PARACHUTE);retVal.push(ctr1);retVal.push(ctr2);retVal.push(ctr3);return retVal;};this.createObstaclesLayer=function(){var obstaclesViews=this.getObstacleViews();if(isUndefinedOrIsNullOrIsEmptyArray(obstaclesViews)){return'';}var obstaclesString='';for(var i=0;i<obstaclesViews.length;i++){var iObstacleView=obstaclesViews[i];if(isUndefinedOrIsNull(iObstacleView)||isUndefinedOrIsNullOneOf([iObstacleView.element_type_id,iObstacleView.x,iObstacleView.y])){continue;}var obstacleIconString=this.createEmptyElementString('use',{"class":"semanticzoomable","xlink:href":'#'+iObstacleView.element_type_id,"x":iObstacleView.x,"y":iObstacleView.y});obstaclesString=obstaclesString+obstacleIconString;if(iObstacleView.elevation!==undefined&&iObstacleView.elevation!==null){obstaclesString=obstaclesString+this.createObstacleHeightText(iObstacleView);}}return this.createSvgGroupString(obstaclesString,{"inkscape:groupmode":"layer","id":"layer7","inkscape:label":"Obstacle","style":"display:inline","sodipodi:insensitive":"true"});};this.createFreqPointsLayer=function(){var freqPointViews=this.getFreqPointViews();if(isUndefinedOrIsNullOrIsEmptyArray(freqPointViews)){return'';}var freqPointsString='';for(var i=0;i<freqPointViews.length;i++){var iFreqPointView=freqPointViews[i];if(isUndefinedOrIsNull(iFreqPointView)||isUndefinedOrIsNullOneOf([iFreqPointView.element_type_id,iFreqPointView.x,iFreqPointView.y])){continue;}var obstacleIconString=this.createEmptyElementString('use',{"class":"semanticzoomable","xlink:href":'#'+iFreqPointView.element_type_id,"x":iFreqPointView.x,"y":iFreqPointView.y});freqPointsString=freqPointsString+obstacleIconString;if(iFreqPointView.elevation!==undefined&&iFreqPointView.elevation!==null){iFreqPointView.elevation=(HtmlUtils.C_EMPTY+iFreqPointView.elevation).split("|",1)[0];freqPointsString=freqPointsString+this.createFreqPointHeightText(iFreqPointView);}}return this.createSvgGroupString(freqPointsString,{"inkscape:groupmode":"layer","id":"layer8","inkscape:label":"FreqPoints","style":"display:inline","sodipodi:insensitive":"true"});};this.createFreqPointHeightText=function(aFreqPointView){var letterWidth=4.6;var retVal='';if(isUndefinedOrIsNull(aFreqPointView)||isUndefinedOrIsNullOneOf([aFreqPointView.x,aFreqPointView.y,aFreqPointView.elevation,aFreqPointView.width])){return retVal;}var textX=aFreqPointView.x-(letterWidth*aFreqPointView.width/2);var obstacleHeightTspan=this.createSvgTspanString(HtmlUtils.encodeForHTML('('+aFreqPointView.elevation+')'),{"class":"semanticzoomable","sodipodi:role":"line","id":"tspan3813","x":textX,"y":(aFreqPointView.y-4)});var obstacleText=this.createSvgTextString(obstacleHeightTspan,{"xml:space":"preserve","style":'font-size:12px;font-style:normal;font-weight:normal;line-height:125%;letter-spacing:0px;word-spacing:0px;fill:#ffffff;fill-opacity:1;stroke:none;font-family:'+this.font_family,"x":textX,"y":aFreqPointView.y,"id":'text'+aFreqPointView.elevation,"sodipodi:linespacing":"125%"});retVal=retVal+obstacleText;return retVal;};this.createObstacleHeightText=function(aObstacleView){var letterWidth=4;var retVal='';if(isUndefinedOrIsNull(aObstacleView)||isUndefinedOrIsNullOneOf([aObstacleView.x,aObstacleView.y,aObstacleView.elevation,aObstacleView.width])){return retVal;}var textX=(aObstacleView.x-((letterWidth*(aObstacleView.elevation+'').length)-(aObstacleView.width/2)));for(var i=0;i<this.axis_y_dash_steps.length;i++){var iAxisDashStep=this.axis_y_dash_steps[i];var obstacleHeightTspan=this.createSvgTspanString(HtmlUtils.encodeForHTML('('+parseFloat(iAxisDashStep.fromMeterConvertFactor*aObstacleView.elevation).toFixed(0)+')'),{"class":"semanticzoomable","sodipodi:role":"line","id":"tspan3813","x":textX,"y":(aObstacleView.y-4)});var obstacleText=this.createSvgTextString(obstacleHeightTspan,{"xml:space":"preserve","style":'font-size:12px;font-style:normal;font-weight:normal;line-height:125%;letter-spacing:0px;word-spacing:0px;fill:#ffffff;fill-opacity:1;stroke:none;font-family:'+this.font_family,"x":textX,"y":aObstacleView.y,"id":'text'+aObstacleView.elevation,"sodipodi:linespacing":"125%"});retVal=retVal+this.createPresentationUnitSvgGroup(obstacleText,iAxisDashStep.showAttribute);}return retVal;};this.getFreqPointViews=function(){if(isUndefinedOrIsNull(this.mRelief)||isUndefinedOrIsNullOrIsEmptyArray(this.mRelief.getPoints())){return'';}var points=this.mRelief.getPoints();var zeroPoint=this.getZeroPointView();var retVal=[];for(var i=0;i<points.length;i++){var yOffset=0;var iPoint=points[i];if(isUndefinedOrIsNull(iPoint)||isUndefinedOrIsNull(iPoint.getType())||(iPoint.getType()!=="Aixm-Ahp"&&iPoint.getType()!=="Aixm-Dme"&&iPoint.getType()!=="Aixm-Vor"&&iPoint.getType()!=="Aixm-Ndb")){continue;}var obstacleType;switch(iPoint.getType()){case"Aixm-Ahp":obstacleType=this.obstacle_types.aixm_ahp;break;case"Aixm-Dme":obstacleType=this.obstacle_types.aixm_dme;break;case"Aixm-Vor":obstacleType=this.obstacle_types.aixm_vor;break;case"Aixm-Ndb":obstacleType=this.obstacle_types.aixm_ndb;yOffset=35;break;default:obstacleType=this.obstacle_types.freq_point;}var view_x=((zeroPoint.x+(iPoint.getDistance()*scaleX))-obstacleType.view_width/2);var view_y=(zeroPoint.y-obstacleType.view_height)-yOffset;var view=new ObstacleView(view_x,view_y,obstacleType.element_type_id,iPoint.getTxt_name(),iPoint.freq,obstacleType.view_width,obstacleType.view_height);retVal.push(view);}return retVal;};this.getObstacleViews=function(){if(isUndefinedOrIsNull(this.mRelief)||isUndefinedOrIsNullOrIsEmptyArray(this.mRelief.getPoints())){return'';}var points=this.mRelief.getPoints();var zeroPoint=this.getZeroPointView();var retVal=[];for(var i=0;i<points.length;i++){var iPoint=points[i];if(isUndefinedOrIsNull(iPoint)||isUndefinedOrIsNull(iPoint.getType())||iPoint.getType()!=="Aixm-Obs"){continue;}var obstacleType=this.obstacle_types[(isUndefinedOrIsNull(iPoint.getTxt_name()))?this.obstacle_default_type_key:iPoint.getTxt_name()];if(isUndefinedOrIsNull(obstacleType)){obstacleType=this.obstacle_types[this.obstacle_default_type_key];}var view_x=((zeroPoint.x+(iPoint.getDistance()*scaleX))-obstacleType.view_width/2);var view_y=(zeroPoint.y-obstacleType.view_height);var view=new ObstacleView(view_x,view_y,obstacleType.element_type_id,iPoint.getTxt_name(),iPoint.getElevation(),obstacleType.view_width,obstacleType.view_height);retVal.push(view);}return retVal;};this.getParachuteViewPositions=function(){var zeroPoint=this.getZeroPointView();var retVal=[zeroPoint,{x:60,y:zeroPoint.y},{x:150,y:zeroPoint.y}];return retVal;};this.createWayPointsLayer=function(){if(isUndefinedOrIsNull(this.mFlight)){return'';}var heightDistanceModel=this.convertFlightProfile2HeightDistance(this.mFlight);if(isUndefinedOrIsNullOrIsEmptyArray(heightDistanceModel)){return'';}var heightDistanceViews=this.scaleHeightDistanceModel2View(heightDistanceModel);if(isUndefinedOrIsNullOrIsEmptyArray(heightDistanceViews)){return'';}var xPoint=this.getZeroPointView().x;var yPoint=this.getZeroPointView().y;var xPointSum=xPoint;var retValDashes='';var retValTextContent='';for(var i=0;i<heightDistanceViews.length;i++){var iHeightDistanceView=heightDistanceViews[i];if(isUndefinedOrIsNull(iHeightDistanceView)||isUndefinedOrIsNullOneOf([iHeightDistanceView.fromPointName,iHeightDistanceView.distance])){xPointSum=xPointSum+Number(iHeightDistanceView.distance);continue;}retValDashes=retValDashes+this.createWayPointElementDash(xPointSum,yPoint-this.waypoint_dash_length);retValTextContent=retValTextContent+this.createWayPointElementText(iHeightDistanceView.fromPointName,xPointSum+this.waypoint_axis_padding_left,yPoint-this.waypoint_axis_padding_bottom);xPointSum=xPointSum+iHeightDistanceView.distance;}var lastSegment=heightDistanceViews[(heightDistanceViews.length-1)];retValDashes=retValDashes+this.createWayPointElementDash(xPointSum,yPoint-this.waypoint_dash_length);retValTextContent=retValTextContent+this.createWayPointElementText(lastSegment.toPointName,xPointSum+this.waypoint_axis_padding_left,yPoint-this.waypoint_axis_padding_bottom)+'</text>';var retValText=this.createSvgTextString(retValTextContent,{"xml:space":"preserve","style":'font-size:'+this.waypoint_text_font_size+'px;font-style:normal;font-weight:bold;line-height:125%;letter-spacing:0px;word-spacing:0px;fill:#ffffff;fill-opacity:1;stroke:none;display:inline;font-family:'+this.font_family+';-inkscape-font-specification:'+this.font_family+' Bold',"x":xPoint,"y":yPoint,"id":"text3915-2","sodipodi:linespacing":"125%"});var retVal=this.createSvgGroupString((retValText+retValDashes),{});return retVal;};this.createWayPointElementText=function(aPointName,aX,aY){return this.createSvgTspanString(HtmlUtils.encodeForHTML(aPointName),{"class":"semanticzoomable","sodipodi:role":"line","x":aX,"y":aY,"id":"tspan3969"});};this.createWayPointElementDash=function(aX,aY){return this.createEmptyElementString('use',{"class":"semanticzoomable","xlink:href":"#waypointDash","x":aX,"y":aY});};this.createMinimalSafeAltitudeLayer=function(){return'';};this.createReliefConflictLayer=function(){if(isUndefinedOrIsNull(this.mRelief)||isUndefinedOrIsNullOrIsEmptyArray(this.mRelief.getHeights())||isUndefinedOrIsNull(this.mRelief.getHeightStep())){return undefined;}var heights=this.mRelief.getHeights();var heightStep=Number(this.mRelief.getHeightStep());var heightStepSum=0;var conflictHeightDistances=[];var conflictPathsHeightDistances=[];for(var i=0;i<heights.length;i++){var iHeightOfRelief=heights[i];if(isUndefinedOrIsNull(iHeightOfRelief)){continue;}heightStepSum=heightStepSum+heightStep;var heightOfFlight=this.getHeightOfFlightAtDistance(heightStepSum);if(isUndefinedOrIsNull(heightOfFlight)||isUndefinedOrIsNull(iHeightOfRelief)){continue;}if(heightOfFlight<iHeightOfRelief){var conflictHeightDistance=new HeightDistance();conflictHeightDistance.distance=heightStepSum;conflictHeightDistance.height=iHeightOfRelief;conflictHeightDistance.heightOfFlight=heightOfFlight;conflictHeightDistances.push(conflictHeightDistance);}else if(conflictHeightDistances.length>0){this.encloseConflictArea(conflictHeightDistances);conflictPathsHeightDistances.push(conflictHeightDistances);conflictHeightDistances=[];}}if(conflictHeightDistances.length>0){conflictPathsHeightDistances.push(conflictHeightDistances);conflictHeightDistances=[];}if(conflictPathsHeightDistances.length>0){for(var j=0;j<conflictPathsHeightDistances.length;j++){var flightBrakes=this.getFlightBrakesBetween(conflictPathsHeightDistances[j]);for(var k=(flightBrakes.length-1);k>=0;k--){conflictPathsHeightDistances[j].push(flightBrakes[k]);}}conflictHeightDistances=[];}return this.createSvgGroupOfReliefConflictPolygons(conflictPathsHeightDistances,{class:'zoomable panable'});};this.encloseConflictArea=function(aConflictHeightDistances){for(var i=aConflictHeightDistances.length-1;i>=0;i--){var enclosingConflictPoint=aConflictHeightDistances[i].clone();enclosingConflictPoint.height=AWUtils.parseFloatElseZero(enclosingConflictPoint.heightOfFlight);aConflictHeightDistances.push(enclosingConflictPoint);}};this.getFlightBrakesBetween=function(aHeightDistances){var retVal=[];if(isUndefinedOrIsNull(aHeightDistances)||aHeightDistances.length<2){return retVal;}var heightDistanceOfFlight=this.convertFlightProfile2HeightDistance(this.mFlight);if(isUndefinedOrIsNullOrIsEmptyArray(heightDistanceOfFlight)){return retVal;}var sumFlightDistance=0;var startPointDistance=aHeightDistances[0].distance;var endPointDistance=aHeightDistances[(aHeightDistances.length-1)].distance;for(var i=0;i<heightDistanceOfFlight.length;i++){var iHeightDistance=heightDistanceOfFlight[i];if(isUndefinedOrIsNull(iHeightDistance)){continue;}var endPointHeight=iHeightDistance.height;var distance=iHeightDistance.distance;sumFlightDistance=sumFlightDistance+distance;if(sumFlightDistance>startPointDistance&&sumFlightDistance<endPointDistance){var brakePoint=new HeightDistance();brakePoint.distance=sumFlightDistance;brakePoint.height=endPointHeight;retVal.push(brakePoint);}}return retVal;};this.createSvgGroupOfReliefConflictPolygons=function(aArrayOfArrayOfHeightDistances,aOptions){if(isUndefinedOrIsNullOrIsEmptyArray(aArrayOfArrayOfHeightDistances)){return'';}var retVal='<g '+this.createOptionsString(aOptions)+'>';for(var k=0;k<aArrayOfArrayOfHeightDistances.length;k++){var kConflictHeightDistances=aArrayOfArrayOfHeightDistances[k];if(isUndefinedOrIsNull(kConflictHeightDistances)){continue;}retVal=retVal+this.createSvgPolygon(kConflictHeightDistances,{"style":'fill:red;'});}return this.createSvgGroupString(retVal,{});};this.createSvgTextString=function(aContent,aOptions){if(isUndefinedOrIsNull(aContent)){return'';}return this.createEnclosedElementString('text',aContent,aOptions);};this.createSvgGroupString=function(aContent,aOptions){if(isUndefinedOrIsNull(aContent)){return'';}return this.createEnclosedElementString('g',aContent,aOptions);};this.createSvgTspanString=function(aContent,aOptions){if(isUndefinedOrIsNull(aContent)){return'';}return this.createEnclosedElementString('tspan',aContent,aOptions);};this.createEnclosedElementString=function(aName,aContent,aOptions){if(isUndefinedOrIsNull(aName)||isUndefinedOrIsNull(aContent)){return'';}return'<'+aName+' '+this.createOptionsString(aOptions)+'>'+aContent+'</'+aName+'>';};this.createEmptyElementString=function(aName,aOptions){if(isUndefinedOrIsNull(aName)){return'';}return'<'+aName+' '+this.createOptionsString(aOptions)+' />';};this.createOptionsString=function(aOptions){var retVal='';if(!isUndefinedOrIsNull(aOptions)&&Object.keys(aOptions).length>0){for(var key in aOptions){var value=aOptions[key];if(isUndefinedOrIsNull(value)){continue;}retVal=retVal+' '+key+'="'+aOptions[key]+'"';}}return retVal;};this.createSvgPolygon=function(aArrayOfHeightDistance,aOptions){if(isUndefinedOrIsNullOrIsEmptyArray(aArrayOfHeightDistance)){return'';}var retVal='<polygon points="';for(var j=0;j<aArrayOfHeightDistance.length;j++){var iHeightDistance=aArrayOfHeightDistance[j];if(isUndefinedOrIsNull(iHeightDistance)){continue;}retVal=retVal+''+(this.getZeroPointView().x+(iHeightDistance.distance*scaleX))+','+(this.getZeroPointView().y-(iHeightDistance.height*mScaleY))+' ';}retVal=retVal+'" '+this.createOptionsString(aOptions)+' />';return retVal;};this.getHeightOfFlightAtDistance=function(aDistance){if(isUndefinedOrIsNull(aDistance)){return null;}var heightDistancesOfFlight=this.convertFlightProfile2HeightDistance(this.mFlight);var sumFlightDistance=0;var startPointHeight=(this.getZeroPointView().y-this.getZeroPointViewOfRelief().y)/mScaleY;for(var i=0;i<heightDistancesOfFlight.length;i++){if(isUndefinedOrIsNull(heightDistancesOfFlight[i])){continue;}var iHeightDistance=heightDistancesOfFlight[i];var endPointHeight=AWUtils.parseIntElseZero(iHeightDistance.height);var distance=AWUtils.parseIntElseZero(iHeightDistance.distance);if((sumFlightDistance+distance)>=aDistance){if(startPointHeight===endPointHeight){return startPointHeight;}else if(startPointHeight<endPointHeight){var heightOfTriangle=(endPointHeight-startPointHeight);var widthOfTriangle=distance;var angle=Math.asin(heightOfTriangle/Math.sqrt(heightOfTriangle*heightOfTriangle+widthOfTriangle*widthOfTriangle));var partialDistance=aDistance-sumFlightDistance;var partialHeight=Math.tan(angle)*partialDistance;return(partialHeight+startPointHeight);}else if(startPointHeight>endPointHeight){var heightOfTriangle=(startPointHeight-endPointHeight);var widthOfTriangle=distance;var angle=Math.asin(heightOfTriangle/Math.sqrt(heightOfTriangle*heightOfTriangle+widthOfTriangle*widthOfTriangle));var partialDistance=sumFlightDistance+distance-aDistance;var partialHeight=Math.tan(angle)*partialDistance;return(partialHeight+endPointHeight);}}sumFlightDistance=sumFlightDistance+distance;startPointHeight=endPointHeight;}return null;};this.createChartLineXLayers=function(){return this.createChartAxisXLine()+this.createAllChartAxisXDashes()+this.createAllAxisXTexts();};this.createChartLineYLayers=function(){return this.createChartAxisYLine()+this.createAllChartAxisYDashes()+this.createAllAxisYTexts();};this.createChartAxisXLine=function(){var path=this.createEmptyElementString('path',{"style":'fill:none;stroke:'+this.axis_line_colour+';stroke-width:'+this.axis_x_line_width+';stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none;stroke-dashoffset:0;display:inline',"d":'m '+this.getZeroPointView().x+','+((this.chart_lines_padding_top+this.y_shift)+this.getYAxisLength())+' '+this.getXAxisLength()+','+0+' ',"id":"path3774","inkscape:connector-curvature":"0"});return this.createSvgGroupString(path,{"inkscape:groupmode":"layer","id":"layer2","inkscape:label":"CHartLine X","style":"display:inline","sodipodi:insensitive":"true"});};this.createChartAxisYLine=function(){var path=this.createEmptyElementString('path',{"style":'fill:none;stroke:'+this.axis_line_colour+';stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none;stroke-dashoffset:0;display:inline',"d":'m '+this.chart_lines_padding_left+','+(this.chart_lines_padding_top+this.y_shift)+' '+0+','+this.getYAxisLength(),"id":"path3774","inkscape:connector-curvature":"0"});return this.createSvgGroupString(path,{"inkscape:groupmode":"layer","id":"layer2","inkscape:label":"CHartLine Y","style":"display:inline","sodipodi:insensitive":"true"});};this.createAllChartAxisXDashes=function(){var retVal='';for(var i=0;i<this.axis_x_dash_steps.length;i++){var iAxisXDashStep=this.axis_x_dash_steps[i];retVal=retVal+this.createChartAxisXDashes(iAxisXDashStep);}return retVal;};this.createChartAxisXDashes=function(aDashStep){if(isUndefinedOrIsNull(aDashStep)){return'';}var axisXDashStep=aDashStep;var axisXDashCount=axisXDashStep.getAxisDashCount();if(axisXDashCount<=0){return'';}var yPosition=this.getZeroPointView().y;var axisDashStepView=axisXDashStep.getAxisDashStepView();var retVal='';for(var i=0;i<axisXDashCount;i++){retVal=retVal+this.createEmptyElementString('use',{"class":"semanticzoomable","xlink:href":"#axisXDash","x":(this.chart_lines_padding_left+((i+1)*axisDashStepView)),"y":yPosition});}return this.createPresentationUnitSvgGroup(retVal,axisXDashStep.showAttribute);};this.createAllChartAxisYDashes=function(){var retVal='';for(var i=0;i<this.axis_y_dash_steps.length;i++){retVal=retVal+this.createChartAxisYDashes(this.axis_y_dash_steps[i]);}return retVal;};this.createChartAxisYDashes=function(aDashStep){if(isUndefinedOrIsNull(aDashStep)){return'';}var axisYDashStep=aDashStep;var axisYDashCount=axisYDashStep.getAxisDashCount();if(axisYDashCount<=0){return'';}var xPosition=this.getZeroPointView().x-this.axis_y_dash_length;var axisYDashStepView=axisYDashStep.getAxisDashStepView();var retVal='';for(var i=0;i<axisYDashCount;i++){retVal=retVal+this.createEmptyElementString('use',{"xlink:href":"#axisYDash","x":xPosition,"y":(this.getZeroPointView().y-((i+1)*axisYDashStepView))});}return this.createPresentationUnitSvgGroup(retVal,axisYDashStep.showAttribute);};this.createAllAxisXTexts=function(){var retVal='';for(var i=0;i<this.axis_x_dash_steps.length;i++){var iDashStep=this.axis_x_dash_steps[i];retVal=retVal+this.createAxisXTexts(iDashStep);}return retVal;};this.createAxisXTexts=function(aDashStep){if(isUndefinedOrIsNull(aDashStep)){return'';}var axisXDashStep=aDashStep;var axisXDashStepText=axisXDashStep.getAxisDashStepText();var axisXDashCount=axisXDashStep.getAxisDashCount();if(axisXDashCount<=0){return'';}var yPosition=this.getZeroPointView().y+this.axis_x_dash_length;var axisDashStepView=axisXDashStep.getAxisDashStepView();var retVal='';for(var i=0;i<axisXDashCount;i++){var textTspan=this.createSvgTspanString(HtmlUtils.encodeForHTML(parseFloat(((i+1)*axisXDashStepText)).toFixed(0)),{"sodipodi:role":"line","class":"semanticzoomable","id":"tspan3813","x":(this.chart_lines_padding_left+((i+1)*axisDashStepView)+this.axis_text_padding_x),"y":yPosition});retVal=retVal+this.createSvgTextString(textTspan,{"xml:space":"preserve","style":'font-size:12px;font-style:normal;font-weight:normal;line-height:125%;letter-spacing:0px;word-spacing:0px;fill:#ffffff;fill-opacity:1;stroke:none;font-family:'+this.font_family,"x":(this.chart_lines_padding_left+((i+1)*axisDashStepView)+this.axis_text_padding_x),"y":yPosition,"id":'text'+i,"sodipodi:linespacing":"125%"});}retVal=retVal+this.createEmptyElementString('rect',{"style":'fill:'+this.grey_block_colour+';',"x":(this.getZeroPointView().x+this.getXAxisLength()-30),"y":(this.getZeroPointView().y+this.axis_x_line_width),"width":(this.svg_width-this.getZeroPointView().x-this.getXAxisLength()+30),"height":this.svg_height});var textLegendTspan=this.createSvgTspanString(HtmlUtils.encodeForHTML(axisXDashStep.legend),{"sodipodi:role":"line","id":"tspan3813","x":(this.chart_lines_padding_left+this.getXAxisLength()-this.axis_x_legend_length),"y":yPosition});var textLegend=this.createSvgTextString(textLegendTspan,{"xml:space":"preserve","style":'font-size:12px;font-style:normal;font-weight:normal;line-height:125%;letter-spacing:0px;word-spacing:0px;fill:#ffffff;fill-opacity:1;stroke:none;font-family:'+this.font_family,"x":(this.chart_lines_padding_left+this.getXAxisLength()-this.axis_x_legend_length),"y":yPosition,"id":'text'+i,"sodipodi:linespacing":"125%"});retVal=retVal+textLegend;return this.createPresentationUnitSvgGroup(retVal,axisXDashStep.showAttribute);};this.createAllAxisYTexts=function(){var retVal='';for(var i=0;i<this.axis_y_dash_steps.length;i++){retVal=retVal+this.createAxisYTexts(this.axis_y_dash_steps[i]);}return retVal;};this.createAxisYTexts=function(aDashStep){if(isUndefinedOrIsNull(aDashStep)){return'';}var axisYDashStep=aDashStep;var axisYDashStepText=axisYDashStep.getAxisDashStepText();var axisYDashCount=axisYDashStep.getAxisDashCount();if(axisYDashCount<=0){return'';}var xPosition=this.getZeroPointView().x-this.axis_y_dash_length;var axisDashStepView=axisYDashStep.getAxisDashStepView();var retVal='';for(var i=0;i<axisYDashCount;i++){var textTspan=this.createSvgTspanString(HtmlUtils.encodeForHTML(parseFloat(((i+1)*axisYDashStepText)).toFixed(0)),{"sodipodi:role":"line","id":"tspan3813","x":xPosition,"y":(this.getZeroPointView().y-((i+1)*axisDashStepView)-this.axis_y_dash_text_padding_bottom)});retVal=retVal+this.createSvgTextString(textTspan,{"xml:space":"preserve","style":'font-size:12px;font-style:normal;font-weight:normal;line-height:125%;letter-spacing:0px;word-spacing:0px;fill:#ffffff;fill-opacity:1;stroke:none;font-family:'+this.font_family,"x":xPosition,"y":(this.getZeroPointView().y-((i+1)*axisDashStepView)-this.axis_y_dash_text_padding_bottom),"id":'text'+i,"sodipodi:linespacing":"125%"});}var yPositionYLegend=(this.getZeroPointView().y-((axisYDashCount+1)*axisDashStepView)-15);var textLegendTspan=this.createSvgTspanString(HtmlUtils.encodeForHTML(axisYDashStep.legend),{"sodipodi:role":"line","id":"tspan3813","x":xPosition,"y":yPositionYLegend});retVal=retVal+this.createSvgTextString(textLegendTspan,{"xml:space":"preserve","style":'font-size:12px;font-style:normal;font-weight:normal;line-height:125%;letter-spacing:0px;word-spacing:0px;fill:#ffffff;fill-opacity:1;stroke:none;font-family:'+this.font_family,"x":xPosition,"y":yPositionYLegend,"id":'text'+i,"sodipodi:linespacing":"125%"});return this.createPresentationUnitSvgGroup(retVal,axisYDashStep.showAttribute);};this.createPresentationUnitSvgGroup=function(aContent,aPresentationUnit){if(isUndefinedOrIsNull(aPresentationUnit)){aPresentationUnit=this.mPresentationUnit;}if(isUndefinedOrIsNull(aContent)){aContent='';}var opacity=0;if(aPresentationUnit===this.mPresentationUnit){opacity=1;}var retVal='<g class="'+this.mPresentationUnitAttributeName+'" '+this.mPresentationUnitAttributeName+'="'+aPresentationUnit+'" opacity="'+opacity+'">';retVal=retVal+aContent+'</g>';return retVal;};this.createGreyBlocksLayer=function(){var rect=this.createEmptyElementString('rect',{"style":'fill:'+this.grey_block_colour+';',"x":"0","y":"0","width":this.getZeroPointView().x,"height":this.svg_height});return this.createSvgGroupString(rect,{});};this.createErrorMessageBox=function(){var retVal='';for(var i=0;i<this.mErrorModels.length;i++){var iError=this.mErrorModels[i];retVal+='<text x="50" y="50" style="fill: white; stroke: #000000;">'+iError.title+"\n"+iError.segmentName+"\n"+iError.message+'</text>';}return retVal;};this.createMetadataElement=function(){return'<metadata\n\     id="metadata7">\n\    <rdf:RDF>\n\      <cc:Work\n\         rdf:about="">\n\        <dc:format>image/svg+xml</dc:format>\n\        <dc:type\n\           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />\n\        <dc:title></dc:title>\n\      </cc:Work>\n\    </rdf:RDF>\n\  </metadata>';};this.createSodipodiElement=function(){return'<sodipodi:namedview\n\     id="base"\n\     pagecolor="#ffffff"\n\     bordercolor="#666666"\n\     borderopacity="1.0"\n\     inkscape:pageopacity="0.0"\n\     inkscape:pageshadow="2"\n\     inkscape:zoom="0.98994949"\n\     inkscape:cx="432.35164"\n\     inkscape:cy="1053.168"\n\     inkscape:document-units="px"\n\     inkscape:current-layer="layer8"\n\     showgrid="false"\n\     inkscape:window-width="1920"\n\     inkscape:window-height="1005"\n\     inkscape:window-x="-9"\n\     inkscape:window-y="-9"\n\     inkscape:window-maximized="1" />';};this.createDefsElement=function(){return'<defs id="defs4">\n\     '+this.createDefElementOfAxisDashes()+'\n\     '+this.createDefElementOfObstacles()+'\n\     '+this.createDefElementOfParachute()+'\n\     '+this.createDefElementOfWayPoints()+'\n\    </defs>';};this.createDefElementOfAxisDashes=function(){return this.createDefElementOfAxisXDash()+this.createDefElementOfAxisYDash();};this.createDefElementOfAxisXDash=function(){return'<path style="fill:'+this.axis_line_colour+';stroke:'+this.axis_line_colour+';stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"\n\       d="m 0,0 0,'+this.axis_x_dash_length+'"\n\       id="axisXDash"\n\       inkscape:connector-curvature="0" />';};this.createDefElementOfAxisYDash=function(){return'<path style="fill:'+this.axis_line_colour+';stroke:'+this.axis_line_colour+';stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"\n\       d="m 0,0 '+this.axis_y_dash_length+',0"\n\       id="axisYDash"\n\       inkscape:connector-curvature="0" />';};this.createDefElementOfWayPoints=function(){return'<path style="fill:'+this.axis_line_colour+';stroke:'+this.axis_line_colour+';stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"\n\       d="m 0,0 0,'+this.waypoint_dash_length+'"\n\       id="waypointDash"\n\       inkscape:connector-curvature="0" />';};this.createDefElementOfObstacles=function(){return''+this.createDefElementAntena()+this.createDefElementAntenaLight()+this.createDefElementBalloon()+this.createDefElementBuildingHigh()+this.createDefElementBuildingHighLight()+this.createDefElementCoolingTower()+this.createDefElementCoolingTowerLight()+this.createDefElementChimney()+this.createDefElementChimneyLight()+this.createDefElementMastPower()+this.createDefElementMastPowerLight()+this.createDefElementOtherObstacle()+this.createDefElementParachute()+this.createDefElementRogallo()+this.createDefElementTower()+this.createDefElementTowerLight()+this.createDefElementWindPower()+this.createDefElementWindPowerLight()+this.createDefElementAixmAhp()+this.createDefElementAixmDme()+this.createDefElementAixmVor()+this.createDefElementAixmNdb();};this.createDefElementAntena=function(){return'<g id="'+this.obstacle_antena_id+'" transform="translate(-279.1135,-276.31506)">\n\<path d="m291.125,317.75-.25.125-10,5-.25093.85827 10.25093,5.01673 .25.125 .21875-.125 10-5v-.875l-10-5-.21875-.125zm0,1.125 8.875,4.4375-8.875,4.4375-8.90625-4.4375 8.90625-4.4375z" fill-rule="evenodd"/>\n\<path d="m290.625,283.1875v.0625c-2e-005,9e-005-.0147.54837-10,40.48954l.71875.01046 10-5 .28125-.125v-.3125-35l-1-.125zm0,4.125v30.6875l-8.78125,4.375c4.70317-18.81265 7.28781-29.08876 8.5-33.9375l.28125-1.125z" fill-rule="evenodd"/>\n\<path d="m291.59375,283.1875-.96875.125v.125 44.875l.71875.4375 10-5 .34375-.15625-.09375-.40625-9.96875-39.875-.03125-.125zm.03125,4.25 8.90625,35.625-8.90625,4.4375v-40.0625z" fill-rule="evenodd"/>\n\<path d="m290.75,288.96875-2,2 .125.78125 1.375.6875-2.0625,2 .09375.78125 1.9375,1.125-3.40625,2.5625 .0625.84375 3.28125,1.625-4.875,3.53125 .0625.84375 4.8125,2.625-6.59375,4.53125 .03125.84375 6.375,3.5-8.5625,3.59375 .40625.9375 9.5-4 .9375-.40625-.90625-.5-6.5625-3.625 6.625-4.53125 .65625-.46875-.71875-.375-4.84375-2.625 4.90625-3.53125 .65625-.46875-.71875-.375-3.28125-1.65625 3.34375-2.5 .59375-.46875-.625-.375-2-1.1875 2.09375-2 .5-.5-.625-.3125-1.40625-.6875 1.53125-1.53125-.71875-.6875z" fill-rule="evenodd"/>\n\<path d="m291.46875,288.96875-.71875.6875 1.53125,1.53125-1.40625.6875-.625.3125 .53125.5 2.0625,2-1.96875,1.1875-.65625.375 .59375.46875 3.34375,2.5-3.28125,1.65625-.71875.375 .65625.46875 4.90625,3.53125-4.84375,2.625-.71875.375 .6875.46875 6.59375,4.5625-6.5625,3.59375-.90625.5 .9375.40625 9.53125,4 .375-.9375-8.5625-3.59375 6.375-3.5 .03125-.84375-6.59375-4.53125 4.8125-2.625 .0625-.84375-4.875-3.53125 3.28125-1.625 .0625-.84375-3.375-2.53125 1.9375-1.15625 .09375-.78125-2.09375-2 1.375-.6875 .125-.78125-2-2z" fill-rule="evenodd"/>\n\<path d="m291.1135,280.82734c-.82253,0-1.5.67747-1.5,1.5s.67747,1.5 1.5,1.5 1.5-.67747 1.5-1.5-.67747-1.5-1.5-1.5zm0,1c.28147,0 .5.21853.5.5s-.21853.5-.5.5-.5-.21853-.5-.5 .21853-.5.5-.5z"/>\n\<path d="m294.34783,285.37234c1.706-1.76177 1.64572-4.54146-.08839-6.27557-1.75259-1.75259-4.61138-1.75258-6.36396,0s-1.75259,4.61137 0,6.36396l.7071-.70711c-1.36999-1.37-1.37-3.57974 0-4.94975s3.57975-1.36999 4.94975,0c1.35651,1.35651 1.33451,3.57163 0,4.94975l.7955.61872z"/>\n\</g>';};this.createDefElementAntenaLight=function(){return'<g id="'+this.obstacle_antena_light_id+'" transform="scale(0.00635)">\  <metadata id="CorelCorpID_0Corel-Layer"/>\  <path class="fil0" d="M1694 6537l-40 20 -1614 807 -40 138 1654 809 40 21 35 -21 1613 -806 0 -141 -1613 -807 -35 -20zm0 181l1431 716 -1431 716 -1437 -716 1437 -716z"/>\  <path class="fil0" d="M1613 962l0 10c0,0 -2,89 -1613,6531l116 2 1613 -807 45 -20 0 -50 0 -5646 -161 -20zm0 665l0 4950 -1416 706c758,-3034 1175,-4692 1371,-5474l45 -182z"/>\  <path class="fil0" d="M1769 962l-156 20 0 20 0 7239 116 70 1613 -806 56 -25 -16 -66 -1608 -6432 -5 -20zm5 686l1437 5746 -1437 716 0 -6462z"/>\  <polygon class="fil0" points="1633,1895 1311,2217 1331,2343 1553,2454 1220,2777 1235,2903 1548,3084 998,3497 1008,3634 1538,3896 751,4465 761,4601 1538,5025 474,5756 479,5892 1507,6456 126,7036 192,7187 1724,6542 1875,6477 1729,6396 671,5811 1739,5080 1845,5005 1729,4944 948,4521 1739,3951 1845,3876 1729,3815 1200,3548 1739,3145 1835,3069 1734,3009 1412,2817 1749,2494 1830,2414 1729,2363 1502,2252 1749,2005 1633,1895 "/>\  <polygon class="fil0" points="1749,1895 1633,2005 1880,2252 1654,2363 1553,2414 1638,2494 1971,2817 1654,3009 1548,3069 1643,3145 2183,3548 1654,3815 1538,3876 1643,3951 2435,4521 1654,4944 1538,5005 1648,5080 2712,5816 1654,6396 1507,6477 1659,6542 3196,7187 3256,7036 1875,6456 2904,5892 2909,5756 1845,5025 2621,4601 2631,4465 1845,3896 2374,3634 2384,3497 1840,3089 2153,2903 2168,2777 1830,2454 2052,2343 2072,2217 1749,1895 "/>\  <path class="fil0" d="M1692 581c-133,0 -242,110 -242,242 0,133 109,242 242,242 133,0 242,-109 242,-242 0,-132 -109,-242 -242,-242zm0 162c45,0 81,35 81,80 0,46 -36,81 -81,81 -45,0 -81,-35 -81,-81 0,-45 36,-80 81,-80z"/>\  <rect class="fil1" transform="matrix(1.41072 0.00436649 -0.00436649 1.41072 1612.82 -0.201461)" width="93.1162" height="364.705" rx="47" ry="47"/>\  <rect class="fil1" transform="matrix(1.22172 -0.705362 0.705362 1.22172 1138.46 150.589)" width="93.1162" height="364.705" rx="47" ry="47"/>\  <rect class="fil1" transform="matrix(0.365122 -1.36265 1.36265 0.365122 830.123 619.632)" width="93.1162" height="364.705" rx="47" ry="47"/>\  <rect class="fil1" transform="matrix(-0.348126 -1.3671 1.3671 -0.348126 850.788 1067.21)" width="93.1162" height="364.705" rx="47" ry="47"/>\  <rect class="fil1" transform="matrix(-1.1133 -0.866433 0.866433 -1.1133 1158.42 1477.1)" width="93.1162" height="364.705" rx="47" ry="47"/>\  <rect class="fil1" transform="matrix(-1.22172 -0.705362 -0.705362 1.22172 2254.19 111.791)" width="93.1162" height="364.705" rx="47" ry="47"/>\  <rect class="fil1" transform="matrix(-0.365122 -1.36265 -1.36265 0.365122 2562.53 580.834)" width="93.1162" height="364.705" rx="47" ry="47"/>\  <rect class="fil1" transform="matrix(0.348126 -1.3671 -1.3671 -0.348126 2541.86 1028.41)" width="93.1162" height="364.705" rx="47" ry="47"/>\  <rect class="fil1" transform="matrix(1.1133 -0.866433 -0.866433 -1.1133 2234.23 1438.31)" width="93.1162" height="364.705" rx="47" ry="47"/>\ </g>';};this.createDefElementBalloon=function(){return'<g id="'+this.obstacle_balloon_id+'" transform="scale(0.045)">\  <metadata id="CorelCorpID_0Corel-Layer"/>\  <path class="fil0" d="M352 0c29,0 57,4 84,10 -9,6 -18,11 -25,14 -2,1 -5,2 -7,3 13,5 25,11 32,19 14,-9 26,-17 38,-24 134,49 229,178 229,330 0,28 -3,55 -9,82l0 0 0 0c-22,91 -129,260 -233,345 85,-170 151,-245 147,-453 -2,-115 -66,-196 -159,-251 0,9 -5,17 -12,23 84,50 144,123 145,228 4,204 -63,278 -147,448 -2,4 -2,7 -1,10 -15,15 -28,22 -48,26 39,-174 68,-254 67,-471 -1,-93 -19,-167 -46,-222 -9,3 -19,6 -29,7 31,50 53,120 54,216 2,212 -30,289 -68,467 -1,2 -1,5 -1,7 -10,2 -20,2 -28,2 0,-3 -1,-6 -1,-9 -39,-178 -70,-255 -69,-467 1,-97 23,-167 56,-217 -11,-2 -21,-5 -29,-9 -28,56 -47,130 -47,225 -2,218 28,298 67,473 -17,-4 -32,-12 -50,-24 3,-4 3,-9 1,-14 -84,-170 -151,-244 -147,-448 2,-107 63,-181 150,-230 -6,-7 -10,-15 -10,-24 0,0 0,0 0,-1 -96,54 -164,137 -166,255 -4,210 64,284 150,459 -88,-69 -171,-200 -211,-294 -19,-43 -29,-90 -29,-139 0,-146 88,-271 214,-324 18,2 14,1 54,19 6,-6 15,-12 25,-16 -5,-4 -11,-7 -17,-10 -7,-3 -13,-6 -19,-8 30,-9 62,-13 95,-13zm1 27c49,0 89,20 89,45 0,26 -40,46 -89,46 -49,0 -89,-20 -89,-46 0,-25 40,-45 89,-45zm-31 813c1,1 2,1 3,1 14,1 29,1 45,-1 2,2 5,1 7,-2 2,0 4,0 6,-1 26,-4 43,-12 60,-26l0 19c0,33 -37,60 -100,60 -62,0 -91,-23 -91,-60l0 -18c24,16 46,25 70,28z"/>\  <path class="fil1" d="M104 599c0,0 175,388 175,388 2,5 0,10 -5,12 -4,1 -10,-1 -12,-6 0,0 -175,-388 -175,-388 -2,-5 0,-10 5,-12 5,-2 10,1 12,6z"/>\  <path class="fil1" d="M593 599c0,0 -177,388 -177,388 -2,5 0,10 5,12 5,1 10,-1 13,-6 0,0 176,-388 176,-388 2,-5 0,-10 -4,-12 -5,-2 -11,1 -13,6z"/>\  <path class="fil0" d="M260 986l104 -33 68 33 0 124 -102 60 -70 -70 0 -114zm20 8l81 -28 55 28 -82 38 -54 -38z"/>\  <path class="fil0" d="M240 1025c0,0 -61,50 -33,79 28,29 42,9 44,-6 3,-15 -3,-71 -3,-71l-8 -2z"/>\  <path class="fil0" d="M455 1034c0,0 61,50 33,79 -28,28 -42,9 -45,-7 -2,-15 4,-70 4,-70l8 -2z"/>\ </g>';};this.createDefElementBuildingHigh=function(){return'<g id="'+this.obstacle_building_high_id+'" transform="scale(0.022)">\  <metadata id="CorelCorpID_0Corel-Layer"/>\  <path class="fil0" d="M62 761c129,0 257,0 386,0 0,16 0,33 0,49 -129,0 -257,0 -386,0 0,-16 0,-33 0,-49zm0 123c129,0 257,0 386,0 0,17 0,33 0,50 -129,0 -257,0 -386,0 0,-17 0,-33 0,-50zm0 124c129,0 257,0 386,0 0,17 0,33 0,50 -129,0 -257,0 -386,0 0,-17 0,-33 0,-50zm0 124c129,0 257,0 386,0 0,17 0,33 0,50 -129,0 -257,0 -386,0 0,-17 0,-33 0,-50zm0 124c129,0 257,0 386,0 0,17 0,33 0,50 -129,0 -257,0 -386,0 0,-17 0,-33 0,-50zm0 124c129,0 257,0 386,0 0,17 0,33 0,50 -129,0 -257,0 -386,0 0,-17 0,-33 0,-50zm0 124c129,0 257,0 386,0 0,17 0,33 0,50 -129,0 -257,0 -386,0 0,-17 0,-33 0,-50zm0 124c129,0 257,0 386,0 0,16 0,33 0,49 -129,0 -257,0 -386,0 0,-16 0,-33 0,-49zm355 -1303l27 0 0 -325 -27 0 0 325zm-114 0l27 0 0 -325 -27 0 0 325zm-65 130l268 0 0 -107 -268 0 0 107zm-197 25l484 0 0 71 -484 0 0 -71zm21 1272l386 0 0 49 -386 0 0 -49zm0 -1115l386 0 0 49 -386 0 0 -49zm-62 -69l583 0 0 778 -56 0 0 999 -527 0 0 -1777zm1011 818l-461 0 0 1099 461 0 0 -1099zm-76 82l-345 0 0 52 345 0 0 -52zm0 120c-115,0 -230,0 -345,0 0,17 0,35 0,53 115,0 230,0 345,0 0,-18 0,-36 0,-53zm0 120c-115,0 -230,0 -345,0 0,18 0,35 0,53 115,0 230,0 345,0 0,-18 0,-35 0,-53zm0 120c-115,0 -230,0 -345,0 0,18 0,35 0,53 115,0 230,0 345,0 0,-18 0,-35 0,-53zm0 120c-115,0 -230,0 -345,0 0,18 0,35 0,53 115,0 230,0 345,0 0,-18 0,-35 0,-53zm0 120c-115,0 -230,0 -345,0 0,18 0,35 0,53 115,0 230,0 345,0 0,-18 0,-35 0,-53zm0 120l-345 0 0 53 345 0 0 -53z"/>\ </g>';};this.createDefElementBuildingHighLight=function(){return'<g id="'+this.obstacle_building_high_light_id+'" transform="scale(0.022)">\  <metadata id="CorelCorpID_0Corel-Layer"/>\  <path class="fil0" d="M62 975c129,0 257,0 386,0 0,17 0,33 0,50 -129,0 -257,0 -386,0 0,-17 0,-33 0,-50zm0 124c129,0 257,0 386,0 0,17 0,33 0,50 -129,0 -257,0 -386,0 0,-17 0,-33 0,-50zm0 124c129,0 257,0 386,0 0,17 0,33 0,50 -129,0 -257,0 -386,0 0,-17 0,-33 0,-50zm0 124c129,0 257,0 386,0 0,16 0,33 0,49 -129,0 -257,0 -386,0 0,-16 0,-33 0,-49zm0 124c129,0 257,0 386,0 0,16 0,33 0,49 -129,0 -257,0 -386,0 0,-16 0,-33 0,-49zm0 124c129,0 257,0 386,0 0,16 0,33 0,49 -129,0 -257,0 -386,0 0,-16 0,-33 0,-49zm0 124c129,0 257,0 386,0 0,16 0,33 0,49 -129,0 -257,0 -386,0 0,-16 0,-33 0,-49zm0 124c129,0 257,0 386,0 0,16 0,33 0,49 -129,0 -257,0 -386,0 0,-16 0,-33 0,-49zm355 -1304l27 0 0 -324 -27 0 0 324zm-114 0l27 0 0 -324 -27 0 0 324zm-65 131l268 0 0 -107 -268 0 0 107zm-197 25l484 0 0 71 -484 0 0 -71zm21 1272l386 0 0 49 -386 0 0 -49zm0 -1116l386 0 0 50 -386 0 0 -50zm-62 -68l583 0 0 778 -56 0 0 998 -527 0 0 -1776zm1011 817l-461 0 0 1099 461 0 0 -1099zm-76 82l-345 0 0 53 345 0 0 -53zm0 121c-115,0 -230,0 -345,0 0,17 0,35 0,52 115,0 230,0 345,0 0,-17 0,-35 0,-52zm0 120c-115,0 -230,0 -345,0 0,17 0,35 0,52 115,0 230,0 345,0 0,-17 0,-35 0,-52zm0 120c-115,0 -230,0 -345,0 0,17 0,35 0,52 115,0 230,0 345,0 0,-17 0,-35 0,-52zm0 120c-115,0 -230,0 -345,0 0,17 0,35 0,53 115,0 230,0 345,0 0,-18 0,-36 0,-53zm0 120c-115,0 -230,0 -345,0 0,18 0,35 0,53 115,0 230,0 345,0 0,-18 0,-35 0,-53zm0 120l-345 0 0 53 345 0 0 -53z"/>\  <rect class="fil0" transform="matrix(0.363994 1.36296 -1.36296 0.363994 535.045 113.934)" width="21.8861" height="85.7204" rx="11" ry="11"/>\  <rect class="fil0" transform="matrix(1.07139 0.91775 -0.91775 1.07139 465.954 23.2976)" width="21.8861" height="85.7204" rx="11" ry="11"/>\  <rect class="fil0" transform="matrix(1.40653 -0.10864 0.10864 1.40653 342.642 1.23498)" width="21.8861" height="85.7204" rx="11" ry="11"/>\  <rect class="fil0" transform="matrix(1.17361 -0.782799 0.782799 1.17361 249.341 39.2719)" width="21.8861" height="85.7204" rx="11" ry="11"/>\  <rect class="fil0" transform="matrix(0.447054 -1.33801 1.33801 0.447054 192.886 138.738)" width="21.8861" height="85.7204" rx="11" ry="11"/>\ </g>';};this.createDefElementCoolingTower=function(){return'<g id="'+this.obstacle_cooling_tower_id+'" transform="scale(0.012)">\  <metadata id="CorelCorpID_0Corel-Layer"/>\  <path class="fil0" d="M62 3599l-1 1 -7 -6 -6 -3 1 -1 -11 -9c-4,-3 -8,-6 -11,-10 -7,-6 -13,-12 -18,-19 -8,-9 -8,-22 -8,-33 -1,-13 -1,-26 -1,-39 0,-38 0,-76 0,-114 1,-56 1,-112 2,-168l51 -18c4,5 8,10 13,14 21,20 48,35 75,47 33,15 68,26 102,36l24 7 14 4 39 8c18,4 36,8 53,11 110,21 221,34 333,43 28,2 57,4 85,6l33 2 28 2 30 1c76,3 152,5 227,5 71,0 142,-2 213,-5l34 -1 0 0 15 -1c9,0 18,-1 27,-1l17 -1 0 0 27 -2c24,-1 48,-3 71,-5 112,-9 223,-22 332,-43 18,-3 36,-7 54,-11l39 -9 14 -3 23 -7c35,-10 70,-21 103,-36 26,-12 54,-27 75,-47 5,-4 9,-9 13,-14l51 18c1,56 1,112 2,168 0,38 0,76 0,114 0,13 0,26 -1,39 0,11 0,24 -8,33 -5,7 -12,13 -18,19 -3,4 -7,7 -10,10l-12 9 1 1 -6 3 -7 6 -1 -1 -13 8c-14,8 -28,15 -43,22 -35,16 -72,28 -110,39 -44,12 -90,22 -135,31 -36,7 -72,13 -108,18l-58 9 0 -1c-11,1 -22,3 -33,4l0 0 -46 5c-31,3 -62,6 -93,9 -118,9 -236,14 -355,15l-51 1 0 -1c-1,0 -2,0 -3,0 -3,0 -7,0 -11,0l0 1 -52 -1c-115,-1 -230,-6 -345,-15 -24,-2 -48,-5 -72,-7l-47 -4 0 -1 -2 0c-17,-2 -34,-4 -51,-6l1 1 -58 -9c-37,-5 -73,-11 -109,-18 -46,-9 -91,-19 -135,-31 -38,-11 -75,-23 -111,-39 -14,-7 -28,-14 -42,-22l-13 -8zm2101 -40c3,-3 7,-6 10,-8 5,-6 10,-11 15,-17 5,-6 0,-336 0,-336 -5,6 -10,12 -15,17 -24,22 -54,39 -83,52 -34,15 -71,27 -107,38l0 0 180 254zm-420 130c36,-5 72,-11 108,-18 44,-9 89,-18 132,-31 36,-10 73,-22 107,-37 13,-6 27,-13 40,-21l-182 -255 -205 362zm-92 12c14,-2 29,-3 44,-5l210 -372c-18,4 -36,8 -54,11 -111,21 -223,34 -335,43 -24,2 -48,4 -72,6l207 317zm-488 29c118,-2 235,-6 353,-16 30,-2 61,-5 92,-8l-208 -320c-9,1 -18,1 -27,2l-210 342zm-73 0c7,0 13,0 19,0 2,0 4,0 5,0l209 -340c-71,3 -143,4 -214,4 -76,0 -152,-1 -228,-5l209 341zm-459 -22c24,2 48,4 72,6 114,9 229,14 344,15l-210 -339 -206 318zm-106 -12c19,2 39,5 58,7l206 -318c-28,-2 -57,-4 -86,-7 -112,-9 -225,-22 -335,-43 -18,-3 -36,-7 -54,-11l211 372zm-436 -114c13,8 27,15 40,21 34,15 71,27 107,37 43,13 88,22 132,31 36,7 72,13 108,18l-205 -362 -182 255zm-58 -384c0,0 -5,330 0,336 4,6 10,11 15,17 3,2 7,5 10,8l181 -254 -1 0c-36,-11 -73,-23 -107,-38 -29,-13 -59,-30 -83,-52 -5,-5 -11,-11 -15,-17zm1684 -1897c-116,300 -126,601 -56,901 67,287 208,575 444,862 16,15 30,23 32,49 0,108 -459,196 -1026,196 -566,0 -1025,-88 -1025,-196 14,-25 26,-44 33,-50 235,-287 376,-574 443,-861 71,-300 60,-601 -56,-901 -2,-3 -3,-7 -3,-10 0,-47 272,-86 609,-86 336,0 608,39 608,86 0,3 -1,7 -3,10zm-759 -537c7,0 13,0 19,1 -2,-11 -3,-22 -3,-33 0,-92 74,-167 166,-167 17,0 33,3 48,7 -15,-25 -24,-54 -24,-86 0,-92 75,-166 167,-166 44,0 85,17 115,46 30,-33 74,-54 123,-54 23,0 45,4 65,13 -1,-8 -2,-17 -2,-25 0,-99 80,-179 179,-179 78,0 144,51 168,121 33,-40 83,-65 139,-65 46,0 89,18 121,47 0,-98 80,-178 178,-178 84,0 155,58 174,137 14,-4 30,-6 46,-6 98,0 178,80 178,178 0,32 -8,62 -22,87 16,27 25,58 25,92 0,75 -47,139 -112,165 -13,87 -87,153 -177,153 -20,0 -40,-3 -58,-9 -31,27 -72,44 -117,44 -65,0 -122,-35 -153,-87 -23,10 -47,15 -73,15 -34,0 -66,-9 -93,-26 -24,64 -85,110 -157,110 0,0 -1,0 -1,0 -8,84 -79,150 -166,150 -54,0 -103,-26 -133,-67 -26,58 -84,99 -152,99 -57,0 -106,-28 -137,-71 -25,15 -54,23 -85,23 -44,0 -85,-17 -114,-45 -26,46 -75,77 -132,77 -83,0 -151,-67 -151,-151 0,-83 68,-150 151,-150zm486 -458c36,-26 79,-40 125,-40 6,0 13,0 20,1 16,-109 109,-192 222,-192 73,0 140,36 182,93 36,-24 80,-37 125,-37 30,0 60,6 88,18 31,-87 114,-149 211,-149 89,0 169,53 205,131 5,0 10,0 15,0 124,0 224,100 224,224 0,30 -6,59 -17,86 13,29 20,61 20,93 0,83 -46,158 -118,197 -25,98 -114,167 -217,167 -16,0 -32,-1 -48,-5 -37,26 -81,40 -127,40 -66,0 -128,-29 -171,-79 -18,5 -36,7 -55,7 -25,0 -49,-4 -73,-12 -32,48 -82,82 -139,92 -26,90 -108,154 -205,154 -45,0 -89,-14 -125,-41 -40,46 -98,73 -160,73 -56,0 -109,-22 -149,-61 -23,9 -48,13 -73,13 -37,0 -73,-9 -105,-27 -37,37 -87,59 -141,59 -109,0 -197,-88 -197,-197 0,-98 73,-180 167,-194 6,-105 89,-190 193,-200 -2,-11 -3,-22 -3,-34 0,-117 95,-212 213,-212 40,0 79,11 113,32zm1376 3187l0 0 -46 5c-26,3 -52,5 -78,7 -100,8 -200,13 -300,13l-51 1 0 0c-4,0 -7,0 -11,0l-16 0 -73 -119 1 -8c1,-62 0,-124 -1,-186l0 -29 29 1c25,0 51,0 76,0 60,0 120,-1 179,-3l28 -1 0 0 15 -1c7,0 15,-1 22,-1l17 -1 0 0 21 -1c20,-2 39,-3 59,-5 94,-7 188,-18 281,-36 15,-3 30,-6 45,-9l31 -7 17 -5 16 -4c30,-9 59,-18 86,-31 22,-10 45,-22 63,-39 4,-3 7,-7 11,-11l50 18c0,47 1,94 1,142 0,32 1,64 0,96 0,11 0,22 0,33 -1,11 -1,22 -8,31 -5,6 -10,11 -16,17 -3,2 -6,5 -9,7l-6 6 1 1 -9 5 -9 8 -1 -2 -8 5c-11,7 -24,13 -36,19 -31,13 -62,24 -94,33 -38,11 -76,19 -115,26 -30,6 -61,11 -92,16l-57 8 1 -1c-5,1 -9,2 -14,2zm421 -147c3,-2 6,-5 8,-7 5,-5 9,-9 13,-14 4,-5 0,-284 0,-284 -4,5 -8,10 -13,14 -20,19 -45,33 -70,44 -29,13 -59,23 -90,32l0 0 152 215zm-355 110c31,-5 61,-10 91,-15 38,-7 75,-16 112,-26 31,-9 61,-19 90,-32 12,-5 23,-11 34,-17l-153 -216 -174 306zm-78 10c12,-1 25,-3 37,-4l178 -315c-15,4 -31,7 -46,10 -93,18 -189,29 -283,36 -20,2 -41,3 -61,5l175 268zm-474 24c5,0 11,0 16,0 2,0 3,0 4,0l177 -287c-60,2 -121,4 -181,4 -25,0 -51,-1 -77,-1 1,65 1,142 1,187l60 97zm62 0c99,-1 199,-5 298,-13 26,-2 52,-4 78,-7l-176 -270c-8,0 -15,1 -23,1l-177 289zm466 -2053c-98,254 -107,508 -47,762 57,243 176,486 375,729 14,12 25,19 28,41 0,92 -389,166 -868,166 -26,0 -52,-1 -77,-1 -1,-25 -1,-41 -1,-41 -5,6 -10,11 -16,17 -9,8 -19,16 -29,23l-8 -125c-3,-26 -16,-34 -32,-49 -159,-194 -275,-387 -354,-581 21,-60 39,-119 53,-179 59,-254 50,-508 -47,-762 -2,-3 -3,-6 -3,-8 0,-41 230,-73 514,-73 285,0 515,32 515,73 0,2 -1,5 -3,8zm-5 -1037c6,-1 12,-1 18,-1 61,0 116,30 150,77 30,-20 66,-32 103,-32 26,0 50,6 73,15 26,-71 94,-122 174,-122 73,0 138,43 168,108 4,0 8,0 12,0 102,0 185,82 185,184 0,24 -5,48 -15,71 11,24 17,49 17,76 0,68 -38,130 -97,162 -21,80 -94,137 -178,137 -14,0 -27,-1 -40,-4 -31,21 -67,33 -104,33 -55,0 -106,-24 -141,-65 -15,4 -30,6 -46,6 -20,0 -40,-4 -59,-10 -27,40 -68,67 -115,76 -21,73 -89,126 -168,126 -38,0 -74,-12 -104,-33 -32,37 -80,59 -131,59 -46,0 -90,-18 -122,-49 -20,7 -40,10 -61,10 -31,0 -60,-8 -86,-23 -30,31 -72,49 -116,49 -89,0 -162,-72 -162,-161 0,-81 60,-148 138,-159 1,-26 8,-51 20,-73 4,0 9,-1 13,-3 7,7 13,14 20,20 -10,20 -16,42 -16,65 0,9 1,18 2,27 -5,-1 -10,-1 -15,-1 -69,0 -124,56 -124,124 0,69 55,124 124,124 46,0 87,-26 108,-63 25,23 58,37 94,37 26,0 50,-7 70,-19 25,35 66,58 113,58 56,0 104,-33 125,-81 25,33 65,55 110,55 71,0 130,-54 136,-124 0,0 1,0 1,0 59,0 110,-38 129,-90 22,14 48,21 76,21 22,0 42,-4 60,-12 26,43 73,71 127,71 36,0 70,-13 96,-36 15,5 31,8 48,8 74,0 135,-55 145,-126 54,-21 92,-74 92,-136 0,-28 -7,-54 -20,-76 11,-21 18,-45 18,-71 0,-81 -66,-147 -147,-147 -13,0 -25,2 -37,5 -16,-65 -74,-113 -143,-113 -81,0 -147,66 -147,147 -26,-24 -61,-39 -100,-39 -46,0 -87,21 -114,54 -19,-58 -74,-100 -139,-100 -10,0 -20,1 -30,4 5,-13 9,-26 12,-40z"/>\ </g>';};this.createDefElementCoolingTowerLight=function(){return'<g id="'+this.obstacle_cooling_tower_light_id+'" transform="scale(0.0115)">\  <metadata id="CorelCorpID_0Corel-Layer"/>\  <path class="fil0" d="M75 4325l-1 2 -9 -8 -7 -4 1 -1 -14 -11c-4,-4 -8,-7 -13,-11 -7,-8 -15,-15 -22,-23 -9,-12 -9,-26 -9,-40 -1,-16 -1,-31 -1,-47 0,-46 0,-91 0,-137 1,-68 2,-135 3,-202l60 -22c5,6 10,12 16,17 26,24 58,42 90,57 40,17 82,31 123,43l29 8 17 5 47 10c21,5 42,9 64,13 132,25 265,41 399,52 34,2 68,5 103,7l39 2 34 2 36 2c91,4 182,5 273,5 85,0 170,-1 255,-5l42 -1 0 0 18 -1c11,-1 22,-1 33,-2l19 -1 0 0 33 -2c29,-2 57,-4 86,-6 133,-11 267,-27 399,-52 21,-4 43,-8 64,-13l47 -10 17 -5 28 -8c42,-12 83,-26 123,-43 32,-15 65,-33 90,-57 6,-5 11,-11 16,-17l61 22c1,67 2,134 2,202 0,46 1,91 0,137 0,16 0,31 -1,47 0,14 0,28 -9,40 -7,8 -14,15 -22,23 -4,4 -8,7 -12,11l-14 11 1 1 -7 4 -9 7 -1 -1 -15 9c-17,10 -34,19 -52,27 -43,19 -87,34 -132,46 -54,16 -108,28 -163,38 -43,8 -86,15 -130,22l-69 10 0 -1c-13,2 -27,4 -40,5l0 0 -56 6c-37,4 -74,7 -111,10 -142,12 -284,18 -426,19l-62 1 0 -1c-1,0 -2,0 -3,0 -4,0 -9,0 -14,0l0 1 -62 -1c-138,-2 -277,-7 -415,-19 -29,-2 -58,-5 -87,-7l-56 -6 1 0 -3 0c-20,-3 -41,-5 -61,-8l0 1 -69 -10c-44,-6 -88,-14 -131,-22 -55,-10 -109,-22 -162,-38 -45,-12 -90,-27 -133,-46 -17,-8 -34,-17 -51,-27l-15 -9zm2525 -49c3,-3 7,-6 11,-9 6,-7 13,-13 19,-20 5,-7 0,-404 0,-404 -6,7 -13,14 -19,20 -29,27 -64,47 -100,63 -41,18 -84,33 -128,45l-1 0 218 305zm-505 157c43,-6 86,-14 129,-22 54,-10 107,-22 159,-37 44,-12 87,-26 128,-45 16,-7 33,-15 48,-25l-218 -306 -246 435zm-112 14c18,-2 36,-4 53,-6l254 -447c-22,5 -44,10 -66,14 -133,25 -268,41 -403,52 -28,2 -57,4 -85,6l247 381zm-585 35c141,-2 282,-7 423,-19 37,-3 74,-6 111,-10l-250 -384c-10,1 -21,1 -32,2l-252 411zm-88 0c8,0 15,0 23,0 2,0 4,0 6,0l250 -408c-85,3 -170,5 -256,5 -91,0 -183,-2 -275,-6l252 409zm-551 -26c29,2 57,5 86,7 137,11 275,17 413,19l-252 -409 -247 383zm-128 -15c23,3 46,6 70,8l247 -382c-34,-2 -68,-4 -103,-7 -134,-11 -270,-27 -403,-52 -21,-4 -43,-9 -65,-13l254 446zm-524 -136c16,9 32,17 48,24 41,19 85,33 128,45 53,15 106,27 159,37 43,8 86,16 130,22l-246 -435 -219 307zm-70 -462c0,0 -6,397 0,404 6,7 12,13 19,20 3,3 7,6 11,10l217 -306 -1 0c-43,-12 -87,-27 -128,-45 -35,-16 -71,-36 -99,-63 -7,-6 -13,-13 -19,-20zm2023 -2280c-138,361 -151,723 -67,1084 81,345 251,690 534,1035 19,18 36,28 39,59 0,130 -552,235 -1233,235 -681,0 -1233,-105 -1233,-235 18,-30 32,-54 41,-60 283,-345 452,-690 532,-1034 85,-361 72,-723 -67,-1084 -3,-4 -4,-7 -4,-11 0,-58 327,-104 731,-104 404,0 732,46 732,104 0,4 -2,7 -5,11zm-911 -645c8,0 15,0 23,1 -3,-13 -4,-26 -4,-39 0,-111 90,-200 200,-200 20,0 39,2 58,8 -19,-30 -29,-66 -29,-104 0,-110 89,-200 200,-200 53,0 102,21 138,56 37,-40 89,-65 148,-65 28,0 54,5 78,16 -1,-10 -2,-20 -2,-31 0,-118 96,-214 214,-214 95,0 174,61 203,145 40,-48 99,-79 166,-79 57,0 108,22 146,57 0,-118 96,-214 214,-214 102,0 186,70 209,165 18,-5 36,-7 55,-7 118,0 214,96 214,214 0,38 -9,74 -27,104 20,33 31,70 31,110 0,91 -56,168 -135,200 -15,103 -104,183 -212,183 -25,0 -48,-4 -70,-11 -38,33 -87,53 -141,53 -78,0 -146,-42 -184,-105 -27,12 -56,19 -87,19 -42,0 -80,-12 -113,-32 -27,77 -101,132 -188,132 0,0 0,0 -1,0 -9,101 -95,181 -199,181 -65,0 -124,-32 -160,-80 -31,69 -101,118 -183,118 -68,0 -128,-34 -164,-86 -30,18 -65,29 -103,29 -53,0 -101,-21 -137,-55 -31,56 -90,93 -158,93 -100,0 -181,-81 -181,-181 0,-100 81,-181 181,-181zm584 -550c43,-32 95,-49 150,-49 8,0 16,1 24,1 19,-130 131,-229 266,-229 89,0 169,43 219,111 44,-29 96,-45 150,-45 37,0 73,7 106,22 38,-105 138,-179 254,-179 108,0 203,63 246,158 6,-1 12,-1 18,-1 149,0 270,121 270,270 0,36 -7,71 -21,104 16,34 24,72 24,110 0,100 -55,191 -141,238 -31,117 -138,201 -261,201 -20,0 -39,-2 -58,-7 -45,31 -98,48 -153,48 -79,0 -154,-35 -205,-94 -21,5 -44,8 -66,8 -30,0 -60,-5 -88,-14 -38,57 -98,98 -167,110 -31,108 -130,185 -246,185 -55,0 -107,-17 -150,-49 -48,55 -118,87 -193,87 -67,0 -131,-26 -178,-73 -29,11 -58,16 -89,16 -44,0 -88,-11 -126,-33 -44,45 -104,71 -169,71 -131,0 -237,-106 -237,-236 0,-118 88,-217 201,-234 7,-126 106,-228 232,-240 -3,-13 -4,-27 -4,-41 0,-141 115,-255 256,-255 48,0 95,13 136,39zm1654 3830l0 0 -55 6c-32,3 -63,6 -95,8 -120,10 -240,15 -360,16l-62 1 1 -1c-5,0 -9,0 -14,0l-19 0 -87 -142 0 -10c1,-74 0,-149 0,-223l-1 -35 35 1c31,0 61,0 92,0 72,0 144,-1 215,-4l33 -1 0 0 18 -1c9,0 18,-1 27,-1l20 -2 0 0 25 -1c24,-2 48,-3 72,-5 113,-9 226,-23 337,-44 18,-3 36,-7 54,-11l38 -8 19 -6 21 -5c35,-10 70,-22 103,-37 26,-12 54,-27 75,-47 4,-4 9,-8 13,-13l60 21c1,57 1,114 2,171 0,38 0,77 0,116 0,13 0,26 -1,40 0,12 0,26 -9,36 -6,7 -12,14 -19,20 -3,3 -7,7 -11,10l-7 6 1 2 -11 6 -11 9 -1 -2 -9 5c-14,9 -29,16 -44,23 -37,17 -75,29 -113,40 -45,13 -91,23 -137,32 -37,7 -74,13 -111,19l-69 10 1 -1c-6,0 -11,1 -16,2zm506 -177c3,-3 6,-6 9,-9 6,-5 11,-11 16,-16 5,-6 0,-342 0,-342 -5,6 -10,12 -16,17 -24,23 -54,40 -84,53 -35,16 -72,28 -108,38l-1 1 184 258zm-427 132c37,-5 73,-11 109,-18 45,-9 90,-19 135,-32 36,-10 73,-22 108,-38 14,-6 27,-13 41,-21l-185 -258 -208 367zm-94 12c15,-1 30,-3 44,-5l214 -378c-18,4 -36,8 -55,12 -112,21 -227,34 -340,43 -25,2 -49,4 -73,6l210 322zm-570 29c7,0 13,0 20,0 2,0 3,0 5,0l212 -345c-73,3 -145,4 -217,4 -31,0 -62,0 -93,0 1,78 2,171 1,224l72 117zm74 0c120,-1 240,-6 359,-15 31,-3 62,-6 93,-9l-211 -325c-9,1 -18,1 -27,2l-214 347zm561 -2467c-117,305 -128,610 -57,916 68,291 212,583 451,875 16,16 30,24 33,50 0,110 -466,199 -1042,199 -32,0 -63,0 -94,-1 0,-30 0,-49 0,-49 -6,7 -12,14 -19,20 -11,10 -23,19 -36,28l-9 -150c-3,-31 -19,-41 -39,-59 -191,-233 -330,-466 -425,-698 26,-72 47,-144 64,-215 71,-306 60,-611 -57,-916 -2,-4 -3,-7 -3,-10 0,-49 276,-88 618,-88 342,0 619,39 619,88 0,3 -2,6 -4,10zm-7 -1246c8,-1 15,-1 23,-1 73,0 139,35 180,92 36,-25 79,-38 124,-38 30,0 60,6 87,18 31,-86 113,-147 209,-147 88,0 166,52 202,130 5,0 10,-1 15,-1 122,0 221,100 221,222 0,29 -5,58 -17,85 13,29 20,60 20,91 0,82 -45,157 -116,195 -25,96 -113,165 -215,165 -16,0 -32,-1 -47,-5 -37,26 -81,39 -126,39 -65,0 -126,-29 -168,-77 -18,4 -37,7 -55,7 -25,0 -49,-5 -72,-12 -32,47 -82,81 -138,91 -26,88 -107,152 -202,152 -45,0 -89,-15 -124,-41 -39,45 -97,72 -158,72 -56,0 -109,-22 -147,-60 -24,9 -48,13 -73,13 -37,0 -73,-9 -104,-27 -36,37 -86,59 -139,59 -107,0 -194,-87 -194,-194 0,-98 72,-178 165,-192 2,-31 10,-61 24,-87 5,-1 11,-2 16,-3 8,8 16,16 24,24 -13,23 -20,49 -20,77 0,11 2,22 4,33 -7,-1 -13,-1 -19,-1 -83,0 -149,66 -149,149 0,82 66,149 149,149 56,0 104,-31 130,-77 29,28 69,45 113,45 31,0 60,-8 84,-23 30,43 80,70 136,70 67,0 124,-40 150,-97 30,40 78,66 132,66 86,0 156,-65 164,-149 0,0 0,0 1,0 71,0 131,-45 154,-108 27,16 59,26 93,26 25,0 50,-6 72,-16 31,52 87,86 151,86 45,0 85,-16 116,-43 18,6 37,9 57,9 89,0 163,-65 175,-151 65,-26 111,-89 111,-164 0,-33 -9,-64 -25,-90 14,-26 22,-55 22,-86 0,-98 -79,-177 -176,-177 -16,0 -31,2 -45,6 -19,-77 -89,-135 -172,-135 -97,0 -176,79 -176,176 -32,-29 -74,-47 -120,-47 -55,0 -105,25 -137,65 -24,-70 -90,-120 -167,-120 -13,0 -25,2 -37,4 6,-15 11,-31 14,-47zm-2607 754l0 0c-14,-8 -32,-2 -40,12l-78 154c-8,14 -2,32 12,39l0 0c15,8 33,2 40,-12l79 -154c7,-14 2,-32 -13,-39zm-214 -36l0 0c-16,2 -28,17 -26,33l22 171c2,16 17,28 33,25l0 0c16,-2 28,-16 26,-33l-22 -171c-2,-16 -17,-27 -33,-25zm-201 127l0 0c-10,13 -8,31 5,41l136 106c13,10 32,7 42,-5l0 0c10,-13 7,-32 -5,-42l-137 -105c-13,-10 -31,-8 -41,5zm-80 175l0 0c-2,16 9,31 25,34l171 25c16,3 31,-9 33,-25l0 0c3,-16 -9,-31 -25,-33l-170 -26c-16,-2 -31,9 -34,25zm50 212l0 0c8,14 26,19 40,11l150 -85c15,-8 20,-26 12,-40l0 0c-8,-14 -26,-19 -41,-11l-150 84c-14,8 -19,26 -11,41z"/>\ </g>';};this.createDefElementChimney=function(){return'<g id="'+this.obstacle_chimney_id+'"  transform="scale(0.025)">\  <metadata id="CorelCorpID_0Corel-Layer"/>\  <path class="fil0" d="M290 1810c3,15 0,31 2,46l0 1 0 0c2,31 4,62 5,94l1 4c-5,8 -8,12 -15,22l0 0c-15,24 -37,47 -62,62 -21,12 -47,18 -71,19l0 0 -1 0c-8,0 -14,-1 -22,-2l0 0c-17,-2 -35,-9 -50,-18 -17,-10 -32,-24 -45,-39l0 0 0 0c-12,-16 -23,-27 -32,-43l0 -5c0,-32 3,-63 4,-95 1,-32 1,-64 4,-96 1,-9 -1,-17 0,-26 1,-23 2,-46 4,-70l0 0 0 -1c1,-7 0,-16 0,-24 0,-7 1,-14 1,-22l0 0 0 0c2,-40 4,-80 6,-119 0,-9 -1,-17 0,-25 3,-32 3,-64 4,-96 0,-8 1,-15 1,-23 0,-8 1,-16 1,-24 0,-32 3,-63 4,-95 1,-9 0,-18 1,-26 2,-23 0,-48 3,-71 1,-8 0,-17 0,-25 1,-16 2,-31 3,-46 0,-9 0,-18 1,-26 2,-48 4,-95 6,-143 0,-8 0,-16 1,-25 1,-8 0,-16 0,-24 1,-16 2,-31 3,-47 0,-24 2,-49 2,-73 0,-8 2,-15 2,-23l0 0c1,-32 2,-64 4,-96l0 0 0 0c0,-9 -1,-18 0,-26 1,-16 2,-32 2,-48 0,-17 -3,-38 18,-44 16,-6 39,-4 56,-3 19,0 39,0 58,3 20,2 34,8 34,30 3,65 6,129 10,193 2,16 0,33 2,48 2,16 1,33 2,49 0,3 2,7 2,11 0,12 0,25 1,37l0 0c0,16 1,32 3,47 1,17 2,34 2,50 2,31 4,63 6,94 1,15 -1,32 1,47l0 0 1 1c6,119 12,238 18,357 7,118 13,236 19,354z"/>\  <path class="fil1" d="M9 1951c17,13 4,9 30,42 11,13 26,27 43,37 16,9 33,15 46,17 9,0 12,2 21,2 19,-1 45,-5 67,-18 25,-14 46,-37 59,-59 8,-14 8,-16 13,-21 -2,-31 -3,-62 -5,-93 -2,-14 0,-34 -2,-47 -6,-118 -13,-236 -19,-354 -6,-119 -12,-238 -19,-358 -2,-13 0,-33 -2,-47 -1,-32 -3,-64 -5,-95 0,-23 -5,-73 -5,-97 -1,-12 -1,-24 -2,-37 0,-6 -1,-5 -1,-11 -1,-16 0,-33 -2,-47 -2,-15 0,-35 -2,-49 -4,-65 -7,-129 -11,-193 1,-16 -8,-20 -25,-21 -16,-3 -37,-3 -57,-4 -20,-1 -40,-2 -53,3 -14,3 -12,14 -11,35 -1,17 -2,33 -3,49 -1,8 1,18 0,25 -1,32 -3,64 -4,96 0,8 -1,13 -1,23 0,21 -3,48 -3,74 -1,15 -2,31 -3,46 0,8 1,18 0,25 -1,8 -1,14 -1,24 -2,48 -4,96 -6,144 -1,8 -1,16 -1,25 -1,15 -2,31 -2,46 -1,8 0,19 -1,26 -2,16 -1,53 -3,71 -1,7 0,18 0,25 -2,31 -4,63 -4,95 0,9 -2,14 -2,24 0,10 -1,16 -1,23 -1,33 -1,66 -4,97 -1,7 0,16 0,24 -2,40 -4,80 -5,119 0,10 -2,15 -2,22 0,9 1,18 0,26 -1,23 -3,47 -4,70 0,8 1,18 0,26 -3,29 -3,62 -4,95 -1,32 -4,59 -4,95z"/>\  <path class="fil2" d="M93 858c15,3 30,6 44,6 15,1 30,-1 44,-2 1,0 1,0 2,0 0,-13 0,-25 0,-38 -15,2 -31,3 -46,2 -15,0 -30,-3 -45,-6 0,12 1,25 1,38z"/>\  <path class="fil2" d="M93 759c15,3 30,6 45,6 15,1 30,0 45,-2 0,-13 0,-25 0,-38 -15,2 -31,3 -46,2 -15,0 -30,-3 -45,-6 0,13 1,25 1,38z"/>\  <path class="fil2" d="M93 956c15,4 30,6 45,7 15,0 30,-1 45,-2 0,-13 0,-26 0,-38 -15,1 -31,3 -46,2 -15,-1 -30,-3 -45,-7 0,13 1,26 1,38z"/>\  <path class="fil2" d="M93 1056c15,4 30,6 46,7 15,1 30,-1 45,-3 0,-12 -1,-25 -1,-37 -15,2 -30,3 -45,2 -15,0 -30,-3 -45,-6 0,12 0,25 0,37z"/>\  <path class="fil2" d="M43 1679c14,8 29,15 44,19 15,5 30,7 45,8 0,-13 0,-25 0,-38 -15,-1 -30,-3 -45,-8 -15,-4 -30,-11 -45,-19 0,12 0,25 1,38z"/>\  <path class="fil2" d="M144 1310c15,0 30,0 45,-3 15,-3 30,-8 45,-14 0,-12 0,-25 -1,-37 -15,6 -29,10 -44,13 -15,3 -30,3 -45,4 0,12 0,25 0,37z"/>\  <path class="fil2" d="M93 660c15,3 30,6 45,6 15,1 30,0 45,-2 0,-12 0,-25 0,-38 -15,2 -30,3 -45,3 -15,-1 -30,-4 -45,-7 0,13 0,25 0,38z"/>\  <path class="fil2" d="M43 1481c14,8 29,15 44,19 15,5 29,7 44,8 1,-12 1,-25 1,-37 0,0 -1,0 -1,0 -15,-2 -30,-4 -45,-8 -15,-5 -30,-12 -45,-20 1,13 1,26 2,38z"/>\  <path class="fil2" d="M93 1453c15,3 30,6 45,7 15,0 30,-1 45,-3 0,-12 0,-25 0,-37 -15,1 -30,3 -45,2 -15,-1 -30,-4 -45,-7 0,13 0,25 0,38z"/>\  <path class="fil2" d="M144 1906c15,0 30,-1 45,-4 15,-2 30,-7 45,-14 0,-12 0,-25 -1,-37 -15,6 -29,11 -44,14 -15,2 -30,3 -45,3 0,13 0,25 0,38z"/>\  <path class="fil2" d="M144 1707c15,0 30,-1 45,-4 15,-2 29,-7 44,-13 0,-13 0,-26 0,-38 -15,6 -29,11 -44,14 -15,3 -30,3 -45,3 0,13 0,25 0,38z"/>\  <path class="fil2" d="M93 1650c15,4 30,7 45,7 15,1 30,0 45,-2 0,-13 0,-25 0,-38 -15,2 -30,3 -45,2 -15,0 -30,-3 -44,-6 -1,12 -1,25 -1,37z"/>\  <path class="fil2" d="M93 1155c15,4 30,6 45,7 15,1 30,-1 45,-3 0,-12 0,-25 0,-37 1,0 1,0 2,0 -14,1 -28,3 -42,2 -15,0 -29,-2 -43,-5 -2,0 -5,-1 -7,-1 0,12 0,25 0,37z"/>\  <path class="fil2" d="M144 1113c15,-1 30,-1 45,-4 15,-3 29,-7 44,-13 0,-13 0,-25 0,-38 -15,6 -29,11 -44,13 -15,3 -30,4 -45,4 0,12 0,25 0,38z"/>\  <path class="fil2" d="M144 1509c15,0 30,-1 45,-3 15,-3 29,-8 44,-14 0,-12 0,-25 0,-37 -15,5 -29,10 -44,13 -15,3 -30,3 -45,3 0,13 0,26 0,38z"/>\  <path class="fil2" d="M93 1254c15,3 30,6 45,7 15,0 30,-1 45,-3 0,-12 0,-25 0,-37 -15,1 -30,3 -45,2 -15,-1 -30,-3 -45,-7 0,13 0,25 0,38z"/>\  <path class="fil2" d="M43 1283c14,8 29,14 44,19 15,4 30,6 45,8 0,-13 0,-25 0,-38 -15,-2 -30,-4 -45,-8 -15,-4 -30,-11 -44,-19 0,13 0,25 0,38z"/>\  <path class="fil2" d="M93 1353c15,3 30,6 45,7 15,0 30,-1 45,-3 0,-12 0,-25 0,-38 -15,2 -30,4 -45,3 -15,-1 -30,-3 -45,-7 0,13 0,25 0,38z"/>\  <path class="fil2" d="M43 1383c14,8 29,15 44,19 15,4 30,6 45,8 0,-13 0,-25 0,-38 -15,-2 -30,-4 -45,-8 -15,-4 -30,-11 -44,-19 0,13 0,25 0,38z"/>\  <path class="fil2" d="M43 1779c14,8 29,15 44,19 15,5 30,7 45,8 0,-12 0,-25 0,-37 -15,-2 -30,-4 -45,-8 -15,-5 -30,-12 -44,-20 0,13 0,25 0,38z"/>\  <path class="fil2" d="M144 1410c15,0 30,0 45,-3 15,-3 29,-8 44,-14 0,-12 0,-25 0,-37 -14,6 -29,10 -44,13 -15,3 -30,4 -45,4 0,12 0,25 0,37z"/>\  <path class="fil2" d="M144 1807c15,0 30,-1 45,-3 15,-3 29,-8 44,-14 0,-13 0,-25 0,-38 -14,6 -29,11 -44,14 -15,2 -30,3 -45,3 0,13 0,26 0,38z"/>\  <path class="fil2" d="M93 1749c15,4 30,6 45,7 15,1 30,-1 44,-2 0,-13 1,-25 1,-38 -15,2 -30,3 -45,2 -15,0 -30,-3 -45,-6 0,12 0,25 0,37z"/>\  <path class="fil2" d="M43 1878c14,7 29,15 44,19 14,4 29,7 44,8 1,-12 1,-25 1,-38 -15,-1 -30,-3 -45,-8 -15,-4 -30,-11 -44,-19 0,12 0,25 0,38z"/>\  <path class="fil2" d="M93 1552c15,3 30,6 45,6 15,1 30,0 45,-2 0,-12 0,-25 0,-38 -15,2 -30,3 -45,3 -15,-1 -29,-4 -44,-7 0,13 -1,25 -1,38z"/>\  <path class="fil2" d="M93 1948c15,4 30,7 45,7 15,1 30,0 45,-2 0,-13 0,-25 0,-38 -15,2 -30,3 -45,2 -15,0 -29,-3 -44,-6 0,12 -1,25 -1,37z"/>\  <path class="fil2" d="M93 1849c15,4 30,7 45,7 14,1 29,0 44,-2 0,-12 0,-25 1,-38 -15,2 -30,3 -45,3 -15,-1 -30,-4 -45,-7 0,12 0,25 0,37z"/>\  <path class="fil2" d="M144 1014c15,0 29,-1 44,-4 15,-2 29,-7 44,-12 1,0 1,-1 1,-1 0,-6 0,-12 0,-18 0,-6 0,-12 0,-18 -15,5 -30,10 -45,12 -14,3 -29,3 -44,3 0,13 0,25 0,38z"/>\  <path class="fil2" d="M195 1951c13,-4 28,-8 41,-14 14,-7 28,-16 41,-25 2,-2 4,-3 5,-5 0,-11 -1,-23 -2,-35 -14,10 -28,19 -42,26 -14,7 -29,11 -43,15 0,12 0,25 0,38z"/>\  <path class="fil2" d="M43 1580c15,8 29,15 45,19 14,5 30,7 45,8 -1,-12 -1,-24 -1,-36 -15,-1 -30,-4 -45,-8 -15,-4 -30,-11 -44,-19 0,12 0,24 0,36z"/>\  <path class="fil2" d="M144 1608c15,0 30,-1 45,-3 15,-3 30,-8 45,-14 0,-12 0,-24 -1,-36 -15,6 -29,10 -44,13 -15,3 -30,4 -45,4 0,12 0,24 0,36z"/>\  <path class="fil2" d="M144 1211c15,0 29,0 44,-3 15,-3 29,-7 44,-13 1,0 1,0 1,0 0,-12 0,-25 0,-37 -15,6 -29,11 -44,14 -15,2 -30,3 -45,3 0,12 0,24 0,36z"/>\  <path class="fil2" d="M43 1976c14,8 29,15 44,20 15,4 30,6 45,8 0,-12 0,-24 0,-37 -15,-1 -30,-3 -45,-8 -15,-4 -30,-11 -44,-19 0,12 0,24 0,36z"/>\  <path class="fil2" d="M144 2005c15,0 30,-1 45,-4 14,-2 29,-8 44,-14 0,-12 0,-24 0,-36 -15,6 -29,11 -44,14 -15,3 -30,3 -45,3 0,13 0,25 0,37z"/>\  <path class="fil2" d="M144 914c14,-1 29,-1 43,-3 15,-3 29,-7 44,-13 -1,-12 -2,-24 -3,-36 -2,1 -4,1 -5,1 -13,5 -26,8 -40,10 -13,2 -26,3 -39,3 0,13 0,25 0,38z"/>\  <path class="fil2" d="M44 1185c15,7 30,14 45,19 15,4 30,6 46,7 -1,0 -2,0 -3,0 0,-12 0,-24 0,-37 -15,-1 -29,-3 -43,-7 -15,-4 -29,-11 -44,-18 0,12 -1,24 -1,36z"/>\  <path class="fil2" d="M48 1088c14,7 28,13 42,17 14,4 28,6 42,7 0,-13 0,-25 0,-38 -14,-1 -29,-3 -43,-7 -14,-4 -28,-10 -42,-17 0,0 1,1 2,1 0,13 -1,25 -1,37z"/>\  <path class="fil2" d="M195 1852c13,-3 26,-7 38,-13 13,-6 26,-13 39,-22 2,-1 3,-3 5,-4 0,-12 -1,-24 -2,-36 -1,1 -3,2 -4,3 -13,8 -26,16 -38,22 -13,5 -26,9 -38,12 0,13 0,25 0,38z"/>\  <path class="fil2" d="M52 992c13,6 26,11 40,15 13,3 27,5 40,6 0,-12 0,-25 0,-38 -2,0 -4,0 -5,0 -13,-1 -25,-3 -38,-7 -12,-3 -25,-8 -37,-14 0,12 0,25 0,38z"/>\  <path class="fil2" d="M55 893c13,6 26,11 39,14 13,4 26,5 39,6 0,-12 -1,-25 -1,-38 -6,0 -23,-2 -39,-6 -17,-5 -32,-11 -36,-12 -1,12 -1,24 -2,36z"/>\  <path class="fil2" d="M144 815c13,0 27,-1 40,-3 13,-2 27,-6 40,-10 0,-12 -1,-24 -1,-36 -2,1 -4,2 -6,2 -12,3 -24,7 -36,8 -13,2 -25,2 -37,2 0,13 0,25 0,37z"/>\  <path class="fil2" d="M195 1752c13,-4 26,-7 38,-13 14,-6 26,-13 39,-22 0,-12 -1,-24 -2,-36 -1,1 -3,2 -5,3 -11,7 -23,14 -35,19 -11,5 -23,8 -35,11 0,12 0,25 0,38z"/>\  <path class="fil2" d="M144 716c13,0 25,-1 38,-2 12,-2 25,-5 37,-9 0,-12 -1,-25 -1,-37 -13,3 -25,6 -38,8 -12,2 -24,2 -37,2 1,13 1,25 1,38z"/>\  <path class="fil2" d="M195 1653c12,-3 24,-7 36,-12 12,-5 24,-12 36,-19 0,-12 -1,-24 -2,-37 -1,2 -3,3 -5,4 -22,11 -44,20 -66,26 0,13 1,25 1,38z"/>\  <path class="fil2" d="M144 617c22,-1 44,-3 65,-8 2,0 4,-1 5,-1 0,-13 -1,-25 -1,-37 -9,0 -57,8 -69,8 0,13 0,26 0,38z"/>\  <path class="fil2" d="M59 797c12,4 25,9 37,12 12,3 24,4 36,5 0,-12 0,-24 0,-36 -6,-1 -22,-2 -37,-6 -16,-4 -30,-10 -34,-10 -1,11 -1,23 -2,35z"/>\  <path class="fil2" d="M63 700c23,7 46,13 68,16 1,-13 1,-26 1,-38 -13,-1 -59,-14 -67,-15 -1,12 -1,25 -2,37z"/>\  <path class="fil2" d="M195 1554c22,-6 45,-15 67,-28 -1,-12 -1,-24 -2,-36 -22,12 -43,20 -65,26 0,13 0,25 0,38z"/>\  <path class="fil2" d="M14 1907c23,16 45,29 67,38 0,-13 0,-26 0,-38 -21,-9 -42,-20 -64,-35 0,-1 -1,-1 -1,-1 -1,12 -1,24 -2,36z"/>\  <path class="fil2" d="M67 602c22,7 43,12 65,15 0,-13 0,-25 0,-38 -21,-3 -42,-7 -63,-14 -1,13 -1,25 -2,37z"/>\  <path class="fil2" d="M93 2027c0,2 0,4 0,6 17,6 31,10 44,11 14,1 28,0 46,-3 0,-1 0,-3 0,-5 0,-7 0,-15 0,-22 -15,2 -30,3 -45,2 -15,0 -30,-3 -45,-7 0,6 0,12 0,18z"/>\  <path class="fil2" d="M18 1812c21,14 42,25 63,34 0,-13 0,-25 0,-38 -20,-8 -41,-19 -61,-33 -1,12 -1,25 -2,37z"/>\  <path class="fil2" d="M195 1455c19,-5 38,-12 58,-22 1,0 3,-1 4,-2 0,-12 -1,-24 -2,-36 -20,10 -40,17 -60,23 0,12 0,25 0,37z"/>\  <path class="fil2" d="M93 560c15,3 30,6 45,6 15,1 30,0 45,-2 0,-9 0,-19 0,-28 -17,5 -31,8 -45,7 -14,0 -28,-5 -45,-12 0,9 0,19 0,29z"/>\  <path class="fil2" d="M22 1715c20,13 40,23 59,31 0,-13 0,-25 0,-38 -19,-7 -39,-18 -58,-31 -1,13 -1,25 -1,38z"/>\  <path class="fil2" d="M195 1355c17,-4 34,-10 52,-18 1,-1 3,-2 5,-3 -1,-12 -1,-24 -2,-36 -1,0 -3,1 -5,1 -17,8 -33,14 -50,18 0,13 0,26 0,38z"/>\  <path class="fil2" d="M26 1619c18,12 37,21 55,28 0,-13 0,-25 0,-38 -18,-7 -35,-15 -53,-27 -1,13 -1,25 -2,37z"/>\  <path class="fil2" d="M195 1256c17,-4 33,-10 50,-18 1,0 2,0 2,0 -1,-13 -1,-25 -2,-37 -2,1 -3,2 -5,2 -15,7 -31,12 -46,16 0,12 0,25 1,37z"/>\  <path class="fil2" d="M30 1523c17,10 34,19 51,25 0,-12 0,-25 0,-38 1,1 2,1 3,1 -17,-6 -34,-14 -51,-24 0,0 -1,0 -2,-1 0,13 -1,25 -1,37z"/>\  <path class="fil2" d="M34 1427c17,10 33,17 50,23 -1,0 -2,0 -3,0 0,-13 0,-26 0,-38 -15,-6 -30,-13 -46,-22 0,13 -1,25 -1,37z"/>\  <path class="fil2" d="M195 1157c15,-4 31,-9 47,-16 -1,-12 -1,-24 -2,-36 -15,6 -30,11 -45,15 0,12 0,25 0,37z"/>\  <path class="fil2" d="M38 1329c15,9 31,16 46,21 -1,0 -2,0 -3,-1 0,-12 0,-25 0,-37 -14,-5 -28,-12 -42,-19 0,12 -1,24 -1,36z"/>\  <path class="fil2" d="M195 1059c12,-3 25,-7 37,-12 2,0 3,-1 5,-2 -1,-12 -1,-24 -2,-36 -7,1 -31,10 -40,12 0,12 0,25 0,38z"/>\  <path class="fil2" d="M42 1233c13,7 26,13 39,18 0,-13 0,-25 0,-38 -12,-5 -25,-10 -38,-17 0,12 -1,25 -1,37z"/>\  <path class="fil2" d="M195 958c10,-2 21,-5 32,-9 2,0 3,-1 5,-2 -1,-12 -1,-24 -2,-36 -1,0 -3,1 -5,1 -10,4 -20,6 -30,9 0,12 0,25 0,37z"/>\  <path class="fil2" d="M247 1981c14,-9 29,-17 34,-26 4,-7 4,-9 4,-15 -1,-7 -2,-13 -2,-20 -12,9 -24,17 -37,24 1,13 1,25 1,37z"/>\  <path class="fil2" d="M46 1136c11,6 22,11 34,15 0,0 1,1 1,1 0,-13 0,-25 0,-38 -11,-4 -23,-9 -34,-14 0,12 -1,24 -1,36z"/>\  <path class="fil2" d="M247 1882c9,-5 18,-11 28,-18 1,-1 3,-2 5,-4 -1,-11 -1,-23 -2,-35 -10,7 -21,14 -31,19 0,13 0,26 0,38z"/>\  <path class="fil2" d="M50 1040c10,5 21,9 32,13 0,-12 -1,-25 -1,-38 -10,-3 -20,-7 -30,-12 -1,12 -1,25 -1,37z"/>\  <path class="fil2" d="M195 860c10,-3 21,-6 32,-10 -1,-12 -1,-24 -2,-36 -2,0 -3,0 -5,1 -8,3 -17,5 -25,7 0,12 0,25 0,38z"/>\  <path class="fil2" d="M195 2037c13,-5 27,-12 39,-22 13,-10 24,-22 33,-34 -2,1 -4,2 -6,3 -22,12 -44,22 -66,28 0,8 0,17 0,25z"/>\  <path class="fil2" d="M247 1783c9,-5 18,-11 28,-17 -1,-12 -1,-24 -2,-36 -2,1 -3,2 -5,3 -7,4 -14,9 -21,13 0,12 0,25 0,37z"/>\  <path class="fil2" d="M53 942c10,4 19,8 28,11 0,-12 0,-25 0,-38 -8,-3 -17,-6 -26,-10 -1,12 -1,24 -2,37z"/>\  <path class="fil2" d="M195 761c9,-2 18,-5 27,-8 -1,-12 -1,-24 -2,-37 -8,3 -17,5 -25,7 0,13 0,25 0,38z"/>\  <path class="fil2" d="M57 845c8,4 16,7 24,9 0,-12 0,-25 0,-37 -7,-3 -15,-6 -22,-9 -1,12 -1,25 -2,37z"/>\  <path class="fil2" d="M247 1683c7,-4 15,-9 23,-14 -1,-12 -2,-24 -2,-36 -2,1 -4,2 -5,3 -6,4 -11,7 -16,10 0,12 0,25 0,37z"/>\  <path class="fil2" d="M195 662c7,-1 15,-3 22,-6 -1,-12 -1,-24 -2,-36 -6,0 -14,3 -20,4 0,13 0,25 0,38z"/>\  <path class="fil2" d="M61 748c7,3 14,5 20,8 0,-13 0,-26 0,-38 -6,-2 -12,-5 -18,-7 -1,12 -1,25 -2,37z"/>\  <path class="fil2" d="M247 1585c6,-4 12,-7 18,-11 -1,-12 -2,-23 -2,-35 -5,3 -11,6 -16,9 0,12 0,24 0,37z"/>\  <path class="fil2" d="M13 1950c14,11 0,6 18,19 0,-13 0,-25 0,-37 -6,-4 -12,-8 -17,-12 -1,10 -1,20 -1,30z"/>\  <path class="fil2" d="M195 529c0,11 0,22 0,33 4,-1 8,-2 12,-3 1,0 3,-1 5,-1 -1,-12 -1,-25 -2,-37 -8,0 -10,5 -15,8z"/>\  <path class="fil2" d="M65 651c6,2 11,4 16,6 0,-13 0,-25 0,-38 -5,-2 -9,-3 -14,-5 -1,12 -1,25 -2,37z"/>\  <path class="fil2" d="M81 2026c0,-7 0,-13 0,-20 -15,-6 -31,-14 -46,-23 8,14 32,33 46,43z"/>\  <path class="fil2" d="M16 1859c5,4 10,7 15,11 0,-13 0,-25 0,-38 -5,-3 -9,-6 -13,-9 -1,12 -1,24 -2,36z"/>\  <path class="fil2" d="M247 1486c4,-2 8,-5 13,-7 -1,-12 -2,-24 -2,-36 -4,2 -8,4 -11,5 0,13 0,25 0,38z"/>\  <path class="fil2" d="M69 552c4,2 8,3 12,5 0,-10 2,-29 -1,-37 -3,-2 -6,-3 -9,-5 -1,13 -1,25 -2,37z"/>\  <path class="fil2" d="M20 1764c4,3 8,5 11,8 0,-13 0,-26 0,-38 -3,-2 -6,-4 -9,-7 -1,13 -1,25 -2,37z"/>\  <ellipse class="fil1" cx="140" cy="514" rx="71" ry="25"/>\  <circle class="fil1" cx="146" cy="460" r="53"/>\  <circle class="fil1" cx="199" cy="372" r="64"/>\  <circle class="fil1" cx="204" cy="422" r="44"/>\  <circle class="fil1" cx="151" cy="277" r="64"/>\  <circle class="fil1" cx="247" cy="264" r="64"/>\  <circle class="fil1" cx="195" cy="176" r="64"/>\  <circle class="fil1" cx="141" cy="344" r="44"/>\  <circle class="fil1" cx="240" cy="315" r="44"/>\  <circle class="fil1" cx="133" cy="162" r="64"/>\  <circle class="fil1" cx="288" cy="154" r="64"/>\  <circle class="fil1" cx="210" cy="76" r="76"/>\  <polygon class="fil3" points="243,1352 256,1345 258,1385 241,1392 "/>\  <polygon class="fil3" points="241,1254 251,1248 253,1285 240,1291 "/>\  <polygon class="fil3" points="239,1193 238,1156 246,1151 248,1190 "/>\  <polygon class="fil3" points="26,1533 36,1539 36,1577 25,1569 "/>\  <polygon class="fil3" points="21,1666 35,1675 35,1637 22,1628 "/>\ </g>';};this.createDefElementChimneyLight=function(){return'<g id="'+this.obstacle_chimney_light_id+'" transform="scale(0.018)">\  <metadata id="CorelCorpID_0Corel-Layer"/>\  <path class="fil0" d="M577 2527c3,21 -1,44 3,65l0 0 0 1c2,43 4,87 7,130l0 6c-6,12 -11,17 -20,31l0 0c-21,34 -52,66 -87,86 -30,17 -65,26 -100,27l0 0 0 0c-11,0 -20,-2 -31,-3l0 0c-24,-3 -49,-13 -70,-25 -23,-14 -45,-33 -63,-54l0 0 0 -1c-17,-21 -32,-36 -45,-60l0 -6c0,-45 5,-89 6,-133 2,-45 2,-90 6,-134 1,-12 -1,-24 0,-36 1,-32 3,-65 5,-97l0 -1 0 -1c1,-10 0,-23 0,-34 1,-10 2,-20 2,-30l0 -1 0 0c3,-55 5,-111 8,-166 0,-12 -1,-23 0,-35 4,-44 4,-89 5,-133 0,-11 2,-22 2,-33 0,-11 2,-22 2,-33 0,-44 3,-89 5,-133 1,-12 -1,-24 1,-37 4,-32 1,-66 5,-98 1,-11 -1,-24 0,-35 1,-22 3,-43 4,-65 0,-12 -1,-24 1,-35 3,-67 5,-134 8,-200 0,-12 1,-23 2,-35 1,-11 -1,-23 0,-34 1,-21 2,-43 4,-65 0,-34 4,-68 3,-103 0,-10 2,-21 2,-31l0 -1c2,-44 4,-89 6,-133l0 -1 0 0c1,-12 -1,-24 0,-36 1,-22 2,-44 4,-66 -1,-25 -5,-54 24,-62 23,-8 55,-5 79,-5 26,1 54,1 80,6 28,2 47,10 47,41 5,90 10,179 15,269 3,22 -1,46 2,68 4,22 2,45 4,67 0,5 2,10 2,16 0,17 1,35 1,52l0 0c0,22 3,44 4,66 2,22 4,46 4,69 2,44 5,87 7,131 2,21 -1,45 3,66l0 0 0 1c9,166 18,333 26,499 9,165 18,330 27,494z"/>\  <path class="fil1" d="M184 2724c24,18 6,12 42,59 15,18 37,37 60,51 22,13 46,21 64,23 13,2 17,3 30,3 27,-1 62,-7 94,-25 33,-19 63,-50 82,-82 11,-19 10,-22 18,-29 -3,-43 -5,-87 -7,-130 -3,-19 0,-47 -3,-65 -9,-165 -18,-330 -27,-495 -8,-166 -17,-332 -26,-499 -3,-19 -1,-46 -3,-67 -2,-44 -4,-88 -7,-132 0,-32 -7,-102 -7,-135 -1,-17 -2,-34 -2,-52 0,-8 -2,-7 -2,-15 -1,-23 0,-47 -3,-66 -3,-21 0,-49 -3,-69 -5,-90 -10,-179 -15,-269 1,-23 -11,-27 -35,-30 -22,-3 -51,-4 -80,-5 -28,-1 -56,-2 -74,4 -19,5 -16,20 -15,50 -2,22 -3,45 -4,67 -1,11 1,25 0,36 -2,45 -4,89 -6,134 0,11 -2,18 -2,31 0,30 -3,68 -3,104 -2,21 -3,43 -4,65 -1,11 1,24 0,34 -1,11 -2,20 -2,34 -3,67 -6,134 -8,201 -2,10 -1,23 -1,35 -2,21 -3,43 -4,64 -1,11 1,26 0,36 -3,23 -2,75 -5,99 -2,10 0,25 -1,36 -2,43 -5,88 -5,132 0,12 -2,19 -2,33 0,14 -2,22 -2,33 -1,46 -2,92 -5,134 -1,10 0,24 -1,35 -2,55 -5,110 -7,166 0,13 -2,20 -2,31 0,11 1,25 0,35 -2,33 -4,66 -5,98 -1,11 0,25 -1,36 -3,42 -4,88 -5,133 -1,46 -6,83 -6,133z"/>\  <path class="fil2" d="M302 1197c20,5 41,9 61,9 21,1 41,0 62,-3 0,0 1,0 2,0 0,-17 0,-35 0,-52 -22,2 -43,4 -64,3 -21,-1 -42,-5 -63,-10 0,18 1,36 2,53z"/>\  <path class="fil2" d="M302 1060c20,4 41,8 62,8 21,1 42,0 63,-3 0,-17 0,-35 0,-52 -22,2 -43,4 -64,3 -21,-1 -42,-5 -63,-10 0,18 1,36 2,54z"/>\  <path class="fil2" d="M302 1335c20,5 41,9 62,9 21,1 42,0 63,-3 0,-17 0,-35 0,-53 -22,3 -43,5 -64,4 -21,-1 -42,-5 -63,-10 0,18 1,36 2,53z"/>\  <path class="fil2" d="M302 1475c21,4 42,8 63,9 21,1 42,-1 63,-3 0,-18 -1,-35 -1,-53 -21,2 -42,4 -63,3 -21,0 -41,-4 -62,-9 0,18 0,35 0,53z"/>\  <path class="fil2" d="M231 2344c21,11 41,21 62,27 21,6 42,9 63,11 0,-18 0,-35 0,-53 -21,-2 -42,-5 -63,-11 -21,-6 -42,-16 -63,-27 0,17 1,35 1,53z"/>\  <path class="fil2" d="M373 1829c20,0 42,-1 62,-4 21,-4 42,-11 63,-19 0,-18 0,-35 -1,-53 -20,8 -41,15 -62,19 -21,4 -42,4 -62,5 0,17 0,35 0,52z"/>\  <path class="fil2" d="M302 922c21,4 42,8 63,8 21,1 42,-1 62,-3 0,-17 0,-35 0,-52 -21,2 -42,4 -63,3 -21,-1 -41,-5 -62,-9 0,17 0,35 0,53z"/>\  <path class="fil2" d="M231 2068c21,11 41,21 62,27 20,6 41,9 62,11 0,-17 0,-35 1,-52 -1,0 -1,-1 -2,-1 -21,-2 -42,-5 -63,-11 -21,-6 -41,-16 -62,-27 1,18 1,35 2,53z"/>\  <path class="fil2" d="M302 2028c21,5 42,9 63,10 21,1 42,-1 62,-3 0,-18 0,-35 0,-53 -21,2 -42,4 -63,3 -21,-1 -41,-5 -62,-9 0,17 0,35 0,52z"/>\  <path class="fil2" d="M373 2661c20,0 41,-1 62,-5 21,-4 42,-11 63,-19 0,-18 0,-35 -1,-53 -20,8 -41,16 -62,19 -21,4 -42,5 -62,5 0,18 0,35 0,53z"/>\  <path class="fil2" d="M373 2383c20,0 41,-1 62,-5 21,-4 42,-11 62,-19 0,-17 0,-35 0,-53 -21,9 -41,16 -62,20 -21,4 -42,4 -63,4 0,18 0,35 1,53z"/>\  <path class="fil2" d="M302 2304c21,5 42,9 63,10 20,1 42,-1 62,-3 0,-18 0,-35 0,-53 -21,2 -42,4 -63,3 -20,-1 -41,-5 -62,-9 0,17 0,35 0,52z"/>\  <path class="fil2" d="M302 1613c20,4 41,8 62,9 21,1 42,-1 63,-3 0,-17 0,-35 0,-53 1,0 2,0 3,0 -20,2 -40,4 -59,4 -20,-1 -40,-4 -60,-7 -3,-1 -6,-2 -9,-3 0,18 0,35 0,53z"/>\  <path class="fil2" d="M373 1553c20,0 41,-1 62,-4 21,-4 42,-11 62,-19 0,-17 0,-35 0,-53 -20,8 -41,15 -62,19 -21,3 -42,4 -62,5 0,17 0,35 0,52z"/>\  <path class="fil2" d="M373 2107c20,0 41,-1 62,-5 21,-4 42,-10 62,-19 0,-17 0,-35 0,-52 -20,8 -41,15 -62,19 -21,3 -42,4 -62,4 0,18 0,36 0,53z"/>\  <path class="fil2" d="M302 1751c20,4 41,8 62,9 21,1 42,-1 63,-3 0,-17 0,-35 0,-53 -21,3 -42,4 -63,4 -21,-1 -41,-5 -62,-10 0,18 0,35 0,53z"/>\  <path class="fil2" d="M231 1791c21,11 41,20 62,27 21,6 42,9 63,11 0,-18 0,-36 0,-53 -21,-2 -42,-5 -63,-11 -21,-6 -41,-16 -62,-27 0,18 0,36 0,53z"/>\  <path class="fil2" d="M302 1889c20,4 41,8 62,9 21,1 42,-1 63,-3 0,-17 0,-35 0,-53 -21,3 -42,4 -63,4 -21,-1 -41,-5 -62,-10 0,18 0,35 0,53z"/>\  <path class="fil2" d="M231 1931c21,10 41,20 62,26 21,6 42,9 63,11 0,-17 0,-35 0,-52 -21,-3 -42,-5 -63,-11 -21,-7 -41,-16 -62,-27 0,17 0,35 0,53z"/>\  <path class="fil2" d="M231 2484c21,11 41,20 62,27 21,6 42,9 63,11 0,-18 0,-35 0,-53 -21,-2 -42,-5 -63,-11 -21,-6 -41,-16 -62,-27 0,17 0,35 0,53z"/>\  <path class="fil2" d="M373 1969c20,0 41,-1 62,-5 21,-3 42,-10 62,-18 0,-18 0,-36 0,-53 -20,8 -41,15 -62,19 -20,3 -41,4 -62,4 0,18 0,36 0,53z"/>\  <path class="fil2" d="M373 2523c20,0 41,-1 62,-5 21,-4 42,-11 62,-19 0,-18 0,-35 0,-53 -20,8 -41,15 -62,19 -20,4 -41,5 -62,5 0,18 0,35 0,53z"/>\  <path class="fil2" d="M302 2442c20,5 41,9 62,10 21,1 41,-1 62,-3 0,-18 0,-35 1,-53 -21,2 -42,4 -63,3 -21,-1 -41,-4 -62,-9 0,17 0,35 0,52z"/>\  <path class="fil2" d="M231 2621c21,11 41,21 62,28 20,6 41,9 62,11 0,-18 0,-35 1,-53 -21,-2 -42,-5 -63,-11 -21,-6 -41,-16 -62,-27 0,17 0,35 0,52z"/>\  <path class="fil2" d="M302 2166c20,5 41,9 62,10 21,1 42,-1 63,-3 0,-18 0,-35 0,-53 -21,2 -42,4 -62,3 -21,-1 -42,-4 -62,-9 -1,17 -1,35 -1,52z"/>\  <path class="fil2" d="M302 2720c20,5 41,9 62,10 21,1 42,-1 63,-4 0,-17 0,-35 0,-52 -21,2 -42,4 -62,3 -21,-1 -42,-5 -62,-10 -1,18 -1,35 -1,53z"/>\  <path class="fil2" d="M302 2582c20,5 41,9 62,10 20,1 41,-1 62,-3 0,-18 0,-36 1,-53 -21,2 -42,4 -63,3 -21,-1 -41,-5 -62,-10 0,18 0,36 0,53z"/>\  <path class="fil2" d="M373 1415c20,0 41,-1 61,-4 21,-4 41,-10 61,-18 1,0 2,-1 2,-1 0,-8 0,-17 0,-25 0,-9 0,-17 -1,-26 -20,8 -41,14 -62,18 -20,3 -41,4 -61,4 0,17 0,35 0,52z"/>\  <path class="fil2" d="M443 2724c20,-5 39,-11 58,-20 20,-9 39,-21 58,-35 2,-2 4,-4 7,-6 -1,-16 -2,-33 -3,-50 -20,15 -39,28 -60,37 -19,10 -40,16 -60,21 0,17 0,35 0,53z"/>\  <path class="fil2" d="M231 2206c21,11 42,21 63,27 20,6 42,9 63,11 -1,-17 -1,-34 -1,-51 -21,-2 -42,-5 -63,-11 -21,-6 -41,-16 -62,-27 0,17 0,34 0,51z"/>\  <path class="fil2" d="M373 2245c20,0 41,-1 62,-5 21,-4 42,-10 63,-19 0,-17 0,-34 -1,-51 -20,9 -41,16 -62,19 -21,4 -42,5 -62,5 0,17 0,34 0,51z"/>\  <path class="fil2" d="M373 1691c20,0 41,-1 61,-4 21,-4 41,-11 61,-18 1,-1 2,-1 2,-1 0,-17 0,-34 0,-51 -20,8 -41,15 -62,19 -21,4 -42,4 -62,4 0,17 0,34 0,51z"/>\  <path class="fil2" d="M231 2759c21,11 41,21 62,28 21,6 42,9 63,11 0,-17 0,-34 0,-51 -21,-2 -42,-5 -63,-11 -21,-7 -41,-17 -62,-28 0,17 0,34 0,51z"/>\  <path class="fil2" d="M373 2799c20,0 41,-1 62,-5 21,-4 41,-11 62,-19 0,-17 0,-34 0,-51 -20,8 -41,15 -62,19 -21,4 -42,5 -62,5 0,17 0,34 0,51z"/>\  <path class="fil2" d="M373 1276c20,-1 40,-1 60,-5 20,-3 40,-10 61,-17 -2,-17 -3,-33 -5,-50 -2,0 -4,1 -7,2 -18,6 -36,11 -55,13 -18,3 -36,4 -54,4 0,18 0,35 0,53z"/>\  <path class="fil2" d="M233 1654c21,11 42,20 63,26 21,6 42,9 63,11 -1,0 -2,-1 -3,-1 0,-16 0,-33 0,-50 -20,-2 -41,-5 -61,-11 -20,-5 -40,-14 -61,-25 0,17 -1,34 -1,50z"/>\  <path class="fil2" d="M238 1519c20,10 39,18 59,24 19,5 39,8 59,9 0,-17 0,-35 0,-52 -20,-2 -40,-5 -60,-10 -20,-6 -40,-15 -59,-24 1,1 2,1 3,2 -1,17 -1,34 -2,51z"/>\  <path class="fil2" d="M443 2586c18,-5 37,-10 54,-18 18,-8 36,-19 54,-31 3,-2 5,-4 8,-6 -1,-16 -2,-33 -3,-49 -2,1 -4,2 -6,3 -18,12 -36,23 -54,31 -17,7 -35,12 -53,17 0,17 0,35 0,53z"/>\  <path class="fil2" d="M243 1384c19,9 38,16 57,21 18,5 37,8 56,10 0,-18 0,-35 0,-53 -3,0 -5,-1 -8,-1 -17,-2 -35,-4 -52,-9 -17,-5 -35,-12 -52,-20 0,17 0,35 -1,52z"/>\  <path class="fil2" d="M249 1247c18,8 36,15 54,20 18,4 36,6 55,8 -1,-18 -2,-35 -2,-53 -9,-1 -33,-4 -55,-9 -23,-6 -45,-15 -50,-16 -1,17 -1,34 -2,50z"/>\  <path class="fil2" d="M373 1138c18,0 37,-1 55,-4 19,-3 38,-8 56,-14 0,-17 -1,-34 -2,-50 -2,1 -5,2 -7,2 -17,5 -34,9 -51,12 -17,2 -34,3 -51,3 0,17 0,34 0,51z"/>\  <path class="fil2" d="M443 2446c18,-5 37,-10 54,-18 19,-8 37,-19 55,-31 -1,-17 -2,-33 -3,-50 -2,1 -5,3 -7,4 -16,10 -33,20 -49,27 -16,6 -33,11 -49,15 0,17 -1,35 -1,53z"/>\  <path class="fil2" d="M373 1000c17,0 35,-1 52,-4 18,-2 35,-7 53,-12 -1,-17 -2,-34 -3,-52 -17,5 -34,10 -52,12 -17,2 -34,3 -51,3 0,18 0,35 1,53z"/>\  <path class="fil2" d="M443 2308c17,-4 34,-10 51,-17 17,-7 34,-16 50,-27 0,-17 -1,-34 -2,-51 -3,2 -5,4 -7,5 -31,16 -62,29 -92,37 0,17 0,35 0,53z"/>\  <path class="fil2" d="M373 862c30,-1 60,-5 91,-12 2,0 5,-1 7,-2 -1,-17 -2,-33 -3,-50 -11,-1 -78,11 -95,11 0,18 0,35 0,53z"/>\  <path class="fil2" d="M254 1112c17,7 34,13 51,17 17,4 34,6 51,8 0,-17 0,-34 0,-51 -9,-1 -31,-3 -52,-8 -22,-6 -42,-14 -48,-15 0,17 -1,33 -2,49z"/>\  <path class="fil2" d="M260 977c31,11 63,18 95,22 0,-18 0,-35 1,-53 -18,-1 -82,-19 -94,-20 -1,17 -2,34 -2,51z"/>\  <path class="fil2" d="M443 2170c32,-9 63,-22 94,-39 0,-17 -1,-34 -2,-51 -31,16 -61,29 -92,37 0,17 0,35 0,53z"/>\  <path class="fil2" d="M191 2662c32,23 63,40 94,53 0,-18 0,-35 0,-53 -30,-12 -60,-28 -89,-49 -1,0 -2,-1 -2,-1 -1,16 -2,34 -3,50z"/>\  <path class="fil2" d="M265 841c30,10 61,16 91,20 0,-18 0,-35 0,-53 -30,-3 -59,-9 -89,-19 0,17 -1,35 -2,52z"/>\  <path class="fil2" d="M302 2830c0,3 0,6 0,8 23,9 42,14 61,16 19,2 39,0 63,-4 0,-2 0,-5 1,-7 0,-10 0,-21 0,-31 -21,2 -42,4 -63,3 -21,-1 -41,-5 -62,-10 0,9 0,17 0,25z"/>\  <path class="fil2" d="M197 2529c29,21 59,36 88,48 0,-17 0,-35 0,-53 -29,-11 -57,-26 -86,-45 -1,16 -1,33 -2,50z"/>\  <path class="fil2" d="M443 2032c27,-8 54,-18 81,-31 2,-1 5,-2 7,-4 -1,-16 -2,-33 -3,-49 -28,14 -56,24 -85,31 0,17 0,35 0,53z"/>\  <path class="fil2" d="M302 782c20,4 41,8 62,9 21,0 42,-1 63,-4 0,-12 0,-26 0,-39 -24,8 -44,12 -63,11 -20,-1 -40,-8 -62,-18 0,13 0,27 0,41z"/>\  <path class="fil2" d="M202 2394c28,18 55,33 83,43 0,-17 0,-35 0,-52 -27,-11 -55,-25 -82,-43 0,17 0,35 -1,52z"/>\  <path class="fil2" d="M443 1892c25,-6 49,-15 73,-26 2,-1 5,-3 7,-4 0,-17 -1,-34 -2,-50 -2,0 -5,1 -7,2 -23,11 -47,19 -71,25 0,18 0,35 0,53z"/>\  <path class="fil2" d="M208 2260c26,16 51,29 77,40 0,-18 0,-36 0,-53 -25,-10 -50,-22 -75,-38 0,17 -1,34 -2,51z"/>\  <path class="fil2" d="M443 1754c24,-6 48,-14 71,-25 1,0 2,-1 2,-1 0,-17 -1,-34 -2,-51 -3,1 -5,2 -7,3 -22,9 -43,16 -65,22 1,17 1,35 1,52z"/>\  <path class="fil2" d="M213 2126c24,15 48,26 72,36 0,-18 0,-36 0,-53 1,0 2,1 4,1 -24,-9 -48,-20 -71,-33 -1,-1 -2,-2 -3,-2 0,17 -1,34 -2,51z"/>\  <path class="fil2" d="M219 1992c23,14 46,24 70,33 -2,-1 -3,-1 -4,-1 0,-18 0,-36 0,-53 -21,-8 -43,-18 -64,-30 -1,17 -2,34 -2,51z"/>\  <path class="fil2" d="M443 1616c22,-6 44,-13 66,-22 0,-17 -1,-35 -2,-52 -21,9 -42,16 -63,21 0,18 0,35 -1,53z"/>\  <path class="fil2" d="M224 1856c22,12 43,22 65,29 -2,0 -3,-1 -4,-1 0,-17 0,-35 0,-53 -20,-7 -39,-16 -59,-26 0,17 -1,34 -2,51z"/>\  <path class="fil2" d="M443 1478c18,-4 35,-9 52,-16 3,-1 5,-2 7,-3 0,-17 -1,-34 -2,-50 -10,1 -44,13 -57,16 0,18 0,35 0,53z"/>\  <path class="fil2" d="M230 1721c18,10 37,18 55,25 0,-17 0,-35 0,-53 -18,-6 -36,-14 -53,-23 -1,17 -2,34 -2,51z"/>\  <path class="fil2" d="M443 1338c15,-3 30,-8 46,-13 2,-1 4,-2 6,-3 -1,-17 -1,-34 -2,-50 -2,0 -5,1 -7,1 -14,5 -28,9 -43,12 0,18 0,36 0,53z"/>\  <path class="fil2" d="M516 2765c20,-12 41,-23 48,-35 5,-10 5,-14 5,-22 -1,-9 -2,-18 -2,-27 -17,13 -34,24 -52,34 1,17 1,34 1,50z"/>\  <path class="fil2" d="M235 1587c16,8 32,15 48,20 1,1 1,1 2,1 0,-17 0,-35 0,-52 -16,-6 -32,-13 -48,-21 0,17 -1,35 -2,52z"/>\  <path class="fil2" d="M516 2628c13,-8 26,-16 39,-25 2,-2 5,-4 7,-6 -1,-16 -2,-33 -2,-49 -15,10 -30,19 -44,27 0,17 0,35 0,53z"/>\  <path class="fil2" d="M241 1452c15,7 30,13 45,19 0,-18 -1,-36 -1,-53 -14,-5 -28,-11 -42,-18 -1,18 -2,35 -2,52z"/>\  <path class="fil2" d="M443 1200c15,-3 30,-7 45,-13 -1,-17 -1,-34 -2,-51 -3,1 -5,1 -7,2 -12,4 -24,7 -36,10 0,17 0,35 0,52z"/>\  <path class="fil2" d="M443 2844c19,-7 39,-17 56,-30 18,-14 33,-31 45,-49 -3,2 -5,3 -8,5 -30,17 -61,30 -92,38 0,12 -1,24 -1,36z"/>\  <path class="fil2" d="M516 2490c13,-8 26,-16 39,-25 -1,-17 -2,-33 -2,-50 -3,1 -5,3 -7,4 -10,7 -20,13 -30,18 0,18 0,35 0,53z"/>\  <path class="fil2" d="M246 1315c13,6 26,11 39,16 0,-18 0,-36 0,-53 -12,-4 -25,-9 -37,-14 -1,17 -1,34 -2,51z"/>\  <path class="fil2" d="M443 1062c13,-2 26,-6 38,-10 -1,-17 -1,-35 -2,-52 -12,4 -24,7 -36,10 0,17 0,35 0,52z"/>\  <path class="fil2" d="M252 1180c11,5 22,9 33,13 0,-18 0,-35 0,-53 -10,-4 -21,-7 -31,-12 -1,17 -2,35 -2,52z"/>\  <path class="fil2" d="M516 2350c11,-6 21,-12 32,-19 -1,-17 -2,-34 -3,-51 -2,2 -4,3 -7,5 -7,4 -15,8 -22,12 0,18 0,36 0,53z"/>\  <path class="fil2" d="M443 924c11,-2 21,-4 32,-8 -1,-17 -2,-33 -3,-50 -8,-1 -20,4 -29,6 0,17 0,35 0,52z"/>\  <path class="fil2" d="M257 1044c9,4 19,8 28,11 0,-18 0,-35 0,-53 -9,-3 -17,-6 -26,-9 -1,17 -1,34 -2,51z"/>\  <path class="fil2" d="M516 2212c8,-4 17,-9 25,-14 -1,-17 -2,-33 -2,-49 -8,4 -15,9 -23,12 0,18 0,34 0,51z"/>\  <path class="fil2" d="M189 2722c20,16 1,8 25,26 0,-17 0,-33 0,-51 -8,-5 -15,-11 -23,-17 -1,14 -1,29 -2,42z"/>\  <path class="fil2" d="M443 739c0,15 0,30 0,45 6,-1 11,-2 17,-3 2,-1 5,-1 7,-2 -1,-17 -1,-34 -2,-51 -12,0 -14,6 -22,11z"/>\  <path class="fil2" d="M263 909c7,3 14,6 22,8 0,-18 0,-35 0,-53 -7,-2 -14,-4 -20,-7 -1,17 -2,35 -2,52z"/>\  <path class="fil2" d="M284 2828c1,-9 1,-18 1,-28 -22,-8 -43,-19 -65,-31 12,19 45,46 64,59z"/>\  <path class="fil2" d="M194 2596c7,5 14,10 20,15 0,-18 0,-36 0,-53 -6,-4 -12,-8 -18,-13 0,17 -1,34 -2,51z"/>\  <path class="fil2" d="M516 2075c6,-4 12,-7 18,-11 -1,-16 -2,-33 -2,-50 -6,3 -11,6 -16,8 0,17 0,35 0,53z"/>\  <path class="fil2" d="M268 771c6,2 11,4 17,6 0,-13 2,-40 -1,-51 -5,-2 -9,-5 -14,-7 -1,18 -1,35 -2,52z"/>\  <path class="fil2" d="M200 2463c5,3 10,7 15,10 0,-17 -1,-35 -1,-53 -4,-2 -8,-5 -12,-8 -1,17 -2,34 -2,51z"/>\  <ellipse class="fil1" cx="367" cy="718" rx="99" ry="35"/>\  <circle class="fil1" cx="375" cy="642" r="73"/>\  <circle class="fil1" cx="449" cy="520" r="89"/>\  <circle class="fil1" cx="456" cy="589" r="62"/>\  <circle class="fil1" cx="383" cy="386" r="89"/>\  <circle class="fil1" cx="516" cy="369" r="89"/>\  <circle class="fil1" cx="444" cy="246" r="89"/>\  <circle class="fil1" cx="368" cy="480" r="62"/>\  <circle class="fil1" cx="507" cy="439" r="62"/>\  <circle class="fil1" cx="357" cy="226" r="89"/>\  <circle class="fil1" cx="574" cy="215" r="89"/>\  <circle class="fil1" cx="465" cy="106" r="106"/>\  <polygon class="fil3" points="510,1887 529,1878 532,1933 508,1943 "/>\  <polygon class="fil3" points="507,1751 522,1743 525,1795 507,1803 "/>\  <polygon class="fil3" points="505,1665 504,1614 515,1607 518,1661 "/>\  <polygon class="fil3" points="208,2140 222,2149 222,2202 206,2191 "/>\  <polygon class="fil3" points="200,2327 220,2338 221,2286 202,2273 "/>\  <rect class="fil1" transform="matrix(1.40644 0.109804 -0.109804 1.40644 223.974 492.312)" width="28.8891" height="113.149" rx="14" ry="14"/>\  <rect class="fil1" transform="matrix(1.22172 -0.705362 0.705362 1.22172 80.8221 538.552)" width="28.8891" height="113.149" rx="14" ry="14"/>\  <rect class="fil1" transform="matrix(0.365122 -1.36265 1.36265 0.365122 -0.753921 682.382)" width="28.8891" height="113.149" rx="14" ry="14"/>\  <rect class="fil1" transform="matrix(-0.348126 -1.3671 1.3671 -0.348126 5.6573 815.223)" width="28.8891" height="113.149" rx="14" ry="14"/>\  <rect class="fil1" transform="matrix(-1.1133 -0.866433 0.866433 -1.1133 104.71 929.151)" width="28.8891" height="113.149" rx="14" ry="14"/>\ </g>';};this.createDefElementMastPower=function(){return'<g id="'+this.obstacle_mast_power_id+'" transform="scale(0.007)">\  <metadata id="CorelCorpID_0Corel-Layer"/>\  <path class="fil0" d="M1515 6312l351 0 0 -179 133 0 134 -2693 -1 0 0 -232 12 9 3 -64 -524 0 -26 0 0 -5 -331 -69 0 78 90 0 0 91 -90 0 0 87 90 0 0 91 -90 0 0 64 90 0 0 91 -90 0 0 109 -181 0 0 -109 -118 0 0 -91 118 0 0 -64 -118 0 0 -91 118 0 0 -87 -118 0 0 -91 118 0 0 -85 147 0 -933 -194 0 76 90 0 0 91 -90 0 0 87 90 0 0 91 -90 0 0 64 90 0 0 91 -90 0 0 108 -181 0 0 -108 -118 0 0 -91 118 0 0 -64 -118 0 0 -91 118 0 0 -87 -118 0 0 -91 118 0 0 -85 135 0 -96 -20 0 -133 12 2 0 -114 2005 0 47 -946 -614 -128 -42 15 -7 -25 -731 -152 0 -133 10 3 0 -133 1412 0 31 -630 -7 0 0 -133 404 -342 0 133 -247 209 500 0 -247 -209 0 -133 404 342 0 133 -6 -5 0 5 -1 0 32 630 1418 0 0 108 10 -2 0 133 -814 166 -7 25 -42 -15 -539 109 48 975 2000 0 0 119 42 -7 0 128 10 0 0 85 91 0 0 91 -91 0 0 87 91 0 0 91 -91 0 0 64 91 0 0 91 -91 0 0 108 -181 0 0 -108 -118 0 0 -91 118 0 0 -64 -118 0 0 -91 118 0 0 -87 -118 0 0 -91 118 0 0 -50 -602 104 -1 5 -10 -3 -816 142 0 26 -149 0 -265 0 148 2980 125 0 0 179 235 0 0 319 -2207 0 0 -319zm923 -5837l-4 74 245 184 248 -187 -4 -71 -485 0zm-386 763l-454 157 -758 -157 1212 0zm-205 209l392 -136 -11 215 -381 -79zm1439 -209l400 147 721 -147 -1121 0zm157 196l-321 -118 9 181 312 -63zm-1056 62l198 -104 -188 -98 -10 202zm90 -258l202 105 201 -105 -403 0zm487 54l-192 100 202 105 -10 -205zm-84 254l-201 -105 -202 105 403 0zm103 133l-605 0 -6 115 328 247 290 -218 -7 -144zm-577 -574l548 0 -1 -25 -274 -206 -271 203 -2 28zm1989 307l181 0 0 85 91 0 0 91 -91 0 0 87 91 0 0 91 -91 0 0 64 91 0 0 91 -91 0 0 108 -181 0 0 -108 -118 0 0 -91 118 0 0 -64 -118 0 0 -91 118 0 0 -87 -118 0 0 -91 118 0 0 -85zm-3596 8l181 0 0 86 91 0 0 91 -91 0 0 86 91 0 0 91 -91 0 0 64 91 0 0 91 -91 0 0 109 -181 0 0 -109 -118 0 0 -91 118 0 0 -64 -118 0 0 -91 118 0 0 -86 -118 0 0 -91 118 0 0 -86zm650 1317l-422 124 12 38 -782 -162 1192 0zm-217 202l654 -193 -2 -9 284 0 -14 283 -531 0 -391 -81zm2721 529l117 0 0 -63 -117 0 0 -91 117 0 0 -87 -117 0 0 -91 117 0 0 -86 181 0 0 86 91 0 0 91 -91 0 0 87 91 0 0 91 -91 0 0 63 91 0 0 91 -91 0 0 109 -181 0 0 -109 -117 0 0 -91zm-1603 -471l235 -140 -200 -120 -60 0 -14 283 39 0 0 -23zm222 -260l107 63 106 -63 -213 0zm401 0l-201 120 227 136 0 27 51 0 -14 -283 -63 0zm-115 283l-179 -107 -180 107 359 0zm1139 -283l459 113 653 -113 -1112 0zm132 170l-653 -161 3 -9 -286 0 14 283 272 0 650 -113zm-1073 246l-752 0 -8 178 375 282 393 -295 -8 -165zm-724 -549l18 0 679 0 -7 -140 -322 -241 -363 272 -5 109zm95 -1919l-12 246 170 -128 -158 -118zm519 249l-13 -252 -161 121 174 131zm-583 1035l-17 338 233 -175 -216 -163zm650 307l-14 -278 -178 134 192 144zm-729 1278l-18 363 251 -188 -233 -175zm-30 603l-3 61 420 315 438 -329 -2 -32 -436 -327 -417 312zm841 -225l-19 -392 -251 189 270 203zm-270 717l318 239 -23 -461 -295 222zm-606 224l298 -224 -277 -208 -21 432zm452 -109l-440 331 440 331 440 -331 -440 -331zm-498 1036l344 -259 -319 -240 -25 499zm989 -512l-337 253 364 274 -27 -527zm-491 369l-510 383 -5 93 90 0 0 179 861 0 0 -179 97 0 -7 -157 0 76 -526 -395z"/>\ </g>';};this.createDefElementMastPowerLight=function(){return'<g id="'+this.obstacle_mast_power_light_id+'" transform="scale(0.007)">\  <metadata id="CorelCorpID_0Corel-Layer"/>\  <path class="fil0" d="M1504 6802l347 0 0 -178 132 0 133 -2672 0 0 0 -230 11 9 3 -63 -519 0 -27 0 0 -6 -328 -68 0 78 90 0 0 90 -90 0 0 86 90 0 0 91 -90 0 0 63 90 0 0 90 -90 0 0 108 -180 0 0 -108 -116 0 0 -90 116 0 0 -63 -116 0 0 -91 116 0 0 -86 -116 0 0 -90 116 0 0 -85 146 0 -926 -192 0 75 90 0 0 91 -90 0 0 86 90 0 0 90 -90 0 0 63 90 0 0 91 -90 0 0 107 -179 0 0 -107 -117 0 0 -91 117 0 0 -63 -117 0 0 -90 117 0 0 -86 -117 0 0 -91 117 0 0 -84 134 0 -95 -20 0 -132 11 2 0 -114 1991 0 46 -938 -609 -127 -43 15 -6 -25 -726 -150 0 -133 11 3 0 -132 1401 0 31 -625 -7 0 0 -132 401 -339 0 132 -245 207 495 0 -245 -207 0 -132 401 339 0 132 -5 -5 0 5 -1 0 31 625 1407 0 0 107 10 -2 0 132 -808 165 -6 25 -43 -15 -534 108 48 967 1984 0 0 119 42 -7 0 127 9 0 0 84 90 0 0 91 -90 0 0 86 90 0 0 90 -90 0 0 63 90 0 0 91 -90 0 0 107 -179 0 0 -107 -117 0 0 -91 117 0 0 -63 -117 0 0 -90 117 0 0 -86 -117 0 0 -91 117 0 0 -50 -597 104 -2 4 -9 -2 -810 141 0 26 -148 0 -263 0 147 2956 124 0 0 178 233 0 0 316 -2189 0 0 -316zm915 -5792l-4 73 243 183 246 -185 -3 -71 -482 0zm-383 757l-450 156 -752 -156 1202 0zm-203 208l388 -135 -10 213 -378 -78zm1428 -208l396 146 716 -146 -1112 0zm156 195l-319 -117 9 180 310 -63zm-1049 61l197 -103 -187 -97 -10 200zm90 -256l200 105 200 -105 -400 0zm483 54l-190 99 200 105 -10 -204zm-83 252l-200 -104 -200 104 400 0zm102 132l-601 0 -5 114 325 245 288 -216 -7 -143zm-572 -570l544 0 -2 -25 -272 -204 -269 202 -1 27zm1973 305l179 0 0 84 91 0 0 91 -91 0 0 86 91 0 0 90 -91 0 0 63 91 0 0 91 -91 0 0 107 -179 0 0 -107 -117 0 0 -91 117 0 0 -63 -117 0 0 -90 117 0 0 -86 -117 0 0 -91 117 0 0 -84zm-3568 8l179 0 0 85 91 0 0 90 -91 0 0 86 91 0 0 90 -91 0 0 64 91 0 0 90 -91 0 0 108 -179 0 0 -108 -117 0 0 -90 117 0 0 -64 -117 0 0 -90 117 0 0 -86 -117 0 0 -90 117 0 0 -85zm645 1306l-419 124 12 37 -776 -161 1183 0zm-216 201l650 -192 -3 -9 282 0 -14 282 -526 0 -389 -81zm2700 525l117 0 0 -63 -117 0 0 -90 117 0 0 -86 -117 0 0 -91 117 0 0 -84 179 0 0 84 91 0 0 91 -91 0 0 86 91 0 0 90 -91 0 0 63 91 0 0 91 -91 0 0 107 -179 0 0 -107 -117 0 0 -91zm-1590 -467l233 -140 -199 -119 -59 0 -14 282 39 0 0 -23zm220 -259l106 64 106 -64 -212 0zm398 0l-199 119 225 135 0 28 50 0 -14 -282 -62 0zm-114 282l-178 -107 -178 107 356 0zm1131 -282l455 113 648 -113 -1103 0zm130 170l-648 -161 3 -9 -284 0 14 282 270 0 645 -112zm-1064 244l-746 0 -9 176 372 280 391 -293 -8 -163zm-719 -546l18 0 674 0 -7 -138 -320 -240 -360 271 -5 107zm94 -1904l-12 244 169 -126 -157 -118zm515 247l-12 -249 -160 120 172 129zm-578 1028l-17 335 232 -174 -215 -161zm644 304l-13 -276 -177 133 190 143zm-722 1269l-18 360 249 -187 -231 -173zm-30 598l-3 60 416 313 435 -327 -2 -31 -433 -325 -413 310zm834 -223l-19 -389 -249 187 268 202zm-268 711l315 237 -22 -457 -293 220zm-601 222l296 -222 -275 -207 -21 429zm448 -108l-437 328 437 329 437 -328 -437 -329zm-494 1028l342 -257 -317 -238 -25 495zm982 -509l-335 252 361 272 -26 -524zm-488 367l-506 380 -4 92 88 0 0 178 855 0 0 -178 97 0 -8 -155 0 75 -522 -392z"/>\  <rect class="fil0" transform="matrix(0.363994 1.36296 -1.36296 0.363994 3114.77 317.898)" width="61.0664" height="239.176" rx="31" ry="31"/>\  <rect class="fil0" transform="matrix(1.07139 0.91775 -0.91775 1.07139 2921.99 65.0046)" width="61.0664" height="239.176" rx="31" ry="31"/>\  <rect class="fil0" transform="matrix(1.40653 -0.10864 0.10864 1.40653 2577.93 3.44584)" width="61.0664" height="239.176" rx="31" ry="31"/>\  <rect class="fil0" transform="matrix(1.17361 -0.782799 0.782799 1.17361 2317.6 109.576)" width="61.0664" height="239.176" rx="31" ry="31"/>\  <rect class="fil0" transform="matrix(0.447054 -1.33801 1.33801 0.447054 2160.08 387.105)" width="61.0664" height="239.176" rx="31" ry="31"/>\ </g>';};this.createDefElementOtherObstacle=function(){return'<g id="'+this.obstacle_other_obstacles_id+'" transform="scale(0.013)">\  <metadata id="CorelCorpID_0Corel-Layer"/>\  <path class="fil0 str0" d="M2577 1285c875,0 1347,1247 1969,1956l-4541 -8c1948,-994 1697,-1948 2572,-1948zm-1183 -337l263 -412 263 412 -210 -113 289 454 -280 -150 291 318 -72 70 -281 -91 -475 154 413 -451 -280 150 289 -454 -210 113zm328 567l0 278 -144 166 0 -440 79 -25 65 21zm402 -1514l113 0 0 158 118 0 0 -158 153 0 0 158c40,0 79,0 119,0l0 -158 153 0 0 158 119 0 0 -158 104 0 0 423 -141 0 0 882 -154 -40 0 -241c0,-80 -65,-145 -145,-145l0 0c-79,0 -144,65 -144,145l0 241 -154 39 0 -881 -141 0 0 -423zm439 277l0 0c63,0 115,66 115,145l0 146 -229 0 0 -146c0,-79 52,-145 114,-145z"/>\ </g>';};this.createDefElementParachute=function(){return'<g id="'+this.obstacle_parachute_id+'" transform="scale(0.02)">\  <metadata id="CorelCorpID_0Corel-Layer"/>\  <path class="fil0" d="M816 0c435,0 791,340 817,769l0 0 0 0c0,1 1,2 1,4l-4 0 -497 631c-6,-10 -12,-20 -19,-30l496 -639c-27,-78 -102,-135 -190,-135 -101,0 -184,75 -198,173l-224 579c-11,-7 -22,-14 -33,-20l233 -608c-31,-73 -102,-124 -186,-124 -83,0 -154,51 -184,122l0 571c-5,0 -10,0 -16,0 -7,0 -15,0 -23,0l0 -571c-31,-71 -102,-122 -185,-122 -86,0 -159,54 -188,130l235 607c-10,6 -21,13 -31,21l-227 -585c-14,-98 -98,-173 -199,-173 -74,0 -138,40 -173,99l490 664c-8,10 -14,21 -21,32 -233,-309 -490,-646 -490,-645 35,-420 387,-750 816,-750zm-8 1421c43,0 78,35 78,78 0,43 -35,78 -78,78 -43,0 -78,-35 -78,-78 0,-43 35,-78 78,-78zm0 196l0 0c39,0 70,31 70,69l0 171c0,38 -31,70 -70,70l0 0c-38,0 -69,-32 -69,-70l0 -171c0,-38 31,-69 69,-69zm92 3l142 -148c10,-11 28,-11 39,-1l0 0c10,11 11,28 0,39l-141 148c-11,11 -28,11 -39,1l0 0c-11,-11 -11,-28 -1,-39zm-184 0l-141 -148c-11,-11 -28,-11 -39,-1l0 0c-11,11 -11,28 -1,39l142 148c10,11 27,11 38,1l0 0c11,-11 12,-28 1,-39zm67 355l-88 245c-6,18 -26,28 -44,21l0 0c-18,-6 -28,-26 -21,-44l88 -246c6,-18 26,-27 44,-21l0 0c18,7 28,27 21,45zm50 0l88 245c7,18 27,28 45,21l0 0c18,-6 27,-26 21,-44l-88 -246c-7,-18 -27,-27 -45,-21l0 0c-18,7 -27,27 -21,45z"/>\ </g>';};this.createDefElementRogallo=function(){return'<g id="'+this.obstacle_rogallo_id+'" transform="scale(0.0125)">\  <metadata id="CorelCorpID_0Corel-Layer"/>\  <path class="fil0" d="M2 1698c-66,0 1541,-1698 1541,-1698l4557 275 0 118c0,0 -688,-52 -787,-45 -98,6 -98,6 -98,6 0,0 -335,-20 -512,59 -177,79 -177,79 -177,79 0,0 -505,26 -609,105 -105,78 -105,78 -105,78 0,0 -341,-98 -512,20 -170,118 -170,118 -170,118 0,0 -92,-66 -243,-26 -151,39 -210,79 -210,79l40 203 295 334 -46 53 -689 -715 348 833 -1036 255 485 -891c0,0 -118,13 -203,72 -86,59 -86,59 -86,59 0,0 -154,3 -244,62 -90,59 -101,90 -101,90 0,0 -117,-26 -246,22 -130,47 -135,109 -135,109 0,0 -165,0 -280,89 -115,88 -115,88 -115,88 0,0 -118,-9 -244,81 -126,90 -131,105 -131,105l-287 -17zm1718 23l408 -765 61 1 95 -37 264 624 -828 177zm-1318 -337l195 -189 405 120c0,0 -146,13 -231,72 -86,59 -115,121 -115,121l-254 -124zm549 -412l464 207c0,0 42,-62 142,-95 100,-33 178,-58 178,-58l-458 -295 -326 241zm918 -631l-226 136 442 398 89 -163 -110 -107 23 -70 -218 -194zm265 572c0,0 30,6 55,3 24,-4 64,-50 64,-50l-41 -116 -78 163zm-204 -597l83 -50 321 313 -39 32 -107 -96 -86 -23 -172 -176zm135 -59l577 572c0,0 172,-96 324,-101 153,-5 207,-5 207,-5l-462 -485 -646 19zm1344 -49l679 0 370 227c0,0 -249,9 -406,65 -158,56 -194,69 -194,69l-449 -361zm1674 71l532 21 23 35 -470 -2 -85 -54z"/>\  <path class="fil0" d="M2009 1062c61,0 110,50 110,110 0,61 -49,110 -110,110 -60,0 -110,-49 -110,-110 0,-60 50,-110 110,-110zm305 987l190 136c24,17 29,51 12,75l0 0c-17,24 -51,29 -75,12l-155 -112c-24,3 -48,-11 -57,-34l-85 -226c-10,-28 4,-59 31,-69l0 0c28,-11 59,4 69,31l70 187zm257 -119c2,1 3,2 4,3l196 141c24,17 30,51 12,75l0 0c-17,23 -50,29 -74,12l-172 -124c-14,-2 -27,-9 -36,-21l-143 -195c-17,-23 -12,-57 12,-74l0 0c23,-18 57,-13 74,11l127 172zm-116 -776l0 0c23,9 34,35 24,58l-74 185c-9,23 -35,34 -58,25l0 0c-22,-9 -34,-35 -24,-58l74 -185c9,-23 35,-34 58,-25zm-485 430l0 0c-15,20 -43,24 -62,9l-161 -119c-19,-14 -24,-42 -9,-62l0 0c14,-19 42,-23 62,-9l161 119c19,15 23,43 9,62zm119 -301l0 0c68,-23 143,14 166,83l76 227c23,68 -14,143 -83,166l0 0c-68,22 -143,-15 -166,-83l-76 -227c-23,-68 14,-143 83,-166z"/>\ </g>';};this.createDefElementTower=function(){return'<g id="'+this.obstacle_tower_id+'" transform="scale(0.04)">\  <metadata id="CorelCorpID_0Corel-Layer"/>\  <path class="fil0" d="M0 1063l106 3 48 -162 181 -163 183 166 47 159 106 -3 -201 -678 100 0 0 -259 -236 -126 -217 126 0 259 84 0 -201 678zm373 -356l68 -60 48 164 -116 -104zm-77 -1l-66 -60 -48 162 114 -102zm-50 -112l87 78 91 -81 -61 -206 -55 0 -62 209zm-54 -419l303 0 0 110 -303 0 0 -110z"/>\ </g>';};this.createDefElementTowerLight=function(){return'<g id="'+this.obstacle_tower_light_id+'" transform="scale(0.04)">\  <metadata id="CorelCorpID_0Corel-Layer"/>\  <path class="fil0" d="M0 1187l106 3 48 -162 181 -163 183 166 47 159 106 -3 -201 -678 100 0 0 -259 -236 -126 -217 126 0 259 84 0 -201 678zm373 -356l68 -60 48 164 -116 -104zm-77 -1l-66 -60 -48 162 114 -102zm-50 -112l87 78 91 -81 -61 -206 -55 0 -62 209zm-54 -419l303 0 0 110 -303 0 0 -110z"/>\  <path class="fil0" d="M444 79l0 0c-1,-5 -6,-8 -11,-7l-54 14c-5,2 -8,7 -6,12l0 0c1,5 6,8 11,7l53 -14c6,-2 9,-7 7,-12zm-37 -59l0 0c-4,-3 -10,-2 -14,1l-36 42c-3,4 -3,10 1,14l0 0c4,3 10,3 14,-1l36 -42c3,-4 3,-10 -1,-14zm-74 -20l0 0c-5,0 -9,5 -8,10l4 55c0,5 5,9 10,9l0 0c5,0 9,-5 9,-10l-5 -55c0,-5 -5,-9 -10,-9zm-58 19l0 0c-5,3 -6,9 -3,13l31 46c2,4 8,5 13,2l0 0c4,-2 5,-8 2,-13l-30 -46c-3,-4 -9,-5 -13,-2zm-40 57l0 0c-2,5 1,10 6,12l52 17c5,2 11,-1 12,-5l0 0c2,-5 -1,-11 -6,-12l-52 -18c-5,-2 -10,1 -12,6z"/>\ </g>';};this.createDefElementWindPower=function(){return'<g id="'+this.obstacle_wind_power_id+'" transform="scale(0.0085)">\  <metadata id="CorelCorpID_0Corel-Layer"/>\  <path class="fil0" d="M1530 1629c0,0 64,-48 147,-57 83,-10 127,13 163,-42 35,-54 -192,-1525 -192,-1525 0,0 -96,-21 -121,24 -26,44 -22,137 -22,137l25 1463zm170 -135c0,0 48,25 44,-115 -5,-141 -151,-1277 -151,-1277 0,0 6,-21 36,-25 29,-5 192,1273 155,1356 -36,83 -84,61 -84,61zm-7 197c128,0 233,105 233,233 0,129 -105,233 -233,233 -129,0 -233,-104 -233,-233 0,-128 104,-233 233,-233zm-7 150c44,0 80,36 80,80 0,44 -36,80 -80,80 -44,0 -79,-36 -79,-80 0,-44 35,-80 79,-80zm-143 4089l70 -3699 198 -3 105 3673c0,0 -54,83 -188,83 -134,0 -185,-54 -185,-54zm238 -3667l86 3625 -85 43 -45 -3661 44 -7zm-295 -78c0,0 -73,-33 -121,-101 -48,-69 -49,-119 -114,-124 -64,-5 -1251,893 -1251,893 0,0 27,94 79,95 51,2 131,-45 131,-45l1276 -718zm-201 -85c0,0 0,-54 -121,16 -122,71 -1052,739 -1052,739 0,0 -22,5 -40,-19 -18,-24 1030,-774 1120,-781 90,-8 93,45 93,45zm651 29c0,0 62,-51 91,-130 28,-78 17,-127 78,-148 61,-21 1438,545 1438,545 0,0 -3,98 -52,112 -49,15 -139,-10 -139,-10l-1416 -369zm172 -134c0,0 -13,-52 122,-15 135,37 1205,446 1205,446 0,0 22,-1 33,-28 12,-28 -1192,-486 -1281,-470 -89,15 -79,67 -79,67z"/>\ </g>';};this.createDefElementAixmAhp=function(){return'<g id="'+this.obstacle_aixm_ahp_id+'" transform="scale(0.25)">\  <metadata id="CorelCorpID_0Corel-Layer"/>\  <path class="fil0" d="M66 49l16 0 1 -1 0 -12 -18 0 0 12 1 1zm21 -4l9 -9 -9 0 0 9zm-25 -9l-10 0 10 9 0 -9zm-15 0l6 -13 42 0 7 13 -15 14 0 37 -25 0 0 -18 0 -19 -15 -14z"/>\  <path class="fil0" d="M124 0c0,9 17,32 4,61 -4,11 -8,10 1,16 5,-2 4,0 7,-7 1,-2 3,-7 3,-9 7,-18 6,-38 -2,-55 -1,-2 -1,-3 -2,-5 0,0 -1,-1 -1,-1l-10 0z"/>\  <path class="fil0" d="M106 10c2,10 7,14 7,27 0,13 -6,17 -7,27l7 3c13,-12 14,-49 0,-60l-7 3z"/>\  <path class="fil0" d="M27 0c0,9 -17,32 -4,61 4,11 8,10 -1,16 -5,-2 -4,0 -7,-7 -1,-2 -3,-7 -4,-9 -6,-18 -5,-38 3,-55 1,-2 1,-3 2,-5 0,0 1,-1 1,-1l10 0z"/>\  <path class="fil0" d="M45 10c-2,10 -7,14 -7,27 0,13 5,17 7,27l-7 3c-13,-12 -14,-49 0,-60l7 3z"/>\  <polygon class="fil1" points="0,48 3,52 2,48 "/>\    </g>';};this.createDefElementAixmDme=function(){return'<g id="'+this.obstacle_aixm_dme_id+'" transform="scale(0.35)">\        <rect x="1" y="1" stroke="black" style="stroke-width: 1px; vector-effect: non-scaling-stroke; fill-opacity: 0;" width="64" height="64"/>\        </g>';};this.createDefElementAixmVor=function(){return'<g id="'+this.obstacle_aixm_vor_id+'" transform="scale(0.35)">\        <path stroke="black" id="e3_shape" style="vector-effect: non-scaling-stroke; stroke-width: 1px; fill-opacity: 0;" transform="matrix(7.78523 0 0 7.93406 117.271 245.649)" d="M -12.362 -30.7861 l -2.38008 4 l 2.50677 4 h 3.11315 l 2.38008 -4 l -2.50677 -4 Z"/>\        </g>';};this.createDefElementAixmNdb=function(){return'<g id="'+this.obstacle_aixm_ndb_id+'" transform="scale(0.1)">\        <metadata id="CorelCorpID_0Corel-Layer"/>\        <path class="fil0_nav" d="M112 77c-11,1 -19,5 -26,13 -6,6 -10,16 -10,28 2,20 20,37 42,36 20,-2 37,-19 35,-42 -1,-15 -11,-28 -25,-33 -4,-2 -10,-3 -16,-2zm1 18c-7,1 -11,4 -13,7 -3,4 -6,9 -5,15 1,11 10,19 22,18 10,-1 19,-10 18,-22 -2,-11 -12,-19 -22,-18zm-1 13c-3,1 -6,4 -5,9 1,3 4,7 9,6 3,-1 7,-5 6,-10 -1,-3 -5,-6 -10,-5zm105 26c-7,2 -5,13 3,11 7,-1 5,-13 -3,-11zm-163 16c-8,2 -5,13 3,11 7,-2 5,-13 -3,-11zm-28 -17c-8,3 -4,14 3,11 8,-2 4,-13 -3,-11zm54 39c-8,2 -5,13 2,12 8,-1 6,-13 -2,-12zm49 -12c-8,1 -5,12 2,11 8,-1 6,-13 -2,-11zm-17 40c-8,2 -5,13 2,11 8,-2 5,-13 -2,-11zm-104 -120c-8,3 -4,14 3,12 7,-2 4,-14 -3,-12zm151 106c-8,2 -4,13 3,11 7,-2 4,-13 -3,-11zm25 -131c-8,1 -6,13 2,11 8,-1 5,-13 -2,-11zm-1 63c-8,2 -5,13 2,12 8,-1 6,-13 -2,-12zm-71 -63c-8,2 -5,13 2,12 8,-1 6,-13 -2,-12zm67 29c-8,2 -5,13 3,12 7,-2 4,-14 -3,-12zm14 97c-8,1 -5,13 2,11 8,-1 6,-13 -2,-11zm-128 -149c-8,2 -4,13 3,11 8,-2 5,-13 -3,-11zm99 69c-8,2 -4,13 3,11 8,-2 4,-14 -3,-11zm-5 -18c-9,1 -6,13 1,11 8,-1 6,-12 -1,-11zm-30 -81c-7,1 -5,13 3,11 7,-2 5,-13 -3,-11zm-62 134c-8,2 -5,13 3,11 7,-2 5,-13 -3,-11zm145 15c-3,0 -5,3 -5,6 2,8 13,6 12,-2 -1,-2 -3,-5 -7,-4zm-20 -82c-8,2 -4,13 3,11 7,-2 5,-13 -3,-11zm-112 -45c-3,1 -5,4 -4,7 2,8 13,5 11,-3 0,-2 -3,-5 -7,-4zm70 187c-3,1 -6,3 -5,7 2,8 13,5 12,-3 -1,-2 -4,-5 -7,-4zm-38 6c-3,1 -6,4 -5,7 1,8 13,6 12,-2 -1,-3 -4,-5 -7,-5zm-15 -39c-3,1 -6,3 -5,7 1,8 13,6 11,-2 0,-3 -3,-5 -6,-5zm101 -94c-7,2 -5,13 3,12 3,-1 5,-4 4,-7 0,-3 -3,-6 -7,-5zm22 14c-8,2 -5,14 2,12 3,-1 5,-4 5,-7 -1,-3 -4,-5 -7,-5zm-199 68c-3,0 -6,3 -5,7 1,3 4,5 7,4 8,-1 5,-13 -2,-11zm150 -97c-3,1 -5,3 -4,7 2,7 13,5 11,-3 -1,-3 -4,-5 -7,-4zm-13 94c-2,1 -5,4 -4,8 2,7 14,4 12,-4 -1,-2 -4,-5 -8,-4zm-46 -145c-8,2 -6,13 2,12 3,0 5,-3 5,-7 -1,-2 -3,-5 -7,-5zm21 198c-3,0 -6,3 -5,7 2,7 13,5 12,-3 -1,-3 -4,-5 -7,-4zm-5 -18c-8,2 -4,13 3,11 3,0 5,-3 4,-7 0,-3 -3,-5 -7,-4zm-62 -116c-7,2 -5,13 3,12 3,-1 5,-4 4,-7 0,-3 -3,-6 -7,-5zm107 -40c-8,2 -6,13 2,12 2,-1 5,-3 4,-7 0,-3 -3,-5 -6,-5zm5 -19c-3,0 -6,3 -5,7 2,7 13,5 12,-3 -1,-3 -4,-5 -7,-4zm-21 114c-3,0 -5,3 -4,7 0,2 3,5 7,4 7,-2 5,-13 -3,-11zm27 26c-3,1 -5,3 -5,7 1,7 13,6 12,-2 -1,-3 -4,-5 -7,-5zm-20 -44c-8,2 -5,13 3,12 2,-1 5,-4 4,-8 -1,-2 -4,-5 -7,-4zm-19 32c-3,0 -5,3 -4,7 1,7 13,5 11,-3 0,-3 -3,-5 -7,-4zm-49 -150c-8,1 -6,13 1,12 3,-1 6,-4 5,-7 0,-3 -3,-6 -6,-5zm64 55c-8,1 -6,13 2,11 3,0 5,-3 5,-7 -1,-2 -4,-5 -7,-4zm-65 -17c-8,1 -5,13 2,11 3,0 6,-3 5,-7 -1,-3 -3,-5 -7,-4zm-53 79c-8,1 -5,13 2,11 3,0 6,-3 5,-7 -1,-3 -4,-5 -7,-4zm150 31c-7,2 -5,13 3,12 2,-1 5,-4 4,-7 0,-3 -3,-6 -7,-5zm-114 -144c-8,2 -5,13 2,12 3,-1 5,-3 5,-7 0,-3 -3,-5 -7,-5zm67 20c-8,1 -6,12 1,11 3,0 6,-3 5,-6 0,-3 -3,-6 -6,-5zm-140 73c-8,1 -6,13 2,11 3,0 6,-3 5,-7 -1,-2 -3,-5 -7,-4zm107 -61c-7,2 -5,13 3,11 3,0 5,-3 4,-7 0,-2 -3,-5 -7,-4zm-79 111c-8,2 -6,13 1,12 3,0 6,-3 5,-7 0,-2 -3,-5 -6,-5zm47 2c-8,1 -6,13 2,12 3,-1 5,-4 4,-7 0,-3 -3,-6 -6,-5zm0 43c-8,1 -5,13 3,11 3,-1 5,-4 4,-7 0,-3 -3,-5 -7,-4zm-67 -43c-8,1 -6,13 2,12 3,-1 5,-4 5,-7 -1,-3 -4,-6 -7,-5zm131 23c-7,2 -5,13 3,12 3,-1 5,-4 4,-8 0,-2 -3,-5 -7,-4zm15 -141c-7,2 -5,13 2,12 3,-1 6,-3 5,-7 0,-3 -3,-5 -7,-5zm-126 36c-8,1 -6,13 1,12 3,-1 6,-4 5,-7 0,-3 -3,-6 -6,-5zm-9 49c-8,1 -6,12 1,11 3,0 6,-3 5,-6 0,-3 -3,-6 -6,-5zm73 -98c-8,1 -6,13 1,12 3,0 6,-3 5,-6 0,-3 -3,-6 -6,-6zm31 160c-7,2 -5,13 3,12 2,-1 5,-4 4,-7 0,-3 -3,-6 -7,-5zm-32 18c-7,2 -5,13 2,12 3,-1 6,-3 5,-7 0,-3 -3,-6 -7,-5zm95 -162c-8,1 -5,13 2,11 3,0 6,-3 5,-7 -1,-3 -4,-5 -7,-4zm-186 80c-8,2 -6,14 2,12 3,0 5,-3 5,-7 -1,-3 -4,-5 -7,-5zm19 -15c-8,1 -6,13 1,12 3,-1 6,-4 5,-7 0,-3 -3,-6 -6,-5zm180 66c-8,2 -6,13 2,12 3,0 5,-3 5,-7 -1,-2 -3,-5 -7,-5zm-181 -118c-3,1 -6,3 -5,7 1,3 4,5 7,5 8,-2 5,-13 -2,-12zm21 144c-8,2 -5,13 3,12 2,-1 5,-3 4,-7 0,-3 -3,-5 -7,-5zm15 10c-8,2 -6,13 2,12 3,0 5,-3 5,-6 0,-3 -3,-6 -7,-6zm-52 -69c-7,1 -5,13 3,12 2,-1 5,-4 4,-7 0,-3 -3,-6 -7,-5zm210 -52c-3,1 -6,3 -5,7 1,7 13,5 12,-2 -1,-3 -4,-6 -7,-5zm-176 -27c-8,2 -5,13 3,11 2,0 5,-3 4,-7 -1,-2 -4,-5 -7,-4zm0 109c-8,2 -5,13 3,11 2,0 5,-3 4,-7 -1,-3 -4,-5 -7,-4zm-27 -100c-3,1 -5,4 -5,7 2,8 13,6 12,-2 0,-2 -3,-5 -7,-5zm81 96c-7,2 -4,13 3,12 3,-1 6,-4 5,-8 -1,-2 -4,-5 -8,-4zm-3 56c-8,2 -5,14 3,12 2,-1 5,-4 4,-8 -1,-2 -4,-5 -7,-4zm37 -195c-8,2 -6,13 2,12 2,-1 5,-4 4,-7 0,-3 -3,-6 -6,-5zm18 -14c-8,2 -6,13 2,12 3,-1 5,-4 5,-7 -1,-3 -4,-6 -7,-5zm-3 187c-8,3 -4,14 3,12 3,-1 5,-4 4,-8 -1,-2 -3,-5 -7,-4zm-92 -18c-8,2 -5,13 3,12 2,-1 5,-4 4,-8 -1,-2 -3,-5 -7,-4zm59 6c-3,1 -5,3 -5,7 1,3 4,5 8,5 7,-2 5,-14 -3,-12zm-64 -159c-8,2 -5,13 2,12 3,-1 6,-4 5,-8 -1,-2 -4,-5 -7,-4zm124 128c-8,2 -6,13 1,12 3,0 6,-3 5,-7 0,-3 -3,-5 -6,-5zm-110 -32c-8,2 -5,14 2,12 3,-1 5,-4 5,-7 -1,-3 -4,-5 -7,-5zm111 58c-8,2 -4,13 3,11 3,-1 5,-4 4,-7 0,-3 -3,-5 -7,-4zm-141 4c-8,3 -4,14 3,12 3,-1 5,-4 4,-8 0,-2 -3,-5 -7,-4zm29 -80c-8,2 -5,13 3,11 3,0 5,-3 4,-7 0,-3 -3,-5 -7,-4zm69 -61c-8,3 -4,14 3,12 3,-1 5,-4 4,-8 0,-2 -3,-5 -7,-4zm-18 124c-8,1 -6,12 2,11 2,0 5,-3 4,-6 0,-3 -3,-6 -6,-5zm-33 -95c-3,1 -5,3 -4,7 0,3 3,5 7,4 2,0 5,-3 4,-7 0,-3 -3,-5 -7,-4zm132 -4c-7,2 -4,13 3,12 3,-1 5,-4 5,-7 -1,-3 -4,-6 -8,-5zm-157 4c-7,2 -4,13 3,12 3,-1 5,-4 4,-7 0,-3 -3,-6 -7,-5zm26 -23c-8,2 -5,13 3,11 2,0 5,-3 4,-7 -1,-2 -4,-5 -7,-4zm67 23c-8,3 -4,14 3,12 3,-1 5,-4 4,-7 0,-3 -3,-6 -7,-5zm-15 -9c-8,1 -6,13 2,11 2,0 5,-3 4,-6 0,-3 -3,-6 -6,-5zm49 134c-2,1 -5,4 -4,7 0,3 3,5 7,5 3,-1 5,-4 4,-7 0,-3 -3,-6 -7,-5zm-115 -138c-8,1 -5,13 2,12 3,-1 6,-4 5,-7 -1,-3 -3,-6 -7,-5zm81 -9c-3,0 -6,3 -5,6 0,3 3,6 7,5 2,0 5,-3 5,-6 -1,-3 -4,-6 -7,-5zm52 88c-8,2 -5,13 3,11 3,0 5,-3 4,-7 0,-2 -3,-5 -7,-4zm-132 51c-3,1 -6,3 -5,7 0,3 3,5 7,5 2,-1 5,-4 4,-7 0,-3 -3,-6 -6,-5zm9 25c-3,1 -5,3 -5,7 1,3 3,5 7,5 3,-1 5,-3 5,-7 -1,-3 -3,-5 -7,-5zm108 -109c-8,2 -5,13 3,11 2,0 5,-3 4,-7 -1,-2 -4,-5 -7,-4zm-136 33c-3,1 -6,3 -6,7 1,3 4,5 7,5 3,0 6,-3 5,-6 0,-3 -3,-6 -6,-6zm154 -17c-8,3 -4,14 3,12 3,-1 5,-4 4,-7 0,-3 -3,-6 -7,-5zm-22 18c-3,1 -6,3 -5,7 0,3 3,5 7,5 3,-1 5,-4 4,-7 0,-3 -3,-6 -6,-5zm-117 -123c-8,2 -5,14 2,12 3,-1 5,-4 5,-7 -1,-3 -4,-5 -7,-5zm101 1c-3,1 -6,4 -5,7 1,3 4,5 7,5 3,-1 6,-4 5,-7 -1,-3 -4,-6 -7,-5zm-49 -13l-2 0c-1,1 -2,0 -4,2 -3,4 0,10 5,10 6,0 8,-8 3,-11 0,0 -1,-1 -2,-1zm-72 100c-3,1 -5,3 -5,7 0,3 3,5 7,5 3,-1 5,-3 5,-7 -1,-3 -4,-5 -7,-5zm52 -42c-3,1 -5,4 -4,7 0,3 3,6 7,5 3,-1 5,-4 4,-8 -1,-2 -3,-5 -7,-4zm108 -9c-8,2 -5,13 3,11 2,0 5,-3 4,-7 -1,-3 -4,-5 -7,-4zm-176 35c-3,0 -5,3 -4,7 0,2 3,5 7,4 3,-1 5,-3 4,-7 0,-3 -3,-5 -7,-4zm175 17c-2,0 -5,3 -4,7 0,2 3,5 7,4 2,0 5,-3 4,-7 0,-3 -3,-5 -7,-4zm-167 -67c-3,1 -5,3 -5,7 0,3 3,5 7,5 3,-1 5,-4 5,-7 -1,-3 -4,-6 -7,-5zm132 169c-3,1 -6,4 -5,7 1,3 4,6 7,5 3,-1 6,-4 5,-7 -1,-3 -4,-6 -7,-5zm-120 -120c-3,1 -6,4 -5,7 1,3 3,6 7,5 3,-1 5,-4 5,-7 -1,-3 -4,-5 -7,-5zm181 40l0 -2c0,-1 0,-2 -1,-2 -3,-5 -11,-3 -11,3 0,3 3,6 5,6 5,0 6,-4 7,-5zm-174 -81c-3,0 -6,2 -5,6 0,3 3,6 6,5 3,0 6,-3 5,-6 0,-3 -3,-6 -6,-5zm13 121c-3,0 -6,3 -5,7 1,2 4,5 7,4 3,-1 6,-4 5,-7 -1,-3 -4,-5 -7,-4z"/>\        </g>';};this.createDefElementWindPowerLight=function(){return'<g id="'+this.obstacle_wind_power_light_id+'" transform="scale(0.0085)">\  <metadata id="CorelCorpID_0Corel-Layer"/>\  <path class="fil0" d="M1489 1585c0,0 62,-46 143,-56 80,-9 124,13 158,-40 34,-53 -186,-1484 -186,-1484 0,0 -94,-21 -118,23 -25,43 -22,133 -22,133l25 1424zm166 -132c0,0 46,25 42,-112 -5,-136 -147,-1242 -147,-1242 0,0 6,-20 35,-24 29,-5 186,1238 151,1319 -35,81 -81,59 -81,59zm-8 193c125,0 227,101 227,226 0,126 -102,227 -227,227 -125,0 -227,-101 -227,-227 0,-125 102,-226 227,-226zm-6 146c43,0 77,34 77,77 0,43 -34,78 -77,78 -43,0 -78,-35 -78,-78 0,-43 35,-77 78,-77zm-140 3977l68 -3598 193 -4 102 3574c0,0 -52,81 -183,81 -130,0 -180,-53 -180,-53zm231 -3568l84 3528 -82 42 -44 -3562 42 -8zm-287 -75c0,0 -70,-32 -117,-99 -46,-66 -48,-115 -110,-120 -63,-5 -1218,869 -1218,869 0,0 26,92 77,93 50,1 127,-44 127,-44l1241 -699zm-195 -83c0,0 0,-52 -118,16 -118,69 -1023,719 -1023,719 0,0 -21,4 -39,-19 -17,-23 1002,-752 1090,-760 88,-7 90,44 90,44zm634 28c0,0 60,-49 88,-126 28,-76 17,-123 76,-144 60,-21 1399,530 1399,530 0,0 -2,96 -50,110 -48,13 -135,-11 -135,-11l-1378 -359zm167 -130c0,0 -13,-51 119,-15 132,37 1173,435 1173,435 0,0 21,-1 32,-28 11,-27 -1160,-473 -1247,-458 -87,16 -77,66 -77,66z"/>\  <rect class="fil0" transform="matrix(1.30891 0.526202 -0.526202 1.30891 1345.78 1220.17)" width="57.8077" height="226.413" rx="29" ry="29"/>\  <rect class="fil0" transform="matrix(1.37695 -0.306858 0.306858 1.37695 1044.77 1222.61)" width="57.8077" height="226.413" rx="29" ry="29"/>\  <rect class="fil0" transform="matrix(0.756666 -1.19063 1.19063 0.756666 802.79 1448.28)" width="57.8077" height="226.413" rx="29" ry="29"/>\  <rect class="fil0" transform="matrix(0.0775228 -1.40859 1.40859 0.0775228 735.376 1705.73)" width="57.8077" height="226.413" rx="29" ry="29"/>\  <rect class="fil0" transform="matrix(-0.802513 -1.16022 1.16022 -0.802513 856.162 1982.61)" width="57.8077" height="226.413" rx="29" ry="29"/>\ </g>';};this.createZoomPanButtonsSvg=function(){return'<svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" width="27mm" height="27mm" version="1.1" style="shape-rendering:geometricPrecision; text-rendering:geometricPrecision; image-rendering:optimizeQuality; fill-rule:evenodd; clip-rule:evenodd" viewBox="0 0 37 37" x="'+(this.svg_width-160)+'" y="10" xmlns:xlink="http://www.w3.org/1999/xlink">\ <defs>\     <clipPath id="id0">\      <path d="M19 0c10,0 18,8 18,19 0,10 -8,18 -18,18 -11,0 -19,-8 -19,-18 0,-11 8,-19 19,-19z"/>\     </clipPath>\     <clipPath id="id1">\      <path d="M19 1c9,0 17,8 17,18 0,9 -8,17 -17,17 -10,0 -18,-8 -18,-17 0,-10 8,-18 18,-18z"/>\     </clipPath>\  <linearGradient id="id2" gradientUnits="userSpaceOnUse" x1="19.8694" y1="13.421" x2="17.2815" y2="0.593333">\   <stop offset="0" style="stop-opacity:1; stop-color:#434242"/>\   <stop offset="0.639216" style="stop-opacity:1; stop-color:#A0A0A0"/>\   <stop offset="1" style="stop-opacity:1; stop-color:#FEFEFE"/>\  </linearGradient>\  <linearGradient id="id3" gradientUnits="userSpaceOnUse" x1="30.5485" y1="7.23809" x2="25.1286" y2="12.1091">\   <stop offset="0" style="stop-opacity:1; stop-color:#9D9E9E"/>\   <stop offset="0.811765" style="stop-opacity:1; stop-color:#CDCECE"/>\   <stop offset="1" style="stop-opacity:1; stop-color:#FEFEFE"/>\  </linearGradient>\  <linearGradient id="id4" gradientUnits="userSpaceOnUse" x1="7.56695" y1="16.9943" x2="1.31393" y2="20.1707">\   <stop offset="0" style="stop-opacity:1; stop-color:#C5C6C6"/>\   <stop offset="0.788235" style="stop-opacity:1; stop-color:#E1E2E2"/>\   <stop offset="1" style="stop-opacity:1; stop-color:#FEFEFE"/>\  </linearGradient>\  <linearGradient id="id5" gradientUnits="userSpaceOnUse" x1="26.6821" y1="29.0013" x2="28.8607" y2="25.8003">\   <stop offset="0" style="stop-opacity:1; stop-color:#898989"/>\   <stop offset="1" style="stop-opacity:1; stop-color:#FEFEFE"/>\  </linearGradient>\  <linearGradient id="id6" gradientUnits="userSpaceOnUse" xlink:href="#id5" x1="28.3006" y1="17.767" x2="25.3703" y2="19.2846">\  </linearGradient>\  <linearGradient id="id7" gradientUnits="userSpaceOnUse" xlink:href="#id2" x1="36.4935" y1="19.3579" x2="23.8243" y2="17.7165">\  </linearGradient>\  <linearGradient id="id8" gradientUnits="userSpaceOnUse" x1="29.879" y1="18.5268" x2="29.7164" y2="18.5421">\   <stop offset="0" style="stop-opacity:1; stop-color:#C5C6C6"/>\   <stop offset="0.878431" style="stop-opacity:1; stop-color:#E1E2E2"/>\   <stop offset="1" style="stop-opacity:1; stop-color:#FEFEFE"/>\  </linearGradient>\  <linearGradient id="id9" gradientUnits="userSpaceOnUse" xlink:href="#id5" x1="8.09827" y1="26.7335" x2="11.3092" y2="28.8861">\  </linearGradient>\  <linearGradient id="id10" gradientUnits="userSpaceOnUse" xlink:href="#id4" x1="20.1456" y1="7.55166" x2="16.9892" y2="1.31059">\  </linearGradient>\  <linearGradient id="id11" gradientUnits="userSpaceOnUse" xlink:href="#id2" x1="18.5754" y1="34.8248" x2="18.5754" y2="25.5262">\  </linearGradient>\  <linearGradient id="id12" gradientUnits="userSpaceOnUse" x1="7.14168" y1="15.1415" x2="4.08941" y2="18.194">\   <stop offset="0" style="stop-opacity:1; stop-color:#5B5B5B"/>\   <stop offset="0.811765" style="stop-opacity:1; stop-color:#ACACAC"/>\   <stop offset="1" style="stop-opacity:1; stop-color:#FEFEFE"/>\  </linearGradient>\  <linearGradient id="id13" gradientUnits="userSpaceOnUse" xlink:href="#id2" x1="12.4356" y1="19.5423" x2="1.5934" y2="17.6066">\  </linearGradient>\  <linearGradient id="id14" gradientUnits="userSpaceOnUse" xlink:href="#id5" x1="19.3264" y1="28.3146" x2="17.8084" y2="25.3897">\  </linearGradient>\  <linearGradient id="id15" gradientUnits="userSpaceOnUse" x1="33.4642" y1="18.5234" x2="29.6519" y2="22.3449">\   <stop offset="0" style="stop-opacity:1; stop-color:#2B2A29"/>\   <stop offset="1" style="stop-opacity:1; stop-color:#FEFEFE"/>\  </linearGradient>\  <linearGradient id="id16" gradientUnits="userSpaceOnUse" xlink:href="#id3" x1="29.8664" y1="30.5177" x2="24.9957" y2="25.102">\  </linearGradient>\  <linearGradient id="id17" gradientUnits="userSpaceOnUse" x1="33.0439" y1="17.2471" x2="30.101" y2="16.0208">\   <stop offset="0" style="stop-opacity:1; stop-color:#2B2A29"/>\   <stop offset="0.811765" style="stop-opacity:1; stop-color:#949493"/>\   <stop offset="1" style="stop-opacity:1; stop-color:#FEFEFE"/>\  </linearGradient>\ </defs>\ <g id="profile_panZoomController">\  <metadata id="CorelCorpID_0Corel-Layer"/>\  <g id="_71725728">\   <g>\    <g style="clip-path:url(#id0)">\     <polygon class="fil0" points="19,19 1,43 2,43 "/>\     <polygon id="1" class="fil1" points="19,19 1,43 2,43 "/>\     <polygon id="2" class="fil2" points="19,19 2,43 2,43 "/>\     <polygon id="3" class="fil3" points="19,19 2,43 2,44 "/>\     <polygon id="4" class="fil4" points="19,19 2,44 3,44 "/>\     <polygon id="5" class="fil5" points="19,19 3,44 3,44 "/>\     <polygon id="6" class="fil6" points="19,19 3,44 3,44 "/>\     <polygon id="7" class="fil7" points="19,19 3,44 4,44 "/>\     <polygon id="8" class="fil8" points="19,19 4,44 4,45 "/>\     <polygon id="9" class="fil9" points="19,19 4,45 4,45 "/>\     <polygon id="10" class="fil10" points="19,19 4,45 5,45 "/>\     <polygon id="11" class="fil11" points="19,19 5,45 5,45 "/>\     <polygon id="12" class="fil12" points="19,19 5,45 5,45 "/>\     <polygon id="13" class="fil13" points="19,19 5,45 6,45 "/>\     <polygon id="14" class="fil14" points="19,19 6,45 6,46 "/>\     <polygon id="15" class="fil15" points="19,19 6,46 6,46 "/>\     <polygon id="16" class="fil16" points="19,19 6,46 7,46 "/>\     <polygon id="17" class="fil17" points="19,19 7,46 7,46 "/>\     <polygon id="18" class="fil18" points="19,19 7,46 7,46 "/>\     <polygon id="19" class="fil19" points="19,19 7,46 8,46 "/>\     <polygon id="20" class="fil20" points="19,19 8,46 8,46 "/>\     <polygon id="21" class="fil21" points="19,19 8,46 8,47 "/>\     <polygon id="22" class="fil22" points="19,19 8,47 9,47 "/>\     <polygon id="23" class="fil23" points="19,19 9,47 9,47 "/>\     <polygon id="24" class="fil24" points="19,19 9,47 9,47 "/>\     <polygon id="25" class="fil25" points="19,19 9,47 10,47 "/>\     <polygon id="26" class="fil26" points="19,19 10,47 10,47 "/>\     <polygon id="27" class="fil27" points="19,19 10,47 10,47 "/>\     <polygon id="28" class="fil28" points="19,19 10,47 11,47 "/>\     <polygon id="29" class="fil29" points="19,19 11,47 11,47 "/>\     <polygon id="30" class="fil30" points="19,19 11,47 11,48 "/>\     <polygon id="31" class="fil31" points="19,19 11,47 12,48 "/>\     <polygon id="32" class="fil32" points="19,19 12,48 12,48 "/>\     <polygon id="33" class="fil33" points="19,19 12,48 13,48 "/>\     <polygon id="34" class="fil34" points="19,19 12,48 13,48 "/>\     <polygon id="35" class="fil35" points="19,19 13,48 13,48 "/>\     <polygon id="36" class="fil36" points="19,19 13,48 14,48 "/>\     <polygon id="37" class="fil37" points="19,19 14,48 14,48 "/>\     <polygon id="38" class="fil38" points="19,19 14,48 14,48 "/>\     <polygon id="39" class="fil39" points="19,19 14,48 15,48 "/>\     <polygon id="40" class="fil40" points="19,19 15,48 15,48 "/>\     <polygon id="41" class="fil41" points="19,19 15,48 15,48 "/>\     <polygon id="42" class="fil42" points="19,19 15,48 16,48 "/>\     <polygon id="43" class="fil43" points="19,19 16,48 16,48 "/>\     <polygon id="44" class="fil44" points="19,19 16,48 17,48 "/>\     <polygon id="45" class="fil45" points="19,19 16,48 17,48 "/>\     <polygon id="46" class="fil46" points="19,19 17,48 17,48 "/>\     <polygon id="47" class="fil47" points="19,19 17,48 18,48 "/>\     <polygon id="48" class="fil48" points="19,19 18,48 18,48 "/>\     <polygon id="49" class="fil49" points="19,19 18,48 18,48 "/>\     <polygon id="50" class="fil50" points="19,19 18,48 19,48 "/>\     <polygon id="51" class="fil51" points="19,19 19,48 19,48 "/>\     <polygon id="52" class="fil52" points="19,19 19,48 19,48 "/>\     <polygon id="53" class="fil53" points="19,19 19,48 20,48 "/>\     <polygon id="54" class="fil54" points="19,19 20,48 20,48 "/>\     <polygon id="55" class="fil55" points="19,19 20,48 21,48 "/>\     <polygon id="56" class="fil56" points="19,19 20,48 21,48 "/>\     <polygon id="57" class="fil57" points="19,19 21,48 21,48 "/>\     <polygon id="58" class="fil58" points="19,19 21,48 22,48 "/>\     <polygon id="59" class="fil59" points="19,19 22,48 22,48 "/>\     <polygon id="60" class="fil60" points="19,19 22,48 22,48 "/>\     <polygon id="61" class="fil61" points="19,19 22,48 23,48 "/>\     <polygon id="62" class="fil62" points="19,19 23,48 23,48 "/>\     <polygon id="63" class="fil63" points="19,19 23,48 23,48 "/>\     <polygon id="64" class="fil64" points="19,19 23,48 24,48 "/>\     <polygon id="65" class="fil65" points="19,19 24,48 24,48 "/>\     <polygon id="66" class="fil66" points="19,19 24,48 25,48 "/>\     <polygon id="67" class="fil67" points="19,19 24,48 25,48 "/>\     <polygon id="68" class="fil68" points="19,19 25,48 25,48 "/>\     <polygon id="69" class="fil69" points="19,19 25,48 26,48 "/>\     <polygon id="70" class="fil70" points="19,19 26,48 26,47 "/>\     <polygon id="71" class="fil71" points="19,19 26,47 26,47 "/>\     <polygon id="72" class="fil72" points="19,19 26,47 27,47 "/>\     <polygon id="73" class="fil73" points="19,19 27,47 27,47 "/>\     <polygon id="74" class="fil74" points="19,19 27,47 27,47 "/>\     <polygon id="75" class="fil75" points="19,19 27,47 28,47 "/>\     <polygon id="76" class="fil76" points="19,19 28,47 28,47 "/>\     <polygon id="77" class="fil77" points="19,19 28,47 28,47 "/>\     <polygon id="78" class="fil78" points="19,19 28,47 29,47 "/>\     <polygon id="79" class="fil79" points="19,19 29,47 29,46 "/>\     <polygon id="80" class="fil80" points="19,19 29,46 29,46 "/>\     <polygon id="81" class="fil81" points="19,19 29,46 30,46 "/>\     <polygon id="82" class="fil82" points="19,19 30,46 30,46 "/>\     <polygon id="83" class="fil83" points="19,19 30,46 31,46 "/>\     <polygon id="84" class="fil84" points="19,19 30,46 31,46 "/>\     <polygon id="85" class="fil85" points="19,19 31,46 31,46 "/>\     <polygon id="86" class="fil86" points="19,19 31,46 32,45 "/>\     <polygon id="87" class="fil87" points="19,19 31,45 32,45 "/>\     <polygon id="88" class="fil88" points="19,19 32,45 32,45 "/>\     <polygon id="89" class="fil89" points="19,19 32,45 32,45 "/>\     <polygon id="90" class="fil90" points="19,19 32,45 33,45 "/>\     <polygon id="91" class="fil91" points="19,19 33,45 33,45 "/>\     <polygon id="92" class="fil92" points="19,19 33,45 33,44 "/>\     <polygon id="93" class="fil93" points="19,19 33,44 34,44 "/>\     <polygon id="94" class="fil94" points="19,19 34,44 34,44 "/>\     <polygon id="95" class="fil95" points="19,19 34,44 34,44 "/>\     <polygon id="96" class="fil96" points="19,19 34,44 35,44 "/>\     <polygon id="97" class="fil97" points="19,19 35,44 35,43 "/>\     <polygon id="98" class="fil98" points="19,19 35,43 35,43 "/>\     <polygon id="99" class="fil99" points="19,19 35,43 36,43 "/>\     <polygon id="100" class="fil100" points="19,19 36,43 36,43 "/>\     <polygon id="101" class="fil101" points="19,19 36,43 36,43 "/>\     <polygon id="102" class="fil102" points="19,19 36,43 37,42 "/>\     <polygon id="103" class="fil103" points="19,19 36,42 37,42 "/>\     <polygon id="104" class="fil104" points="19,19 37,42 37,42 "/>\     <polygon id="105" class="fil105" points="19,19 37,42 37,42 "/>\     <polygon id="106" class="fil106" points="19,19 37,42 38,41 "/>\     <polygon id="107" class="fil107" points="19,19 38,42 38,41 "/>\     <polygon id="108" class="fil108" points="19,19 38,41 38,41 "/>\     <polygon id="109" class="fil109" points="19,19 38,41 39,41 "/>\     <polygon id="110" class="fil110" points="19,19 38,41 39,41 "/>\     <polygon id="111" class="fil111" points="19,19 39,41 39,40 "/>\     <polygon id="112" class="fil112" points="19,19 39,40 39,40 "/>\     <polygon id="113" class="fil113" points="19,19 39,40 40,40 "/>\     <polygon id="114" class="fil114" points="19,19 40,40 40,39 "/>\     <polygon id="115" class="fil115" points="19,19 40,40 40,39 "/>\     <polygon id="116" class="fil116" points="19,19 40,39 40,39 "/>\     <polygon id="117" class="fil117" points="19,19 40,39 41,39 "/>\     <polygon id="118" class="fil118" points="19,19 41,39 41,38 "/>\     <polygon id="119" class="fil119" points="19,19 41,38 41,38 "/>\     <polygon id="120" class="fil120" points="19,19 41,38 41,38 "/>\     <polygon id="121" class="fil121" points="19,19 41,38 42,38 "/>\     <polygon id="122" class="fil122" points="19,19 41,38 42,37 "/>\     <polygon id="123" class="fil123" points="19,19 42,37 42,37 "/>\     <polygon id="124" class="fil124" points="19,19 42,37 42,37 "/>\     <polygon id="125" class="fil125" points="19,19 42,37 42,36 "/>\     <polygon id="126" class="fil126" points="19,19 42,36 43,36 "/>\     <polygon id="127" class="fil127" points="19,19 43,36 43,36 "/>\     <polygon id="128" class="fil128" points="19,19 43,36 43,36 "/>\     <polygon id="129" class="fil129" points="19,19 43,36 43,35 "/>\     <polygon id="130" class="fil130" points="19,19 43,35 44,35 "/>\     <polygon id="131" class="fil131" points="19,19 43,35 44,35 "/>\     <polygon id="132" class="fil132" points="19,19 44,35 44,34 "/>\     <polygon id="133" class="fil133" points="19,19 44,34 44,34 "/>\     <polygon id="134" class="fil134" points="19,19 44,34 44,34 "/>\     <polygon id="135" class="fil135" points="19,19 44,34 44,33 "/>\     <polygon id="136" class="fil136" points="19,19 44,33 45,33 "/>\     <polygon id="137" class="fil137" points="19,19 45,33 45,33 "/>\     <polygon id="138" class="fil138" points="19,19 45,33 45,32 "/>\     <polygon id="139" class="fil139" points="19,19 45,32 45,32 "/>\     <polygon id="140" class="fil140" points="19,19 45,32 45,32 "/>\     <polygon id="141" class="fil141" points="19,19 45,32 45,31 "/>\     <polygon id="142" class="fil142" points="19,19 45,31 46,31 "/>\     <polygon id="143" class="fil143" points="19,19 46,31 46,31 "/>\     <polygon id="144" class="fil144" points="19,19 46,31 46,30 "/>\     <polygon id="145" class="fil145" points="19,19 46,30 46,30 "/>\     <polygon id="146" class="fil146" points="19,19 46,30 46,30 "/>\     <polygon id="147" class="fil147" points="19,19 46,30 46,29 "/>\     <polygon id="148" class="fil148" points="19,19 46,29 46,29 "/>\     <polygon id="149" class="fil149" points="19,19 46,29 47,29 "/>\     <polygon id="150" class="fil150" points="19,19 47,29 47,28 "/>\     <polygon id="151" class="fil151" points="19,19 47,28 47,28 "/>\     <polygon id="152" class="fil152" points="19,19 47,28 47,28 "/>\     <polygon id="153" class="fil153" points="19,19 47,28 47,27 "/>\     <polygon id="154" class="fil154" points="19,19 47,27 47,27 "/>\     <polygon id="155" class="fil155" points="19,19 47,27 47,27 "/>\     <polygon id="156" class="fil156" points="19,19 47,27 47,26 "/>\     <polygon id="157" class="fil157" points="19,19 47,26 47,26 "/>\     <polygon id="158" class="fil158" points="19,19 47,26 48,26 "/>\     <polygon id="159" class="fil159" points="19,19 48,26 48,25 "/>\     <polygon id="160" class="fil160" points="19,19 48,25 48,25 "/>\     <polygon id="161" class="fil161" points="19,19 48,25 48,24 "/>\     <polygon id="162" class="fil162" points="19,19 48,25 48,24 "/>\     <polygon id="163" class="fil163" points="19,19 48,24 48,24 "/>\     <polygon id="164" class="fil164" points="19,19 48,24 48,23 "/>\     <polygon id="165" class="fil165" points="19,19 48,23 48,23 "/>\     <polygon id="166" class="fil166" points="19,19 48,23 48,23 "/>\     <polygon id="167" class="fil167" points="19,19 48,23 48,22 "/>\     <polygon id="168" class="fil168" points="19,19 48,22 48,22 "/>\     <polygon id="169" class="fil169" points="19,19 48,22 48,22 "/>\     <polygon id="170" class="fil170" points="19,19 48,22 48,21 "/>\     <polygon id="171" class="fil171" points="19,19 48,21 48,21 "/>\     <polygon id="172" class="fil172" points="19,19 48,21 48,20 "/>\     <polygon id="173" class="fil173" points="19,19 48,21 48,20 "/>\     <polygon id="174" class="fil174" points="19,19 48,20 48,20 "/>\     <polygon id="175" class="fil175" points="19,19 48,20 48,19 "/>\     <polygon id="176" class="fil176" points="19,19 48,19 48,19 "/>\     <polygon id="177" class="fil177" points="19,19 48,19 48,19 "/>\     <polygon id="178" class="fil178" points="19,19 48,19 48,18 "/>\     <polygon id="179" class="fil179" points="19,19 48,18 48,18 "/>\     <polygon id="180" class="fil180" points="19,19 48,18 48,18 "/>\     <polygon id="181" class="fil181" points="19,19 48,18 48,17 "/>\     <polygon id="182" class="fil182" points="19,19 48,17 48,17 "/>\     <polygon id="183" class="fil183" points="19,19 48,17 48,16 "/>\     <polygon id="184" class="fil184" points="19,19 48,17 48,16 "/>\     <polygon id="185" class="fil185" points="19,19 48,16 48,16 "/>\     <polygon id="186" class="fil186" points="19,19 48,16 48,15 "/>\     <polygon id="187" class="fil187" points="19,19 48,15 48,15 "/>\     <polygon id="188" class="fil188" points="19,19 48,15 48,15 "/>\     <polygon id="189" class="fil189" points="19,19 48,15 48,14 "/>\     <polygon id="190" class="fil190" points="19,19 48,14 48,14 "/>\     <polygon id="191" class="fil191" points="19,19 48,14 48,14 "/>\     <polygon id="192" class="fil192" points="19,19 48,14 48,13 "/>\     <polygon id="193" class="fil193" points="19,19 48,13 48,13 "/>\     <polygon id="194" class="fil194" points="19,19 48,13 48,12 "/>\     <polygon id="195" class="fil195" points="19,19 48,13 48,12 "/>\     <polygon id="196" class="fil196" points="19,19 48,12 48,12 "/>\     <polygon id="197" class="fil197" points="19,19 48,12 47,11 "/>\     <polygon id="198" class="fil198" points="19,19 48,11 47,11 "/>\     <polygon id="199" class="fil199" points="19,19 47,11 47,11 "/>\     <polygon id="200" class="fil200" points="19,19 47,11 47,10 "/>\     <polygon id="201" class="fil201" points="19,19 47,10 47,10 "/>\     <polygon id="202" class="fil202" points="19,19 47,10 47,10 "/>\     <polygon id="203" class="fil203" points="19,19 47,10 47,9 "/>\     <polygon id="204" class="fil204" points="19,19 47,9 47,9 "/>\     <polygon id="205" class="fil205" points="19,19 47,9 47,9 "/>\     <polygon id="206" class="fil206" points="19,19 47,9 47,8 "/>\     <polygon id="207" class="fil207" points="19,19 47,8 46,8 "/>\     <polygon id="208" class="fil208" points="19,19 46,8 46,8 "/>\     <polygon id="209" class="fil209" points="19,19 46,8 46,7 "/>\     <polygon id="210" class="fil210" points="19,19 46,7 46,7 "/>\     <polygon id="211" class="fil211" points="19,19 46,7 46,6 "/>\     <polygon id="212" class="fil212" points="19,19 46,7 46,6 "/>\     <polygon id="213" class="fil213" points="19,19 46,6 46,6 "/>\     <polygon id="214" class="fil214" points="19,19 46,6 45,6 "/>\     <polygon id="215" class="fil215" points="19,19 45,6 45,5 "/>\     <polygon id="216" class="fil216" points="19,19 45,5 45,5 "/>\     <polygon id="217" class="fil217" points="19,19 45,5 45,5 "/>\     <polygon id="218" class="fil218" points="19,19 45,5 45,4 "/>\     <polygon id="219" class="fil219" points="19,19 45,4 44,4 "/>\     <polygon id="220" class="fil220" points="19,19 45,4 44,4 "/>\     <polygon id="221" class="fil221" points="19,19 44,4 44,3 "/>\     <polygon id="222" class="fil222" points="19,19 44,3 44,3 "/>\     <polygon id="223" class="fil223" points="19,19 44,3 44,3 "/>\     <polygon id="224" class="fil224" points="19,19 44,3 44,2 "/>\     <polygon id="225" class="fil225" points="19,19 44,2 43,2 "/>\     <polygon id="226" class="fil226" points="19,19 43,2 43,2 "/>\     <polygon id="227" class="fil227" points="19,19 43,2 43,1 "/>\     <polygon id="228" class="fil228" points="19,19 43,1 43,1 "/>\     <polygon id="229" class="fil229" points="19,19 43,1 42,1 "/>\     <polygon id="230" class="fil230" points="19,19 43,1 42,1 "/>\     <polygon id="231" class="fil231" points="19,19 42,1 42,0 "/>\     <polygon id="232" class="fil232" points="19,19 42,0 42,0 "/>\     <polygon id="233" class="fil233" points="19,19 42,0 42,0 "/>\     <polygon id="234" class="fil234" points="19,19 42,0 41,-1 "/>\     <polygon id="235" class="fil235" points="19,19 41,-1 41,-1 "/>\     <polygon id="236" class="fil236" points="19,19 41,-1 41,-1 "/>\     <polygon id="237" class="fil237" points="19,19 41,-1 41,-1 "/>\     <polygon id="238" class="fil238" points="19,19 41,-1 40,-2 "/>\     <polygon id="239" class="fil239" points="19,19 40,-2 40,-2 "/>\     <polygon id="240" class="fil240" points="19,19 40,-2 40,-2 "/>\     <polygon id="241" class="fil241" points="19,19 40,-2 40,-3 "/>\     <polygon id="242" class="fil242" points="19,19 40,-2 39,-3 "/>\     <polygon id="243" class="fil243" points="19,19 39,-3 39,-3 "/>\     <polygon id="244" class="fil244" points="19,19 39,-3 39,-3 "/>\     <polygon id="245" class="fil245" points="19,19 39,-3 39,-4 "/>\     <polygon id="246" class="fil246" points="19,19 39,-3 38,-4 "/>\     <polygon id="247" class="fil247" points="19,19 38,-4 38,-4 "/>\     <polygon id="248" class="fil248" points="19,19 38,-4 38,-4 "/>\     <polygon id="249" class="fil249" points="19,19 38,-4 37,-4 "/>\     <polygon id="250" class="fil250" points="19,19 38,-4 37,-5 "/>\     <polygon id="251" class="fil251" points="19,19 37,-5 37,-5 "/>\     <polygon id="252" class="fil252" points="19,19 37,-5 37,-5 "/>\     <polygon id="253" class="fil253" points="19,19 37,-5 36,-5 "/>\     <polygon id="254" class="fil254" points="19,19 36,-5 36,-6 "/>\     <polygon id="255" class="fil253" points="19,19 36,-6 36,-6 "/>\     <polygon id="256" class="fil252" points="19,19 36,-6 35,-6 "/>\     <polygon id="257" class="fil251" points="19,19 35,-6 35,-6 "/>\     <polygon id="258" class="fil250" points="19,19 35,-6 35,-6 "/>\     <polygon id="259" class="fil249" points="19,19 35,-6 34,-7 "/>\     <polygon id="260" class="fil248" points="19,19 35,-7 34,-7 "/>\     <polygon id="261" class="fil247" points="19,19 34,-7 34,-7 "/>\     <polygon id="262" class="fil246" points="19,19 34,-7 34,-7 "/>\     <polygon id="263" class="fil245" points="19,19 34,-7 33,-7 "/>\     <polygon id="264" class="fil244" points="19,19 33,-7 33,-8 "/>\     <polygon id="265" class="fil243" points="19,19 33,-8 33,-8 "/>\     <polygon id="266" class="fil242" points="19,19 33,-8 32,-8 "/>\     <polygon id="267" class="fil241" points="19,19 32,-8 32,-8 "/>\     <polygon id="268" class="fil240" points="19,19 32,-8 32,-8 "/>\     <polygon id="269" class="fil239" points="19,19 32,-8 31,-8 "/>\     <polygon id="270" class="fil238" points="19,19 31,-8 31,-9 "/>\     <polygon id="271" class="fil237" points="19,19 31,-8 31,-9 "/>\     <polygon id="272" class="fil236" points="19,19 31,-9 30,-9 "/>\     <polygon id="273" class="fil235" points="19,19 30,-9 30,-9 "/>\     <polygon id="274" class="fil234" points="19,19 30,-9 30,-9 "/>\     <polygon id="275" class="fil233" points="19,19 30,-9 29,-9 "/>\     <polygon id="276" class="fil232" points="19,19 29,-9 29,-9 "/>\     <polygon id="277" class="fil231" points="19,19 29,-9 29,-9 "/>\     <polygon id="278" class="fil230" points="19,19 29,-9 28,-10 "/>\     <polygon id="279" class="fil229" points="19,19 28,-10 28,-10 "/>\     <polygon id="280" class="fil228" points="19,19 28,-10 27,-10 "/>\     <polygon id="281" class="fil227" points="19,19 28,-10 27,-10 "/>\     <polygon id="282" class="fil226" points="19,19 27,-10 27,-10 "/>\     <polygon id="283" class="fil225" points="19,19 27,-10 26,-10 "/>\     <polygon id="284" class="fil224" points="19,19 27,-10 26,-10 "/>\     <polygon id="285" class="fil223" points="19,19 26,-10 26,-10 "/>\     <polygon id="286" class="fil222" points="19,19 26,-10 25,-10 "/>\     <polygon id="287" class="fil221" points="19,19 25,-10 25,-11 "/>\     <polygon id="288" class="fil220" points="19,19 25,-10 25,-11 "/>\     <polygon id="289" class="fil219" points="19,19 25,-11 24,-11 "/>\     <polygon id="290" class="fil218" points="19,19 24,-11 24,-11 "/>\     <polygon id="291" class="fil217" points="19,19 24,-11 24,-11 "/>\     <polygon id="292" class="fil216" points="19,19 24,-11 23,-11 "/>\     <polygon id="293" class="fil215" points="19,19 23,-11 23,-11 "/>\     <polygon id="294" class="fil214" points="19,19 23,-11 22,-11 "/>\     <polygon id="295" class="fil213" points="19,19 23,-11 22,-11 "/>\     <polygon id="296" class="fil212" points="19,19 22,-11 22,-11 "/>\     <polygon id="297" class="fil211" points="19,19 22,-11 21,-11 "/>\     <polygon id="298" class="fil210" points="19,19 21,-11 21,-11 "/>\     <polygon id="299" class="fil209" points="19,19 21,-11 21,-11 "/>\     <polygon id="300" class="fil208" points="19,19 21,-11 20,-11 "/>\     <polygon id="301" class="fil207" points="19,19 20,-11 20,-11 "/>\     <polygon id="302" class="fil206" points="19,19 20,-11 20,-11 "/>\     <polygon id="303" class="fil205" points="19,19 20,-11 19,-11 "/>\     <polygon id="304" class="fil204" points="19,19 19,-11 19,-11 "/>\     <polygon id="305" class="fil203" points="19,19 19,-11 18,-11 "/>\     <polygon id="306" class="fil202" points="19,19 19,-11 18,-11 "/>\     <polygon id="307" class="fil201" points="19,19 18,-11 18,-11 "/>\     <polygon id="308" class="fil200" points="19,19 18,-11 17,-11 "/>\     <polygon id="309" class="fil199" points="19,19 17,-11 17,-11 "/>\     <polygon id="310" class="fil198" points="19,19 17,-11 17,-11 "/>\     <polygon id="311" class="fil197" points="19,19 17,-11 16,-11 "/>\     <polygon id="312" class="fil196" points="19,19 16,-11 16,-11 "/>\     <polygon id="313" class="fil195" points="19,19 16,-11 16,-11 "/>\     <polygon id="314" class="fil194" points="19,19 16,-11 15,-11 "/>\     <polygon id="315" class="fil193" points="19,19 15,-11 15,-11 "/>\     <polygon id="316" class="fil192" points="19,19 15,-11 14,-11 "/>\     <polygon id="317" class="fil191" points="19,19 15,-11 14,-11 "/>\     <polygon id="318" class="fil190" points="19,19 14,-11 14,-11 "/>\     <polygon id="319" class="fil189" points="19,19 14,-11 13,-11 "/>\     <polygon id="320" class="fil188" points="19,19 13,-11 13,-11 "/>\     <polygon id="321" class="fil187" points="19,19 13,-11 13,-11 "/>\     <polygon id="322" class="fil186" points="19,19 13,-11 12,-11 "/>\     <polygon id="323" class="fil185" points="19,19 12,-11 12,-10 "/>\     <polygon id="324" class="fil184" points="19,19 12,-10 12,-10 "/>\     <polygon id="325" class="fil183" points="19,19 12,-10 11,-10 "/>\     <polygon id="326" class="fil182" points="19,19 11,-10 11,-10 "/>\     <polygon id="327" class="fil181" points="19,19 11,-10 10,-10 "/>\     <polygon id="328" class="fil180" points="19,19 11,-10 10,-10 "/>\     <polygon id="329" class="fil179" points="19,19 10,-10 10,-10 "/>\     <polygon id="330" class="fil178" points="19,19 10,-10 9,-10 "/>\     <polygon id="331" class="fil177" points="19,19 9,-10 9,-10 "/>\     <polygon id="332" class="fil176" points="19,19 9,-10 9,-10 "/>\     <polygon id="333" class="fil175" points="19,19 9,-10 8,-9 "/>\     <polygon id="334" class="fil174" points="19,19 8,-9 8,-9 "/>\     <polygon id="335" class="fil173" points="19,19 8,-9 8,-9 "/>\     <polygon id="336" class="fil172" points="19,19 8,-9 7,-9 "/>\     <polygon id="337" class="fil171" points="19,19 7,-9 7,-9 "/>\     <polygon id="338" class="fil170" points="19,19 7,-9 7,-9 "/>\     <polygon id="339" class="fil169" points="19,19 7,-9 6,-9 "/>\     <polygon id="340" class="fil168" points="19,19 6,-9 6,-8 "/>\     <polygon id="341" class="fil167" points="19,19 6,-8 6,-8 "/>\     <polygon id="342" class="fil166" points="19,19 6,-8 5,-8 "/>\     <polygon id="343" class="fil165" points="19,19 5,-8 5,-8 "/>\     <polygon id="344" class="fil164" points="19,19 5,-8 5,-8 "/>\     <polygon id="345" class="fil163" points="19,19 5,-8 4,-8 "/>\     <polygon id="346" class="fil162" points="19,19 4,-8 4,-7 "/>\     <polygon id="347" class="fil161" points="19,19 4,-7 4,-7 "/>\     <polygon id="348" class="fil160" points="19,19 4,-7 3,-7 "/>\     <polygon id="349" class="fil159" points="19,19 3,-7 3,-7 "/>\     <polygon id="350" class="fil158" points="19,19 3,-7 3,-7 "/>\     <polygon id="351" class="fil157" points="19,19 3,-7 2,-6 "/>\     <polygon id="352" class="fil156" points="19,19 3,-7 2,-6 "/>\     <polygon id="353" class="fil155" points="19,19 2,-6 2,-6 "/>\     <polygon id="354" class="fil154" points="19,19 2,-6 2,-6 "/>\     <polygon id="355" class="fil153" points="19,19 2,-6 1,-6 "/>\     <polygon id="356" class="fil152" points="19,19 1,-6 1,-5 "/>\     <polygon id="357" class="fil151" points="19,19 1,-5 1,-5 "/>\     <polygon id="358" class="fil150" points="19,19 1,-5 0,-5 "/>\     <polygon id="359" class="fil149" points="19,19 0,-5 0,-5 "/>\     <polygon id="360" class="fil148" points="19,19 0,-5 0,-5 "/>\     <polygon id="361" class="fil147" points="19,19 0,-5 0,-4 "/>\     <polygon id="362" class="fil146" points="19,19 0,-4 -1,-4 "/>\     <polygon id="363" class="fil145" points="19,19 -1,-4 -1,-4 "/>\     <polygon id="364" class="fil144" points="19,19 -1,-4 -1,-4 "/>\     <polygon id="365" class="fil143" points="19,19 -1,-4 -2,-3 "/>\     <polygon id="366" class="fil142" points="19,19 -2,-3 -2,-3 "/>\     <polygon id="367" class="fil141" points="19,19 -2,-3 -2,-3 "/>\     <polygon id="368" class="fil140" points="19,19 -2,-3 -2,-3 "/>\     <polygon id="369" class="fil139" points="19,19 -2,-3 -3,-2 "/>\     <polygon id="370" class="fil138" points="19,19 -3,-2 -3,-2 "/>\     <polygon id="371" class="fil137" points="19,19 -3,-2 -3,-2 "/>\     <polygon id="372" class="fil136" points="19,19 -3,-2 -3,-2 "/>\     <polygon id="373" class="fil135" points="19,19 -3,-2 -4,-1 "/>\     <polygon id="374" class="fil134" points="19,19 -4,-1 -4,-1 "/>\     <polygon id="375" class="fil133" points="19,19 -4,-1 -4,-1 "/>\     <polygon id="376" class="fil132" points="19,19 -4,-1 -4,0 "/>\     <polygon id="377" class="fil131" points="19,19 -4,0 -5,0 "/>\     <polygon id="378" class="fil130" points="19,19 -5,0 -5,0 "/>\     <polygon id="379" class="fil129" points="19,19 -5,0 -5,0 "/>\     <polygon id="380" class="fil128" points="19,19 -5,0 -5,1 "/>\     <polygon id="381" class="fil127" points="19,19 -5,1 -5,1 "/>\     <polygon id="382" class="fil126" points="19,19 -5,1 -6,1 "/>\     <polygon id="383" class="fil125" points="19,19 -6,1 -6,2 "/>\     <polygon id="384" class="fil124" points="19,19 -6,2 -6,2 "/>\     <polygon id="385" class="fil123" points="19,19 -6,2 -6,2 "/>\     <polygon id="386" class="fil122" points="19,19 -6,2 -7,3 "/>\     <polygon id="387" class="fil121" points="19,19 -6,2 -7,3 "/>\     <polygon id="388" class="fil120" points="19,19 -7,3 -7,3 "/>\     <polygon id="389" class="fil119" points="19,19 -7,3 -7,4 "/>\     <polygon id="390" class="fil118" points="19,19 -7,3 -7,4 "/>\     <polygon id="391" class="fil117" points="19,19 -7,4 -7,4 "/>\     <polygon id="392" class="fil116" points="19,19 -7,4 -8,4 "/>\     <polygon id="393" class="fil115" points="19,19 -8,4 -8,5 "/>\     <polygon id="394" class="fil114" points="19,19 -8,5 -8,5 "/>\     <polygon id="395" class="fil113" points="19,19 -8,5 -8,5 "/>\     <polygon id="396" class="fil112" points="19,19 -8,5 -8,6 "/>\     <polygon id="397" class="fil111" points="19,19 -8,6 -8,6 "/>\     <polygon id="398" class="fil110" points="19,19 -8,6 -9,6 "/>\     <polygon id="399" class="fil109" points="19,19 -9,6 -9,7 "/>\     <polygon id="400" class="fil108" points="19,19 -9,7 -9,7 "/>\     <polygon id="401" class="fil107" points="19,19 -9,7 -9,7 "/>\     <polygon id="402" class="fil106" points="19,19 -9,7 -9,8 "/>\     <polygon id="403" class="fil105" points="19,19 -9,8 -9,8 "/>\     <polygon id="404" class="fil104" points="19,19 -9,8 -9,8 "/>\     <polygon id="405" class="fil103" points="19,19 -9,8 -10,9 "/>\     <polygon id="406" class="fil102" points="19,19 -10,9 -10,9 "/>\     <polygon id="407" class="fil101" points="19,19 -10,9 -10,10 "/>\     <polygon id="408" class="fil100" points="19,19 -10,9 -10,10 "/>\     <polygon id="409" class="fil99" points="19,19 -10,10 -10,10 "/>\     <polygon id="410" class="fil98" points="19,19 -10,10 -10,11 "/>\     <polygon id="411" class="fil97" points="19,19 -10,10 -10,11 "/>\     <polygon id="412" class="fil96" points="19,19 -10,11 -10,11 "/>\     <polygon id="413" class="fil95" points="19,19 -10,11 -10,12 "/>\     <polygon id="414" class="fil94" points="19,19 -10,12 -10,12 "/>\     <polygon id="415" class="fil93" points="19,19 -10,12 -11,12 "/>\     <polygon id="416" class="fil92" points="19,19 -11,12 -11,13 "/>\     <polygon id="417" class="fil91" points="19,19 -11,13 -11,13 "/>\     <polygon id="418" class="fil90" points="19,19 -11,13 -11,13 "/>\     <polygon id="419" class="fil89" points="19,19 -11,13 -11,14 "/>\     <polygon id="420" class="fil88" points="19,19 -11,14 -11,14 "/>\     <polygon id="421" class="fil87" points="19,19 -11,14 -11,15 "/>\     <polygon id="422" class="fil86" points="19,19 -11,14 -11,15 "/>\     <polygon id="423" class="fil85" points="19,19 -11,15 -11,15 "/>\     <polygon id="424" class="fil84" points="19,19 -11,15 -11,16 "/>\     <polygon id="425" class="fil83" points="19,19 -11,16 -11,16 "/>\     <polygon id="426" class="fil82" points="19,19 -11,16 -11,16 "/>\     <polygon id="427" class="fil81" points="19,19 -11,16 -11,17 "/>\     <polygon id="428" class="fil80" points="19,19 -11,17 -11,17 "/>\     <polygon id="429" class="fil79" points="19,19 -11,17 -11,17 "/>\     <polygon id="430" class="fil78" points="19,19 -11,17 -11,18 "/>\     <polygon id="431" class="fil77" points="19,19 -11,18 -11,18 "/>\     <polygon id="432" class="fil76" points="19,19 -11,18 -11,19 "/>\     <polygon id="433" class="fil75" points="19,19 -11,18 -11,19 "/>\     <polygon id="434" class="fil74" points="19,19 -11,19 -11,19 "/>\     <polygon id="435" class="fil73" points="19,19 -11,19 -11,20 "/>\     <polygon id="436" class="fil72" points="19,19 -11,20 -11,20 "/>\     <polygon id="437" class="fil71" points="19,19 -11,20 -11,20 "/>\     <polygon id="438" class="fil70" points="19,19 -11,20 -11,21 "/>\     <polygon id="439" class="fil69" points="19,19 -11,21 -11,21 "/>\     <polygon id="440" class="fil68" points="19,19 -11,21 -11,21 "/>\     <polygon id="441" class="fil67" points="19,19 -11,21 -11,22 "/>\     <polygon id="442" class="fil66" points="19,19 -11,22 -11,22 "/>\     <polygon id="443" class="fil65" points="19,19 -11,22 -11,23 "/>\     <polygon id="444" class="fil64" points="19,19 -11,22 -11,23 "/>\     <polygon id="445" class="fil63" points="19,19 -11,23 -11,23 "/>\     <polygon id="446" class="fil62" points="19,19 -11,23 -11,24 "/>\     <polygon id="447" class="fil61" points="19,19 -11,24 -11,24 "/>\     <polygon id="448" class="fil60" points="19,19 -11,24 -11,24 "/>\     <polygon id="449" class="fil59" points="19,19 -11,24 -11,25 "/>\     <polygon id="450" class="fil58" points="19,19 -11,25 -10,25 "/>\     <polygon id="451" class="fil57" points="19,19 -10,25 -10,25 "/>\     <polygon id="452" class="fil56" points="19,19 -10,25 -10,26 "/>\     <polygon id="453" class="fil55" points="19,19 -10,26 -10,26 "/>\     <polygon id="454" class="fil54" points="19,19 -10,26 -10,27 "/>\     <polygon id="455" class="fil53" points="19,19 -10,26 -10,27 "/>\     <polygon id="456" class="fil52" points="19,19 -10,27 -10,27 "/>\     <polygon id="457" class="fil51" points="19,19 -10,27 -10,28 "/>\     <polygon id="458" class="fil50" points="19,19 -10,28 -10,28 "/>\     <polygon id="459" class="fil49" points="19,19 -10,28 -10,28 "/>\     <polygon id="460" class="fil48" points="19,19 -10,28 -9,29 "/>\     <polygon id="461" class="fil47" points="19,19 -9,29 -9,29 "/>\     <polygon id="462" class="fil46" points="19,19 -9,29 -9,29 "/>\     <polygon id="463" class="fil45" points="19,19 -9,29 -9,30 "/>\     <polygon id="464" class="fil44" points="19,19 -9,30 -9,30 "/>\     <polygon id="465" class="fil43" points="19,19 -9,30 -9,30 "/>\     <polygon id="466" class="fil42" points="19,19 -9,30 -9,31 "/>\     <polygon id="467" class="fil41" points="19,19 -9,31 -8,31 "/>\     <polygon id="468" class="fil40" points="19,19 -9,31 -8,31 "/>\     <polygon id="469" class="fil39" points="19,19 -8,31 -8,32 "/>\     <polygon id="470" class="fil38" points="19,19 -8,32 -8,32 "/>\     <polygon id="471" class="fil37" points="19,19 -8,32 -8,32 "/>\     <polygon id="472" class="fil36" points="19,19 -8,32 -8,33 "/>\     <polygon id="473" class="fil35" points="19,19 -8,33 -7,33 "/>\     <polygon id="474" class="fil34" points="19,19 -8,33 -7,33 "/>\     <polygon id="475" class="fil33" points="19,19 -7,33 -7,34 "/>\     <polygon id="476" class="fil32" points="19,19 -7,34 -7,34 "/>\     <polygon id="477" class="fil31" points="19,19 -7,34 -7,34 "/>\     <polygon id="478" class="fil30" points="19,19 -7,34 -7,35 "/>\     <polygon id="479" class="fil29" points="19,19 -7,34 -6,35 "/>\     <polygon id="480" class="fil28" points="19,19 -6,35 -6,35 "/>\     <polygon id="481" class="fil27" points="19,19 -6,35 -6,35 "/>\     <polygon id="482" class="fil26" points="19,19 -6,35 -6,36 "/>\     <polygon id="483" class="fil25" points="19,19 -6,36 -6,36 "/>\     <polygon id="484" class="fil24" points="19,19 -6,36 -5,36 "/>\     <polygon id="485" class="fil23" points="19,19 -5,36 -5,37 "/>\     <polygon id="486" class="fil22" points="19,19 -5,37 -5,37 "/>\     <polygon id="487" class="fil21" points="19,19 -5,37 -5,37 "/>\     <polygon id="488" class="fil20" points="19,19 -5,37 -4,38 "/>\     <polygon id="489" class="fil19" points="19,19 -4,37 -4,38 "/>\     <polygon id="490" class="fil18" points="19,19 -4,38 -4,38 "/>\     <polygon id="491" class="fil17" points="19,19 -4,38 -4,38 "/>\     <polygon id="492" class="fil16" points="19,19 -4,38 -3,39 "/>\     <polygon id="493" class="fil15" points="19,19 -4,39 -3,39 "/>\     <polygon id="494" class="fil14" points="19,19 -3,39 -3,39 "/>\     <polygon id="495" class="fil13" points="19,19 -3,39 -3,39 "/>\     <polygon id="496" class="fil12" points="19,19 -3,39 -2,40 "/>\     <polygon id="497" class="fil11" points="19,19 -2,40 -2,40 "/>\     <polygon id="498" class="fil10" points="19,19 -2,40 -2,40 "/>\     <polygon id="499" class="fil9" points="19,19 -2,40 -2,40 "/>\     <polygon id="500" class="fil8" points="19,19 -2,40 -1,41 "/>\     <polygon id="501" class="fil7" points="19,19 -1,41 -1,41 "/>\     <polygon id="502" class="fil6" points="19,19 -1,41 -1,41 "/>\     <polygon id="503" class="fil5" points="19,19 -1,41 -1,41 "/>\     <polygon id="504" class="fil4" points="19,19 -1,41 0,42 "/>\     <polygon id="505" class="fil3" points="19,19 0,42 0,42 "/>\     <polygon id="506" class="fil2" points="19,19 0,42 0,42 "/>\     <polygon id="507" class="fil1" points="19,19 0,42 1,42 "/>\     <polygon id="508" class="fil0" points="19,19 1,42 1,43 "/>\     <polygon id="509" class="fil255" points="19,19 1,43 1,43 "/>\    </g>\   </g>\   <g>\    <g style="clip-path:url(#id1)">\     <polygon class="fil256" points="19,19 19,43 19,43 "/>\     <polygon id="1" class="fil257" points="19,19 19,43 19,43 "/>\     <polygon id="2" class="fil257" points="19,19 19,43 20,43 "/>\     <polygon id="3" class="fil257" points="19,19 20,43 20,43 "/>\     <polygon id="4" class="fil257" points="19,19 20,43 20,43 "/>\     <polygon id="5" class="fil258" points="19,19 20,43 21,43 "/>\     <polygon id="6" class="fil258" points="19,19 21,43 21,43 "/>\     <polygon id="7" class="fil258" points="19,19 21,43 21,43 "/>\     <polygon id="8" class="fil258" points="19,19 21,43 22,43 "/>\     <polygon id="9" class="fil259" points="19,19 21,43 22,43 "/>\     <polygon id="10" class="fil259" points="19,19 22,43 22,43 "/>\     <polygon id="11" class="fil259" points="19,19 22,43 22,43 "/>\     <polygon id="12" class="fil259" points="19,19 22,43 23,43 "/>\     <polygon id="13" class="fil260" points="19,19 23,43 23,43 "/>\     <polygon id="14" class="fil260" points="19,19 23,43 23,43 "/>\     <polygon id="15" class="fil260" points="19,19 23,43 24,43 "/>\     <polygon id="16" class="fil260" points="19,19 24,43 24,42 "/>\     <polygon id="17" class="fil261" points="19,19 24,42 24,42 "/>\     <polygon id="18" class="fil261" points="19,19 24,42 24,42 "/>\     <polygon id="19" class="fil261" points="19,19 24,42 25,42 "/>\     <polygon id="20" class="fil261" points="19,19 25,42 25,42 "/>\     <polygon id="21" class="fil262" points="19,19 25,42 25,42 "/>\     <polygon id="22" class="fil262" points="19,19 25,42 26,42 "/>\     <polygon id="23" class="fil262" points="19,19 26,42 26,42 "/>\     <polygon id="24" class="fil262" points="19,19 26,42 26,42 "/>\     <polygon id="25" class="fil263" points="19,19 26,42 27,42 "/>\     <polygon id="26" class="fil263" points="19,19 26,42 27,42 "/>\     <polygon id="27" class="fil263" points="19,19 27,42 27,42 "/>\     <polygon id="28" class="fil263" points="19,19 27,42 27,41 "/>\     <polygon id="29" class="fil264" points="19,19 27,41 28,41 "/>\     <polygon id="30" class="fil264" points="19,19 28,41 28,41 "/>\     <polygon id="31" class="fil264" points="19,19 28,41 28,41 "/>\     <polygon id="32" class="fil264" points="19,19 28,41 28,41 "/>\     <polygon id="33" class="fil265" points="19,19 28,41 29,41 "/>\     <polygon id="34" class="fil265" points="19,19 29,41 29,41 "/>\     <polygon id="35" class="fil265" points="19,19 29,41 29,41 "/>\     <polygon id="36" class="fil265" points="19,19 29,41 30,40 "/>\     <polygon id="37" class="fil266" points="19,19 29,40 30,40 "/>\     <polygon id="38" class="fil266" points="19,19 30,40 30,40 "/>\     <polygon id="39" class="fil266" points="19,19 30,40 30,40 "/>\     <polygon id="40" class="fil266" points="19,19 30,40 31,40 "/>\     <polygon id="41" class="fil267" points="19,19 31,40 31,40 "/>\     <polygon id="42" class="fil267" points="19,19 31,40 31,40 "/>\     <polygon id="43" class="fil267" points="19,19 31,40 31,39 "/>\     <polygon id="44" class="fil267" points="19,19 31,39 32,39 "/>\     <polygon id="45" class="fil268" points="19,19 32,39 32,39 "/>\     <polygon id="46" class="fil268" points="19,19 32,39 32,39 "/>\     <polygon id="47" class="fil268" points="19,19 32,39 32,39 "/>\     <polygon id="48" class="fil268" points="19,19 32,39 33,39 "/>\     <polygon id="49" class="fil269" points="19,19 33,39 33,38 "/>\     <polygon id="50" class="fil269" points="19,19 33,38 33,38 "/>\     <polygon id="51" class="fil269" points="19,19 33,38 33,38 "/>\     <polygon id="52" class="fil269" points="19,19 33,38 34,38 "/>\     <polygon id="53" class="fil270" points="19,19 34,38 34,38 "/>\     <polygon id="54" class="fil270" points="19,19 34,38 34,37 "/>\     <polygon id="55" class="fil270" points="19,19 34,38 34,37 "/>\     <polygon id="56" class="fil270" points="19,19 34,37 35,37 "/>\     <polygon id="57" class="fil270" points="19,19 34,37 35,37 "/>\     <polygon id="58" class="fil270" points="19,19 35,37 35,37 "/>\     <polygon id="59" class="fil271" points="19,19 35,37 35,37 "/>\     <polygon id="60" class="fil271" points="19,19 35,37 35,36 "/>\     <polygon id="61" class="fil271" points="19,19 35,36 36,36 "/>\     <polygon id="62" class="fil271" points="19,19 36,36 36,36 "/>\     <polygon id="63" class="fil271" points="19,19 36,36 36,36 "/>\     <polygon id="64" class="fil271" points="19,19 36,36 36,35 "/>\     <polygon id="65" class="fil272" points="19,19 36,36 37,35 "/>\     <polygon id="66" class="fil272" points="19,19 36,35 37,35 "/>\     <polygon id="67" class="fil272" points="19,19 37,35 37,35 "/>\     <polygon id="68" class="fil272" points="19,19 37,35 37,35 "/>\     <polygon id="69" class="fil272" points="19,19 37,35 37,34 "/>\     <polygon id="70" class="fil272" points="19,19 37,34 37,34 "/>\     <polygon id="71" class="fil273" points="19,19 37,34 38,34 "/>\     <polygon id="72" class="fil273" points="19,19 38,34 38,34 "/>\     <polygon id="73" class="fil273" points="19,19 38,34 38,33 "/>\     <polygon id="74" class="fil273" points="19,19 38,33 38,33 "/>\     <polygon id="75" class="fil273" points="19,19 38,33 38,33 "/>\     <polygon id="76" class="fil273" points="19,19 38,33 39,33 "/>\     <polygon id="77" class="fil274" points="19,19 39,33 39,32 "/>\     <polygon id="78" class="fil274" points="19,19 39,32 39,32 "/>\     <polygon id="79" class="fil274" points="19,19 39,32 39,32 "/>\     <polygon id="80" class="fil274" points="19,19 39,32 39,32 "/>\     <polygon id="81" class="fil274" points="19,19 39,32 39,31 "/>\     <polygon id="82" class="fil274" points="19,19 39,31 40,31 "/>\     <polygon id="83" class="fil275" points="19,19 40,31 40,31 "/>\     <polygon id="84" class="fil275" points="19,19 40,31 40,31 "/>\     <polygon id="85" class="fil275" points="19,19 40,31 40,30 "/>\     <polygon id="86" class="fil275" points="19,19 40,30 40,30 "/>\     <polygon id="87" class="fil275" points="19,19 40,30 40,30 "/>\     <polygon id="88" class="fil275" points="19,19 40,30 40,30 "/>\     <polygon id="89" class="fil276" points="19,19 40,30 41,29 "/>\     <polygon id="90" class="fil276" points="19,19 41,29 41,29 "/>\     <polygon id="91" class="fil276" points="19,19 41,29 41,29 "/>\     <polygon id="92" class="fil276" points="19,19 41,29 41,28 "/>\     <polygon id="93" class="fil276" points="19,19 41,29 41,28 "/>\     <polygon id="94" class="fil276" points="19,19 41,28 41,28 "/>\     <polygon id="95" class="fil277" points="19,19 41,28 41,28 "/>\     <polygon id="96" class="fil277" points="19,19 41,28 41,27 "/>\     <polygon id="97" class="fil277" points="19,19 41,27 42,27 "/>\     <polygon id="98" class="fil277" points="19,19 41,27 42,27 "/>\     <polygon id="99" class="fil277" points="19,19 42,27 42,27 "/>\     <polygon id="100" class="fil277" points="19,19 42,27 42,26 "/>\     <polygon id="101" class="fil278" points="19,19 42,26 42,26 "/>\     <polygon id="102" class="fil278" points="19,19 42,26 42,26 "/>\     <polygon id="103" class="fil278" points="19,19 42,26 42,25 "/>\     <polygon id="104" class="fil278" points="19,19 42,25 42,25 "/>\     <polygon id="105" class="fil278" points="19,19 42,25 42,25 "/>\     <polygon id="106" class="fil279" points="19,19 42,25 42,24 "/>\     <polygon id="107" class="fil279" points="19,19 42,25 42,24 "/>\     <polygon id="108" class="fil279" points="19,19 42,24 42,24 "/>\     <polygon id="109" class="fil279" points="19,19 42,24 43,24 "/>\     <polygon id="110" class="fil279" points="19,19 43,24 43,23 "/>\     <polygon id="111" class="fil279" points="19,19 43,23 43,23 "/>\     <polygon id="112" class="fil280" points="19,19 43,23 43,23 "/>\     <polygon id="113" class="fil280" points="19,19 43,23 43,22 "/>\     <polygon id="114" class="fil280" points="19,19 43,22 43,22 "/>\     <polygon id="115" class="fil280" points="19,19 43,22 43,22 "/>\     <polygon id="116" class="fil280" points="19,19 43,22 43,22 "/>\     <polygon id="117" class="fil280" points="19,19 43,22 43,21 "/>\     <polygon id="118" class="fil281" points="19,19 43,21 43,21 "/>\     <polygon id="119" class="fil281" points="19,19 43,21 43,21 "/>\     <polygon id="120" class="fil281" points="19,19 43,21 43,20 "/>\     <polygon id="121" class="fil281" points="19,19 43,20 43,20 "/>\     <polygon id="122" class="fil281" points="19,19 43,20 43,20 "/>\     <polygon id="123" class="fil281" points="19,19 43,20 43,19 "/>\     <polygon id="124" class="fil282" points="19,19 43,19 43,19 "/>\     <polygon id="125" class="fil282" points="19,19 43,19 43,19 "/>\     <polygon id="126" class="fil282" points="19,19 43,19 43,19 "/>\     <polygon id="127" class="fil282" points="19,19 43,19 43,18 "/>\     <polygon id="128" class="fil282" points="19,19 43,18 43,18 "/>\     <polygon id="129" class="fil281" points="19,19 43,18 43,18 "/>\     <polygon id="130" class="fil281" points="19,19 43,18 43,17 "/>\     <polygon id="131" class="fil281" points="19,19 43,17 43,17 "/>\     <polygon id="132" class="fil281" points="19,19 43,17 43,17 "/>\     <polygon id="133" class="fil280" points="19,19 43,17 43,16 "/>\     <polygon id="134" class="fil280" points="19,19 43,16 43,16 "/>\     <polygon id="135" class="fil280" points="19,19 43,16 43,16 "/>\     <polygon id="136" class="fil280" points="19,19 43,16 43,16 "/>\     <polygon id="137" class="fil279" points="19,19 43,16 43,15 "/>\     <polygon id="138" class="fil279" points="19,19 43,15 43,15 "/>\     <polygon id="139" class="fil279" points="19,19 43,15 43,15 "/>\     <polygon id="140" class="fil279" points="19,19 43,15 43,14 "/>\     <polygon id="141" class="fil278" points="19,19 43,14 43,14 "/>\     <polygon id="142" class="fil278" points="19,19 43,14 43,14 "/>\     <polygon id="143" class="fil278" points="19,19 43,14 42,13 "/>\     <polygon id="144" class="fil278" points="19,19 43,14 42,13 "/>\     <polygon id="145" class="fil277" points="19,19 42,13 42,13 "/>\     <polygon id="146" class="fil277" points="19,19 42,13 42,13 "/>\     <polygon id="147" class="fil277" points="19,19 42,13 42,12 "/>\     <polygon id="148" class="fil277" points="19,19 42,12 42,12 "/>\     <polygon id="149" class="fil276" points="19,19 42,12 42,12 "/>\     <polygon id="150" class="fil276" points="19,19 42,12 42,11 "/>\     <polygon id="151" class="fil276" points="19,19 42,11 42,11 "/>\     <polygon id="152" class="fil275" points="19,19 42,11 42,11 "/>\     <polygon id="153" class="fil275" points="19,19 42,11 42,11 "/>\     <polygon id="154" class="fil275" points="19,19 42,11 42,10 "/>\     <polygon id="155" class="fil275" points="19,19 42,10 41,10 "/>\     <polygon id="156" class="fil274" points="19,19 41,10 41,10 "/>\     <polygon id="157" class="fil274" points="19,19 41,10 41,9 "/>\     <polygon id="158" class="fil274" points="19,19 41,9 41,9 "/>\     <polygon id="159" class="fil274" points="19,19 41,9 41,9 "/>\     <polygon id="160" class="fil273" points="19,19 41,9 41,9 "/>\     <polygon id="161" class="fil273" points="19,19 41,9 41,8 "/>\     <polygon id="162" class="fil273" points="19,19 41,8 41,8 "/>\     <polygon id="163" class="fil273" points="19,19 41,8 41,8 "/>\     <polygon id="164" class="fil272" points="19,19 41,8 40,7 "/>\     <polygon id="165" class="fil272" points="19,19 40,8 40,7 "/>\     <polygon id="166" class="fil272" points="19,19 40,7 40,7 "/>\     <polygon id="167" class="fil272" points="19,19 40,7 40,7 "/>\     <polygon id="168" class="fil271" points="19,19 40,7 40,6 "/>\     <polygon id="169" class="fil271" points="19,19 40,6 40,6 "/>\     <polygon id="170" class="fil271" points="19,19 40,6 39,6 "/>\     <polygon id="171" class="fil271" points="19,19 40,6 39,6 "/>\     <polygon id="172" class="fil270" points="19,19 39,6 39,5 "/>\     <polygon id="173" class="fil270" points="19,19 39,5 39,5 "/>\     <polygon id="174" class="fil270" points="19,19 39,5 39,5 "/>\     <polygon id="175" class="fil270" points="19,19 39,5 39,5 "/>\     <polygon id="176" class="fil269" points="19,19 39,5 39,4 "/>\     <polygon id="177" class="fil269" points="19,19 39,4 38,4 "/>\     <polygon id="178" class="fil269" points="19,19 38,4 38,4 "/>\     <polygon id="179" class="fil269" points="19,19 38,4 38,4 "/>\     <polygon id="180" class="fil269" points="19,19 38,4 38,3 "/>\     <polygon id="181" class="fil268" points="19,19 38,3 38,3 "/>\     <polygon id="182" class="fil268" points="19,19 38,3 37,3 "/>\     <polygon id="183" class="fil268" points="19,19 37,3 37,3 "/>\     <polygon id="184" class="fil268" points="19,19 37,3 37,3 "/>\     <polygon id="185" class="fil268" points="19,19 37,3 37,2 "/>\     <polygon id="186" class="fil268" points="19,19 37,2 37,2 "/>\     <polygon id="187" class="fil267" points="19,19 37,2 36,2 "/>\     <polygon id="188" class="fil267" points="19,19 36,2 36,2 "/>\     <polygon id="189" class="fil267" points="19,19 36,2 36,1 "/>\     <polygon id="190" class="fil267" points="19,19 36,1 36,1 "/>\     <polygon id="191" class="fil267" points="19,19 36,1 36,1 "/>\     <polygon id="192" class="fil267" points="19,19 36,1 35,1 "/>\     <polygon id="193" class="fil266" points="19,19 35,1 35,1 "/>\     <polygon id="194" class="fil266" points="19,19 35,1 35,0 "/>\     <polygon id="195" class="fil266" points="19,19 35,0 35,0 "/>\     <polygon id="196" class="fil266" points="19,19 35,0 34,0 "/>\     <polygon id="197" class="fil266" points="19,19 34,0 34,0 "/>\     <polygon id="198" class="fil266" points="19,19 34,0 34,0 "/>\     <polygon id="199" class="fil265" points="19,19 34,0 34,-1 "/>\     <polygon id="200" class="fil265" points="19,19 34,-1 34,-1 "/>\     <polygon id="201" class="fil265" points="19,19 34,-1 33,-1 "/>\     <polygon id="202" class="fil265" points="19,19 33,-1 33,-1 "/>\     <polygon id="203" class="fil265" points="19,19 33,-1 33,-1 "/>\     <polygon id="204" class="fil264" points="19,19 33,-1 33,-1 "/>\     <polygon id="205" class="fil264" points="19,19 33,-1 32,-2 "/>\     <polygon id="206" class="fil264" points="19,19 32,-2 32,-2 "/>\     <polygon id="207" class="fil264" points="19,19 32,-2 32,-2 "/>\     <polygon id="208" class="fil264" points="19,19 32,-2 32,-2 "/>\     <polygon id="209" class="fil264" points="19,19 32,-2 31,-2 "/>\     <polygon id="210" class="fil263" points="19,19 31,-2 31,-2 "/>\     <polygon id="211" class="fil263" points="19,19 31,-2 31,-3 "/>\     <polygon id="212" class="fil263" points="19,19 31,-3 30,-3 "/>\     <polygon id="213" class="fil263" points="19,19 31,-3 30,-3 "/>\     <polygon id="214" class="fil263" points="19,19 30,-3 30,-3 "/>\     <polygon id="215" class="fil263" points="19,19 30,-3 30,-3 "/>\     <polygon id="216" class="fil262" points="19,19 30,-3 29,-3 "/>\     <polygon id="217" class="fil262" points="19,19 29,-3 29,-3 "/>\     <polygon id="218" class="fil262" points="19,19 29,-3 29,-4 "/>\     <polygon id="219" class="fil262" points="19,19 29,-4 29,-4 "/>\     <polygon id="220" class="fil262" points="19,19 29,-4 28,-4 "/>\     <polygon id="221" class="fil262" points="19,19 28,-4 28,-4 "/>\     <polygon id="222" class="fil261" points="19,19 28,-4 28,-4 "/>\     <polygon id="223" class="fil261" points="19,19 28,-4 27,-4 "/>\     <polygon id="224" class="fil261" points="19,19 28,-4 27,-4 "/>\     <polygon id="225" class="fil261" points="19,19 27,-4 27,-4 "/>\     <polygon id="226" class="fil261" points="19,19 27,-4 27,-4 "/>\     <polygon id="227" class="fil261" points="19,19 27,-4 26,-5 "/>\     <polygon id="228" class="fil260" points="19,19 26,-5 26,-5 "/>\     <polygon id="229" class="fil260" points="19,19 26,-5 26,-5 "/>\     <polygon id="230" class="fil260" points="19,19 26,-5 25,-5 "/>\     <polygon id="231" class="fil260" points="19,19 26,-5 25,-5 "/>\     <polygon id="232" class="fil260" points="19,19 25,-5 25,-5 "/>\     <polygon id="233" class="fil260" points="19,19 25,-5 25,-5 "/>\     <polygon id="234" class="fil259" points="19,19 25,-5 24,-5 "/>\     <polygon id="235" class="fil259" points="19,19 24,-5 24,-5 "/>\     <polygon id="236" class="fil259" points="19,19 24,-5 24,-5 "/>\     <polygon id="237" class="fil259" points="19,19 24,-5 23,-5 "/>\     <polygon id="238" class="fil259" points="19,19 24,-5 23,-5 "/>\     <polygon id="239" class="fil259" points="19,19 23,-5 23,-5 "/>\     <polygon id="240" class="fil258" points="19,19 23,-5 23,-6 "/>\     <polygon id="241" class="fil258" points="19,19 23,-6 22,-6 "/>\     <polygon id="242" class="fil258" points="19,19 22,-6 22,-6 "/>\     <polygon id="243" class="fil258" points="19,19 22,-6 22,-6 "/>\     <polygon id="244" class="fil258" points="19,19 22,-6 21,-6 "/>\     <polygon id="245" class="fil258" points="19,19 21,-6 21,-6 "/>\     <polygon id="246" class="fil257" points="19,19 21,-6 21,-6 "/>\     <polygon id="247" class="fil257" points="19,19 21,-6 20,-6 "/>\     <polygon id="248" class="fil257" points="19,19 21,-6 20,-6 "/>\     <polygon id="249" class="fil257" points="19,19 20,-6 20,-6 "/>\     <polygon id="250" class="fil257" points="19,19 20,-6 20,-6 "/>\     <polygon id="251" class="fil257" points="19,19 20,-6 19,-6 "/>\     <polygon id="252" class="fil256" points="19,19 19,-6 19,-6 "/>\     <polygon id="253" class="fil256" points="19,19 19,-6 19,-6 "/>\     <polygon id="254" class="fil283" points="19,19 19,-6 18,-6 "/>\     <polygon id="255" class="fil256" points="19,19 18,-6 18,-6 "/>\     <polygon id="256" class="fil256" points="19,19 18,-6 18,-6 "/>\     <polygon id="257" class="fil257" points="19,19 18,-6 17,-6 "/>\     <polygon id="258" class="fil257" points="19,19 18,-6 17,-6 "/>\     <polygon id="259" class="fil257" points="19,19 17,-6 17,-6 "/>\     <polygon id="260" class="fil257" points="19,19 17,-6 17,-6 "/>\     <polygon id="261" class="fil257" points="19,19 17,-6 16,-6 "/>\     <polygon id="262" class="fil257" points="19,19 16,-6 16,-6 "/>\     <polygon id="263" class="fil258" points="19,19 16,-6 16,-6 "/>\     <polygon id="264" class="fil258" points="19,19 16,-6 15,-6 "/>\     <polygon id="265" class="fil258" points="19,19 15,-6 15,-6 "/>\     <polygon id="266" class="fil258" points="19,19 15,-6 15,-6 "/>\     <polygon id="267" class="fil258" points="19,19 15,-6 14,-6 "/>\     <polygon id="268" class="fil258" points="19,19 15,-6 14,-5 "/>\     <polygon id="269" class="fil259" points="19,19 14,-5 14,-5 "/>\     <polygon id="270" class="fil259" points="19,19 14,-5 14,-5 "/>\     <polygon id="271" class="fil259" points="19,19 14,-5 13,-5 "/>\     <polygon id="272" class="fil259" points="19,19 13,-5 13,-5 "/>\     <polygon id="273" class="fil259" points="19,19 13,-5 13,-5 "/>\     <polygon id="274" class="fil259" points="19,19 13,-5 12,-5 "/>\     <polygon id="275" class="fil260" points="19,19 12,-5 12,-5 "/>\     <polygon id="276" class="fil260" points="19,19 12,-5 12,-5 "/>\     <polygon id="277" class="fil260" points="19,19 12,-5 12,-5 "/>\     <polygon id="278" class="fil260" points="19,19 12,-5 11,-5 "/>\     <polygon id="279" class="fil260" points="19,19 11,-5 11,-5 "/>\     <polygon id="280" class="fil260" points="19,19 11,-5 11,-5 "/>\     <polygon id="281" class="fil261" points="19,19 11,-5 10,-4 "/>\     <polygon id="282" class="fil261" points="19,19 10,-4 10,-4 "/>\     <polygon id="283" class="fil261" points="19,19 10,-4 10,-4 "/>\     <polygon id="284" class="fil261" points="19,19 10,-4 10,-4 "/>\     <polygon id="285" class="fil261" points="19,19 10,-4 9,-4 "/>\     <polygon id="286" class="fil261" points="19,19 9,-4 9,-4 "/>\     <polygon id="287" class="fil262" points="19,19 9,-4 9,-4 "/>\     <polygon id="288" class="fil262" points="19,19 9,-4 8,-4 "/>\     <polygon id="289" class="fil262" points="19,19 9,-4 8,-4 "/>\     <polygon id="290" class="fil262" points="19,19 8,-4 8,-3 "/>\     <polygon id="291" class="fil262" points="19,19 8,-3 8,-3 "/>\     <polygon id="292" class="fil262" points="19,19 8,-3 7,-3 "/>\     <polygon id="293" class="fil263" points="19,19 7,-3 7,-3 "/>\     <polygon id="294" class="fil263" points="19,19 7,-3 7,-3 "/>\     <polygon id="295" class="fil263" points="19,19 7,-3 7,-3 "/>\     <polygon id="296" class="fil263" points="19,19 7,-3 6,-3 "/>\     <polygon id="297" class="fil263" points="19,19 6,-3 6,-2 "/>\     <polygon id="298" class="fil263" points="19,19 6,-2 6,-2 "/>\     <polygon id="299" class="fil264" points="19,19 6,-2 6,-2 "/>\     <polygon id="300" class="fil264" points="19,19 6,-2 5,-2 "/>\     <polygon id="301" class="fil264" points="19,19 5,-2 5,-2 "/>\     <polygon id="302" class="fil264" points="19,19 5,-2 5,-2 "/>\     <polygon id="303" class="fil264" points="19,19 5,-2 5,-1 "/>\     <polygon id="304" class="fil264" points="19,19 5,-1 4,-1 "/>\     <polygon id="305" class="fil265" points="19,19 4,-1 4,-1 "/>\     <polygon id="306" class="fil265" points="19,19 4,-1 4,-1 "/>\     <polygon id="307" class="fil265" points="19,19 4,-1 4,-1 "/>\     <polygon id="308" class="fil265" points="19,19 4,-1 3,-1 "/>\     <polygon id="309" class="fil265" points="19,19 3,-1 3,0 "/>\     <polygon id="310" class="fil266" points="19,19 3,0 3,0 "/>\     <polygon id="311" class="fil266" points="19,19 3,0 3,0 "/>\     <polygon id="312" class="fil266" points="19,19 3,0 2,0 "/>\     <polygon id="313" class="fil266" points="19,19 2,0 2,0 "/>\     <polygon id="314" class="fil266" points="19,19 2,0 2,1 "/>\     <polygon id="315" class="fil266" points="19,19 2,1 2,1 "/>\     <polygon id="316" class="fil267" points="19,19 2,1 2,1 "/>\     <polygon id="317" class="fil267" points="19,19 2,1 1,1 "/>\     <polygon id="318" class="fil267" points="19,19 1,1 1,2 "/>\     <polygon id="319" class="fil267" points="19,19 1,1 1,2 "/>\     <polygon id="320" class="fil267" points="19,19 1,2 1,2 "/>\     <polygon id="321" class="fil267" points="19,19 1,2 0,2 "/>\     <polygon id="322" class="fil268" points="19,19 1,2 0,2 "/>\     <polygon id="323" class="fil268" points="19,19 0,2 0,3 "/>\     <polygon id="324" class="fil268" points="19,19 0,3 0,3 "/>\     <polygon id="325" class="fil268" points="19,19 0,3 0,3 "/>\     <polygon id="326" class="fil268" points="19,19 0,3 -1,3 "/>\     <polygon id="327" class="fil268" points="19,19 0,3 -1,4 "/>\     <polygon id="328" class="fil269" points="19,19 -1,3 -1,4 "/>\     <polygon id="329" class="fil269" points="19,19 -1,4 -1,4 "/>\     <polygon id="330" class="fil269" points="19,19 -1,4 -1,4 "/>\     <polygon id="331" class="fil269" points="19,19 -1,4 -1,5 "/>\     <polygon id="332" class="fil269" points="19,19 -1,4 -2,5 "/>\     <polygon id="333" class="fil270" points="19,19 -2,5 -2,5 "/>\     <polygon id="334" class="fil270" points="19,19 -2,5 -2,5 "/>\     <polygon id="335" class="fil270" points="19,19 -2,5 -2,6 "/>\     <polygon id="336" class="fil270" points="19,19 -2,5 -2,6 "/>\     <polygon id="337" class="fil271" points="19,19 -2,6 -2,6 "/>\     <polygon id="338" class="fil271" points="19,19 -2,6 -3,6 "/>\     <polygon id="339" class="fil271" points="19,19 -3,6 -3,7 "/>\     <polygon id="340" class="fil271" points="19,19 -3,6 -3,7 "/>\     <polygon id="341" class="fil272" points="19,19 -3,7 -3,7 "/>\     <polygon id="342" class="fil272" points="19,19 -3,7 -3,7 "/>\     <polygon id="343" class="fil272" points="19,19 -3,7 -3,8 "/>\     <polygon id="344" class="fil272" points="19,19 -3,8 -3,8 "/>\     <polygon id="345" class="fil273" points="19,19 -3,8 -4,8 "/>\     <polygon id="346" class="fil273" points="19,19 -3,8 -4,8 "/>\     <polygon id="347" class="fil273" points="19,19 -4,8 -4,9 "/>\     <polygon id="348" class="fil273" points="19,19 -4,9 -4,9 "/>\     <polygon id="349" class="fil274" points="19,19 -4,9 -4,9 "/>\     <polygon id="350" class="fil274" points="19,19 -4,9 -4,10 "/>\     <polygon id="351" class="fil274" points="19,19 -4,9 -4,10 "/>\     <polygon id="352" class="fil274" points="19,19 -4,10 -4,10 "/>\     <polygon id="353" class="fil275" points="19,19 -4,10 -4,10 "/>\     <polygon id="354" class="fil275" points="19,19 -4,10 -5,11 "/>\     <polygon id="355" class="fil275" points="19,19 -5,11 -5,11 "/>\     <polygon id="356" class="fil275" points="19,19 -5,11 -5,11 "/>\     <polygon id="357" class="fil276" points="19,19 -5,11 -5,12 "/>\     <polygon id="358" class="fil276" points="19,19 -5,11 -5,12 "/>\     <polygon id="359" class="fil276" points="19,19 -5,12 -5,12 "/>\     <polygon id="360" class="fil277" points="19,19 -5,12 -5,12 "/>\     <polygon id="361" class="fil277" points="19,19 -5,12 -5,13 "/>\     <polygon id="362" class="fil277" points="19,19 -5,13 -5,13 "/>\     <polygon id="363" class="fil277" points="19,19 -5,13 -5,13 "/>\     <polygon id="364" class="fil278" points="19,19 -5,13 -5,14 "/>\     <polygon id="365" class="fil278" points="19,19 -5,14 -5,14 "/>\     <polygon id="366" class="fil278" points="19,19 -5,14 -5,14 "/>\     <polygon id="367" class="fil278" points="19,19 -5,14 -6,14 "/>\     <polygon id="368" class="fil279" points="19,19 -5,14 -6,15 "/>\     <polygon id="369" class="fil279" points="19,19 -6,15 -6,15 "/>\     <polygon id="370" class="fil279" points="19,19 -6,15 -6,15 "/>\     <polygon id="371" class="fil279" points="19,19 -6,15 -6,16 "/>\     <polygon id="372" class="fil280" points="19,19 -6,16 -6,16 "/>\     <polygon id="373" class="fil280" points="19,19 -6,16 -6,16 "/>\     <polygon id="374" class="fil280" points="19,19 -6,16 -6,17 "/>\     <polygon id="375" class="fil280" points="19,19 -6,16 -6,17 "/>\     <polygon id="376" class="fil281" points="19,19 -6,17 -6,17 "/>\     <polygon id="377" class="fil281" points="19,19 -6,17 -6,17 "/>\     <polygon id="378" class="fil281" points="19,19 -6,17 -6,18 "/>\     <polygon id="379" class="fil281" points="19,19 -6,18 -6,18 "/>\     <polygon id="380" class="fil282" points="19,19 -6,18 -6,18 "/>\     <polygon id="381" class="fil282" points="19,19 -6,18 -6,19 "/>\     <polygon id="382" class="fil282" points="19,19 -6,19 -6,19 "/>\     <polygon id="383" class="fil282" points="19,19 -6,19 -6,19 "/>\     <polygon id="384" class="fil282" points="19,19 -6,19 -6,20 "/>\     <polygon id="385" class="fil281" points="19,19 -6,19 -6,20 "/>\     <polygon id="386" class="fil281" points="19,19 -6,20 -6,20 "/>\     <polygon id="387" class="fil281" points="19,19 -6,20 -6,20 "/>\     <polygon id="388" class="fil281" points="19,19 -6,20 -6,21 "/>\     <polygon id="389" class="fil281" points="19,19 -6,21 -6,21 "/>\     <polygon id="390" class="fil281" points="19,19 -6,21 -6,21 "/>\     <polygon id="391" class="fil280" points="19,19 -6,21 -6,22 "/>\     <polygon id="392" class="fil280" points="19,19 -6,22 -6,22 "/>\     <polygon id="393" class="fil280" points="19,19 -6,22 -6,22 "/>\     <polygon id="394" class="fil280" points="19,19 -6,22 -6,23 "/>\     <polygon id="395" class="fil280" points="19,19 -6,22 -5,23 "/>\     <polygon id="396" class="fil280" points="19,19 -5,23 -5,23 "/>\     <polygon id="397" class="fil279" points="19,19 -5,23 -5,23 "/>\     <polygon id="398" class="fil279" points="19,19 -5,23 -5,24 "/>\     <polygon id="399" class="fil279" points="19,19 -5,24 -5,24 "/>\     <polygon id="400" class="fil279" points="19,19 -5,24 -5,24 "/>\     <polygon id="401" class="fil279" points="19,19 -5,24 -5,25 "/>\     <polygon id="402" class="fil279" points="19,19 -5,25 -5,25 "/>\     <polygon id="403" class="fil278" points="19,19 -5,25 -5,25 "/>\     <polygon id="404" class="fil278" points="19,19 -5,25 -5,25 "/>\     <polygon id="405" class="fil278" points="19,19 -5,25 -5,26 "/>\     <polygon id="406" class="fil278" points="19,19 -5,26 -5,26 "/>\     <polygon id="407" class="fil278" points="19,19 -5,26 -5,26 "/>\     <polygon id="408" class="fil277" points="19,19 -5,26 -4,27 "/>\     <polygon id="409" class="fil277" points="19,19 -5,27 -4,27 "/>\     <polygon id="410" class="fil277" points="19,19 -4,27 -4,27 "/>\     <polygon id="411" class="fil277" points="19,19 -4,27 -4,27 "/>\     <polygon id="412" class="fil277" points="19,19 -4,27 -4,28 "/>\     <polygon id="413" class="fil277" points="19,19 -4,28 -4,28 "/>\     <polygon id="414" class="fil276" points="19,19 -4,28 -4,28 "/>\     <polygon id="415" class="fil276" points="19,19 -4,28 -4,29 "/>\     <polygon id="416" class="fil276" points="19,19 -4,29 -4,29 "/>\     <polygon id="417" class="fil276" points="19,19 -4,29 -3,29 "/>\     <polygon id="418" class="fil276" points="19,19 -3,29 -3,29 "/>\     <polygon id="419" class="fil276" points="19,19 -3,29 -3,30 "/>\     <polygon id="420" class="fil275" points="19,19 -3,30 -3,30 "/>\     <polygon id="421" class="fil275" points="19,19 -3,30 -3,30 "/>\     <polygon id="422" class="fil275" points="19,19 -3,30 -3,30 "/>\     <polygon id="423" class="fil275" points="19,19 -3,30 -3,31 "/>\     <polygon id="424" class="fil275" points="19,19 -3,31 -2,31 "/>\     <polygon id="425" class="fil275" points="19,19 -3,31 -2,31 "/>\     <polygon id="426" class="fil274" points="19,19 -2,31 -2,32 "/>\     <polygon id="427" class="fil274" points="19,19 -2,31 -2,32 "/>\     <polygon id="428" class="fil274" points="19,19 -2,32 -2,32 "/>\     <polygon id="429" class="fil274" points="19,19 -2,32 -2,32 "/>\     <polygon id="430" class="fil274" points="19,19 -2,32 -1,33 "/>\     <polygon id="431" class="fil274" points="19,19 -2,32 -1,33 "/>\     <polygon id="432" class="fil273" points="19,19 -1,33 -1,33 "/>\     <polygon id="433" class="fil273" points="19,19 -1,33 -1,33 "/>\     <polygon id="434" class="fil273" points="19,19 -1,33 -1,34 "/>\     <polygon id="435" class="fil273" points="19,19 -1,33 -1,34 "/>\     <polygon id="436" class="fil273" points="19,19 -1,34 0,34 "/>\     <polygon id="437" class="fil273" points="19,19 0,34 0,34 "/>\     <polygon id="438" class="fil272" points="19,19 0,34 0,34 "/>\     <polygon id="439" class="fil272" points="19,19 0,34 0,35 "/>\     <polygon id="440" class="fil272" points="19,19 0,35 0,35 "/>\     <polygon id="441" class="fil272" points="19,19 0,35 1,35 "/>\     <polygon id="442" class="fil272" points="19,19 1,35 1,35 "/>\     <polygon id="443" class="fil272" points="19,19 1,35 1,36 "/>\     <polygon id="444" class="fil271" points="19,19 1,36 1,36 "/>\     <polygon id="445" class="fil271" points="19,19 1,36 1,36 "/>\     <polygon id="446" class="fil271" points="19,19 1,36 2,36 "/>\     <polygon id="447" class="fil271" points="19,19 2,36 2,36 "/>\     <polygon id="448" class="fil271" points="19,19 2,36 2,37 "/>\     <polygon id="449" class="fil271" points="19,19 2,37 2,37 "/>\     <polygon id="450" class="fil270" points="19,19 2,37 3,37 "/>\     <polygon id="451" class="fil270" points="19,19 2,37 3,37 "/>\     <polygon id="452" class="fil270" points="19,19 3,37 3,37 "/>\     <polygon id="453" class="fil270" points="19,19 3,37 3,38 "/>\     <polygon id="454" class="fil270" points="19,19 3,38 3,38 "/>\     <polygon id="455" class="fil270" points="19,19 3,38 4,38 "/>\     <polygon id="456" class="fil269" points="19,19 4,38 4,38 "/>\     <polygon id="457" class="fil269" points="19,19 4,38 4,38 "/>\     <polygon id="458" class="fil269" points="19,19 4,38 4,39 "/>\     <polygon id="459" class="fil269" points="19,19 4,38 5,39 "/>\     <polygon id="460" class="fil268" points="19,19 5,39 5,39 "/>\     <polygon id="461" class="fil268" points="19,19 5,39 5,39 "/>\     <polygon id="462" class="fil268" points="19,19 5,39 5,39 "/>\     <polygon id="463" class="fil268" points="19,19 5,39 6,39 "/>\     <polygon id="464" class="fil267" points="19,19 6,39 6,39 "/>\     <polygon id="465" class="fil267" points="19,19 6,39 6,40 "/>\     <polygon id="466" class="fil267" points="19,19 6,40 6,40 "/>\     <polygon id="467" class="fil267" points="19,19 6,40 7,40 "/>\     <polygon id="468" class="fil266" points="19,19 7,40 7,40 "/>\     <polygon id="469" class="fil266" points="19,19 7,40 7,40 "/>\     <polygon id="470" class="fil266" points="19,19 7,40 7,40 "/>\     <polygon id="471" class="fil266" points="19,19 7,40 8,41 "/>\     <polygon id="472" class="fil265" points="19,19 8,40 8,41 "/>\     <polygon id="473" class="fil265" points="19,19 8,41 8,41 "/>\     <polygon id="474" class="fil265" points="19,19 8,41 9,41 "/>\     <polygon id="475" class="fil265" points="19,19 9,41 9,41 "/>\     <polygon id="476" class="fil264" points="19,19 9,41 9,41 "/>\     <polygon id="477" class="fil264" points="19,19 9,41 9,41 "/>\     <polygon id="478" class="fil264" points="19,19 9,41 10,41 "/>\     <polygon id="479" class="fil264" points="19,19 10,41 10,41 "/>\     <polygon id="480" class="fil263" points="19,19 10,41 10,42 "/>\     <polygon id="481" class="fil263" points="19,19 10,42 11,42 "/>\     <polygon id="482" class="fil263" points="19,19 10,42 11,42 "/>\     <polygon id="483" class="fil263" points="19,19 11,42 11,42 "/>\     <polygon id="484" class="fil262" points="19,19 11,42 11,42 "/>\     <polygon id="485" class="fil262" points="19,19 11,42 12,42 "/>\     <polygon id="486" class="fil262" points="19,19 12,42 12,42 "/>\     <polygon id="487" class="fil262" points="19,19 12,42 12,42 "/>\     <polygon id="488" class="fil261" points="19,19 12,42 13,42 "/>\     <polygon id="489" class="fil261" points="19,19 12,42 13,42 "/>\     <polygon id="490" class="fil261" points="19,19 13,42 13,42 "/>\     <polygon id="491" class="fil261" points="19,19 13,42 13,42 "/>\     <polygon id="492" class="fil260" points="19,19 13,42 14,43 "/>\     <polygon id="493" class="fil260" points="19,19 14,43 14,43 "/>\     <polygon id="494" class="fil260" points="19,19 14,43 14,43 "/>\     <polygon id="495" class="fil260" points="19,19 14,43 15,43 "/>\     <polygon id="496" class="fil259" points="19,19 15,43 15,43 "/>\     <polygon id="497" class="fil259" points="19,19 15,43 15,43 "/>\     <polygon id="498" class="fil259" points="19,19 15,43 16,43 "/>\     <polygon id="499" class="fil259" points="19,19 15,43 16,43 "/>\     <polygon id="500" class="fil258" points="19,19 16,43 16,43 "/>\     <polygon id="501" class="fil258" points="19,19 16,43 16,43 "/>\     <polygon id="502" class="fil258" points="19,19 16,43 17,43 "/>\     <polygon id="503" class="fil258" points="19,19 17,43 17,43 "/>\     <polygon id="504" class="fil257" points="19,19 17,43 17,43 "/>\     <polygon id="505" class="fil257" points="19,19 17,43 18,43 "/>\     <polygon id="506" class="fil257" points="19,19 18,43 18,43 "/>\     <polygon id="507" class="fil257" points="19,19 18,43 18,43 "/>\     <polygon id="508" class="fil256" points="19,19 18,43 19,43 "/>\     <polygon id="509" class="fil283" points="19,19 18,43 19,43 "/>\    </g>\   </g>\   <path class="fil284" d="M12 12c4,-4 9,-4 13,0l5 -5c-6,-7 -17,-7 -23,0l5 5z" />\   <polygon class="fil305" points="8,22 4,19 4,19 7,22 "/>\   <polygon class="fil285" points="12,12 7,7 8,7 12,11 "/>\   <path class="fil286" d="M30 7l-1 0c-6,-6 -15,-6 -21,0l-1 0c6,-7 17,-7 23,0z"/>\   <polygon class="fil287" points="29,7 25,11 25,12 30,7 "/>\   <path class="fil288" d="M25 11c-4,-3 -9,-3 -13,0l0 1c4,-4 9,-4 13,0l0 -1z"/>\   <path class="fil289" d="M12 25c4,4 9,4 13,0l5 5c-6,7 -17,7 -23,0l5 -5z"/>\   <polygon class="fil290" points="12,25 7,30 8,30 12,26 "/>\   <path class="fil288" d="M30 30l-1 0c-6,6 -15,6 -21,0l-1 0c6,7 17,7 23,0z"/>\   <polygon class="fil291" points="29,30 25,26 25,25 30,30 "/>\   <path class="fil292" d="M25 26c-4,3 -9,3 -13,0l0 -1c4,4 9,4 13,0l0 1z"/>\   <path class="fil293" d="M25 25c4,-4 4,-9 0,-13l5 -5c7,6 7,17 0,23l-5 -5z"/>\   <polygon class="fil294" points="25,25 30,30 30,29 26,25 "/>\   <path class="fil288" d="M30 7l0 1c6,6 6,15 0,21l0 1c7,-6 7,-17 0,-23z"/>\   <polygon class="fil295" points="30,8 26,12 25,12 30,7 "/>\   <path class="fil296" d="M26 12c3,4 3,9 0,13l-1 0c4,-4 4,-9 0,-13l1 0z"/>\   <path class="fil297" d="M30 15l0 7 3 -3 -3 -4zm0 4m2 1m0 -3"/>\   <polygon class="fil298" points="30,22 30,22 30,16 30,15 "/>\   <polygon class="fil299" points="33,19 30,15 30,16 33,19 "/>\   <polygon class="fil300" points="30,22 33,19 33,19 30,22 "/>\   <path class="fil301" d="M12 25c-4,-4 -4,-9 0,-13l-5 -5c-7,6 -7,17 0,23l5 -5z"/>\   <polygon class="fil285" points="12,25 7,30 7,29 11,25 "/>\   <path class="fil302" d="M7 7l0 1c-6,6 -6,15 0,21l0 1c-7,-6 -7,-17 0,-23z"/>\   <polygon class="fil287" points="7,8 11,12 12,12 7,7 "/>\   <path class="fil288" d="M11 12c-3,4 -3,9 0,13l1 0c-4,-4 -4,-9 0,-13l-1 0z"/>\   <path class="fil303" d="M8 15l0 7 -4 -3 4 -4zm0 4m-2 1m0 -3"/>\   <polygon class="fil288" points="8,22 7,22 7,16 8,15 "/>\   <polygon class="fil304" points="4,19 8,15 7,16 4,19 "/>\   <polygon class="fil305" points="18,3 18,5 16,5 16,6 18,6 18,8 19,8 19,6 21,6 21,5 19,5 19,3 "/>\   <polygon class="fil306" points="18,3 19,3 19,5 19,5 19,3 18,3 "/>\   <polygon class="fil307" points="18,3 18,5 18,5 18,3 "/>\   <polygon class="fil288" points="18,8 19,8 19,6 19,6 19,8 18,8 "/>\   <polygon class="fil306" points="18,8 18,6 18,6 18,8 "/>\   <polygon class="fil288" points="21,5 21,6 19,6 19,6 21,6 21,5 "/>\   <polygon class="fil307" points="16,6 16,5 18,5 18,5 16,5 16,6 "/>\   <polygon class="fil288" points="16,6 18,6 18,6 16,6 "/>\   <polygon class="fil307" points="19,5 21,5 21,5 19,5 "/>\   <polygon class="fil307" points="18,3 18,3 19,3 19,3 "/>\   <rect class="fil308 str0" x="16" y="30" width="5.08125" height="1.50364"/>\   <rect class="fil305" x="17" y="31" width="4.56274" height="0.985134"/>\   <polygon class="fil307" points="16,30 17,31 21,31 22,30 "/>\   <path class="fil288" d="M21 32c0,0 0,-1 0,-1l1 -1 0 2 -1 0z"/>\   <polygon class="fil288" points="16,32 17,32 21,32 22,32 "/>\   <polygon class="fil287" points="16,30 16,32 17,32 17,31 "/>\   <path class="fil284" style="fill:#FFFFFF;fill-opacity:0;" id="profileZoomIn" d="M12 12c4,-4 9,-4 13,0l5 -5c-6,-7 -17,-7 -23,0l5 5z" />\   <path class="fil289" style="fill:#FFFFFF;fill-opacity:0;" id="profileZoomOut" d="M12 25c4,4 9,4 13,0l5 5c-6,7 -17,7 -23,0l5 -5z"/>\   <path class="fil301" style="fill:#FFFFFF;fill-opacity:0;" id="profilePanRight" d="M12 25c-4,-4 -4,-9 0,-13l-5 -5c-7,6 -7,17 0,23l5 -5z"/>\   <path class="fil293" style="fill:#FFFFFF;fill-opacity:0;" id="profilePanLeft" d="M25 25c4,-4 4,-9 0,-13l5 -5c7,6 7,17 0,23l-5 -5z"/>\  </g>\ </g>\</svg>';};this.createDefElementOfParachute=function(){return'<g id="'+this.parachute_element_id+'" transform="scale(0.125) translate(-260,-200)">\n\		<path d="m289.543,272.957c12.968,0 23.486,10.541 23.486,23.508 0-12.967 10.507-23.508 23.485-23.508s23.486,10.541 23.486,23.508c0-12.967 10.508-23.508 23.508-23.508 12.979,0 23.485,10.541 23.485,23.508 0-12.967 10.508-23.508 23.509-23.508 12.957,0 23.463,10.541 23.463,23.508 0-51.893-42.072-93.965-93.965-93.965s-93.965,42.072-93.965,93.965c0-12.967 10.518-23.508 23.508-23.508z" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.172"></path>\n\	<path d="m453.965,296.465-93.965,193.035 46.993-193.035" fill="none" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.172"></path>\n\	<path d="m266.035,296.465 93.965,193.035-46.971-193.035" fill="none" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.172"></path>\n\		<path d="m360,296.465v193.035" fill="none" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.172"></path>\n\<path d="m335.502,481.002h48.996v48.996h-48.996z" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.172"></path>\n\</g>';};this.getReliefXmlDoc=function(){return this.getReliefXmlDocDev();};this.getReliefXmlDocDev=function(){var xhttp=null;if(window.XMLHttpRequest){xhttp=new XMLHttpRequest();}else{xhttp=new ActiveXObject("Microsoft.XMLHTTP");}xhttp.open("GET",this.dev_test_xml_terrain_profile,false);try{xhttp.responseType="msxml-document";}catch(err){}xhttp.send("");return xhttp.responseXML;};this.repaintGeometricZoomAndPan=function(){var newScaleString="scale("+this.lastXScale+",1)";var newTranslateString="translate("+(this.getZeroPointView().x-(this.getZeroPointView().x*this.lastXScale)+this.lastXTranslate)+",0)";var zoomableElements=document.getElementsByClassName("zoomable");if(isUndefinedOrIsNullOrIsEmptyArray(zoomableElements)){return;}for(var i=0;i<zoomableElements.length;i++){var iZoomableElement=zoomableElements[i];if(isUndefinedOrIsNull(iZoomableElement)){continue;}iZoomableElement.setAttributeNS(null,"transform",newTranslateString+" "+newScaleString);}};this.repaintSemanticZoomAndPan=function(){var semanticZoomableElements=document.getElementsByClassName("semanticzoomable");if(isUndefinedOrIsNullOrIsEmptyArray(semanticZoomableElements)){return;}for(var i=0;i<semanticZoomableElements.length;i++){var iSemanticZoomableElement=semanticZoomableElements[i];if(isUndefinedOrIsNull(iSemanticZoomableElement)){continue;}var backup_x_attribute_name="original_x";var originalXValue=iSemanticZoomableElement.getAttribute(backup_x_attribute_name);if(isUndefinedOrIsNull(originalXValue)){originalXValue=Number(iSemanticZoomableElement.getAttribute("x"));iSemanticZoomableElement.setAttributeNS(null,backup_x_attribute_name,originalXValue);}else{originalXValue=Number(originalXValue);}iSemanticZoomableElement.setAttributeNS(null,"x",((originalXValue*this.lastXScale)-((this.getZeroPointView().x*this.lastXScale)-this.getZeroPointView().x)+this.lastXTranslate));}};this.zoom=function(aScale){if(isUndefinedOrIsNull(aScale)){aScale=1;}var newScaleString="scale("+aScale+",1)";var zoomableElements=document.getElementsByClassName("zoomable");for(var i=0;zoomableElements.length;i++){var iZoomableElement=zoomableElements[i];if(isUndefinedOrIsNull(iZoomableElement)){continue;}iZoomableElement.setAttributeNS(null,"transform",newScaleString);}};this.zoomIn=function(aScale){if(isUndefinedOrIsNull(aScale)){return;}this.usedXScaleStep=aScale;var newScale=this.lastXScale+aScale;this.lastXScale=newScale;this.repaintSemanticZoomAndPan();this.repaintGeometricZoomAndPan();};this.zoomOut=function(aScale){if(isUndefinedOrIsNull(aScale)){return;}this.usedXScaleStep=(-1*aScale);var newScale=this.lastXScale-aScale;this.lastXScale=newScale;this.repaintGeometricZoomAndPan();this.repaintSemanticZoomAndPan();};this.pan=function(aX,aY){if(isUndefinedOrIsNullOneOf([aX,aY])){return;}var newXTranslate=this.lastXTranslate+aX;var newYTranslate=this.lastYTranslate+aY;this.lastXTranslate=newXTranslate;this.lastYTranslate=newYTranslate;this.repaintGeometricZoomAndPan();this.repaintSemanticZoomAndPan();};this.repaintPresentationUnits=function(){var unitPresentationElements=document.getElementsByClassName(this.mPresentationUnitAttributeName);for(var i=0;i<unitPresentationElements.length;i++){var iPresentationElement=unitPresentationElements[i];if(isUndefinedOrIsNull(iPresentationElement)){continue;}var presentationValue=iPresentationElement.getAttribute(this.mPresentationUnitAttributeName);if(isUndefinedOrIsNull(presentationValue)){continue;}var opacityValue=0;if(presentationValue===this.mPresentationUnit){opacityValue=1;}iPresentationElement.setAttributeNS(null,"opacity",opacityValue);}};this.localize=function(){localeObject('#tspan2991','FlightProfile.title');};this.connectButtonActions=function(){JQ("#profileZoomIn").click(()=>zoomIn(this.zoom_step));JQ("#profileZoomOut").click(()=>zoomOut(this.zoom_step));JQ("#profilePanRight").click(()=>pan(this.pan_step,0));JQ("#profilePanLeft").click(()=>pan(-this.pan_step,0));};};function ObstacleType(aElementId,aViewWidth,aViewHeight){this.element_type_id=aElementId;this.view_width=aViewWidth;this.view_height=aViewHeight;};function ObstacleView(aX,aY,aElementTypeId,aName,aElevation,aWidth,aHeight){this.name=aName;this.x=aX;this.y=aY;this.element_type_id=aElementTypeId;this.elevation=aElevation;this.width=aWidth;this.height=aHeight;}function AreaView(aName,aWidth,aHeight,aX,aY,aType,aSecondLineText){this.width=aWidth;this.height=aHeight;this.x=aX;this.y=aY;this.name=aName;this.secondLineText=aSecondLineText;this.type=aType;this.isCut=false;this.y1HeightType=null;this.y2HeightType=null;var mHeightDistanceViewsChain=null;var mBorderPathsHeightDistanceViewsArray=null;this.setBorderPathsHeightDistViewsArray=function(aHeightDistanceArray){mBorderPathsHeightDistanceViewsArray=aHeightDistanceArray;};this.getBorderPathsHeightDistViewsArray=function(){return mBorderPathsHeightDistanceViewsArray;};this.setPolygonHeightDistViewsArray=function(aValue){mHeightDistanceViewsChain=aValue;};this.getPolygonHeightDistViewsArray=function(){return mHeightDistanceViewsChain;};this.createSVGPolygonPointsStr=function(){var heightDistanceChain=this.getPolygonHeightDistViewsArray();if(AWUtils.isUndefinedOrIsNull(heightDistanceChain)===true){return'';}var polygonPoints=[];heightDistanceChain.forEach(function(iHeightDistance){if(AWUtils.isUndefinedOrIsNull(iHeightDistance)===true){return;}polygonPoints.push(iHeightDistance.distance+","+iHeightDistance.height);});return polygonPoints.join(" ");};this.createSVGPathsArray=function(){var borderPathsHDArrays=this.getBorderPathsHeightDistViewsArray();var retVal=[];borderPathsHDArrays.forEach(function(iPathHDArray){if(AWUtils.isArray(iPathHDArray)===false){return;}var onePathString='M';iPathHDArray.forEach(function(iHDPoint){if(AWUtils.isUndefinedOrIsNull(iHDPoint)===true){return;}onePathString+=' '+iHDPoint.distance+','+iHDPoint.height;});retVal.push(onePathString);});return retVal;};this.setWidth=function(aValue){this.width=aValue;};this.getWidth=function(){return this.width;};this.setHeight=function(aValue){this.height=aValue;};this.getHeight=function(){return this.height;};this.setX=function(aValue){this.x=aValue;};this.getX=function(){return this.x;};this.setY=function(aValue){this.y=aValue;};this.getY=function(){return this.y;};this.setName=function(aValue){this.name=aValue;};this.getName=function(){return this.name;};this.setSecondLineText=function(aValue){this.secondLineText=aValue;};this.getSecondLinetext=function(){return this.secondLineText;};this.setType=function(aValue){this.type=aValue;};this.getType=function(){return this.type;};this.setIsCut=function(aValue){this.isCut=aValue;};this.getIsCut=function(){return this.isCut;};this.setY1HeightType=function(aValue){this.y1HeightType=aValue;};this.getY1HeightType=function(){return this.y1HeightType;};this.setY2HeightType=function(aValue){this.y2HeightType=aValue;};this.getY2HeightType=function(){return this.y2HeightType;};this.getUpperLeftXY=function(){return{x:this.x,y:this.y};};this.getUpperRightXY=function(){return{x:(this.x+this.width),y:this.y};};this.getLowerLeftXY=function(){return{x:this.x,y:(this.y+this.height)};};this.getLowerRightXY=function(){return{x:(this.x+this.width),y:(this.y+this.height)};};}function HeightDistance(aHeight,aDistance){this.height;this.distance;this.fromPointName;this.toPointName;this.segmentErrorMsg;this.heightOfFlight;this.flightProfileHDPoints;this.distanceStart;if(AWUtils.isNumber(aHeight)===true){this.height=Number(aHeight);}if(AWUtils.isNumber(aDistance)===true){this.distance=Number(aDistance);}this.clone=function(){var retVal=new HeightDistance();retVal.height=this.height;retVal.distance=this.distance;retVal.distanceStart=this.distanceStart;retVal.fromPointName=this.fromPointName;retVal.toPointName=this.toPointName;retVal.segmentErrorMsg=this.segmentErrorMsg;retVal.heightOfFlight=this.heightOfFlight;var profilePoints=[];profilePoints.concat(this.getFlightProfileHDPoints());retVal.flightProfileHDPoints=profilePoints;return retVal;};this.getDistanceInt=function(){return AWUtils.parseIntElseZero(this.distance);};this.getHeightInt=function(){return AWUtils.parseIntElseZero(this.height);};this.getDistanceFloat=function(){return AWUtils.parseFloatElseZero(this.distance);};this.getDistanceStartFloat=function(){return AWUtils.parseFloatElseZero(this.distanceStart);};this.getHeightFloat=function(){return AWUtils.parseFloatElseZero(this.height);};this.getFlightProfileHDPoints=function(){if(AWUtils.isArray(this.flightProfileHDPoints)===false){this.flightProfileHDPoints=[];}if(this.flightProfileHDPoints.length<=0){this.flightProfileHDPoints.push(this);}var lastProfileHD=this.flightProfileHDPoints[(this.flightProfileHDPoints.length-1)];lastProfileHD.toPointName=this.toPointName;return this.flightProfileHDPoints;};}function SegmentErrorMsgModel(){this.title;this.segmentName;this.segmentHeight;this.segmentDistance;this.message;}function AxisDashStep(aShowStep,aToMeterConvertFactor,aFromMeterConvertFactor,aLegend,aShowAttribute){this.showStepValues=aShowStep;this.toMeterConvertFactor=aToMeterConvertFactor;this.fromMeterConvertFactor=aFromMeterConvertFactor;this.legend=aLegend;this.setStep=aShowStep[(aShowStep.length-1)];this.scaleFactor=1;this.axisLength=0;this.axis_minimal_dash_step=1;this.showAttribute=aShowAttribute;this.setScaleFactor=function(aScale){this.scaleFactor=aScale;};this.setAxisLength=function(aAxisLength){this.axisLength=aAxisLength;};this.setMinimalDashStep=function(aMinimalDashStep){this.axis_minimal_dash_step=aMinimalDashStep;};this.getAxisDashStep=function(){for(var i=0;i<this.showStepValues.length;i++){var iDashStepX=this.showStepValues[i];var scaledDashStepX=iDashStepX*this.toMeterConvertFactor*this.scaleFactor;if(scaledDashStepX<this.axis_minimal_dash_step){continue;}else{this.setStep=iDashStepX;return this.setStep;}}this.setStep=this.showStepValues[(this.showStepValues.length-1)];return this.setStep;};this.getAxisDashCount=function(){var dashStep=this.getAxisDashStep();var count=this.axisLength/((dashStep*this.toMeterConvertFactor)*this.scaleFactor);return(count-1);};this.getAxisDashStepText=function(){return this.getAxisDashStep();};this.getAxisDashStepView=function(){return(this.getAxisDashStep()*this.toMeterConvertFactor*this.scaleFactor);};};function load(){var svgProfile=new AisSvgProfile(1250,250);var flight=createFlight_test();var relief=createRelief_test();overwriteAreasData(relief);overwritePointsData(relief,svgProfile);overwriteRouteData(flight);svgProfile.setFlight(flight);svgProfile.setRelief(relief);document.getElementById("aissvgprofile").innerHTML=svgProfile.createSvgProfile();svgProfile.connectButtonActions();};function createDevFlightData(){var routeSegment0=new RouteSegment();routeSegment0.setHeight("100");routeSegment0.setDistance("1000");var flightRoute=new FlightRoute();flightRoute.addSegment(routeSegment0);var flight=new Flight();flight.setRoute(flightRoute);return flight;}function overwriteAreasData(aRelief){var area1=new Area();area1.setTxt_name("Test01 Code Name");area1.setCode_id("Test01 Code ID");var rectangle=new Rectangle();rectangle.setX1(1000);rectangle.setY1(500);rectangle.setX2(15000);rectangle.setY2(2000);area1.setConflict("STCA");area1.setConflict_desc("STCA Conflict");var area11=new Area();area11.setTxt_name("Test0111 Code Name");area11.setCode_id("Test0111 Code ID");var rectangle11=new Rectangle();rectangle11.setX1(1000);rectangle11.setY1(500);rectangle11.setX2(15000);rectangle11.setY2(2000);area11.setConflict("STCA11");area11.setConflict_desc("STCA Conflict11");area11.addRectangle(rectangle11);var area2=new Area();area2.setTxt_name("Test02 CTR");area2.setType("Aixm-Ase-CTR");var rectangle2=new Rectangle();rectangle2.setX1(20000);rectangle2.setY1(1000);rectangle2.setX2(35000);rectangle2.setY2(3000);area2.addRectangle(rectangle2);var area21=new Area();area21.setTxt_name("Test021 CTR");area21.setType("021 Aixm-Ase-CTR");var rectangle21=new Rectangle();rectangle21.setX1(24000);rectangle21.setY1(1000);rectangle21.setX2(35000);rectangle21.setY2(3000);area21.addRectangle(rectangle21);var area3=new Area();area3.setTxt_name("Test03 CTR");area3.setType("Aixm-Ase-CTR");var rectangle3=new Rectangle();rectangle3.setX1(40000);rectangle3.setY1(1000);rectangle3.setX2(50000);rectangle3.setY2(1500);var rectangle4=new Rectangle();rectangle4.setX1(55000);rectangle4.setY1(500);rectangle4.setX2(65000);rectangle4.setY2(1500);area3.addRectangle(rectangle3);area1.addRectangle(rectangle);area1.addRectangle(rectangle4);aRelief.setAreas([area11,area1,area2,area21,area3]);}function overwritePointsData(aRelief,aSvgProfile){var distanceStep=5000;var count=1;var allPoints=[];for(var iKeyName in aSvgProfile.obstacle_types){var point1=new Point();point1.setTxt_name(iKeyName);point1.setDistance((count*distanceStep));point1.setElevation((count*distanceStep));point1.type="Aixm-Obs";if(iKeyName===aSvgProfile.obstacle_types.aixm_ahp){point1.type="Aixm-Ahp";}else if(iKeyName===aSvgProfile.obstacle_types.aixm_ahp){point1.type="Aixm-Dme";}allPoints.push(point1);count++;}var last_point=new Point();last_point.setDistance((count*distanceStep));allPoints.push(last_point);aRelief.setPoints(allPoints);};function overwriteRouteData(flight){overwriteRouteDataTerrainConflict(flight);}function overwriteRouteDataNoConflict(flight){var segment1=new RouteSegment();var fromPoint1=new Location("From Point1");var toPoint1=new Location("To Point1");segment1.setFromPoint(fromPoint1);segment1.setToPoint(toPoint1);segment1.setHeight(900);segment1.setDistance(5000);var segment2=new RouteSegment();var fromPoint2=new Location("From Point2");var toPoint2=new Location("To Point2");segment2.setFromPoint(fromPoint2);segment2.setToPoint(toPoint2);segment2.setHeight(2800);segment2.setDistance(114500);var segment3=new RouteSegment();var fromPoint3=new Location("From Point3");var toPoint3=new Location("To Point3");segment3.setFromPoint(fromPoint3);segment3.setToPoint(toPoint3);segment3.setHeight(2000);segment3.setDistance(12500);var segment4=new RouteSegment();var fromPoint4=new Location("From Point4");var toPoint4=new Location("To Point4");segment4.setFromPoint(fromPoint4);segment4.setToPoint(toPoint4);segment4.setHeight(1500);segment4.setDistance(12500);flight.getRoute().setSegments([segment1,segment2,segment3,segment4]);}function overwriteRouteDataTerrainConflict(flight){var segment1=new RouteSegment();var fromPoint1=new Location("From Point1");var toPoint1=new Location("To Point1");segment1.setFromPoint(fromPoint1);segment1.setToPoint(toPoint1);segment1.setHeight(250);segment1.setDistance(5000);var segment2=new RouteSegment();var fromPoint2=new Location("From Point2");var toPoint2=new Location("To Point2");segment2.setFromPoint(fromPoint2);segment2.setToPoint(toPoint2);segment2.setHeight(850);segment2.setDistance(12750);var segment3=new RouteSegment();var fromPoint3=new Location("From Point3");var toPoint3=new Location("To Point3");segment3.setFromPoint(fromPoint3);segment3.setToPoint(toPoint3);segment3.setHeight(350);segment3.setDistance(12500);var segment4=new RouteSegment();var fromPoint4=new Location("From Point4");var toPoint4=new Location("To Point4");segment4.setFromPoint(fromPoint4);segment4.setToPoint(toPoint4);segment4.setHeight(1500);segment4.setDistance(14000);flight.getRoute().setSegments([segment1,segment2,segment3,segment4]);}function overwriteRouteDataZeroHeight(aFlight){var segment1=new RouteSegment();var fromPoint1=new Location("From Point1");var toPoint1=new Location("To Point1");segment1.setFromPoint(fromPoint1);segment1.setToPoint(toPoint1);segment1.setHeight(null);segment1.setDistance(5000);var segment2=new RouteSegment();var fromPoint2=new Location("From Point2");var toPoint2=new Location("To Point2");segment2.setFromPoint(fromPoint2);segment2.setToPoint(toPoint2);segment2.setHeight(null);segment2.setDistance(12750);var segment3=new RouteSegment();var fromPoint3=new Location("From Point3");var toPoint3=new Location("To Point3");segment3.setFromPoint(fromPoint3);segment3.setToPoint(toPoint3);segment3.setHeight(null);segment3.setDistance(12500);var segment4=new RouteSegment();var fromPoint4=new Location("From Point4");var toPoint4=new Location("To Point4");segment4.setFromPoint(fromPoint4);segment4.setToPoint(toPoint4);segment4.setHeight(null);segment4.setDistance(14000);aFlight.getRoute().setSegments([segment1,segment2,segment3,segment4]);aFlight.setFlevel(55);aFlight.setFlevelUnit('m');}function overwriteHeightData(aRelief){var heights=[500,1000,0];aRelief.setHeights(heights);aRelief.setHeightStep(1000);}function zoom(aZoomFactor){svgProfile.zoom(aZoomFactor);}function zoomIn(aZoomFactor){svgProfile.zoomIn(aZoomFactor);}function zoomOut(aZoomFactor){svgProfile.zoomOut(aZoomFactor);}function pan(aX,aY){svgProfile.pan(aX,aY);}function setSvgUnitsToKM(){svgProfile.setPresentationUnit('KM');}function setSvgUnitsToNM(){svgProfile.setPresentationUnit('NM');}function repaintSvg(){svgProfile.repaint();};function FlightProfile(){}FlightProfile.showFlightProfile=function(flight,aCloseBtnFunction){const page=JQ('body').pagecontainer("getActivePage");const profileDivClass="rs-flight-profile";JQ("."+profileDivClass).remove();if(flight!==null){const profileGraph=HtmlUtils.div();const profileAdditionalTextDiv=HtmlUtils.div("");const profileAddErrorTextDiv=HtmlUtils.div("");const additionalTextWrapper=HtmlUtils.div(profileAdditionalTextDiv);const profileDiv=JQ('<div>');profileDiv.addClass(profileDivClass);var closeBtn=JQ('<div class="rsys-form-title" style="border-bottom-left-radius: 10px; border-bottom-right-radius: 10px;    position: absolute;     right: 0;    width: 1.5em;"><a class="ui-icon-delete ui-btn-icon-right ui-link"></a></div>');closeBtn.click(function(){if(AWUtils.isUndefinedOrIsNull(aCloseBtnFunction)===false){aCloseBtnFunction();}else{FlightProfile.showFlightProfile(null);}});profileDiv.append(closeBtn);profileGraph.addClass('flight-profile-graph-landscape');profileAdditionalTextDiv.addClass('profile-additional-text');profileAddErrorTextDiv.addClass('profile-additional-error-text');additionalTextWrapper.append(profileAddErrorTextDiv);additionalTextWrapper.addClass('profile-additional-text-wrapper');profileDiv.append(profileGraph);profileDiv.append(additionalTextWrapper);page.append(profileDiv);profileDiv.loading(true,true);}};FlightProfile.setFlightProfileData=function(flight,relief,aShowSegmentErrors,aAdditionalText,aErrorPopupText,aErrorAddTxt){var initialWidth=JQ(window).width();var initialHeight=JQ(window).height();var profileHeightWidthRatio=5;var profileWidthLandscape=initialWidth>initialHeight?initialWidth:initialHeight;var profileHeightLandscape=profileWidthLandscape/profileHeightWidthRatio;var svgProfileLandscape=FlightProfile.createSvgProfileInstance(profileWidthLandscape,profileHeightLandscape,flight,aShowSegmentErrors);FlightProfile.showSvgProfile(svgProfileLandscape,relief,aShowSegmentErrors,aAdditionalText,aErrorPopupText,aErrorAddTxt);};FlightProfile.createSvgProfileInstance=function(aWidth,aHeight,flight,aShowSegmentErrors){var svgProfile=new AisSvgProfile(aWidth,aHeight);svgProfile.setClimbDistanceCheck(aShowSegmentErrors);svgProfile.setDescentDistanceCheck(aShowSegmentErrors);svgProfile.setPresentationUnit(AppController.distanceUnit);svgProfile.setFlight(flight);return svgProfile;};FlightProfile.showSvgProfile=function(svgProfileLandscape,relief,aShowSegmentErrors,aAdditionalText,aErrorPopupText,aErrorAddTxt){const winMan=AppController.controlPanel.getWindowManager();const flightPlanForm=winMan.getFormWithId("flightPlanPanel");const rendering=JQ("<span>");const flPlanDiv=JQ("#FlightPlanDiv");const profileDiv=JQ(".rs-flight-profile > div.flight-profile-graph-landscape");flPlanDiv.loading(false);rendering.html(JQ.i18n._('FlightProfile.rendering'));profileDiv.append(rendering);profileDiv.data("controllerObj",svgProfileLandscape);if(HtmlUtils.isUndefinedOrIsNull(flightPlanForm)===false){flightPlanForm.minimize();}JQ("#showBufferOnMapChk").checkboxradio("enable");setTimeout(function(){debug("FlightProfile rendering statred ...");svgProfileLandscape.setRelief(relief);profileDiv.append(svgProfileLandscape.createSvgProfile());svgProfileLandscape.connectButtonActions();svgProfileLandscape.localize();rendering.remove();FlightProfile.setProfileAdditionalText(aAdditionalText);profileDiv.parent().loading(false);debug("FlightProfile rendering done!");if(aShowSegmentErrors===true){FlightProfile.showProfileErrors(svgProfileLandscape.mErrorModels,aErrorPopupText,aErrorAddTxt);}},500);};FlightProfile.showProfileErrors=function(aErrorModels,aErrorPopupText,aErrorAddTxt){if(AWUtils.isArray(aErrorModels)===false){return;}if(aErrorModels.length<=0){return;}if(AWUtils.isNotEmptyString(aErrorPopupText)===true){JQMUtil.showInfoMsg(aErrorPopupText,true);}if(AWUtils.isNotEmptyString(aErrorAddTxt)===true){FlightProfile.setProfileAdditionalErrorText(aErrorAddTxt,true);}};FlightProfile.setProfileAdditionalText=function(aText){if(AWUtils.isUndefinedOrIsNull(aText)===true||AWUtils.isString(aText)===false){aText='';}JQ('.profile-additional-text').text(aText);};FlightProfile.setProfileAdditionalErrorText=function(aText){if(AWUtils.isUndefinedOrIsNull(aText)===true||AWUtils.isString(aText)===false){aText='';}JQ('.profile-additional-error-text').text(aText);};var WeatherCode={THUNDERSTORMS:"thunderstorms",FOG:"fog",SNOW:"snow",PRECIPITATIONS:"precipitations",WIND:"wind"};var MetarCloudCode={SKC:"No cloud",CLR:"No clouds below 12,000 ft",NSC:"No significant cloud",FEW:"Few",SCT:"Scattered",BKN:"Broken",OVC:"Overcast",VV:"See Vertical Visibility"};function getDecodedMetarDescription(metar){var retVal=JQ('<span class="decoded-metar-info"></span>');if(metar!==undefined){var windDir=(metar.windDir!==undefined&&metar.windDir.length>0)?metar.windDir:null;var windGust=(metar.windGust!==undefined&&metar.windGust.length>0)?", gusts up to "+HtmlUtils.encodeForHTML(metar.windGust):"";windDir=(AWUtils.isNumber(windDir))?AWUtils.addLeadingZero(windDir,3)+" ":(windDir!==null)?HtmlUtils.encodeForHTML(windDir)+" ":"";retVal.append("Date: "+HtmlUtils.encodeForHTML(metar.datetime));retVal.append("<br>");retVal.append("Visibility: "+HtmlUtils.encodeForHTML(metar.visibility)+"m");retVal.append("<br>");retVal.append("Wind: "+windDir+HtmlUtils.encodeForHTML(metar.windSpeed)+windGust);retVal.append("<br>");retVal.append("Temperature: "+HtmlUtils.encodeForHTML(metar.temperature)+"C / Dew point: "+HtmlUtils.encodeForHTML(metar.dewpoint)+"C");retVal.append("<br>");retVal.append("Clouds: ");if(JQ.isArray(metar.cloud)){JQ.each(metar.cloud,function(idx,cloud){retVal.append(getMetarCloudDescription(cloud));if(idx<metar.cloud.length-1){retVal.append(" / ");}});}else{retVal.append(getMetarCloudDescription(metar.cloud));}retVal.append("<br>");retVal.append("Significant Weather: ");if(JQ.isArray(metar.weather)){retVal.append(metar.weather.join(", "));}else{retVal.append(HtmlUtils.encodeForHTML(metar.weather));}}return retVal;};function getMetarCloudDescription(cloud){var retVal=JQ('<span class="metar-cloud-info"></span>');if(cloud!==undefined){var height=(cloud.height!==undefined)?", "+HtmlUtils.encodeForHTML(cloud.height):"";retVal.append(MetarCloudCode[cloud.type]+height);}return retVal;}function MeteoAdCoordList(){this.list=new Array();var _instance=this;this.add=function(meteo){this.list.push(meteo);};this.init=function(jsonObject){if(jsonObject!==undefined&&jsonObject.MeteoAdCoord!==undefined){var fObj=jsonObject.MeteoAdCoord;if(fObj instanceof Array){JQ.each(fObj,function(index,value){_instance.add(value);});}else{_instance.add(fObj);}}};this.size=function(){return this.list.length;};this.at=function(index){return this.list[index];};this.getMeteoForAd=function(ad_code){var retVal=null;JQ.each(this.list,function(index,meteo){if(meteo.getAd_code()===ad_code){retVal=meteo;return false;}});return retVal;};}function JQMUtil(){}jQuery.fn.loading=function(enabled,glass){this.toggleClass("ui-loading",enabled);if(enabled){let obj=this;const loader=JQ('<div class="ui-loader ui-loader-default"><span class="ui-icon-loading"></span></div>');if(glass){const glassObj=JQ('<div class="div-glass">');this.append(glassObj);obj=glassObj;}obj.append(loader);}else{this.find(".div-glass").remove();this.find("div.ui-loader").remove();}};jQuery.fn.buttonVisible=function(visible){if(visible){this.closest(".ui-btn").show();}else{this.closest(".ui-btn").hide();}};function showFlightList(data,listObject){listObject=(typeof listObject==="string")?JQ(listObject):listObject;if(data===null){return;}for(var i=0;i<data.size();i++){var flight=data.at(i);if(isUndefinedOrIsNullOrIsEmptyArray(flight)){continue;}var listItem=createFlightListItem(flight);if(isUndefinedOrIsNull(listItem)){continue;}listObject.append(listItem);}listObject.listview("refresh");};function createFlightListItem(flight){var li=JQ('<li></li>');if(!isUndefinedOrIsNull(flight)){var route=flight.getRoute();var etdTime=flight.getEtd();var etdDate=new Date((etdTime*60*1000));var dof=new Date(flight.getDof());li.data('flight',flight);li.append("<h2>"+HtmlUtils.encodeForHTML(flight.getPic())+"</h2>");li.append("<div class='flight-list-rtname'>"+HtmlUtils.encodeForHTML(route.getName())+"</div>");li.append("<div class='flight-list-adep-ades'>"+HtmlUtils.encodeForHTML(flight.getAdep().getName())+" - "+HtmlUtils.encodeForHTML(flight.getAdes().getName())+"</div>");li.append("<p class='ui-li-aside'>"+HtmlUtils.encodeForHTML(dof.toLocaleDateString())+' '+etdDate.getUTCHours()+":"+AWUtils.addLeadingZero(etdDate.getUTCMinutes(),2)+"</p>");li.append("<div class='flight-list-status status-value-"+HtmlUtils.encodeForHTMLAttribute(flight.getxstat())+"'></div>");}return li;};function showPopupMsg(aMessageObject,aIsError,aIsSoft,aCallbackFnc){closePopupMsg();var popupDiv=JQ('<div data-dismissible="false" data-role="popup" data-theme="a" data-overlay-theme="b" data-position-to="origin" class="closePopup" id="popupMsg"></div>');var closeBtnText=JQ.i18n._('InfoMessage.closeBtn');var closeBtn=JQ('<button class="ui-btn ui-corner-all">'+closeBtnText+'</button>');closeBtn.click(function(){popupDiv.popup("close");popupDiv.popup("destroy");if(!isUndefinedOrIsNull(aCallbackFnc)&&typeof aCallbackFnc==="function"){setTimeout(function(){aCallbackFnc(popupDiv);popupDiv.remove();},100);}else{popupDiv.remove();}closePopupMsg();});popupDiv.append(aMessageObject);popupDiv.append(closeBtn);if(closeBtn!==null){closeBtn.focus();}popupDiv.popup({positionTo:JQ.mobile.activePage});popupDiv.trigger("create");popupDiv.popup("open");}function closePopupMsg(){JQ("#popupMsg").remove();JQ("#popupMsg-popup").remove();}JQMUtil.closePopup=function(popup){popup.popup("close");popup.popup("destroy");JQ("#popupMsg").remove();JQ("#popupMsg-popup").remove();};JQMUtil.toStringOrEmpty=function(aElement){var rv=HtmlUtils.C_EMPTY;try{if(AWUtils.isUndefinedOrIsNullOrIsEmptyString(aElement)===true){rv=HtmlUtils.C_EMPTY;}else if(AWUtils.isObject(aElement)===true){if(aElement.hasOwnProperty('__text')===false){rv=HtmlUtils.C_EMPTY;}else{rv=aElement.toString();}}else{rv=aElement.toString();}}catch(e){}return rv;};JQMUtil.showInfoMsg=function(message,isError,isSoft,callbackFnc){var popupDiv=JQ('<div data-dismissible="false" data-role="popup" data-theme="a" data-overlay-theme="b" data-position-to="origin" class="closePopup" id="infoMessagePopup">');var msgTag=JQ('<p class="info-message-text">');var closeBtn=null,oldPopup;var showFnc;if(typeof isError==="function"){callbackFnc=isError;isError=false;}if(isUndefinedOrIsNull(isSoft)&&typeof message!=="object"&&isError===false){isSoft=true;}if(typeof isSoft==="function"){callbackFnc=isSoft;isSoft=!isError;}popupDiv.append(msgTag);if(isSoft){var timeout=getConfigValue("warningTimeout",4);if(timeout>120){timeout=120;}else if(timeout<1){timeout=1;}timeout*=1000;setTimeout(function(){popupDiv.popup().popup("close");popupDiv.popup("destroy");popupDiv.remove();JQ("#infoMessagePopup").remove();JQ("#infoMessagePopup-popup").remove();},timeout);}else{var closeBtnText=JQ.i18n._('InfoMessage.closeBtn');closeBtn=JQ('<button class="ui-btn ui-corner-all">'+closeBtnText+'</button>');popupDiv.append(closeBtn);closeBtn.click(function(){popupDiv.popup("close");});}if(typeof message==="string"){message=message.replaceAll("<br>","\n");message=message.replaceAll("<br/>","\n");msgTag.text(message);debug(((isError)?"Error popup: ":"Info popup: ")+message);}else if(typeof message==="object"&&message.text){var detailsBtnText=JQ.i18n._('InfoMessage.detailsBtn.show');var detailsBtn=JQ('<button class="ui-btn ui-corner-all">'+detailsBtnText+'</button>');var detailsDiv=JQ('<div class="rs-info-details">');if(message.details instanceof Array){var detailsUl=JQ("<ul data-role='listview' data-inset='true'>");JQ.each(message.details,function(idx,detail){var li=JQ("<li>");li.append(detail);detailsUl.append(li);});detailsDiv.append(detailsUl);detailsUl.listview();}else{detailsDiv.html(message.details);}message.text=message.text.replace("<br>","\n");msgTag.text(message.text);debug(((isError)?"Error popup: ":"Info popup: ")+message.text);if(message.detailsOn===undefined||message.detailsOn===false){detailsDiv.hide();}else{detailsBtn.text(JQ.i18n._('InfoMessage.detailsBtn.hide'));}popupDiv.append(detailsBtn);popupDiv.append(detailsDiv);detailsBtn.click(function(){detailsDiv.toggle();if(detailsDiv.is(":visible")){detailsBtn.text(JQ.i18n._('InfoMessage.detailsBtn.hide'));}else{detailsBtn.text(JQ.i18n._('InfoMessage.detailsBtn.show'));}popupDiv.popup("reposition",{positionTo:'window'});});}if(isError){popupDiv.addClass("alert-field");}showFnc=function(){if(popupDiv.hasClass("ui-popup")===false){popupDiv.popup({positionTo:JQ.mobile.activePage});}popupDiv.popup("open");if(closeBtn!==null){closeBtn.focus();}};popupDiv.on("popupafterclose",function(e,ui){if(popupDiv.attr("data-still-alive")!=="1"){if(!isUndefinedOrIsNull(callbackFnc)&&typeof callbackFnc==="function"){callbackFnc.apply();}popupDiv.popup("destroy");popupDiv.remove();}});oldPopup=JQ("#infoMessagePopup.ui-popup:not([data-still-alive])");if(oldPopup.length>0){oldPopup.attr("data-still-alive","1");oldPopup.popup("close");AWUtils.invokeLater(function(){popupDiv.on("popupafterclose",function(e,ui){oldPopup.attr("data-still-alive","0");if(oldPopup.hasClass("ui-popup")){AWUtils.invokeLater(function(){oldPopup.popup("open");});}else{oldPopup.remove();}});AWUtils.invokeLater(function(){showFnc();});});}else{showFnc();}return popupDiv;};function OptionElement(aID,aText){this.id=aID;this.text=aText;}JQMUtil.showOptionMsgFormated=function(aMessage,aOptionsArray,aCallbackFnc,aElementOptionsMap){if(AWUtils.isUndefinedOrIsNull(aElementOptionsMap)===true){aElementOptionsMap={};}var popupDiv=JQMUtil.createOptionMsgPanel(aMessage,aOptionsArray,aCallbackFnc);for(iAttrName in aElementOptionsMap){var iAttrValue=aElementOptionsMap[iAttrName];if(iAttrName==='class'){popupDiv.addClass(iAttrValue);}else{popupDiv.attr(iAttrName,iAttrValue);}}JQMUtil.openPopupDiv(popupDiv);JQMUtil.focusOnFirstButton(popupDiv);};JQMUtil.showOptionMsg=function(aMessage,aOptionsArray,aCallbackFnc){var msgPanelDiv=JQMUtil.createOptionMsgPanel(aMessage,aOptionsArray,aCallbackFnc);JQMUtil.openPopupDiv(msgPanelDiv);JQMUtil.focusOnFirstButton(msgPanelDiv);};JQMUtil.focusOnFirstButton=function(popupDiv){var optionButton=popupDiv.find('input[type="button"]').first();if(optionButton!==null){optionButton.focus();}};JQMUtil.openPopupDiv=function(popupDiv){JQ.mobile.activePage.append(popupDiv);popupDiv.trigger("create");AWLocale.processLocalisationOnJQElement(popupDiv);popupDiv.popup();popupDiv.popup("open");};JQMUtil.createOptionMsgPanel=function(aMessage,aOptionsArray,aCallbackFnc){var msgTag=HtmlUtils.p({},aMessage);if(HtmlUtils.isString(aMessage)===true){msgTag.attr(AWLocale.LOCALISATION_KEY,aMessage);}msgTag.attr('class','info-message-text');var popupDiv=JQ('<div data-dismissible="false" data-role="popup" data-theme="a" data-overlay-theme="b" class="closePopup" id="optionMessagePopup"></div>');popupDiv.append(msgTag);var closeFunction=function(){popupDiv.popup("close");popupDiv.popup("destroy");popupDiv.remove();JQ("#optionMessagePopup").remove();};if(JQ.isArray(aOptionsArray)&&aOptionsArray.length>0){var optsArea=JQ('<div class="optionMessagePopup_options">');for(var i=0;i<aOptionsArray.length;i++){var iOption=aOptionsArray[i];if(isUndefinedOrIsNull(iOption)===true){continue;}var optionButton=createButton(iOption.text,iOption.id,function(){closeFunction();if(isUndefinedOrIsNull(aCallbackFnc)===false){var buttonID=JQ(this).attr('id');aCallbackFnc(buttonID);}});optsArea.append(optionButton);}popupDiv.append(optsArea);}return popupDiv;};JQMUtil.yesOption=new OptionElement('yesOption','Common.yes');JQMUtil.noOption=new OptionElement('noOption','Common.no');JQMUtil.okOption=new OptionElement('okOption','Common.ok');JQMUtil.cancelOption=new OptionElement('cancelOption','Common.cancel');JQMUtil.saveAsOption=new OptionElement('saveAsOption','Common.saveAs');JQMUtil.confirmAndSendOption=new OptionElement('confirmAndSendOption','Common.confirmAndSend');JQMUtil.backOption=new OptionElement('backOption','Common.back');JQMUtil.createRangeSlider=function(id,min,max,step,defaultMin,defaultMax){var retVal=JQ('<div data-role="rangeslider" data-defaults="true"></div>');var lowerInput=JQ('<input type="range" data-highlight="true">');var upperInput=JQ('<input type="range" data-highlight="true">');defaultMin=defaultMin||min;defaultMax=defaultMax||max;retVal.attr('id',id);lowerInput.attr("id",id+"_lower");lowerInput.attr("min",min);lowerInput.attr("max",max);lowerInput.attr("step",step);lowerInput.attr("value",defaultMin);upperInput.attr("id",id+"_upper");upperInput.attr("min",min+step);upperInput.attr("max",max);upperInput.attr("step",step);upperInput.attr("value",defaultMax);retVal.append(lowerInput);retVal.append(upperInput);retVal.on("rangeslidercreate",function(o,i){AWUtils.invokeLater(function(){retVal.rangeslider("refresh");},null,800);});return retVal;};JQMUtil.addSideLabelToElement=function(localeKey,element,intoElement){var retVal=JQ('<div class="ui-field-contain">');var firstInput=element.find("input").first();var label=JQ('<label>');if(firstInput.attr('id')){label.attr('id',"label_"+firstInput.attr('id'));}label.attr(AWLocale.LOCALISATION_KEY,localeKey);label.text(HtmlUtils.encodeForHTML(localeKey));if(intoElement===true){element.append(label);}else{retVal.append(label);}retVal.append(element);return retVal;};JQMUtil.createInputElement=function(type,name,value,localeKeyPrefix,customLabelClass,id){var input=JQ('<input>');var label=JQ('<label>');id=HtmlUtils.encodeForHTMLAttribute(id);type=HtmlUtils.encodeForHTMLAttribute(type);name=HtmlUtils.encodeForHTMLAttribute(name);value=HtmlUtils.encodeForHTMLAttribute(value);localeKeyPrefix=HtmlUtils.encodeForHTMLAttribute(localeKeyPrefix);customLabelClass=HtmlUtils.encodeForHTMLAttribute(customLabelClass);input.attr('type',type);input.attr('name',name);if(value){input.attr('value',value);if(id.length===0){id=(name+'_'+value);}}input.attr('id',id);label.attr('for',id);if(localeKeyPrefix&&localeKeyPrefix.length>0){localeKeyPrefix=(value)?localeKeyPrefix+'.'+value:localeKeyPrefix;label.attr(AWLocale.LOCALISATION_KEY,localeKeyPrefix);}else{label.text(value);}if(customLabelClass&&customLabelClass.length>0){label.addClass(customLabelClass);}return[input,label];};JQMUtil.createRadioElement=function(name,value,localeKeyPrefix,customLabelClass,id){return JQMUtil.createInputElement("radio",name,value,localeKeyPrefix,customLabelClass,id);};JQMUtil.createCheckboxElement=function(name,value,localeKeyPrefix,customLabelClass,id){return JQMUtil.createInputElement("checkbox",name,value,localeKeyPrefix,customLabelClass,id);};JQMUtil.createSelectElement=function(id,localeKey,customLabelClass,dataAttributes){const label=JQ('<label for="'+id+'">');const select=JQ('<select id="'+id+'">');label.attr(AWLocale.LOCALISATION_KEY,localeKey);if(typeof customLabelClass==="object"){dataAttributes=customLabelClass;customLabelClass=undefined;}if(customLabelClass){label.addClass(customLabelClass);}if(dataAttributes){for(name in dataAttributes){select.attr(name,dataAttributes[name]);}}return[label,select];};JQMUtil.setReadonlyInputs=function(element,ids){JQ.each(ids,function(idx,elemId){var e;if(typeof elemId==="string"){e=element.find('#'+elemId);}else if(typeof elemId==="object"){e=JQ(elemId);}if(e instanceof jQuery&&e.length>0){if(e.is("select")){e.selectmenu().selectmenu('disable');}else if(e.is(":button")){e.button().button('disable');}else if(e.is(":checkbox")||e.is(":radio")){e.checkboxradio().checkboxradio('disable');}else if(e.is("fieldset")){JQMUtil.setReadonlyInputs(e,e.find("input"));}else{e.prop('readonly',true);}}});};JQMUtil.createFeatureLabel=function(callback){var featureNamePopup=JQ('<div data-dismissible="false" data-role="popup" data-theme="a" data-overlay-theme="b" class="closePopup" id="featureNamePopup">Enter Feature Name</div>');var nameField=JQ('<input value="" type="text"></input>');var confirmBtn=JQ('<button>');var cancelBtn=JQ('<button>');var finish=function(name){featureNamePopup.popup("close");callback(name);};confirmBtn.attr(AWLocale.LOCALISATION_KEY,"FeatureNamePanel.confirmBtn");cancelBtn.attr(AWLocale.LOCALISATION_KEY,"Common.cancel");nameField.change(function(){AWUtils.disableSpecialCharsInUserRequest(JQ(this));});featureNamePopup.text(getLocalizedString("FeatureNamePanel.title"));featureNamePopup.append(nameField);featureNamePopup.append(confirmBtn);featureNamePopup.append(cancelBtn);if(!isUndefinedOrIsNull(callback)){confirmBtn.click(function(){finish(nameField.val());});cancelBtn.click(function(){finish();});featureNamePopup.on('keydown',function(e){if(e.keyCode===27){finish();}else if(e.keyCode===13){finish(nameField.val());}});}JQ.mobile.activePage.append(featureNamePopup);featureNamePopup.trigger("create");AWLocale.processLocalisationOnJQElement(featureNamePopup);featureNamePopup.popup();featureNamePopup.popup("open");nameField.focus();};JQMUtil.createGpsLocationName=function(latLon,callback,defaultName){const gpsNamePopup=JQ('<div data-dismissible="false" data-role="popup" data-theme="a" data-overlay-theme="b" class="closePopup" id="gpsNamePopup">');const pointName=JQ('<input id="pointNameInput" value="" type="text" />');const label=JQ("<span>");const btnGroup=JQ('<div id="gpsNamePopupButtonGroup">');const confirmButton=JQ('<input id="confirmButton" type="button" value="Confirm" />');const cancelButton=JQ('<input id="cancelButton" type="button" value="Cancel" />');const msgArea=JQ('<div class="saveMessage">');const saveDiv=JQ('<div id="saveGpsToProfile" data-role="collapsible" data-inset="true" data-collapsed="true">');const saveRemark=JQ('<input id="nameField" value="" type="text" />');const saveButton=JQ('<input id="gpsNamePopupSaveButton" type="button" value="Save" />');const nameHint=JQ('<div id="gpsNamePopupNameHint">');if(HtmlUtils.isUndefinedOrIsNull(latLon)===false){defaultName=defaultName||AwCoordinates.formatLonLat(latLon,AwCoordinates.FORMAT.DD_ddd," ");defaultName="COORD_"+defaultName;pointName.val(defaultName).select();}AWLocale.localizeJqElement(label,"LocationNamePanel.title");nameHint.attr(AWLocale.LOCALISATION_KEY,"LocationNamePanel.nameHint");pointName.attr('placeholder',getLocalizedString("LocationNamePanel.pointName"));pointName.change(function(){AWUtils.disableSpecialCharsInUserRequest(JQ(this));});gpsNamePopup.append(label);gpsNamePopup.append(pointName);saveButton.val(getLocalizedString("LocationNamePanel.saveBtn"));saveRemark.attr('placeholder',getLocalizedString("LocationNamePanel.saveRemark"));confirmButton.val(getLocalizedString("LocationNamePanel.confirmBtn"));cancelButton.val(getLocalizedString("LocationNamePanel.cancelBtn"));msgArea.hide();saveDiv.append("<h3>"+getLocalizedString("LocationNamePanel.saveBtn")+"</h3>");saveDiv.append(saveRemark);saveDiv.append(msgArea);saveDiv.append(saveButton);if(defaultName===undefined||defaultName.length===0){saveDiv.collapsible().collapsible('disable');nameHint.show();}else{nameHint.hide();}btnGroup.append(confirmButton);btnGroup.append(cancelButton);gpsNamePopup.append(btnGroup);gpsNamePopup.append(saveDiv);gpsNamePopup.append(nameHint);saveButton.click(function(){var lonLatStr=AwCoordinates.formatLonLat(latLon,AwCoordinates.FORMAT.DD_ddd," ");var pointNameVal=pointName.val();if(getConfigValue("forceUppercaseInput",false)){pointNameVal=pointNameVal.toUpperCase();}gpsNamePopup.loading(true,true);AWDataHandler.addUserPoint(pointNameVal,latLon.lat,latLon.lon,lonLatStr,saveRemark.val(),function(pointId){gpsNamePopup.loading(false);pointId=parseInt(pointId);if(pointId===-2){msgArea.text(getLocalizedString("LocationNamePanel.msg.dbFullMsg"));msgArea.addClass("alert-field");}else if(pointId===0){msgArea.text(getLocalizedString("LocationNamePanel.msg.updated"));msgArea.removeClass("alert-field");}else if(pointId>-1){msgArea.text(getLocalizedString("LocationNamePanel.msg.saved"));msgArea.removeClass("alert-field");}else{msgArea.text(getLocalizedString("LocationNamePanel.msg.error"));msgArea.addClass("alert-field");}msgArea.fadeIn(1000);setTimeout(function(){msgArea.fadeOut(1000);if(pointId>-1){saveDiv.collapsible('collapse');saveDiv.collapsible('disable');}},5000);});});confirmButton.click(function(){var name=pointName.val();var dialog=JQ("#gpsNamePopup");if(getConfigValue("forceUppercaseInput",false)){name=name.toUpperCase();}dialog.popup("close");dialog.popup("destroy");dialog.remove();callback(name);});cancelButton.click(function(){var dialog=JQ("#gpsNamePopup");dialog.popup("close");dialog.popup("destroy");dialog.remove();});pointName.on("keyup",function(e){if(e.keyCode===13){confirmButton.focus();confirmButton.trigger("click");}else if(this.value.length>2){saveDiv.collapsible('enable');nameHint.hide();}else{saveDiv.collapsible('disable');saveDiv.collapsible('collapse');nameHint.show();}});gpsNamePopup.popup({positionTo:JQ.mobile.activePage});gpsNamePopup.trigger("create");AWLocale.processLocalisationOnJQElement(gpsNamePopup);gpsNamePopup.popup("open");pointName.focus();};JQMUtil.createSwitchBar=function(){const switchBar=JQ('<div class="switch-bar">');const switchBarGrp=JQ('<fieldset data-role="controlgroup" data-type="horizontal" data-mini="true">');const createElement=function(id,localeKey,action){const retVal=[];const chkbox=JQ('<input type="checkbox">');const label=JQ('<label>');const img=JQ('<div class="image">');chkbox.attr('id',id);label.attr('for',id);label.append(img);chkbox.click(action);AWUtils.addLocalizedTooltip(label,"SwitchBar."+localeKey);retVal.push(chkbox);retVal.push(label);return retVal;};const worldwideBtnAction=function(e){var b=JQ(this).is(":checked");AppController.userPrefs.setValue("worldwideSearch",b,AwUserPreferences.TYPE.BOOL);return false;};const graticuleBtnAction=function(e){var b=JQ(this).is(":checked");AppController.aisWeb.showGraticule(b);AppController.userPrefs.setValue("graticule",b,AwUserPreferences.TYPE.BOOL);return false;};if(FunctionsController.isFunctionEnabled("flightlog")&&AppController.bundleController.isBundleConfigured("flightlog")){const plotBtnAction=function(e){var b=JQ(this).is(":checked");AppController.controlPanel.getFlightPlanController().refreshRoutes();AppController.userPrefs.setValue("plotting",b,AwUserPreferences.TYPE.BOOL);return false;};switchBarGrp.append(createElement("plotSwitchBtn","plotting",plotBtnAction));}switchBarGrp.append(createElement("worldwideSwitchBtn","worldWide",worldwideBtnAction));if(FunctionsController.isFunctionEnabled("rangeCircles")){const rangeCirclesBtnAction=function(e){var obj=JQ(this);var b=obj.is(":checked");var flogPanel=JQ("#flightPlanPanel");if(flogPanel.length>0){AppController.controlPanel.getFlightPlanController().setupRangeCircles(b);return false;}if(b){var panel=new RangeCirclesPanel();var winMan=AppController.controlPanel.getWindowManager();var form=winMan.createForm("rangeCirclesTool","RangeCircles.title",panel.createPanelContent());obj.data('form',form);winMan.showForm(form,AwWinMan.AREA.LEFT);form.on(RsForm.EVENTS.CLOSE,function(){obj.attr("checked",false).checkboxradio("refresh");AppController.aisWeb.setupRangeCircles(false);});JQ(panel).on("preferenceschanged",function(event,settings){AppController.userPrefs.setValue("rangeCircles",settings,AwUserPreferences.TYPE.JSON);});JQ(panel).on("settingschanged",function(event,settings){var speed=AWUtils.calculateSpeed(settings.speedValue,settings.speedUnit);var time=parseInt(settings.time)*60;var timeArc=parseInt(settings.timeArc);AppController.aisWeb.setupRangeCircles(true,speed,time,timeArc);});}else{var form=obj.data('form');form.hide();}return false;};switchBarGrp.append(createElement("rangeCirclesSwitchBtn","rangeCircles",rangeCirclesBtnAction));}switchBarGrp.append(createElement("graticuleSwitchBtn","graticule",graticuleBtnAction));switchBar.append(switchBarGrp);return switchBar;};addMinutesToDateTime=function(aDateObject,aMinutes){if(isUndefinedOrIsNull(aDateObject)||isUndefinedOrIsNull(aMinutes)){return aDateObject;}var milisecs=convertMinutesToMilisec(aMinutes);var addingDateTime=new Date(milisecs);return addDateTimeFromEpoch(aDateObject,addingDateTime);};convertHHMM2Minutes=function(aHHMMString){if(HtmlUtils.isUndefinedOrIsNullOrIsEmptyString(aHHMMString)===true||aHHMMString.length<4){return aHHMMString;}var HH=aHHMMString.substring(0,2);HH=parseInt(HH);var MM=aHHMMString.substring(2);MM=parseInt(MM);var retVal=(HH*60)+MM;return retVal;};addDateTimeFromEpoch=function(aDateObject,aAddingDateTime){if(isUndefinedOrIsNullOneOf([aDateObject,aAddingDateTime])){return aDateObject;}var dateTimeFromEpoch=aDateObject.getTime();var addingDateTimeFromEpoch=aAddingDateTime.getTime();var retVal=new Date(dateTimeFromEpoch+addingDateTimeFromEpoch);return retVal;};convertMinutesToMilisec=function(aMinutes){if(isUndefinedOrIsNullOrIsEmptyString(aMinutes)===true){return aMinutes;}var minNum=new Number(aMinutes);var seconds=convertMinutesToSec(minNum);return convertSecToMilisec(seconds);};convertMinutesToSec=function(aMinutes){if(isUndefinedOrIsNullOrIsEmptyString(aMinutes)===true){return aMinutes;}var retVal=(new Number(aMinutes))*60;return retVal;};convertSecToMilisec=function(aSeconds){if(isUndefinedOrIsNullOrIsEmptyString(aSeconds)===true){return aSeconds;}var retVal=(new Number(aSeconds))*1000;return retVal;};parseFplRegValue=function(aFlOtherString){if(isUndefinedOrIsNull(aFlOtherString)===true){return'';}var splitedOther=aFlOtherString.toUpperCase().split('REG/');if(isUndefinedOrIsNullOrIsEmptyArray(splitedOther)===true||splitedOther.length<2||isUndefinedOrIsNullOrIsEmptyString(splitedOther[1])){return'';}var splitedReg=splitedOther[1].split(' ');if(isUndefinedOrIsNullOrIsEmptyArray(splitedReg)===true||splitedReg.length<1){return'';}return splitedReg[0];};setDateTimeFromValue=function(aDateFilterElement,aTimeFilterElement,aDate,aSetUTC){if(isUndefinedOrIsNullOrIsEmptyString(aDate)){return;}if(isUndefinedOrIsNull(aSetUTC)===true){aSetUTC=true;}if(isUndefinedOrIsNull(aDateFilterElement)===false){var year=(aSetUTC===true?aDate.getUTCFullYear():aDate.getFullYear());var month=zeroPad(((aSetUTC===true?aDate.getUTCMonth():aDate.getMonth())+1),2);var day=zeroPad((aSetUTC===true?aDate.getUTCDate():aDate.getDate()),2);aDateFilterElement.val(year+'-'+month+'-'+day);}if(isUndefinedOrIsNull(aTimeFilterElement)===false){var hourValue=zeroPad((aSetUTC===true?aDate.getUTCHours():aDate.getHours()),2);var minuteValue=zeroPad((aSetUTC===true?aDate.getUTCMinutes():aDate.getMinutes()),2);aTimeFilterElement.val(hourValue+":"+minuteValue);}};representDateLocaleAsUTC=function(aDate){var retVal=new Date(Date.UTC(aDate.getFullYear(),aDate.getMonth(),aDate.getDate(),aDate.getHours(),aDate.getMinutes(),aDate.getSeconds()));return retVal;};setNotNullComboboxValue=function(aCombobox,aValue){if(isUndefinedOrIsNull(aCombobox)===false&&isUndefinedOrIsNull(aValue)===false){aCombobox.val(aValue).selectmenu('refresh');}};setNotNullTextInputValue=function(aTextInput,aValue){if(isUndefinedOrIsNull(aTextInput)===false&&isUndefinedOrIsNull(aValue)===false){aTextInput.val(aValue);}};setNotNullCheckBoxValue=function(aCheckbox,aValue){if(aValue===null||aValue===''){aValue=false;}if(aCheckbox!==null){aCheckbox.find('input').prop('checked',aValue).checkboxradio('refresh');}};createCheckBox=function(aId,aValue){return JQ("<input name=\""+aId+"\" type=\"checkbox\" id=\""+aId+"\" data-cacheval=\""+aValue+"\">");};createSelectFileButton=function(aText,aId,aOnclickAction){var retVal=JQ('<input value="'+aText+'" type="file" id="'+aId+'">');if(isUndefinedOrIsNull(aOnclickAction)===false){retVal.click(aOnclickAction);}retVal.attr(AWLocale.LOCALISATION_KEY,aText);return retVal;};createButton=function(aText,aId,aOnclickAction){var retVal=JQ('<input value="'+aText+'" type="button" id="'+aId+'">');retVal.click(aOnclickAction);retVal.attr(AWLocale.LOCALISATION_KEY,aText);return retVal;};showFadedAlertElement=function(obj,msg,aFadeInTime,aStayTime,aFadeOutTime){obj.addClass("alert-field");showFadedElement(obj,msg,aFadeInTime,aStayTime,aFadeOutTime);};showFadedElement=function(obj,msg,aFadeInTime,aStayTime,aFadeOutTime){obj.text(msg);obj.removeClass("ui-screen-hidden");obj.fadeIn(aFadeInTime);setTimeout(function(){obj.fadeOut(aFadeOutTime,function(){obj.text("");obj.removeClass("alert-field");obj.addClass("ui-screen-hidden");});},aStayTime);};fillNotNullFromComboboxValue=function(aCombobox,aParameterName,aFilter){if(aCombobox!==null&&aParameterName!==null&&aFilter!==null){aFilter[aParameterName]=aCombobox.val();}};createCombobox=function(aId,aItems){var retVal=JQ('<select name="'+aId+'-select" id="'+aId+'-select">');fillComboboxWithValues(retVal,aItems);return retVal;};fillComboboxWithValues=function(aCombobox,aItems){if(aItems instanceof Array){aItems={};}for(var value in aItems){var iOpiton=JQ('<option value="'+value+'">'+aItems[value]+'</option>');aCombobox.append(iOpiton);}};AllHeightUnits={'VFR':'VFR','A':'A','F':'F','S':'S','M':'M','GND':'GND','UNL':'UNL'};AllHeightFormats={'VFR':0,'A':3,'F':3,'S':4,'M':4,'GND':0,'UNL':0};HeightUnits=[AllHeightUnits.VFR,AllHeightUnits.A,AllHeightUnits.F,AllHeightUnits.S,AllHeightUnits.M];AreaHeightUnitsFrom=[AllHeightUnits.GND,AllHeightUnits.F,AllHeightUnits.A,AllHeightUnits.S,AllHeightUnits.M];AreaHeightUnitsTo=[AllHeightUnits.UNL,AllHeightUnits.F,AllHeightUnits.A,AllHeightUnits.S,AllHeightUnits.M];createAreaAltitudeFromInputDiv=function(aElementId,aLabelName){return JQMUtil.createGeneralAltitudeInputDiv(aElementId,aLabelName,AreaHeightUnitsFrom);};createAreaAltitudeToInputDiv=function(aElementId,aLabelName){return JQMUtil.createGeneralAltitudeInputDiv(aElementId,aLabelName,AreaHeightUnitsTo);};createAltitudeInputDiv=function(aElementId,aLabelName){return JQMUtil.createGeneralAltitudeInputDiv(aElementId,aLabelName,HeightUnits);};JQMUtil.createGeneralAltitudeInputDiv=function(aElementId,aLabelName,aHeightUnitsArray){var inputDiv=divGridA(null);var heightTextField=createTextInput('',(aElementId+'-input'));heightTextField.attr('maxlength','4');var unitSelect=JQ('<select name="'+aElementId+'-select" id="'+aElementId+'-select">');for(var i=0;i<aHeightUnitsArray.length;i++){var iOpiton=JQ('<option value="'+i+'">'+aHeightUnitsArray[i]+'</option>');unitSelect.append(iOpiton);}var blockA=divBlockA(unitSelect);blockA.addClass('altitudeInputBox');inputDiv.append(blockA);inputDiv.append(divBlockB(heightTextField));var label=createLabel(aLabelName,aElementId);label.css('margin','0');return twoRowedDivGridSolo(label,inputDiv);};setAreaAltitudeFromInputValue=function(aElementId,aValue){JQMUtil.setGeneralAltitudeInputValue(aElementId,aValue,AreaHeightUnitsFrom);};setAreaAltitudeToInputValue=function(aElementId,aValue){JQMUtil.setGeneralAltitudeInputValue(aElementId,aValue,AreaHeightUnitsTo);};setAltitudeInputValue=function(aFilterID,aValue){JQMUtil.setGeneralAltitudeInputValue(aFilterID,aValue,HeightUnits);};JQMUtil.setGeneralAltitudeInputValue=function(aAltitudeElementId,aValue,aHeightUnitArray){if(isUndefinedOrIsNull(aValue)){return;}var flFilterElement=JQ(("#"+aAltitudeElementId+"-input"));var flUnitElement=JQ(("#"+aAltitudeElementId+"-select"));for(var i=0;i<aHeightUnitArray.length;i++){var iUnit=aHeightUnitArray[i].charAt(0);var iUnitIndex=aValue.indexOf(iUnit);if(iUnitIndex!==-1){flUnitElement.val(i).selectmenu('refresh').trigger("change");flFilterElement.val(zeroPad(aValue.substring(0,iUnitIndex),AllHeightFormats[aHeightUnitArray[i]]));break;}}};findAreaAltitudeFromUnitName=function(aUnit,aDefaultRetVal){return findGeneralAltitudeUnitName(aUnit,aDefaultRetVal,AreaHeightUnitsFrom);};findAreaAltitudeToUnitName=function(aUnit,aDefaultRetVal){return findGeneralAltitudeUnitName(aUnit,aDefaultRetVal,AreaHeightUnitsTo);};findLevelUnitName=function(aUnit,aDefaultRetVal){return findGeneralAltitudeUnitName(aUnit,aDefaultRetVal,HeightUnits);};findGeneralAltitudeUnitName=function(aUnit,aDefaultRetVal,aHeightUnitArray){if(isUndefinedOrIsNull(aDefaultRetVal)===true){aDefaultRetVal=aHeightUnitArray[0];}else{aDefaultRetVal=null;}var retVal=aDefaultRetVal;for(var i=0;i<aHeightUnitArray.length;i++){var iUnitLetter=aHeightUnitArray[i].charAt(0);var iUnitIndex=aUnit.indexOf(iUnitLetter);if(iUnitIndex!==-1){retVal=aHeightUnitArray[i];break;}}return retVal;};getAltitudeValue=function(aAltitudeInputID){var flDownFilterElement=JQ(("#"+aAltitudeInputID+"-input"));return flDownFilterElement.val();};getAreaAltitudeFromUnit=function(aAltitudeInputID){return getGeneralAltitudeUnit(aAltitudeInputID,AreaHeightUnitsFrom);};getAreaAltitudeToUnit=function(aAltitudeInputID){return getGeneralAltitudeUnit(aAltitudeInputID,AreaHeightUnitsTo);};getAltitudeUnit=function(aAltitudeInputID){return getGeneralAltitudeUnit(aAltitudeInputID,HeightUnits);};getGeneralAltitudeUnit=function(aAltitudeInputID,aHeightUnitsArray){var flDownUnitElement=JQ(("#"+aAltitudeInputID+"-select"));return aHeightUnitsArray[flDownUnitElement.val()];};getAltitudeValueWithUnit=function(aAltitudeInputID){return getAltitudeValue(aAltitudeInputID)+""+getAltitudeUnit(aAltitudeInputID);};setAltitudeInputEnablity=function(aFilterID,aEnableValue){if(isUndefinedOrIsNull(aEnableValue)){return;}var flFilterElement=JQ(("#"+aFilterID+"-input"));var flUnitElement=JQ(("#"+aFilterID+"-select"));flFilterElement.textinput(aEnableValue);flUnitElement.selectmenu(aEnableValue);};function LoaderCounter(aLoadingElement,aAfterLoadingFunction){this.loaderCounter=0;var loadingElement=aLoadingElement;var afterLoadingFunction=aAfterLoadingFunction;this.startLoadingOrIncraseCounter=function(){if(this.loaderCounter===0&&isUndefinedOrIsNull(loadingElement)===false){loadingElement.loading(true);}this.loaderCounter++;};this.stopLoadingOrDecraseCounter=function(){if(this.loaderCounter<=1&&isUndefinedOrIsNull(loadingElement)===false){loadingElement.loading(false);}this.loaderCounter--;if(this.loaderCounter<0){this.loaderCounter=0;}};this.runFunctionIfLoadingIsDone=function(){if(this.loaderCounter<=0&&isUndefinedOrIsNull(afterLoadingFunction)===false){afterLoadingFunction();}};}createDateTimeDiv=function(aId,aLabelText,aDatePlaceHolder,aTimePlaceholder,dateTime){if(isUndefinedOrIsNull(aDatePlaceHolder)===true){aDatePlaceHolder='';}if(isUndefinedOrIsNull(aTimePlaceholder)===true){aTimePlaceholder='';}if(isUndefinedOrIsNull(aLabelText)===true){aLabelText='';}var dateID=aId+"_date";var timeID=aId+"_time";var dateTimeLabel=createLabel(aLabelText,aId);var dateDiv=createDateDiv(dateID,'',aDatePlaceHolder,dateTime);var timeDiv=createTimeDiv(timeID,'',aTimePlaceholder,dateTime);var dateTimeDiv=divGridA(null);dateTimeDiv.append(divBlockA(dateDiv));dateTimeDiv.append(divBlockB(timeDiv));var retValDiv=div(null);retValDiv.attr('id',aId);retValDiv.append(dateTimeLabel);retValDiv.append(dateTimeDiv);return retValDiv;};var aisMobileDateTimeClass='aisMobileDateTime';createDateDiv=function(aID,aLabelText,aPlaceHolder,dateTime){var dateLabel=createLabel(aLabelText,aID);var datePicker=createDateInput(aPlaceHolder,aID,dateTime);var retVal=twoRowedDivGridSolo(dateLabel,datePicker);retVal.addClass(aisMobileDateTimeClass);return retVal;};createTimeDiv=function(aId,aLabelText,aPlaceHolder,dateTime){var timeLabel=createLabel(aLabelText,aId);var timePicker=createTimeInput(aPlaceHolder,aId,dateTime);var retVal=twoRowedDivGridSolo(timeLabel,timePicker);retVal.addClass(aisMobileDateTimeClass);return retVal;};createDateInput=function(aPlaceHolder,aId,dateTime){var datePicker=JQ('<input data-role="datebox" data-mini="true" id="'+aId+'" type="text" placeholder="'+aPlaceHolder+'"></input>');var opts={mode:"flipbox",centerHoriz:true};if(dateTime!==undefined){opts.defaultValue=[dateTime.getFullYear(),dateTime.getMonth(),dateTime.getDate()];}datePicker.attr("data-options",JSON.stringify(opts));datePicker.attr(AWLocale.LOCALISATION_KEY,aPlaceHolder);return datePicker;};createTimeInput=function(aPlaceHolder,aId,dateTime){var timePicker=JQ('<input data-role="datebox" data-mini="true" id="'+aId+'" type="text" placeholder="'+aPlaceHolder+'"></input>');var opts={mode:"timeflipbox"};if(dateTime!==undefined){opts.defaultValue=[dateTime.getHours(),dateTime.getMinutes()];}timePicker.attr("data-options",JSON.stringify(opts));timePicker.attr(AWLocale.LOCALISATION_KEY,aPlaceHolder);return timePicker;};getDateTimeFromInput=function(aDateInputId,aTimeInputId){var dateFilterElement=JQ(("#"+aDateInputId));var timeFilterElement=JQ(("#"+aTimeInputId));var dateFilterElementVal="";if(!isUndefinedOrIsNull(dateFilterElement)){dateFilterElementVal=dateFilterElement.val();}return new Date(dateFilterElementVal.split('T')[0]+'T'+timeFilterElement.val()+':00+00:00');};JQMUtil.setDateTimeFromValueById=function(aDateInputElementId,aTimeInputElementId,aDate){if(isUndefinedOrIsNullOrIsEmptyString(aDate)){return;}var dateInputElement=JQ(("#"+aDateInputElementId));var timeInputElement=JQ(("#"+aTimeInputElementId));setDateTimeFromValue(dateInputElement,timeInputElement,aDate);};createLabeledColorPickerDiv=function(aId,aLabelText,aColorValue){var label=createLabel(aLabelText,aId);var colorPickerSpan=createColorPicker(aId,aColorValue);return twoRowedDivGridSolo(label,colorPickerSpan);};var colorPickerSuffix='_colorpicker';createColorPicker=function(aId,aColorValue){var retVal=JQ('<input type="color" id="'+aId+colorPickerSuffix+'" value="'+aColorValue+'"/>');return retVal;};setCheckBoxValue=function(aElementId,aValue){if(isUndefinedOrIsNull(aElementId)){return;}if(isUndefinedOrIsNull(aValue)){aValue=false;}var element=JQ('#'+aElementId);setCheckBoxElementValue(element,aValue);};setCheckBoxElementValue=function(aElement,aValue){if(''+aValue==='true'){aElement.prop('checked',true).checkboxradio().checkboxradio('refresh');}else{aElement.prop('checked',false).checkboxradio().checkboxradio('refresh');}};setMultiselectElementValues=function(aElement,aValuesArray){if(isUndefinedOrIsNull(aValuesArray)===true){aValuesArray=[];}aElement.find('option:selected').removeAttr('selected');aElement.val(HtmlUtils.C_EMPTY);aElement.selectmenu().selectmenu(HtmlUtils.C_REFRESH);aElement.val(aValuesArray);aElement.selectmenu().selectmenu(HtmlUtils.C_REFRESH);};convertMinutesToHHMM=function(aMinutes){var retVal=((Math.floor(aMinutes/60)).toString()+HtmlUtils.C_EMPTY+AWUtils.addLeadingZero((aMinutes-Math.floor(aMinutes/60)*60).toString(),2));return retVal;};JQMUtil.setGuiTheme=function(themeClass){themeClass=(typeof themeClass==="string")?themeClass.toLowerCase():"c";JQ("body").removeClass("ui-overlay-a ui-overlay-b  ui-overlay-c").addClass("ui-overlay-"+themeClass);JQ("#aisweb-main-page").removeClass("ui-page-theme-a ui-page-theme-b  ui-page-theme-c").addClass("ui-page-theme-"+themeClass);JQ(".rsys-panel").removeClass("ui-body-a ui-body-b ui-body-c").addClass("ui-body-"+themeClass);JQ(".ui-collapsible-content").removeClass("ui-body-a ui-body-b ui-body-c").addClass("ui-body-"+themeClass);JQ(".ui-input-datebox").removeClass("ui-body-a ui-body-b ui-body-c").addClass("ui-body-"+themeClass);JQ(".ui-listview").removeClass("ui-group-theme-a ui-group-theme-b ui-group-theme-c").addClass("ui-group-theme-"+themeClass);JQ(".ui-header").removeClass("ui-bar-a ui-bar-b ui-bar-c").addClass("ui-bar-"+themeClass);JQMUtil.refreshSelectmenuTheme();return themeClass;};JQMUtil.refreshSelectmenuTheme=function(){var themeClass=this._actualTheme;var dialog=JQ('body > div[data-role="dialog"]');if(dialog.length<=0){return;}var changeSelectmenuThemeClasses=["ui-bar-","ui-body-","ui-group-theme-","ui-page-theme-"];changeSelectmenuThemeClasses.forEach(function(aClassName){var classSelector='[class*="'+aClassName+'"]';var classElements=dialog.find(classSelector).andSelf().filter(classSelector);if(classElements.length<=0){return;}var oldClasses=classElements.attr('class');var newClasses=oldClasses.replace(new RegExp(aClassName+'[a-zA-Z]{1}[ "]',"g"),aClassName+themeClass+" ");classElements.attr('class',newClasses);});};JQMUtil.atLeastOneCheckbox=function(controlgroup){controlgroup.change((e)=>{const chbox=JQ(e.target);if(chbox.is(":checked")===false){if(chbox.closest(".ui-controlgroup-controls").find("input:checked").length===0){chbox.prop("checked",true);}}});};var WarningItem=function(key,addon){this.key=key;this.addon=addon;this.customClass;this.staticAddon=!isUndefinedOrIsNull(addon);this.action=null;this.hover=false;this.setAddon=function(addon){this.addon=addon;};this.setCustomClass=function(aClass){this.customClass=aClass;};this.equals=function(aObj){return(this.key===aObj.key&&(this.staticAddon===false||(this.staticAddon&&this.addon===aObj.addon)));};this.setAction=function(action){if(typeof action==="function"){this.action=action;}};};var WarningBar=function(parentDiv,customClass){this._parentDiv=parentDiv;this._customClass=customClass;this._warningBar=null;this._warningCnt=null;this._warningWin=null;this._warningItems=[];var _ibt=0;var _instance=this;var INITIAL_BLINK_COUNT=6;var INITIAL_BLINK_DELAY=200;const ANIMATION_DURATION=550;this.getWarningBarWidget=function(specialClass){if(this._warningBar===null){this._warningBar=JQ('<div class="warning-bar">');this._warningCnt=JQ('<div class="warning-bar-counter">');this._warningBar.append(this._warningCnt);if(!isUndefinedOrIsNull(specialClass)){this._warningBar.addClass(specialClass);}this._warningBar.hover(()=>{let pos=_instance._warningBar.position();_instance.hover=true;_instance.showWarnings(pos);},()=>{_instance.hover=false;this.hideWarnings();});}return this._warningBar;};this.addWarningItem=function(warningItem){this.removeWarningItem(warningItem);this._warningItems.push(warningItem);this.refreshCounter();this.initialBlink();};this.removeWarningItem=function(warningItem){var warnItemId=this._warningItems.indexOf(warningItem);if(warnItemId===-1){JQ.each(this._warningItems,function(index,wi){if(wi.equals(warningItem)){warnItemId=index;return false;}});}if(warnItemId!==-1){this._warningItems.splice(warnItemId,1);if(this._warningItems.length===0){this.turnOffIcon();}this.refreshCounter();}};this.removeWarningItems=function(warningItemArr){JQ.each(warningItemArr,function(idx,item){_instance.removeWarningItem(item);});};this.getWarningItemsByKey=function(key){var rv=[];JQ.each(this._warningItems,function(idx,item){if(item.key===key){rv.push(item);}});return rv;};this.initialBlink=function(){if(_instance._warningBar.isPeriodicClassActive()===false){_instance._warningBar.periodicClassChange(INITIAL_BLINK_DELAY,'warning-bar-on',INITIAL_BLINK_COUNT,function(){_instance.turnOnIcon();});}};this.turnOnIcon=function(){this._warningBar.addClass("warning-bar-on");};this.turnOffIcon=function(){if(_instance._warningBar.isPeriodicClassActive()){_instance._warningBar.periodicClassChange(0);}this._warningBar.removeClass("warning-bar-on");};this.isIconOn=function(){return this._warningBar.hasClass("warning-bar-on");};this.refreshCounter=function(){if(this._warningItems.length>0){this._warningCnt.text(this._warningItems.length);}else{this._warningCnt.text("");}};this.showWarnings=function(position){if(_instance._warningItems.length>0){if(_instance._warningWin===null){_instance._warningWin=JQ('<div class="warning-bar-window">');if(_instance._customClass){_instance._warningWin.addClass(_instance._customClass);}}else{_instance._warningWin.empty();}JQ.each(_instance._warningItems,function(index,warnItem){var itemDiv=JQ('<div class="warning-bar-item">');var header=JQ('<div class="warning-bar-item-header">');itemDiv.append(header);if(warnItem.addon instanceof jQuery){itemDiv.append(warnItem.addon);}else{var addon=(warnItem.addon)?" "+HtmlUtils.encodeForHTML(warnItem.addon):"";itemDiv.append(getLocalizedString(warnItem.key)+addon);}if(warnItem.customClass){itemDiv.addClass(warnItem.customClass);}_instance._warningWin.append(itemDiv);if(warnItem.action){itemDiv.addClass("warning-bar-actionItem");itemDiv.click(()=>{_instance.hover=false;_instance.hideWarnings();warnItem.action();});}});_instance._parentDiv.append(_instance._warningWin);var window=JQ(".warning-bar-window");var ww=_instance._warningWin.width();var mousex=position.left-(ww/2);var pw=_instance._warningWin.parent().width();if(ww+mousex>pw){mousex=pw-ww;}window.css({left:mousex});_instance._warningWin.fadeIn(ANIMATION_DURATION);_instance._warningWin.hover(()=>{_instance.hover=true;},()=>{_instance.hover=false;this.hideWarnings();});}};this.hideWarnings=function(){AWUtils.invokeLater(()=>{if(_instance._warningWin!==null&&!_instance.hover){_instance._warningWin.fadeOut(ANIMATION_DURATION);_instance._warningWin.remove();_instance._warningWin=null;}},null,350);};};OpenLayers.Control.RangeCircles=OpenLayers.Class(OpenLayers.Control,{EVENT_TYPES:[],size:null,autoActivate:false,allowSelection:true,ranges:null,element:null,lastKnownLonLat:null,lastCoord:null,scheduledScaleUpdating:false,scheduledRedraw:false,lastMoveEvent:null,scheduledOnMove:false,initialize:function(options){this.EVENT_TYPES=OpenLayers.Control.RangeCircles.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);if(!options){options={};}if(!options.size){options.size=new OpenLayers.Size(48,48);}OpenLayers.Control.prototype.initialize.apply(this,[options]);},removeElement:function(){if(this.div!==null&&this.element!==null){this.div.removeChild(this.element);this.element.innerHTML="";delete this.element;this.element=null;}},setupRanges:function(ranges){this.removeElement();if(ranges!==null&&ranges!==undefined&&ranges instanceof Array){this.ranges=ranges;this.element=this.createCircleElement();this.div.appendChild(this.element);if(AWUtils.device.is_mobile()){var ctrl=this;JQ(this.div).on('touchstart',function(e){var coord=ctrl.map.getPixelFromLonLat(ctrl.lastKnownLonLat);ctrl.touchStartDelta={x:coord.x-e.originalEvent.touches[0].clientX,y:coord.y-e.originalEvent.touches[0].clientY};return false;});JQ(this.div).on('touchend',function(e){const coord=ctrl.map.getPixelFromLonLat(ctrl.lastKnownLonLat);ctrl.updateScale(coord);return false;});JQ(this.div).on('touchmove',function(e){var retVal=true;if(e&&e.originalEvent&&e.originalEvent.touches){if(e.originalEvent.touches.length===1){var touch=e.originalEvent.touches[0];e.clientX=touch.clientX+ctrl.touchStartDelta.x;e.clientY=touch.clientY+ctrl.touchStartDelta.y;ctrl.onMove(e);retVal=false;}}return retVal;});}if(!this.lastKnownLonLat){const coord=new OpenLayers.Pixel(this.map.div.clientWidth/2,this.map.div.clientHeight/2);const lonLat=this.map.getLonLatFromPixel(coord);this.lastKnownLonLat=lonLat;}this.redraw(this.map.getPixelFromLonLat(this.lastKnownLonLat));}},activate:function(){if(OpenLayers.Control.prototype.activate.apply(this,arguments)){if(!AWUtils.device.is_mobile()){this.map.events.register('mousemove',this,this.onMove);}this.map.events.register('move',this,this.onMapChange);this.map.events.register('moveend',this,this.onMapChangeEnd);return true;}else{return false;}},deactivate:function(){if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){this.map.events.unregister('mousemove',this,this.onMove);this.map.events.unregister('move',this,this.onMapChange);this.map.events.unregister('moveend',this,this.onMapChangeEnd);this.removeElement();return true;}else{return false;}},redraw:function(position){const svg=this.element;const bbox=svg.getBBox();const refY=Number(svg.getAttributeNS(null,"refY"));const x=position.x-bbox.width/2;const y=position.y-(refY-bbox.y);OpenLayers.Control.prototype.draw.apply(this,[new OpenLayers.Pixel(x,y)]);return this.div;},onMove:function(event){this.lastMoveEvent=event;if(!this.scheduledOnMove){this.scheduledOnMove=true;setTimeout(()=>{const lastCoord=new OpenLayers.Pixel(this.lastMoveEvent.clientX,this.lastMoveEvent.clientY);this.lastKnownLonLat=this.map.getLonLatFromPixel(lastCoord);if(!AWUtils.device.is_mobile()){this.invokeUpdateScale(lastCoord);}this.scheduledOnMove=false;},1000);}this.invokeRedraw();},onMapChange:function(event){const coord=this.map.getPixelFromLonLat(this.lastKnownLonLat);if(AWUtils.device.is_mobile()===false){this.invokeUpdateScale(coord);}this.redraw(coord);},onMapChangeEnd:function(event){const coord=this.map.getPixelFromLonLat(this.lastKnownLonLat);this.invokeUpdateScale(coord);this.redraw(coord);},invokeUpdateScale:function(coord){this.lastCoord=coord;if(!this.scheduledScaleUpdating){this.scheduledScaleUpdating=true;setTimeout(()=>{if(this.active){this.updateScale(this.lastCoord);this.invokeRedraw(this.lastCoord);}this.scheduledScaleUpdating=false;},1000);}},invokeRedraw:function(coord){if(!this.scheduledRedraw){this.scheduledRedraw=true;this.lastCoord=coord||new OpenLayers.Pixel(this.lastMoveEvent.clientX,this.lastMoveEvent.clientY);requestAnimationFrame(()=>{if(this.active){this.redraw(this.lastCoord);}this.scheduledRedraw=false;});}},updateScale:function(coord){this.removeElement();this.element=this.createCircleElement(coord);this.div.appendChild(this.element);},createSvgElement:function(name){return document.createElementNS("http://www.w3.org/2000/svg",name);},createCircleElement:function(coord){var svg=this.createSvgElement("svg");if(this.ranges!==undefined&&this.ranges!==null&&this.ranges instanceof Array&&this.ranges.length>0){var lonLat,bounds;const map=this.map;const projection=map.getProjectionObject();if(coord===undefined){lonLat=map.center;coord=map.getPixelFromLonLat(lonLat);}else{lonLat=map.getLonLatFromPixel(coord);}this.lastKnownLonLat=lonLat;for(let i=0,len=this.ranges.length;i<len;i++){var range=this.ranges[i];var geoRing;if(i===0){geoRing=this.createGeodesicRing(lonLat,0,range.value*1000,projection);var circle=this.createSvgElement("circle");circle.setAttributeNS(null,"cx",coord.x);circle.setAttributeNS(null,"cy",coord.y);circle.setAttributeNS(null,"r","5");circle.setAttributeNS(null,"stroke","blue");circle.setAttributeNS(null,"stroke-width","2");circle.setAttributeNS(null,"stroke-opacity","0.8");circle.setAttributeNS(null,"fill-opacity","0");svg.appendChild(circle);}else{var prevRange=this.ranges[i-1];geoRing=this.createGeodesicRing(lonLat,prevRange.value*1000,range.value*1000,projection);}var ringPath=this.createSvgRingPath(geoRing);svg.appendChild(ringPath.svg);svg.appendChild(this.createLabel(geoRing,range.label));if(i===0){bounds=ringPath.bounds;}else{if(bounds.containsBounds(ringPath.bounds)===false){bounds=ringPath.bounds;}}}var defs=this.createSvgElement("defs");var gradient=this.createSvgElement("radialGradient");var stop1=this.createSvgElement("stop");var stop2=this.createSvgElement("stop");stop1.setAttributeNS(null,"offset","30%");stop1.setAttributeNS(null,"style","stop-color:rgb(210,210,255);stop-opacity:0.2");stop2.setAttributeNS(null,"offset","100%");stop2.setAttributeNS(null,"style","stop-color:rgb(180,180,255);stop-opacity:0.5");gradient.setAttributeNS(null,"id","grad1");gradient.setAttributeNS(null,"cx","50%");gradient.setAttributeNS(null,"cy","50%");gradient.setAttributeNS(null,"r","50%");gradient.setAttributeNS(null,"fx","50%");gradient.setAttributeNS(null,"fy","50%");var offset=2;svg.setAttributeNS(null,"width",bounds.getWidth());svg.setAttributeNS(null,"height",bounds.getHeight());svg.setAttributeNS(null,"viewBox",""+bounds.left+","+bounds.bottom+","+(Math.ceil(bounds.getWidth())+offset)+","+(Math.ceil(bounds.getHeight())+offset));svg.setAttributeNS(null,"refY",coord.y);gradient.appendChild(stop1);gradient.appendChild(stop2);defs.appendChild(gradient);svg.appendChild(defs);}return svg;},createLabel:function(ringObj,text){const retVal=this.createSvgElement("g");const coords=ringObj.outer;var coord=this.map.getPixelFromLonLat(coords[0]);const label1=this.createSvgElement("text");const label2=this.createSvgElement("text");const label3=this.createSvgElement("text");const label4=this.createSvgElement("text");label1.setAttributeNS(null,"x",coord.x);label1.setAttributeNS(null,"y",coord.y);label1.setAttributeNS(null,"text-anchor","middle");label1.setAttributeNS(null,"dy","1.2em");label1.textContent=text+"'";coord=this.map.getPixelFromLonLat(coords[Math.ceil(coords.length/4)]);label2.setAttributeNS(null,"x",coord.x);label2.setAttributeNS(null,"y",coord.y);label2.setAttributeNS(null,"text-anchor","end");label2.textContent=text+"'";coord=this.map.getPixelFromLonLat(coords[Math.ceil(coords.length/4)*2]);label3.setAttributeNS(null,"x",coord.x);label3.setAttributeNS(null,"y",coord.y);label3.setAttributeNS(null,"text-anchor","middle");label3.setAttributeNS(null,"dy","-.4em");label3.textContent=text+"'";coord=this.map.getPixelFromLonLat(coords[Math.ceil(coords.length/4)*3]);label4.setAttributeNS(null,"x",coord.x);label4.setAttributeNS(null,"y",coord.y);label4.setAttributeNS(null,"text-anchor","start");label4.textContent=text+"'";retVal.appendChild(label1);retVal.appendChild(label2);retVal.appendChild(label3);retVal.appendChild(label4);return retVal;},createGeodesicRing:function(center,innerR,outerR,projection){var angle;var sides=60;var innerLL;var outerLL;var wgsCenter;var innerPts=[];var outerPts=[];projection=(projection!==undefined)?projection:"EPSG:4326";wgsCenter=center.clone().transform(projection,"EPSG:4326");for(var i=0;i<sides;i++){angle=i*360/sides;innerLL=OpenLayers.Util.destinationVincenty(wgsCenter,angle,innerR);outerLL=OpenLayers.Util.destinationVincenty(wgsCenter,angle,outerR);innerLL.transform("EPSG:4326",projection);outerLL.transform("EPSG:4326",projection);innerPts.push(innerLL);outerPts.push(outerLL);}return{inner:innerPts,outer:outerPts};},createSvgRingPath:function(ringObj){var pathInner="";var pathOuter="";var minX;var minY;var maxX;var maxY;if(ringObj!==null&&ringObj!==undefined&&typeof ringObj==="object"&&ringObj.inner.length>0&&ringObj.inner.length===ringObj.outer.length){for(var i=0;i<ringObj.inner.length;i++){var pen=' L';var innerCoord=this.map.getPixelFromLonLat(ringObj.inner[i]);var outerCoord=this.map.getPixelFromLonLat(ringObj.outer[i]);if(i===0){pen=' M';minX=outerCoord.x;maxX=outerCoord.x;minY=outerCoord.y;maxY=outerCoord.y;}else{if(outerCoord.x>maxX)maxX=outerCoord.x;if(outerCoord.x<minX)minX=outerCoord.x;if(outerCoord.y>maxY)maxY=outerCoord.y;if(outerCoord.y<minY)minY=outerCoord.y;}pathInner+=pen+innerCoord.x+' '+innerCoord.y;pathOuter+=pen+outerCoord.x+' '+outerCoord.y;}pathInner+=" Z";pathOuter+=" Z";}var path=pathInner+pathOuter;var svg=this.createSvgElement('path');var bounds=new OpenLayers.Bounds(minX,minY,maxX,maxY);svg.setAttributeNS(null,'d',path);svg.setAttributeNS(null,"fill","url(#grad1)");svg.setAttributeNS(null,"fill-rule","evenodd");svg.setAttributeNS(null,"stroke","blue");svg.setAttributeNS(null,"stroke-opacity","0.7");return{svg:svg,bounds:bounds};},CLASS_NAME:"OpenLayers.Control.RangeCircles"});function RangeCirclesPanel(){var _instance=this;this.createPanelContent=function(){const retVal=JQ('<div id="rangeCirclesToolContent">');const acSpeedBlock=JQ('<div class="rct_acSpeedBlock">');const acBlock=JQ('<div class="rct_acBlock">');const speedBlock=JQ('<div class="rct_speedBlock">');const acLabel=JQ('<label for="rct_aircraftSelect">');const acSelect=JQ('<select data-mini="true" id="rct_aircraftSelect">');const cSpeedLabel=JQ('<label for="rct_cspeedValue">');const cSpeedValBlock=JQ('<div class="rct_cspeedValBlock">');const cSpeedValue=JQ('<input class="floatControl" id="rct_cspeedValue" type="text">');const cSpeedUnit=JQ('<select class="heightAsField" data-iconpos="noicon" data-mini="true" id="rct_cspeedUnit"><option value="km/h">km/h</option><option value="mph">mph</option><option value="kts">kts</option></select>');acLabel.attr(AWLocale.LOCALISATION_KEY,"RangeCircles.aircraft");cSpeedLabel.attr(AWLocale.LOCALISATION_KEY,"RangeCircles.cspeed");acBlock.append(acLabel);acBlock.append(acSelect);cSpeedValBlock.append(cSpeedValue);cSpeedValBlock.append(cSpeedUnit);speedBlock.append(cSpeedLabel);speedBlock.append(cSpeedValBlock);acSpeedBlock.append(acBlock);acSpeedBlock.append(speedBlock);retVal.append(acSpeedBlock);retVal.append(this.createSettingsContent());acSelect.change(function(){const ac=JQ(this).find(":selected").data('ac');cSpeedValue.val(ac.getIas());cSpeedUnit.val(ac.getIasUnit());cSpeedUnit.selectmenu('refresh',true);triggerSettingsChanged();});cSpeedValue.change(triggerSettingsChanged);cSpeedUnit.change(triggerSettingsChanged);retVal.loading(true,true);AWDataHandler.getAircraftList(function(aircraftList){if(aircraftList!==null){for(var i=0;i<aircraftList.size();i++){const aircraft=aircraftList.at(i);const acListItem=JQ("<option>");acListItem.val(aircraft.getId());acListItem.text(aircraft.getRegistration());acListItem.data('ac',aircraft);acSelect.append(acListItem);}acSelect.val(1).selectmenu('refresh');acSelect.trigger("change");retVal.loading(false);}});return retVal;};this.createSettingsContent=function(){const retVal=JQ("<div class='rct-settings'>");const timeBlock=JQ("<div class='rct_timeBlock'>");const timeArcBlock=JQ("<div class='rct_timeArcBlock'>");const timeLabel=JQ('<label id="rct_timeLabel">');const timeGrp=JQ('<fieldset id="rct_time_group" data-role="controlgroup" data-type="horizontal">');const timeArcLabel=JQ('<label id="rct_timeArcLabel">');const timeArcGrp=JQ('<fieldset id="rct_time_arc_group" data-role="controlgroup" data-type="horizontal">');timeGrp.append(JQMUtil.createRadioElement("rct_time","1"));timeGrp.append(JQMUtil.createRadioElement("rct_time","2"));timeGrp.append(JQMUtil.createRadioElement("rct_time","3"));timeBlock.append(timeLabel);timeBlock.append(timeGrp);timeArcGrp.append(JQMUtil.createRadioElement("rct_time_arc","5"));timeArcGrp.append(JQMUtil.createRadioElement("rct_time_arc","10"));timeArcGrp.append(JQMUtil.createRadioElement("rct_time_arc","15"));timeArcGrp.append(JQMUtil.createRadioElement("rct_time_arc","30"));timeArcBlock.append(timeArcLabel);timeArcBlock.append(timeArcGrp);timeLabel.attr(AWLocale.LOCALISATION_KEY,"RangeCircles.time");timeArcLabel.attr(AWLocale.LOCALISATION_KEY,"RangeCircles.timeArc");retVal.append(timeBlock);retVal.append(timeArcBlock);if(AppController.userPrefs.isValueForName("rangeCircles")){const prefs=AppController.userPrefs.getValue("rangeCircles",true);timeGrp.find("input[value='"+prefs.time+"']").prop('checked',true);timeArcGrp.find("input[value='"+prefs.timeArc+"']").prop('checked',true);}timeGrp.change(function(){triggerSettingsChanged();triggerPreferencesChanged();});timeArcGrp.change(function(){triggerSettingsChanged();triggerPreferencesChanged();});return retVal;};triggerSettingsChanged=function(){var speedVal=JQ("#rct_cspeedValue").val();var speedUnit=JQ("#rct_cspeedUnit").find(":selected").val();var time=JQ("#rct_time_group").find("input[name='rct_time']:checked").val();var timeArc=JQ("#rct_time_arc_group").find("input[name='rct_time_arc']:checked").val();var settings={speedValue:speedVal,speedUnit:speedUnit,time:time,timeArc:timeArc};RangeCirclesPanel.ACTUAL_SETTINGS={time:time,timeArc:timeArc};JQ(_instance).trigger("settingschanged",settings);};triggerPreferencesChanged=function(){const time=JQ("#rct_time_group").find("input[name='rct_time']:checked").val();const timeArc=JQ("#rct_time_arc_group").find("input[name='rct_time_arc']:checked").val();const prefs={time:time,timeArc:timeArc};RangeCirclesPanel.ACTUAL_SETTINGS=prefs;JQ(_instance).trigger("preferenceschanged",prefs);};}RangeCirclesPanel.DEFAULT_SETTINGS={time:1,timeArc:30};RangeCirclesPanel.ACTUAL_SETTINGS=RangeCirclesPanel.DEFAULT_SETTINGS;if(typeof(OpenLayers)!=='undefined'){OpenLayers.INCHES_PER_UNIT["NM"]=1852*OpenLayers.INCHES_PER_UNIT.m;OpenLayers.Format.Filter.v1.prototype.filterMap["FUNCTION"]="Function";OpenLayers.Control.GetMapLonLat=OpenLayers.Class(OpenLayers.Control,{defaultHandlerOptions:{'single':true,'double':false,'pixelTolerance':1,'stopSingle':true,'stopDouble':false},initialize:function(options){this.handlerOptions=OpenLayers.Util.extend({},this.defaultHandlerOptions);OpenLayers.Control.prototype.initialize.apply(this,arguments);this.handler=new OpenLayers.Handler.Click(this,{'click':this.trigger},this.handlerOptions);},trigger:function(e){var lonLat=this.map.getLonLatFromPixel(e.xy);this.events.triggerEvent("clicked",{lonLat:lonLat});if(this.oneClickCallback!==undefined&&typeof this.oneClickCallback==="function"){this.oneClickCallback(lonLat);delete this.oneClickCallback;}},getOneClick:function(callback){this.oneClickCallback=callback;}});OpenLayers.Util.extend(OpenLayers.Events.featureclick.prototype,{onClick:function(evt){if(!this.startEvt||evt.type!=="touchend"&&!OpenLayers.Event.isLeftClick(evt)){return;}const features=this.getFeatures(this.startEvt);delete this.startEvt;var more,clicked={};for(var i=0,len=features.length;i<len;++i){const featureObj=features[i];const feature=featureObj.feature;const layer=feature.layer;clicked[layer.id]=true;more=this.triggerEvent("featureclick",{feature,target:featureObj.target});if(more===false){break;}}for(i=0,len=this.map.layers.length;i<len;++i){layer=this.map.layers[i];if(layer instanceof OpenLayers.Layer.Vector&&!clicked[layer.id]){this.triggerEvent("nofeatureclick",{layer:layer});}}},getFeatures:function(evt){var x=evt.clientX,y=evt.clientY,layers=[],layer,target,feature,i,len;const featuresId=[];const targets=document.elementsFromPoint(x,y);const retVal=[];targets?.length>0&&targets.forEach(target=>{const featureId=target._featureId;featureId&&featuresId.push({id:featureId,target});});for(i=this.map.layers.length-1;i>=0;--i){layer=this.map.layers[i];if(layer.div.style.display!=="none"){if(layer.renderer instanceof OpenLayers.Renderer.Elements){if(layer instanceof OpenLayers.Layer.Vector){featuresId.forEach(featureObj=>{const feature=layer.getFeatureById(featureObj.id);if(feature){retVal.push({feature,target:featureObj.target});}});}layers.push(layer);layer.div.style.display="none";}else if(layer.renderer instanceof OpenLayers.Renderer.Canvas){feature=layer.renderer.getFeatureIdFromEvent(evt);if(feature){retVal.push({feature});layers.push(layer);}}}}for(i=layers.length-1;i>=0;--i){layers[i].div.style.display="block";}return retVal;}});OpenLayers.Util.extend(OpenLayers.Event,{preventDefault:function(event){if(event.defaultPrevented){if(event.preventDefault){event.preventDefault();}else{event.returnValue=false;}}},observe:function(elementParam,name,observer,useCapture){var element=OpenLayers.Util.getElement(elementParam);useCapture=useCapture||false;if(name=='keypress'&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||element.attachEvent)){name='keydown';}if(!this.observers){this.observers={};}if(!element._eventCacheID){var idPrefix="eventCacheID_";if(element.id){idPrefix=element.id+"_"+idPrefix;}element._eventCacheID=OpenLayers.Util.createUniqueID(idPrefix);}var cacheID=element._eventCacheID;if(!this.observers[cacheID]){this.observers[cacheID]=[];}this.observers[cacheID].push({'element':element,'name':name,'observer':observer,'useCapture':useCapture});if(element.addEventListener){let opts={capture:useCapture,passive:true};element.addEventListener(name,observer,opts);}else if(element.attachEvent){element.attachEvent('on'+name,observer);}}});OpenLayers.Util.extend(OpenLayers.Handler.Pinch.prototype,{touchstart:function(evt){var propagate=true;this.pinching=false;if(OpenLayers.Event.isMultiTouch(evt)){this.started=true;this.last=this.start={distance:this.getDistance(evt.touches),delta:0,scale:1};this.callback("start",[evt,this.start]);propagate=!this.stopDown;}else if(this.started){return false;}else{this.started=false;this.start=null;this.last=null;}OpenLayers.Event.preventDefault(evt);event.preventDefault();return propagate;}});OpenLayers.Util.extend(OpenLayers.Tile.Image.prototype,{'setImgSrc':function(url){var img=this.imgDiv;if(this.layer.oldLoadingMode){if(url){img.style.visibility='hidden';img.style.opacity=0;if(this.crossOriginKeyword){if(url.substr(0,5)!=='data:'){img.setAttribute("crossorigin",this.crossOriginKeyword);}else{img.removeAttribute("crossorigin");}}img.src=url;}else{this.stopLoading();this.imgDiv=null;if(img.parentNode){img.parentNode.removeChild(img);}}}else{if(url){img.style.visibility='hidden';img.style.opacity=0;var xhr=AWUtils.getXhr();xhr.open("GET",url,true);xhr.responseType="arraybuffer";if(this.crossOriginKeyword){if(url.substr(0,5)!=='data:'){img.setAttribute("crossorigin",this.crossOriginKeyword);xhr.setRequestHeader('Access-Control-Allow-Origin',this.crossOriginKeyword);}else{img.removeAttribute("crossorigin");}}AWDataHandler.addTokenToXhr(xhr);xhr.onload=function(e){var abv=new Uint8Array(this.response);var type=this.getResponseHeader('Content-type');var blob=new Blob([abv],{type:type});var imageUrl=URL.createObjectURL(blob);img.src=imageUrl;var owsProxy=this.getResponseHeader('OwsProxy');var secMan=xhr.getResponseHeader('SecurityManager');img.ResponseHeader={OwsProxy:owsProxy,SecurityManager:secMan};};xhr.send();}else{this.stopLoading();this.imgDiv=null;if(img.parentNode){img.parentNode.removeChild(img);}}}}});OpenLayers.Util.extend(OpenLayers.Layer.Google.v3,{setGMapVisibility:function(visible){var cache=OpenLayers.Layer.Google.cache[this.map.id];var map=this.map;if(cache&&map){var type=this.type;var layers=map.layers;var layer;for(var i=layers.length-1;i>=0;--i){layer=layers[i];if(layer instanceof OpenLayers.Layer.Google&&layer.visibility===true&&layer.inRange===true){type=layer.type;visible=true;break;}}var container=this.mapObject.getDiv();if(container&&visible===true){if(container.parentNode!==map.div){if(!cache.rendered){var me=this;google.maps.event.addListenerOnce(this.mapObject,"tilesloaded",function(){cache.rendered=true;me.setGMapVisibility(me.getVisibility());me.moveTo(me.map.getCenter());cache.googleControl.appendChild(map.viewPortDiv);me.map.pan(1,0);google.maps.event.trigger(me.mapObject,"resize");});}else{cache.googleControl.appendChild(map.viewPortDiv);}map.div.appendChild(container);google.maps.event.trigger(this.mapObject,"resize");}this.mapObject.setMapTypeId(type);}else if(cache.googleControl.hasChildNodes()){map.div.appendChild(map.viewPortDiv);map.div.removeChild(container);}}}});OpenLayers.Util.extend(OpenLayers.Format.WFST.v1_1_0.prototype.writers.wfs,{'Query':function(options){options=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName},options);var prefix=options.featurePrefix;if(options.featureVersion==undefined){attributes={typeName:(prefix?prefix+":":"")+options.featureType,srsName:options.srsName};}else{attributes={typeName:(prefix?prefix+":":"")+options.featureType,srsName:options.srsName,featureVersion:options.featureVersion};}var node=this.createElementNSPlus("wfs:Query",{attributes:attributes});if(options.featureNS){node.setAttribute("xmlns:"+prefix,options.featureNS);}if(options.propertyNames){for(var i=0,len=options.propertyNames.length;i<len;i++){this.writeNode("wfs:PropertyName",{property:options.propertyNames[i]},node);}}if(options.filter){OpenLayers.Format.WFST.v1_1_0.prototype.setFilterProperty.call(this,options.filter);this.writeNode("ogc:Filter",options.filter,node);}return node;}});OpenLayers.Strategy.AttributeCluster=OpenLayers.Class(OpenLayers.Strategy.Cluster,{includePolygons:false,cluster:function(event){if((!event||event.zoomChanged)&&this.features){var resolution=this.layer.map.getResolution();if(resolution!==this.resolution||!this.clustersExist()){this.resolution=resolution;var clusters=[];var otherFeatures=[];var feature,clusterOrFeature;for(var i=0;i<this.features.length;++i){var clustered=false;feature=this.features[i];if(feature.geometry){if(feature.geometry instanceof OpenLayers.Geometry.Point||(this.includePolygons&&feature.geometry instanceof OpenLayers.Geometry.Polygon)){if(clusters.length>0){for(var j=clusters.length-1;j>=0;--j){clusterOrFeature=clusters[j];if(this.shouldCluster(clusterOrFeature,feature)){if(clusterOrFeature.cluster){this.addToCluster(clusterOrFeature,feature);}else{clusters.push(this.createCluster(clusterOrFeature,feature));clusters=clusters.filter(function(el){return el!==clusterOrFeature;});}clustered=true;break;}}}if(!clustered){clusters.push(feature);}}else{otherFeatures.push(feature);}}}this.clustering=true;this.layer.removeAllFeatures();this.layer.addFeatures(otherFeatures);this.clustering=false;if(clusters.length>0){if(this.threshold>1){var clone=clusters.slice();clusters=[];var candidate;for(var i=0,len=clone.length;i<len;++i){candidate=clone[i];if(candidate.attributes.count<this.threshold){Array.prototype.push.apply(clusters,candidate.cluster);}else{clusters.push(candidate);}}}this.clustering=true;this.layer.addFeatures(clusters);this.clustering=false;}this.clusters=clusters;}}},addToCluster:function(cluster,feature){cluster.cluster.push(feature);this.updateLabel(cluster);if(cluster.cluster.length<50&&feature.hoverInfo){cluster.hoverInfo.push(this.createClusterItemHoverInfo(feature));}},createCluster:function(feature1,feature2){var center=feature1.geometry.getBounds().getCenterLonLat();var cluster=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(center.lon,center.lat));cluster.attributes=JQ.extend({},feature2.attributes);cluster.cluster=[feature1,feature2];this.updateLabel(cluster);cluster.hoverInfo=[this.createClusterItemHoverInfo(feature1),this.createClusterItemHoverInfo(feature2)];return cluster;},createClusterItemHoverInfo:function(item){return item.hoverInfo;},updateLabel:function(cluster){cluster.attributes.label=cluster.cluster.length+" Zones";},cacheFeatures:function(event){var propagate=true;if(!this.clustering){if(JQ.isArray(this.features)){this.features=this.features.concat(event.features);}else{this.features=event.features;}this.cluster();propagate=false;}return propagate;},CLASS_NAME:"OpenLayers.Strategy.AttributeCluster"});OpenLayers.Geometry.Polygon.createGeodesicRegularPolygon=function(origin,radius,projection,sides){var angle;var ll;var wgsCenter;var points=[];var geomPoint;projection=(projection!==undefined)?projection:"EPSG:4326";sides=(sides!==undefined)?sides:60;wgsCenter=origin.clone().transform(projection,"EPSG:4326");for(var i=0;i<sides;i++){angle=i*360/sides;ll=OpenLayers.Util.destinationVincenty(wgsCenter,angle,radius);ll.transform("EPSG:4326",projection);geomPoint=new OpenLayers.Geometry.Point(ll.lon,ll.lat);points.push(geomPoint);}var ring=new OpenLayers.Geometry.LinearRing(points);return new OpenLayers.Geometry.Polygon([ring]);};OpenLayers.Util.extend(OpenLayers.Control.Graticule.prototype,{labelLonYOffset:2,labelLatXOffset:null,leftSideLabels:false,'update':function(){var mapBounds=this.map.getExtent();if(!mapBounds){return;}if(this.labelLatXOffset===null){this.labelLatXOffset=(this.leftSideLabels)?2:-2;}this.gratLayer.destroyFeatures();var llProj=new OpenLayers.Projection("EPSG:4326");var mapProj=this.map.getProjectionObject();var mapRes=this.map.getResolution();if(mapProj.proj&&mapProj.proj.projName==="longlat"){this.numPoints=1;}var mapCenter=this.map.getCenter();var mapCenterLL=new OpenLayers.Pixel(mapCenter.lon,mapCenter.lat);OpenLayers.Projection.transform(mapCenterLL,mapProj,llProj);var testSq=this.targetSize*mapRes;testSq*=testSq;var llInterval;for(var i=0;i<this.intervals.length;++i){llInterval=this.intervals[i];var delta=llInterval/2;var p1=mapCenterLL.offset({x:-delta,y:-delta});var p2=mapCenterLL.offset({x:delta,y:delta});OpenLayers.Projection.transform(p1,llProj,mapProj);OpenLayers.Projection.transform(p2,llProj,mapProj);var distSq=(p1.x-p2.x)*(p1.x-p2.x)+(p1.y-p2.y)*(p1.y-p2.y);if(distSq<=testSq){break;}}mapCenterLL.x=Math.floor(mapCenterLL.x/llInterval)*llInterval;mapCenterLL.y=Math.floor(mapCenterLL.y/llInterval)*llInterval;var iter=0;var centerLonPoints=[mapCenterLL.clone()];var newPoint=mapCenterLL.clone();var mapXY;do{newPoint=newPoint.offset({x:0,y:llInterval});mapXY=OpenLayers.Projection.transform(newPoint.clone(),llProj,mapProj);centerLonPoints.unshift(newPoint);}while(mapBounds.containsPixel(mapXY)&&++iter<1000);newPoint=mapCenterLL.clone();do{newPoint=newPoint.offset({x:0,y:-llInterval});mapXY=OpenLayers.Projection.transform(newPoint.clone(),llProj,mapProj);centerLonPoints.push(newPoint);}while(mapBounds.containsPixel(mapXY)&&++iter<1000);iter=0;var centerLatPoints=[mapCenterLL.clone()];newPoint=mapCenterLL.clone();do{newPoint=newPoint.offset({x:-llInterval,y:0});mapXY=OpenLayers.Projection.transform(newPoint.clone(),llProj,mapProj);centerLatPoints.unshift(newPoint);}while(mapBounds.containsPixel(mapXY)&&++iter<1000);newPoint=mapCenterLL.clone();do{newPoint=newPoint.offset({x:llInterval,y:0});mapXY=OpenLayers.Projection.transform(newPoint.clone(),llProj,mapProj);centerLatPoints.push(newPoint);}while(mapBounds.containsPixel(mapXY)&&++iter<1000);var lines=[];for(var i=0;i<centerLatPoints.length;++i){var lon=centerLatPoints[i].x;var pointList=[];var labelPoint=null;var latEnd=Math.min(centerLonPoints[0].y,90);var latStart=Math.max(centerLonPoints[centerLonPoints.length-1].y,-90);var latDelta=(latEnd-latStart)/this.numPoints;var lat=latStart;for(var j=0;j<=this.numPoints;++j){var gridPoint=new OpenLayers.Geometry.Point(lon,lat);gridPoint.transform(llProj,mapProj);pointList.push(gridPoint);lat+=latDelta;if(gridPoint.y>=mapBounds.bottom&&!labelPoint){labelPoint=gridPoint;}}if(this.labelled){var labelPos=new OpenLayers.Geometry.Point(labelPoint.x,mapBounds.bottom);var labelAttrs={value:lon,label:this.labelled?OpenLayers.Util.getFormattedLonLat(lon,"lon",this.labelFormat):"",labelAlign:"cb",xOffset:0,yOffset:this.labelLonYOffset};this.gratLayer.addFeatures(new OpenLayers.Feature.Vector(labelPos,labelAttrs));}var geom=new OpenLayers.Geometry.LineString(pointList);lines.push(new OpenLayers.Feature.Vector(geom));}for(var j=0;j<centerLonPoints.length;++j){lat=centerLonPoints[j].y;if(lat<-90||lat>90){continue;}var pointList=[];var lonStart=centerLatPoints[0].x;var lonEnd=centerLatPoints[centerLatPoints.length-1].x;var lonDelta=(lonEnd-lonStart)/this.numPoints;var lon=lonStart;var labelPoint=null;for(var i=0;i<=this.numPoints;++i){var gridPoint=new OpenLayers.Geometry.Point(lon,lat);gridPoint.transform(llProj,mapProj);pointList.push(gridPoint);lon+=lonDelta;if(gridPoint.x<mapBounds.right){labelPoint=gridPoint;}}if(this.labelled){var xpos=(this.leftSideLabels)?mapBounds.left:mapBounds.right;var align=(this.leftSideLabels)?"lb":"rb";var labelPos=new OpenLayers.Geometry.Point(xpos,labelPoint.y);var labelAttrs={value:lat,label:this.labelled?OpenLayers.Util.getFormattedLonLat(lat,"lat",this.labelFormat):"",labelAlign:align,xOffset:this.labelLatXOffset,yOffset:2};this.gratLayer.addFeatures(new OpenLayers.Feature.Vector(labelPos,labelAttrs));}var geom=new OpenLayers.Geometry.LineString(pointList);lines.push(new OpenLayers.Feature.Vector(geom));}this.gratLayer.addFeatures(lines);}});OpenLayers.Layer.OSM.prototype.attribution="&copy; <a target='_blank' rel='noopener noreferrer' href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors";OpenLayers.Handler.Click.prototype.pixelTolerance=1;var _class=OpenLayers.Format.XML;var originalWriteFunction=_class.prototype.write;var patchedWriteFunction=function(){var child=originalWriteFunction.apply(this,arguments);child=child.replace(new RegExp('xmlns:NS1="" NS1:','g'),'');return child;};_class.prototype.write=patchedWriteFunction;}function createImSoapRequest(methodName,jsonData){var x2js=new X2JS();var retVal='<?xml version="1.0" encoding="utf-8" ?>';var nsJsonData={};JQ.each(jsonData,function(attr,val){if(val!==null){nsJsonData[attr]=val;}});var paramsStr=x2js.json2xml_str(nsJsonData);retVal+='<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">';retVal+='<soap:Body>';retVal+='<'+methodName+' xmlns="www.litas.sk"';if(paramsStr.length>0){retVal+='>';retVal+=x2js.json2xml_str(nsJsonData);retVal+='</'+methodName+'>';}else{retVal+=' />';}retVal+='</soap:Body>';retVal+='</soap:Envelope>';return retVal;}function callImWs(methodName,params,callbackFnc,errCallbackFnc){if(config.imDataHandlerUrl===undefined){var msg="IntegMon WebService not configured. Check configuration!";debug(msg);AWUtils.applyFunction(this,errCallbackFnc,[msg]);return;}var x2js=new X2JS();var action="http://www.litas.sk/"+methodName;JQ.ajax({url:config.imDataHandlerUrl,type:"POST",dataType:"xml",data:createImSoapRequest(methodName,params),contentType:"text/xml; charset=\"utf-8\"",headers:{SOAPAction:action},complete:function(xhr,status){var retVal;try{var obj=x2js.xml2json(xhr.responseXML);var body=obj.Envelope.Body;if(body.Fault!==undefined){AWUtils.applyFunction(this,errCallbackFnc,[body.Fault.faultstring]);}else{var response=body[methodName+"Response"];retVal=response[Object.keys(response)[0]];delete retVal.__prefix;if(retVal.IsError!==undefined&&retVal.IsError.toString()==="1"){var errMsg=retVal.ErrorDescription.toString();AWUtils.applyFunction(this,errCallbackFnc,[errMsg]);}else{AWUtils.applyFunction(this,callbackFnc,[retVal]);}}}catch(e){AWUtils.applyFunction(this,errCallbackFnc,[e.message]);}},error:function(xmlHttpRequest,textStatus,errorThrown){AWUtils.applyFunction(this,errCallbackFnc,[textStatus]);}});};function getPublisherList(callbackFnc,errCallbackFnc){var params={};callImWs("ImPublisherList",params,callbackFnc,errCallbackFnc);}function getQcodesList(callbackFnc,errCallbackFnc){var params={};callImWs("ImQCodeDesc",params,callbackFnc,errCallbackFnc);}var WmsToWfsTypes={"AIXM Layer.Airports":"Aixm-Ahp","AIXM Layer.Airspaces.AMC R":"Aixm-Ase-R-AMC","AIXM Layer.Airspaces.Aixm-Ase-R-AMC":"Aixm-Ase-R-AMC","AIXM Layer.Airspaces.AMC D":"Aixm-Ase-D-AMC","AIXM Layer.Airspaces.Aixm-Ase-D-AMC":"Aixm-Ase-D-AMC","AIXM Layer.Airspaces.D":"Aixm-Ase-D","AIXM Layer.Airspaces.Aixm-Ase-D":"Aixm-Ase-D","AIXM Layer.Airspaces.R":"Aixm-Ase-R","AIXM Layer.Airspaces.Aixm-Ase-R":"Aixm-Ase-R","AIXM Layer.Airspaces.P":"Aixm-Ase-P","AIXM Layer.Airspaces.Aixm-Ase-P":"Aixm-Ase-P","AIXM Layer.Airspaces.TSA":"Aixm-Ase-TSA","AIXM Layer.Airspaces.Aixm-Ase-TSA":"Aixm-Ase-TSA","AIXM Layer.Airspaces.TRA":"Aixm-Ase-TRA","AIXM Layer.Airspaces.Aixm-Ase-TRA":"Aixm-Ase-TRA","AIXM Layer.Airspaces.TMA":"Aixm-Ase-TMA","AIXM Layer.Airspaces.Aixm-Ase-TMA":"Aixm-Ase-TMA","AIXM Layer.Airspaces.TMA P":"Aixm-Ase-TMA-P","AIXM Layer.Airspaces.Aixm-Ase-TMA-P":"Aixm-Ase-TMA-P","AIXM Layer.Airspaces.CTR":"Aixm-Ase-CTR","AIXM Layer.Airspaces.Aixm-Ase-CTR":"Aixm-Ase-CTR","AIXM Layer.Airspaces.FIR":"Aixm-Ase-FIR","AIXM Layer.Airspaces.Aixm-Ase-FIR":"Aixm-Ase-FIR","AIXM Layer.Airspaces.SECTOR":"Aixm-Ase-SECTOR","AIXM Layer.Airspaces.Aixm-Ase-SECTOR":"Aixm-Ase-SECTOR","AIXM Layer.Airspaces.PROTECT":"Aixm-Ase-PROTECT","AIXM Layer.Airspaces.Aixm-Ase-PROTECT":"Aixm-Ase-PROTECT","AIXM Layer.Navaid.Tacan":"Aixm-Tcn","AIXM Layer.Navaid.NDB":"Aixm-Ndb","AIXM Layer.Navaid.DME":"Aixm-Dme","AIXM Layer.Navaid.VOR":"Aixm-Vor","AIXM Layer.WPT.Designated Point":"Aixm-Dpn","AIXM Layer.WPT.Designated Point.ICAO WPT":"Aixm-Dpn",LAST_LINE:"Do not edit or move."};function FplInfoWidget(){var _instance=this;var _gui=null;var _clickAction=null;this.init=function(){JQ(AppController.aisWeb).on(AisWeb.EVENT.REFRESH_COMMON,function(){_instance.refresh();});};this.getGui=function(){if(_gui===null){_gui=JQ('<div class="fpl-info-widget"></div>');var valsDiv=JQ('<div class="fpl-info-widget-vals"></div>');_gui.append('<div class="fpl-info-widget-label">FPL</div>');valsDiv.append(createWidgetItem("total"));valsDiv.append(createWidgetItem("active"));_gui.append(valsDiv);_gui.click(function(){AWUtils.applyFunction(_instance,_clickAction);});}this.refresh();return _gui;};createWidgetItem=function(className){var retVal=JQ('<div class="fpl-info-widget-item"></div>');var label=JQ('<span class="fpl-info-widget-item-label">'+className+'</span>');retVal.append(label);retVal.append('<span class="fpl-info-widget-item-value"></span>');retVal.addClass("fpl-info-"+className);label.attr(AWLocale.LOCALISATION_KEY,'FplInfoWidget.'+className);return retVal;};this.refresh=function(){JQ.ajax({url:(config.fplInfoProviderUrl!==undefined)?config.fplInfoProviderUrl:"fplInfoProvider.php",dataType:"json",crossDomain:true,success:function(data,textStatus){_gui.find(".fpl-info-total .fpl-info-widget-item-value").text(data.total);_gui.find(".fpl-info-active .fpl-info-widget-item-value").text(data.active);},error:function(xhr,textStatus,errorThrown){_gui.find(".fpl-info-total .fpl-info-widget-item-value").text("-");_gui.find(".fpl-info-active .fpl-info-widget-item-value").text("-");}});};this.setClickAction=function(action){_clickAction=action;};this.init();}function Validation(){}const ValidationDefaultConfig={strongPassword:4,pilotLicenseNumberPattern:/^[A-Z0-9 \.\-\/\(\)]{2,30}$/,emailPattern:/^[_a-zA-Z0-9\-]+(\.[_a-zA-Z0-9\-]+)*\@[a-zA-Z0-9\-\.]+\.([a-zA-Z]{2,6}|[0-9]{1,3})$/,passwordPattern:/^[A-Za-z0-9 \@\+\.\!\/]{8,30}$/,phonePattern:/^\+{0,1}[0-9]{1}[0-9 \-]{0,48}$/,streetPattern:/^(?:([^\x00-\x7F^])|[^\W_]|[.,\-\/() ])*$/,cityPattern:/^(?:([^\x00-\x7F^])|[^\W_]|[.,\- ])*$/,firstNamePattern:/^(?:([^\x00-\x7F^])|[^\W_]|[.,\- ])*$/,lastNamePattern:/^(?:([^\x00-\x7F^])|[^\W_]|[.,\- ])*$/,postalCodePattern:/^[A-Z 0-9\-\.]{1,32}$/,lettersOnlyPattern:/^([A-Za-z])+?$/,streetNumberPattern:/^[a-zA-Z0-9 \-]+$/};Validation._getPattern=function(name){var retVal=getConfigValue2("validation",name,ValidationDefaultConfig[name]);if(retVal instanceof RegExp===false){retVal=new RegExp(retVal);}return retVal;};Validation.validateLength=function(input,mx,my){var len=input.length;if(len<mx){throw{err:"Validation.length.short",text:getLocalizedString("Validation.length.short")+", "+getLocalizedString("Validation.length.min")+" "+mx};}if(len>my){throw{err:"Validation.length.long",text:getLocalizedString("Validation.length.long")+", "+getLocalizedString("Validation.length.max")+" "+my};}};Validation.validateMandatory=function(input){if(input===undefined||input===null||input.length===0){throw"Validation.mandatory";}};Validation.validateEmail=function(input){var pattern=Validation._getPattern("emailPattern");if(pattern.test(input)===false){throw"Validation.email";}};Validation.validatePassword=function(input){const pattern=Validation._getPattern("passwordPattern");const limits=pattern.toString().split(/\{(\d+),(\d+)\}/);if(limits.length>3){Validation.validateLength(input,limits[1],limits[2]);}if(pattern.test(input)===false){throw"Validation.password";}Validation.validateStrongPassword(input);};Validation.validateStrongPassword=function(input){const requiredStrength=parseInt(getConfigValue2("validation","strongPassword",ValidationDefaultConfig["strongPassword"]));if(requiredStrength>0){var strength=0;if(/[A-Z]/.test(input)){strength++;}if(/[a-z]/.test(input)){strength++;}if(/[0-9]/.test(input)){strength++;}if(/[ \@\+\.\!\/]/.test(input)){strength++;}if(strength<requiredStrength){throw"Validation.password.strength";}}};Validation.validatePhone=function(input){var pattern=Validation._getPattern("phonePattern");if(pattern.test(input)===false){throw"Validation.phone";}};Validation.validatePilotLicenseNumber=function(input){var pattern=Validation._getPattern("pilotLicenseNumberPattern");if(pattern.test(input)===false){throw"Validation.pilotLicenseNumber";}};Validation.validateStreet=function(input){var pattern=Validation._getPattern("streetPattern");if(pattern.test(input)===false){throw"Validation.street";}};Validation.validateCity=function(input){var pattern=Validation._getPattern("cityPattern");if(pattern.test(input)===false){throw"Validation.city";}};Validation.validatePostalCode=function(input){var pattern=Validation._getPattern("postalCodePattern");if(pattern.test(input)===false){throw"Validation.postalCode";}};Validation.validateStreetNumber=function(input){var pattern=Validation._getPattern("streetNumberPattern");if(pattern.test(input)===false){throw"Validation.streetNumber";}};Validation.validateOnlyLetters=function(input){var pattern=Validation._getPattern("lettersOnlyPattern");if(pattern.test(input)===false){throw"Validation.onlyLetters";}};Validation.validateFirstName=function(input){var pattern=Validation._getPattern("firstNamePattern");if(pattern.test(input)===false){throw"Validation.firstName";}};Validation.validateLastName=function(input){var pattern=Validation._getPattern("lastNamePattern");if(pattern.test(input)===false){throw"Validation.lastName";}};function AftnMsgViewer(){var _gui=null;var _instance=this;var _dataLoader=null;var _data=null;var _msgTag=null;var _descriptFnc=null;var _rqTimeStamp=null;this.guiParams;this.setDataLoader=function(loadFnc){_dataLoader=loadFnc;};this.setMessagesTag=function(tagName){_msgTag=tagName;};this.setMessageDescriptor=function(descriptFnc){_descriptFnc=descriptFnc;};this.loadData=function(){var param=(_gui&&_instance.guiParams&&_instance.guiParams.requestFilter)?_instance.guiParams.requestFilter:null;_rqTimeStamp=new Date();if(_gui!==null){_gui.loading(true,true);}AWUtils.applyFunction(this,_dataLoader,[_instance,param]);};this.showData=function(data){if(data!==null&&_gui!==null){var listHolder=_gui.find(".aftnViewer-list-holder");var msgList=JQ('<div class="aftn-message-preview"></div>');msgList.attr("data-filter",true);msgList.attr("data-input",'#aftnViewer-filter-input');msgList.on("filterablefilter",_instance.updateMsgCounter);if(_msgTag!==null){data=data[_msgTag];}if(data!==undefined){if(Array.isArray(data)===false){data=[data];}JQ.each(data,function(idx,msg){var desc=AWUtils.applyFunction(this,_descriptFnc,[msg]);if(typeof desc==="string"){var msgListItem=JQ("<pre></pre>");msgListItem.html(desc);msgList.append(msgListItem);}else{msgList.append(desc);}});}else{msgList.append('<pre class="aftnViewer-nil-info">NIL</pre>');}if(_rqTimeStamp===null){_rqTimeStamp=new Date();}_gui.find(".aftnViewer-released .value").text(AWUtils.date2yyyymmdd(_rqTimeStamp)+" "+AWUtils.getTimeString(_rqTimeStamp,true));listHolder.empty();listHolder.append(msgList);listHolder.trigger("create");AWUtils.invokeLater(_instance.updateMsgCounter);AWLocale.processLocalisationOnJQElement(_gui);}};this.updateMsgCounter=function(){_gui.find(".aftnViewer-counter .value").text(_gui.find(".aftn-message-preview").children(":visible:not(.aftnViewer-nil-info)").length);};this.getGui=function(params){if(_gui===null){var group=JQ('<fieldset data-role="controlgroup" data-type="horizontal"></fieldset>');var refreshBtn=JQ('<button class="ui-btn ui-icon-refresh ui-btn-icon-notext"></button>');var infos=JQ('<div class="aftnViewer-infos"></div>');this.guiParams=params;_gui=JQ('<div class="aftnViewer"></div>');group.append('<input id="aftnViewer-filter-input" data-type="search" data-wrapper-class="controlgroup-textinput ui-btn">');group.append(refreshBtn);if(params!==undefined&&typeof params.requestFilter==="object"){_gui.append(params.requestFilter);params.requestFilter.on('change',_instance.loadData);}infos.append('<div class="aftnViewer-released"><span class="label">Released:</span><span class="value"></span></div>');infos.append('<div class="aftnViewer-counter"><span class="label">Count:</span><span class="value"></span></div>');_gui.append(group);_gui.append(infos);_gui.append('<div class="aftnViewer-list-holder"></div>');refreshBtn.click(_instance.loadData);if(_data!==null){_instance.showData(_data);}_instance.localize();}return _gui;};this.processDataMsg=function(data){if(_gui!==null){_gui.loading(false);}if(data===undefined){JQMUtil.showInfoMsg(getLocalizedString("Warning: No Messages Received"));data=null;}_instance.showData(data);_data=data;};this.processErrorMsg=function(message){if(_gui!==null){_gui.loading(false);}JQMUtil.showInfoMsg(message,true);};this.localize=function(){_gui.find('.aftnViewer-released .label').attr(AWLocale.LOCALISATION_KEY,'AftnViewer.released');_gui.find('.aftnViewer-counter .label').attr(AWLocale.LOCALISATION_KEY,'AftnViewer.msgCount');};}AftnMsgViewer.requestFilter=function(filter){var retVal=JQ('<div class="aftnViewer-requestFilter"></div>');retVal.append(filter);return retVal;};AftnMsgViewer.filters={date:function(id,label){var retVal=JQ('<input type="text" data-role="datebox" class="aftnViewer-filter-date" data-wrapper-class="aftnViewer-filter-date-wrapper" placeholder="Date"></input>');var opts={mode:"calbox",calControlGroup:true,overrideDateFormat:"%d.%m.%Y",overrideCalStartDay:1,theme:"a",themeDatePick:"b",useClearButton:true};retVal.attr("id",id);retVal.attr("data-options",JSON.stringify(opts));if(label!==undefined){retVal.attr(AWLocale.LOCALISATION_KEY,label);}return retVal;},options:function(localeKeyPrefix,values){var retVal=[];if(JQ.isArray(values)){JQ.each(values,function(i,value){var option=JQ('<option>');option.attr('value',value);option.attr(AWLocale.LOCALISATION_KEY,localeKeyPrefix+"."+value);retVal.push(option);});}return retVal;},select:function(id,label,options){var retVal=JQ('<select>');var labelOption=JQ('<option>');labelOption.attr(AWLocale.LOCALISATION_KEY,label);labelOption.val(null);retVal.attr('id',id);retVal.append(labelOption);retVal.append(options);return retVal;}};AftnMsgViewer.createStripLabelledValue=function(localeKey,customClass,value){var retVal=JQ('<div class="aftnViewer-strip-labelledValue"></div>');var labelObj=JQ('<span class="label"></span>');var valueObj=JQ('<span class="value"></span>');labelObj.attr(AWLocale.LOCALISATION_KEY,localeKey);valueObj.append(value);retVal.addClass(customClass);retVal.append(labelObj);retVal.append(valueObj);return retVal;};AftnMsgViewer.createStripLocalizedValue=function(localeKey){var retVal=JQ('<span>');retVal.attr(AWLocale.LOCALISATION_KEY,localeKey);return retVal;};(function(root,factory){if(typeof define==='function'&&define.amd){define(factory);}else if(typeof exports==='object'){module.exports=factory();}else{root.latinize=factory();}})(this,function(){function latinize(str){if(typeof str==='string'){return str.replace(/[^A-Za-z0-9]/g,function(x){return latinize.characters[x]||x;});}else{return str;}}latinize.characters={'':'A','':'A','':'A','':'A','':'A','':'A','':'A','':'A','':'A','':'A','':'A','':'A','':'A','':'A','':'A','':'A','':'A','':'A','':'A','':'A','':'A','':'A','':'A','':'A','':'A','':'A','':'A','':'A','':'A','':'A','':'AA','':'AE','':'AE','':'AE','':'AO','':'AU','':'AV','':'AV','':'AY','':'B','':'B','':'B','':'B','':'B','':'B','':'C','':'C','':'C','':'C','':'C','':'C','':'C','':'C','':'D','':'D','':'D','':'D','':'D','':'D','':'D','':'D','':'D','':'D','':'D','':'DZ','':'DZ','':'E','':'E','':'E','':'E','':'E','':'E','':'E','':'E','':'E','':'E','':'E','':'E','':'E','':'E','':'E','':'E','':'E','':'E','':'E','':'E','':'E','':'E','':'E','':'E','':'E','':'E','':'ET','':'F','':'F','':'G','':'G','':'G','':'G','':'G','':'G','':'G','':'G','':'G','':'H','':'H','':'H','':'H','':'H','':'H','':'H','':'H','':'H','':'I','':'I','':'I','':'I','':'I','':'I','':'I','':'I','':'I','':'I','':'I','':'I','':'I','':'I','':'I','':'I','':'I','':'D','':'F','':'G','':'R','':'S','':'T','':'IS','':'J','':'J','':'K','':'K','':'K','':'K','':'K','':'K','':'K','':'K','':'K','':'K','':'L','':'L','':'L','':'L','':'L','':'L','':'L','':'L','':'L','':'L','':'L','':'L','':'L','':'L','':'LJ','':'M','':'M','':'M','':'M','':'N','':'N','':'N','':'N','':'N','':'N','':'N','':'N','':'N','':'N','':'N','':'N','':'NJ','':'O','':'O','':'O','':'O','':'O','':'O','':'O','':'O','':'O','':'O','':'O','':'O','':'O','':'O','':'O','':'O','':'O','':'O','':'O','':'O','':'O','':'O','':'O','':'O','':'O','':'O','':'O','':'O','':'O','':'O','':'O','':'O','':'O','':'O','':'O','':'O','':'O','':'O','':'O','':'OI','':'OO','':'E','':'O','':'OU','':'P','':'P','':'P','':'P','':'P','':'P','':'P','':'Q','':'Q','':'R','':'R','':'R','':'R','':'R','':'R','':'R','':'R','':'R','':'R','':'R','':'C','':'E','':'S','':'S','':'S','':'S','':'S','':'S','':'S','':'S','':'S','':'S','':'ss','':'T','':'T','':'T','':'T','':'T','':'T','':'T','':'T','':'T','':'T','':'T','':'A','':'L','':'M','':'V','':'TZ','':'U','':'U','':'U','':'U','':'U','':'U','':'U','':'U','':'U','':'U','':'U','':'U','':'U','':'U','':'U','':'U','':'U','':'U','':'U','':'U','':'U','':'U','':'U','':'U','':'U','':'U','':'U','':'U','':'U','':'U','':'V','':'V','':'V','':'V','':'VY','':'W','':'W','':'W','':'W','':'W','':'W','':'W','':'X','':'X','':'Y','':'Y','':'Y','':'Y','':'Y','':'Y','':'Y','':'Y','':'Y','':'Y','':'Y','':'Y','':'Z','':'Z','':'Z','':'Z','':'Z','':'Z','':'Z','':'Z','':'Z','':'IJ','':'OE','':'A','':'AE','':'B','':'B','':'C','':'D','':'E','':'F','':'G','':'G','':'H','':'I','':'R','':'J','':'K','':'L','':'L','':'M','':'N','':'O','':'OE','':'O','':'OU','':'P','':'R','':'N','':'R','':'S','':'T','':'E','':'R','':'U','':'V','':'W','':'Y','':'Z','':'a','':'a','':'a','':'a','':'a','':'a','':'a','':'a','':'a','':'a','':'a','':'a','':'a','':'a','':'a','':'a','':'a','':'a','':'a','':'a','':'a','':'a','':'a','':'a','':'a','':'a','':'a','':'a','':'a','':'a','':'a','':'a','':'aa','':'ae','':'ae','':'ae','':'ao','':'au','':'av','':'av','':'ay','':'b','':'b','':'b','':'b','':'b','':'b','':'b','':'b','':'o','':'c','':'c','':'c','':'c','':'c','':'c','':'c','':'c','':'c','':'d','':'d','':'d','':'d','':'d','':'d','':'d','':'d','':'d','':'d','':'d','':'d','':'d','':'d','':'i','':'j','':'j','':'j','':'dz','':'dz','':'e','':'e','':'e','':'e','':'e','':'e','':'e','':'e','':'e','':'e','':'e','':'e','':'e','':'e','':'e','':'e','':'e','':'e','':'e','':'e','':'e','':'e','':'e','':'e','':'e','':'e','':'e','':'e','':'et','':'f','':'f','':'f','':'f','':'g','':'g','':'g','':'g','':'g','':'g','':'g','':'g','':'g','':'g','':'h','':'h','':'h','':'h','':'h','':'h','':'h','':'h','':'h','':'h','':'h','':'hv','':'i','':'i','':'i','':'i','':'i','':'i','':'i','':'i','':'i','':'i','':'i','':'i','':'i','':'i','':'i','':'i','':'i','':'d','':'f','':'g','':'r','':'s','':'t','':'is','':'j','':'j','':'j','':'j','':'k','':'k','':'k','':'k','':'k','':'k','':'k','':'k','':'k','':'k','':'k','':'l','':'l','':'l','':'l','':'l','':'l','':'l','':'l','':'l','':'l','':'l','':'l','':'l','':'l','':'l','':'l','':'l','':'lj','':'s','':'s','':'s','':'s','':'m','':'m','':'m','':'m','':'m','':'m','':'n','':'n','':'n','':'n','':'n','':'n','':'n','':'n','':'n','':'n','':'n','':'n','':'n','':'n','':'n','':'nj','':'o','':'o','':'o','':'o','':'o','':'o','':'o','':'o','':'o','':'o','':'o','':'o','':'o','':'o','':'o','':'o','':'o','':'o','':'o','':'o','':'o','':'o','':'o','':'o','':'o','':'o','':'o','':'o','':'o','':'o','':'o','':'o','':'o','':'o','':'o','':'o','':'o','':'o','':'o','':'oi','':'oo','':'e','':'e','':'o','':'o','':'ou','':'p','':'p','':'p','':'p','':'p','':'p','':'p','':'p','':'p','':'q','':'q','':'q','':'q','':'r','':'r','':'r','':'r','':'r','':'r','':'r','':'r','':'r','':'r','':'r','':'r','':'r','':'r','':'r','':'r','':'c','':'c','':'e','':'r','':'s','':'s','':'s','':'s','':'s','':'s','':'s','':'s','':'s','':'s','':'s','':'s','':'s','':'s','':'g','':'o','':'o','':'u','':'t','':'t','':'t','':'t','':'t','':'t','':'t','':'t','':'t','':'t','':'t','':'t','':'t','':'t','':'t','':'th','':'a','':'ae','':'e','':'g','':'h','':'h','':'h','':'i','':'k','':'l','':'m','':'m','':'oe','':'r','':'r','':'r','':'r','':'t','':'v','':'w','':'y','':'tz','':'u','':'u','':'u','':'u','':'u','':'u','':'u','':'u','':'u','':'u','':'u','':'u','':'u','':'u','':'u','':'u','':'u','':'u','':'u','':'u','':'u','':'u','':'u','':'u','':'u','':'u','':'u','':'u','':'u','':'u','':'u','':'ue','':'um','':'v','':'v','':'v','':'v','':'v','':'v','':'v','':'vy','':'w','':'w','':'w','':'w','':'w','':'w','':'w','':'w','':'x','':'x','':'x','':'y','':'y','':'y','':'y','':'y','':'y','':'y','':'y','':'y','':'y','':'y','':'y','':'y','':'z','':'z','':'z','':'z','':'z','':'z','':'z','':'z','':'z','':'z','':'z','':'z','':'z','':'z','':'ff','':'ffi','':'ffl','':'fi','':'fl','':'ij','':'oe','':'st','':'a','':'e','':'i','':'j','':'o','':'r','':'u','':'v','':'x','':'YO','':'I','':'TS','':'U','':'K','':'E','':'N','':'G','':'SH','':'SCH','':'Z','':'H','':"'",'':'yo','':'i','':'ts','':'u','':'k','':'e','':'n','':'g','':'sh','':'sch','':'z','':'h','':"'",'':'F','':'I','':'V','':'a','':'P','':'R','':'O','':'L','':'D','':'ZH','':'E','':'f','':'i','':'v','':'a','':'p','':'r','':'o','':'l','':'d','':'zh','':'e','':'Ya','':'CH','':'S','':'M','':'I','':'T','':"'",'':'B','':'YU','':'ya','':'ch','':'s','':'m','':'i','':'t','':"'",'':'b','':'yu'};return latinize;});function IbafDataHandler(){}IbafDataHandler.token;IbafDataHandler.setToken=function(token){IbafDataHandler.token=token;};function createIbafSoapRequest(methodName,jsonData){var x2js=new X2JS();var retVal='<?xml version="1.0" encoding="utf-8" ?>';var nsJsonData={};if(jsonData!==undefined&&jsonData!==null&&typeof jsonData==="object"){JQ.each(jsonData,function(attr,val){if(val!==null){nsJsonData["mob:"+attr]=val;}});}retVal+='<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:mob="http://mobiltech.sk/">';retVal+='<soapenv:Body>';retVal+='<mob:'+methodName+'Request>';retVal+=x2js.json2xml_str(nsJsonData);retVal+='</mob:'+methodName+'Request>';retVal+='</soapenv:Body>';retVal+='</soapenv:Envelope>';return retVal;}IbafDataHandler.getCurrentSessionId=function(){return(IbafDataHandler.token)?IbafDataHandler.token:null;};IbafDataHandler.processResponse=function(methodName,xhr,callbackFnc,errCallbackFnc){var retVal;const x2js=new X2JS();try{var obj=x2js.xml2json(xhr.responseXML);var body=obj.Envelope.Body;if(body.Fault!==undefined){AWUtils.applyFunction(this,errCallbackFnc,[body.Fault.faultstring]);}else{var response=body[methodName+"Response"];retVal=response[Object.keys(response)[0]];delete retVal.__prefix;if(retVal.IsError!==undefined&&retVal.IsError.toString()==="1"){var errMsg=(retVal.ErrorMsg===undefined)?'':retVal.ErrorMsg.toString();var errCode=(retVal.ErrorCode===undefined)?'':retVal.ErrorCode.toString();debug("IbafDataHandler received error from ibafWS. ("+errMsg+")");if(errMsg==="Invalid UserSession"){JQMUtil.showInfoMsg(getLocalizedString("Messages.sessionError"),true,function(){window.location.reload();});}else{AWUtils.applyFunction(this,errCallbackFnc,[errMsg,errCode]);}}else{AWUtils.applyFunction(this,callbackFnc,[retVal]);}}}catch(e){var msg=(e.message)?e.message:(e)?"IBAF WS: "+e:"Undefined error while loading data from IBAF service.";AWUtils.applyFunction(this,errCallbackFnc,[msg]);}};function callIbafWs(methodName,params,callbackFnc,errCallbackFnc){JQ.ajax({url:(config.ibafDataHandlerUrl!==undefined)?config.ibafDataHandlerUrl:"ibafws/wservice.php",type:"POST",dataType:"xml",data:createIbafSoapRequest(methodName,params),contentType:"text/xml; charset=\"utf-8\"",success:function(data,statusText,xhr){IbafDataHandler.processResponse(methodName,xhr,callbackFnc,errCallbackFnc);},error:function(xmlHttpRequest,textStatus,errorThrown){debug("IBAF DataHandler communication failed!");AWUtils.applyFunction(this,errCallbackFnc,[textStatus,xmlHttpRequest]);}});};IbafDataHandler.callIbafWs=function(methodName,params,callbackFnc,errCallbackFnc){callIbafWs(methodName,params,callbackFnc,errCallbackFnc);};IbafDataHandler.ibafUserLogin=function(userName,password,callbackFnc,errCallbackFnc){var params={"LoginName":userName,"LoginPwd":password};callIbafWs("IBAFUserLogin",params,callbackFnc,errCallbackFnc);};IbafDataHandler.getADServices=function(adCode,callbackFnc,errCallbackFnc){var sessionId=IbafDataHandler.getCurrentSessionId();var params={"ICAOCode":adCode,"UserSession":sessionId};callIbafWs("ADServices",params,callbackFnc,errCallbackFnc);};IbafDataHandler.getADMetar=function(params,callbackFnc,errCallbackFnc){params=params||{};params.UserSession=IbafDataHandler.getCurrentSessionId();callIbafWs("ADMetar",params,callbackFnc,errCallbackFnc);};IbafDataHandler.getADTaf=function(params,callbackFnc,errCallbackFnc){params=params||{};params.UserSession=IbafDataHandler.getCurrentSessionId();callIbafWs("ADTaf",params,callbackFnc,errCallbackFnc);};IbafDataHandler.getADSigmet=function(params,callbackFnc,errCallbackFnc){params=params||{};params.UserSession=IbafDataHandler.getCurrentSessionId();callIbafWs("ADSigmet",params,callbackFnc,errCallbackFnc);};IbafDataHandler.getRegionalQnh=function(params,callbackFnc,errCallbackFnc){params=params||{};params.UserSession=IbafDataHandler.getCurrentSessionId();callIbafWs("RegionalQNH",params,callbackFnc,errCallbackFnc);};IbafDataHandler.getRegionalForecast=function(params,callbackFnc,errCallbackFnc){params=params||{};params.UserSession=IbafDataHandler.getCurrentSessionId();callIbafWs("RegionalForecast",params,callbackFnc,errCallbackFnc);};IbafDataHandler.getCheckF18Indicators=function(params,callbackFnc,errCallbackFnc){params=params||{};params.UserSession=IbafDataHandler.getCurrentSessionId();callIbafWs("CheckF18Indicators",params,callbackFnc,errCallbackFnc);};function getFplList(hoursAfterEta,aARCID,aADEP,aADES,aFlRules,aPageNum,aItemsCount,aOwnFls,aOrderColumn,aOrderType,callbackFnc,errCallbackFnc){debug('getFplList:  hoursAfterEta="'+hoursAfterEta+'"');var sessionId=IbafDataHandler.getCurrentSessionId();var params={"NumHoursAfterETA":hoursAfterEta,"UserSession":sessionId,"PageNumber":aPageNum,"PageItems":aItemsCount,"ARCID":aARCID,"ADEP":aADEP,"ADES":aADES,"FlRules":aFlRules,"OwnFls":aOwnFls,"OrderColumn":aOrderColumn,"OrderType":aOrderType};callIbafWs("GetFPLList",params,callbackFnc,errCallbackFnc);}function getFplArchive(EOBTFrom,EOBTTill,aARCID,aADEP,aADES,aFlRules,aPageNum,aItemsCount,aOwnFls,aOrderColumn,aOrderType,callbackFnc,errCallbackFnc){var sessionId=IbafDataHandler.getCurrentSessionId();var params={"UserSession":sessionId,"PageNumber":aPageNum,"PageItems":aItemsCount,"ARCID":aARCID,"ADEP":aADEP,"ADES":aADES,"FlRules":aFlRules,"OwnFls":aOwnFls,"OrderColumn":aOrderColumn,"OrderType":aOrderType};if(HtmlUtils.isUndefinedOrIsNull(aARCID)===true){delete params["ARCID"];}if(HtmlUtils.isUndefinedOrIsNull(aADEP)===true){delete params["ADEP"];}if(HtmlUtils.isUndefinedOrIsNull(aADES)===true){delete params["ADES"];}if(HtmlUtils.isUndefinedOrIsNull(aFlRules)===true){delete params["FlRules"];}if(EOBTFrom!==null){params["EOBTFrom"]=EOBTFrom;}if(EOBTTill!==null){params["EOBTTill"]=EOBTTill;}callIbafWs("GetFPLArchive",params,callbackFnc,errCallbackFnc);}IbafDataHandler.saveFlTpl=function(aFlTplValues,callbackFnc,errCallbackFnc){var sessionId=IbafDataHandler.getCurrentSessionId();var params={"FlTplValues":aFlTplValues,"UserSession":sessionId};callIbafWs("SaveFlTpl",params,callbackFnc,errCallbackFnc);};IbafDataHandler.getFlTplList=function(callbackFnc,errCallbackFnc){var sessionId=IbafDataHandler.getCurrentSessionId();var params={"UserSession":sessionId};callIbafWs("GetFlTplList",params,callbackFnc,errCallbackFnc);};IbafDataHandler.deleteFlTpl=function(aTplId,callbackFnc,errCallbackFnc){var sessionId=IbafDataHandler.getCurrentSessionId();var params={"UserSession":sessionId,"TplId":aTplId};callIbafWs("DeleteFlTpl",params,callbackFnc,errCallbackFnc);};IbafDataHandler.getFlTpl=function(aTplId,callbackFnc,errCallbackFnc){var sessionId=IbafDataHandler.getCurrentSessionId();var params={"UserSession":sessionId,"TplId":aTplId};callIbafWs("GetFlTpl",params,callbackFnc,errCallbackFnc);};function setFlDeleted(aFplId,callbackFnc,errCallbackFnc){var sessionId=IbafDataHandler.getCurrentSessionId();var params={"UserSession":sessionId,"FlId":aFplId};callIbafWs("SetFlDeleted",params,callbackFnc,errCallbackFnc);}function checkFplValidity(fplParams,useNMB2BFlag,callbackFnc,errCallbackFnc){var sessionId=IbafDataHandler.getCurrentSessionId();var params={FlAttributes:fplParams,UseNMB2B:useNMB2BFlag,UserSession:sessionId};callIbafWs("CheckFplValidity",params,callbackFnc,errCallbackFnc);}function proposeFplRoute(fplParams,callbackFnc,errCallbackFnc){var sessionId=IbafDataHandler.getCurrentSessionId();var params={FlAttributes:fplParams,UserSession:sessionId};callIbafWs("ProposeFplRoute",params,callbackFnc,errCallbackFnc);}function sendFplToCaro(fplParams,useNMB2BFlag,callbackFnc,errCallbackFnc){var sessionId=IbafDataHandler.getCurrentSessionId();var params={FlAttributes:fplParams,UseNMB2B:useNMB2BFlag,UserSession:sessionId};callIbafWs("SendFplToCaro",params,callbackFnc,errCallbackFnc);}function sendDLA(fplId,eobtVal,callbackFnc,errCallbackFnc){var sessionId=IbafDataHandler.getCurrentSessionId();var params={FlId:fplId,EobtVal:eobtVal,UserSession:sessionId};callIbafWs("SendDLA",params,callbackFnc,errCallbackFnc);}function sendCNL(fplId,callbackFnc,errCallbackFnc){var sessionId=IbafDataHandler.getCurrentSessionId();var params={FlId:fplId,UserSession:sessionId};callIbafWs("SendCNL",params,callbackFnc,errCallbackFnc);}function sendDEP(fplId,atdVal,callbackFnc,errCallbackFnc){var sessionId=IbafDataHandler.getCurrentSessionId();var params={FlId:fplId,AtdVal:atdVal,UserSession:sessionId};callIbafWs("SendDEP",params,callbackFnc,errCallbackFnc);}function sendARR(fplId,ataVal,divAd,nonIcaoDivAd,callbackFnc,errCallbackFnc){var sessionId=IbafDataHandler.getCurrentSessionId();var params={FlId:fplId,AtaVal:ataVal,DivAD:divAd,NonIcaoDivAD:nonIcaoDivAd,UserSession:sessionId};callIbafWs("SendARR",params,callbackFnc,errCallbackFnc);}function sendCHG(fplId,fplParams,callbackFnc,errCallbackFnc){var sessionId=IbafDataHandler.getCurrentSessionId();var params={FlId:fplId,FlAttributes:fplParams,UserSession:sessionId};callIbafWs("SendCHG",params,callbackFnc,errCallbackFnc);}IbafDataHandler.getMeteoRadars=function(callbackFnc,errCallbackFnc){var sessionId=IbafDataHandler.getCurrentSessionId();var params={"UserSession":sessionId};callIbafWs("GetMeteoRadars",params,callbackFnc,errCallbackFnc);};IbafDataHandler.getMeteoImg=function(imgId,callbackFnc,errCallbackFnc){var sessionId=IbafDataHandler.getCurrentSessionId();var params={"ImgId":imgId,"UserSession":sessionId};callIbafWs("GetMeteoImg",params,callbackFnc,errCallbackFnc);};IbafDataHandler.getMeteoImgHistory=function(productId,time,history,order,callbackFnc,errCallbackFnc){var sessionId=IbafDataHandler.getCurrentSessionId();var params={"ProductId":productId,"TillTime":time,"ImgHistory":history,"AscOrder":order,"UserSession":sessionId};callIbafWs("GetMeteoImgHistory",params,callbackFnc,errCallbackFnc);};IbafDataHandler.getAdDocumentList=function(icaoCode,categoryGroup,callbackFnc,errCallbackFnc){var params={"ICAOCode":icaoCode,"UserSession":IbafDataHandler.getCurrentSessionId()};if(categoryGroup){params.CategoryGroup=categoryGroup;}callIbafWs("ADDocumentsList",params,callbackFnc,errCallbackFnc);};IbafDataHandler.getDocCategories=function(catGroup,callbackFnc,errCallbackFnc){var sessionId=IbafDataHandler.getCurrentSessionId();var params={"UserSession":sessionId};if(catGroup!==null){params.CategoryGroup=catGroup;}callIbafWs("DocCategoryList",params,callbackFnc,errCallbackFnc);};IbafDataHandler.getDocumentList=function(categoryId,futureFlag,callbackFnc,errCallbackFnc){var sessionId=IbafDataHandler.getCurrentSessionId();var params={"CategoryId":categoryId,"UserSession":sessionId};if(futureFlag!==null){params.FutureFlg=(futureFlag)?1:0;}callIbafWs("CatDocumentList",params,callbackFnc,errCallbackFnc);};IbafDataHandler.getDocument=function(documentId,callbackFnc,errCallbackFnc){var sessionId=IbafDataHandler.getCurrentSessionId();var params={"DocumentId":documentId,"UserSession":sessionId};callIbafWs("GetDocument",params,callbackFnc,errCallbackFnc);};IbafDataHandler.getEAIM=function(data,callbackFnc,errCallbackFnc){var sessionId=IbafDataHandler.getCurrentSessionId();var params={"UserSession":sessionId};JQ.extend(params,data);callIbafWs("GetEAIM",params,callbackFnc,errCallbackFnc);};IbafDataHandler.getERegulations=function(data,callbackFnc,errCallbackFnc){var sessionId=IbafDataHandler.getCurrentSessionId();var params={"UserSession":sessionId};JQ.extend(params,data);callIbafWs("GetERegulations",params,callbackFnc,errCallbackFnc);};IbafDataHandler.getERegulationByFlId=function(fplId,callbackFnc,errCallbackFnc){var sessionId=IbafDataHandler.getCurrentSessionId();var params={"FlId":fplId,"UserSession":sessionId};callIbafWs("GetERegulationByFlId",params,callbackFnc,errCallbackFnc);};function getFlMsgList(aFlId,aCallBackFnc,aErrorCallBackFnc){var sessionId=IbafDataHandler.getCurrentSessionId();var params={"FlId":aFlId,"UserSession":sessionId};callIbafWs("GetFlMsgList",params,aCallBackFnc,aErrorCallBackFnc);}IbafDataHandler.getSynopStations=function(aCallBackFnc,aErrorCallBackFnc){var sessionId=IbafDataHandler.getCurrentSessionId();var params={"UserSession":sessionId};callIbafWs("GetSynopStations",params,aCallBackFnc,aErrorCallBackFnc);};IbafDataHandler.getSynopMsg=function(date,history,icaoCode,wmoCode,aCallBackFnc,aErrorCallBackFnc){var sessionId=IbafDataHandler.getCurrentSessionId();date=AWUtils.date2yyyymmdd(date);var params={"ValidityDate":date,"MsgHistory":history,"ICAOCode":icaoCode,"WMOCode":wmoCode,"UserSession":sessionId};callIbafWs("GetSynopMsg",params,aCallBackFnc,aErrorCallBackFnc);};IbafDataHandler.getMetMsg=function(params,aCallBackFnc,aErrorCallBackFnc){params=params||{};params.UserSession=IbafDataHandler.getCurrentSessionId();callIbafWs("GetMetMsg",params,aCallBackFnc,aErrorCallBackFnc);};IbafDataHandler.getVAAdvisory=function(vaac,date,history,volcanoNum,aCallBackFnc,aErrorCallBackFnc){var sessionId=IbafDataHandler.getCurrentSessionId();date=AWUtils.date2yyyymmdd(date);var params={"VAAC":vaac,"VAADate":date,"MsgHistory":history,"VolcanoNum":volcanoNum,"UserSession":sessionId};callIbafWs("GetVAAdvisory",params,aCallBackFnc,aErrorCallBackFnc);};IbafDataHandler.userRegistration=function(data,aCallBackFnc,aErrorCallBackFnc){var params={"UserType":data.userType,"LoginName":data.loginName,"LoginPwd":data.loginPwd,"UserEmail":data.userEmail,"UserName":data.userName,"UserSurname":data.userSurname,"UserPhone":data.userPhone,"City":data.city,"Street":data.street,"PostCode":data.postCode,"CountryCode":data.countryCode,"PilotAttributes":data.pilotAttributes,"Newsletter":(data.newsletter)?"1":"0"};if(data.pilotAttributes&PilotAttributes.IFR_MASK){params.PilotLicense=data.pilotLicense;}if(data.pilotAttributes&PilotAttributes.DRONE_MASK){params.DroneId=data.droneId;}callIbafWs("UserRegistration",params,aCallBackFnc,aErrorCallBackFnc);};IbafDataHandler.ibafUserChangePwd=function(oldPwd,newPwd,aCallBackFnc,aErrorCallBackFnc){var sessionId=IbafDataHandler.getCurrentSessionId();var params={"UserSession":sessionId,"OldLoginPwd":oldPwd,"NewLoginPwd":newPwd};callIbafWs("IBAFUserChangePwd",params,aCallBackFnc,aErrorCallBackFnc);};IbafDataHandler.ibafSetPwdToken=function(token,newPwd,aCallBackFnc,aErrorCallBackFnc){var params={"Token":token,"NewLoginPwd":newPwd};callIbafWs("IBAFSetPwdToken",params,aCallBackFnc,aErrorCallBackFnc);};IbafDataHandler.ibafUserChangeProfile=function(data,aCallBackFnc,aErrorCallBackFnc){var sessionId=IbafDataHandler.getCurrentSessionId();var params={"UserSession":sessionId,"UserType":data.userType,"LoginName":data.loginName,"LoginPwd":data.loginPwd,"UserEmail":data.userEmail,"UserName":data.userName,"UserSurname":data.userSurname,"UserPhone":data.userPhone,"City":data.city,"Street":data.street,"PostCode":data.postCode,"CountryCode":data.countryCode,"PilotAttributes":data.pilotAttributes,"Newsletter":(data.newsletter)?"1":"0"};if(data.pilotAttributes&PilotAttributes.VFR_MASK||data.pilotAttributes&PilotAttributes.IFR_MASK){params.PilotLicense=(data.pilotLicense.length>0)?data.pilotLicense:"PL000";}if(data.pilotAttributes&PilotAttributes.DRONE_MASK){params.DroneId=data.droneId;}callIbafWs("IBAFUserChangeProfile",params,aCallBackFnc,aErrorCallBackFnc);};IbafDataHandler.ibafUserChangeDroneId=function(droneIds,aCallBackFnc,aErrorCallBackFnc){if(droneIds){var params={UserSession:IbafDataHandler.getCurrentSessionId(),DroneId:droneIds};callIbafWs("IBAFUserChangeDroneId",params,aCallBackFnc,aErrorCallBackFnc);}};IbafDataHandler.ibafGetLostPwd=function(email,aCallBackFnc,aErrorCallBackFnc){var params={"UserEmail":email};callIbafWs("IBAFGetLostPwd",params,aCallBackFnc,aErrorCallBackFnc);};function IbafUtils(){}IbafUtils.loadElement=function(methodFunc,params,formatterFnc,element){if(methodFunc!==undefined&&params!==undefined&&JQ.isArray(params)&&element!==undefined){if(element instanceof jQuery===false){element=JQ(element);}var callbackFnc=function(data){element.loading(false);var content=AWUtils.applyFunction(this,formatterFnc,[data]);element.html(content);};var errorFnc=function(msg){element.loading(false);JQMUtil.showInfoMsg(msg,true,true);element.text("Loading error!");};params.push(callbackFnc);params.push(errorFnc);AWUtils.applyFunction(this,methodFunc,params);}};IbafUtils.defaultMetFormatter=function(data){var retVal=JQ('<div class="aftn-message-preview ibaf-met-message"></div>');if(data!==undefined){if(data.MetMsg!==undefined&&JQ.isArray(data.MetMsg)===false){data.MetMsg=[data.MetMsg];}if(data.MetMsg!==undefined&&data.MetMsg.length>0){JQ.each(data.MetMsg,function(index,msg){var msgPre=JQ("<pre></pre>");msgPre.text(msg.MsgTxt.toString());retVal.append(msgPre);});}else{retVal.addClass("ibaf-nil-message");retVal.html("NIL");}}return retVal;};IbafUtils.parseUtcDateString=function(dateStr){var retVal;if(typeof dateStr==="string"){var length=dateStr.length;var lastChar=dateStr.slice(-1);if(length===19&&lastChar!=="Z"){dateStr+="Z";}else if(length===16&&lastChar!=="Z"){dateStr+="Z";}else if(length>20&&length<24&&lastChar!=="Z"){dateStr+="Z";}retVal=new Date(dateStr);retVal=(isNaN(retVal))?undefined:retVal;}else{retVal=dateStr;}return retVal;};IbafUtils.getValue=function(attribute,defaultValue=null,prefix="",suffix=""){let retVal=defaultValue;if(typeof attribute==="object"&&typeof attribute.toString==="function"&&attribute.toString()!==Object.prototype.toString()){retVal=""+prefix+attribute.toString()+suffix;}return retVal;};function LogoutForm(){}LogoutForm.create=function(){var retVal=JQ('<div data-role="popup" data-theme="a" data-overlay-theme="b" class="closePopup" id="logoutPopup"></div>');var text=JQ('<div class="text">Do you really want to logout?</div>');var yesBtn=JQ('<input id="userLogoutYesButton" type="button" value="Yes" />');var noBtn=JQ('<input id="userLogoutNoButton" type="button" value="No" />');var blockA=JQ('<div class="ui-block-a block"></div>');var blockB=JQ('<div class="ui-block-b block"></div>');var popupGrid=JQ('<div class="ui-grid-a "></div>');text.attr(AWLocale.LOCALISATION_KEY,"LogoutPanel.text");yesBtn.attr(AWLocale.LOCALISATION_KEY,"LogoutPanel.yesBtn");noBtn.attr(AWLocale.LOCALISATION_KEY,"LogoutPanel.noBtn");retVal.append(text);yesBtn.click(function(){retVal.popup("close");AWDataHandler.userLogout();});noBtn.click(function(){retVal.popup("close");});blockA.append(yesBtn);blockB.append(noBtn);popupGrid.append(blockA);popupGrid.append(blockB);retVal.append(popupGrid);AWLocale.processLocalisationOnJQElement(retVal);return retVal;};OpenLayers.Tile.AnimatedImage=OpenLayers.Class(OpenLayers.Tile.Image,{initImage:function(){if(!this.url&&!this.imgDiv){this.isLoading=false;return;}this.events.triggerEvent('beforeload');this.layer.div.appendChild(this.getTile());var img=this.getImage();var src=img.getAttribute('src')||'';this.hide();if(this.url&&OpenLayers.Util.isEquivalentUrl(src,this.url)){this._loadTimeout=window.setTimeout(OpenLayers.Function.bind(this.onImageLoad,this),0);}else{this.stopLoading();if(this.crossOriginKeyword){img.removeAttribute("crossorigin");}OpenLayers.Event.observe(img,"load",OpenLayers.Function.bind(this.onImageLoad,this));OpenLayers.Event.observe(img,"error",OpenLayers.Function.bind(this.onImageError,this));this.imageReloadAttempts=0;if(this.url!==undefined&&this.url!==null){this.imgDiv.src=this.url;}}},draw:function(){var shouldDraw=true;if(shouldDraw){if(this.layer!=this.layer.map.baseLayer&&this.layer.reproject){this.bounds=this.getBoundsFromBaseLayer(this.position);}if(this.isLoading){this._loadEvent="reload";}else{this.isLoading=true;this._loadEvent="loadstart";}this.renderTile();this.positionTile();}else if(shouldDraw===false){this.unload();}return shouldDraw;},renderTile:function(){this.initImage();},onImageLoad:function(){var img=this.imgDiv;this.stopLoading();img.style.visibility='hidden';img.style.opacity=this.layer.opacity;this.isLoading=false;this.canvasContext=null;this.events.triggerEvent("loadend");OpenLayers.Element.removeClass(img,"olImageLoadError");if(this.layerAlphaHack===true){img.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+img.src+"', sizingMethod='scale')";}},onImageError:function(){var img=this.imgDiv;if(img.src!=null&&this.url!==null){this.imageReloadAttempts++;if(this.imageReloadAttempts<=OpenLayers.IMAGE_RELOAD_ATTEMPTS){this.imgDiv.src=this.url;}else{OpenLayers.Element.addClass(img,"olImageLoadError");this.events.triggerEvent("loaderror");this.onImageLoad();}}},hide:function(){if(this.imgDiv!==null){this.imgDiv.style.visibility='hidden';}},show:function(){if(this.imgDiv!==null){this.imgDiv.style.visibility=null;}},CLASS_NAME:"OpenLayers.Tile.AnimatedImage"});OpenLayers.Layer.AnimatedImageLayer=OpenLayers.Class(OpenLayers.Layer.Image,{isBaseLayer:false,redrawInterval:1,frames:[],tiles:[],timerId:null,frameIndex:-1,initialize:function(name,extent,size,options){this.extent=extent;this.maxExtent=extent;this.size=size;OpenLayers.Layer.prototype.initialize.apply(this,[name,options]);this.aspectRatio=(this.extent.getHeight()/this.size.h)/(this.extent.getWidth()/this.size.w);this.events.register("visibilitychanged",this,function(){if(this.visibility){this.startAnimation();}else{this.stopAnimation();}});},setFramesArr:function(arr){if(JQ.isArray(arr)){this.frames=arr;this.tiles=[];JQ(this.div).empty();for(var i=0;i<this.frames.length;i++){var frameObj=this.frames[i];var extent=(frameObj!==undefined&&frameObj.extent!==undefined)?frameObj.extent:this.extent;var ulPx=this.map.getLayerPxFromLonLat({lon:extent.left,lat:extent.top});var size=(frameObj!==undefined&&frameObj.size!==undefined)?frameObj.size:this.size;var tile=new OpenLayers.Tile.AnimatedImage(this,ulPx,extent,null,size);tile.url=frameObj.url;tile.dateTime=frameObj.time;tile.frameObj=frameObj;this.addTileMonitoringHooks(tile);if(i===0){this.setTileSize();}tile.draw();this.tiles.push(tile);}if(this.visibility&&this.timerId===null){this.startAnimation();}}},showNextFrame:function(){this.frameIndex++;if(this.frameIndex>=this.tiles.length){if(this.infiniteLoop){this.frameIndex=0;}else{this.stopAnimation();this.frameIndex=-1;return;}}if(this.frameIndex<=0){this.hideFrame(this.tiles.length-1);}else{this.hideFrame(this.frameIndex-1);}var tile=this.tiles[this.frameIndex];var evtParams={dateTime:tile.dateTime,tile:tile};tile.show();this.events.triggerEvent("frameChanged",evtParams);},startAnimation:function(){var instance=this;if(this.timerId!==null){return;}if(instance.tiles.length>0){this.events.triggerEvent("animationStarted");this.timerId=setInterval(function(){instance.showNextFrame();},this.redrawInterval*1000);}},stopAnimation:function(){if(this.timerId!==null){clearInterval(this.timerId);this.timerId=null;this.events.triggerEvent("animationStopped");}},hideFrame:function(index){if(this.tiles[index]){this.tiles[index].hide();}},isAnimationStarted:function(){return(this.timerId!==null);},getURL:function(bounds){return this.url;},moveTo:function(bounds,zoomChanged,dragging){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);if(zoomChanged&&this.tiles.length>0){for(var idx=0;idx<this.tiles.length;idx++){var tile=this.tiles[idx];this.setTileSize();if(tile!==undefined){var frameObj=this.frames[this.frameIndex];var extent=(frameObj!==undefined&&frameObj.extent!==undefined)?frameObj.extent:this.extent;var ulPx=this.map.getLayerPxFromLonLat({lon:extent.left,lat:extent.top});var size=(frameObj!==undefined&&frameObj.size!==undefined)?frameObj.size:this.size;tile.size=size.clone();tile.position=ulPx.clone();tile.positionTile();}}}},setTileSize:function(){var frameObj=this.frames[this.frameIndex];var extent=(frameObj!==undefined&&frameObj.extent!==undefined)?frameObj.extent:this.extent;var tileWidth=extent.getWidth()/this.map.getResolution();var tileHeight=extent.getHeight()/this.map.getResolution();this.tileSize=new OpenLayers.Size(tileWidth,tileHeight);},CLASS_NAME:"OpenLayers.Layer.AnimatedImageLayer"});